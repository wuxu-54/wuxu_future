# ssh 配置

使用 SSH 方式进行 Git 上传（push）和下载（clone/pull）是一种安全且便捷的方式，无需每次操作都输入密码。以下是详细步骤：

## 一、准备工作：配置 SSH 密钥

1. **检查是否已有 SSH 密钥**  
   打开终端，输入以下命令查看是否存在密钥文件：

   ```bash
   ls -la ~/.ssh
   ```

   如果看到 `id_rsa` 和 `id_rsa.pub`（或 `id_ed25519` 和 `id_ed25519.pub`），说明已有密钥，可直接跳到步骤 3。

2. **生成新的 SSH 密钥**  
   若没有密钥，输入以下命令生成（替换为你的 GitHub 绑定邮箱）：

   ```bash
   ssh-keygen -t ed25519 -C "your_email@example.com"
   ```

   按回车默认保存路径（`~/.ssh/id_ed25519`），无需设置密码（直接回车跳过）。

3. **复制公钥内容**  
   输入以下命令查看并复制公钥：

   ```bash
   cat ~/.ssh/id_ed25519.pub  # 或 id_rsa.pub（根据实际文件名）
   ```

   复制输出的全部内容（以 `ssh-ed25519` 或 `ssh-rsa` 开头，邮箱结尾）。

4. **将公钥添加到 GitHub**  
   - 登录 GitHub，进入 Settings → SSH and GPG keys → New SSH key  
   - 填写 Title（如“我的笔记本”），粘贴公钥到 Key 框，点击 Add SSH key。

## 二、使用 SSH 方式操作仓库

### 1. **克隆（下载）仓库**  

   从 GitHub 仓库页面获取 SSH 地址（格式：`git@github.com:用户名/仓库名.git`），然后克隆：

   ```bash
   git clone git@github.com:用户名/仓库名.git
   ```

   例如：

   ```bash
   git clone git@github.com:wuxu-54/wuxu_future.git
   ```

### 2. **上传（推送）代码**  

   进入已克隆的仓库目录，完成修改后推送：

   ```bash
   # 添加修改到暂存区
   git add .

   # 提交修改
   git commit -m "描述修改内容"

   # 推送到远程仓库（默认推送到 main 分支，根据实际分支名调整）
   git push origin main
   ```

### 3. **拉取（更新）远程代码**  

   获取远程仓库的最新修改：

   ```bash
   git pull origin main  # 拉取 main 分支的更新
   ```

## 三、常见问题解决

- **首次连接提示“是否继续连接”**：输入 `yes` 并回车即可。
- **权限错误（Permission denied）**：  
  检查公钥是否正确添加到 GitHub，或重新生成密钥并重新配置。
- **切换远程地址为 SSH**：  
  若已用 HTTPS 克隆仓库，可切换为 SSH：

  ```bash
  git remote set-url origin git@github.com:用户名/仓库名.git
  ```

通过 SSH 方式操作后，后续 push/pull 无需重复验证，操作更高效。

---

出现 "Permission denied (publickey)" 错误，说明 SSH 密钥认证失败，导致无法连接到 GitHub 仓库。这通常是由于 SSH 密钥未正确配置或权限设置问题导致的，解决方法如下：

## 1. 检查 SSH 密钥是否被正确加载

首先确认你的 SSH 密钥是否被 ssh-agent 正确管理：

```bash
# 启动 ssh-agent
eval "$(ssh-agent -s)"

# 将私钥添加到 agent（替换为你的私钥文件名，通常是 id_ed25519 或 id_rsa）
ssh-add ~/.ssh/id_ed25519
```

如果出现 "Could not open a connection to your authentication agent" 错误，先执行：

```bash
ssh-agent bash
```

再重新执行 `ssh-add` 命令。

## 2. 验证 SSH 连接是否正常

运行以下命令测试与 GitHub 的 SSH 连接：

```bash
ssh -T git@github.com
```

如果配置正确，会显示类似信息：

```txt
Hi 你的用户名! You've successfully authenticated, but GitHub does not provide shell access.
```

如果仍提示权限错误，继续下一步排查。

## 3. 检查公钥是否正确添加到 GitHub

- 重新查看本地公钥内容：

  ```bash
  cat ~/.ssh/id_ed25519.pub  # 或 id_rsa.pub
  ```

- 登录 GitHub，进入 **Settings → SSH and GPG keys**，确认已添加的 SSH 密钥与本地公钥完全一致（包括开头的 `ssh-ed25519` 和结尾的邮箱）。
- 若不一致或未添加，点击 **New SSH key** 重新添加。

## 4. 检查仓库权限与地址

- 确认你有权限访问该仓库（是仓库所有者或已被添加为协作者）。
- 检查本地仓库的远程地址是否正确（SSH 格式）：

  ```bash
  git remote -v
  ```

  正确格式应为：`git@github.com:用户名/仓库名.git`  
  若地址错误，重新设置：

  ```bash
  git remote set-url origin git@github.com:wuxu-54/wuxu_future.git
  ```

## 5. 权限或文件所有权问题（Linux/macOS）

如果是文件权限设置不当导致的，修复 `.ssh` 目录及文件的权限：

```bash
# 设置 .ssh 目录权限（仅当前用户可读写）
chmod 700 ~/.ssh

# 设置私钥文件权限
chmod 600 ~/.ssh/id_ed25519  # 替换为你的私钥文件名

# 设置公钥和 known_hosts 文件权限
chmod 644 ~/.ssh/id_ed25519.pub ~/.ssh/known_hosts
```

完成以上步骤后，再次尝试 `git push` 或 `git pull` 即可。如果问题仍存在，建议重新生成 SSH 密钥并重复配置步骤（可能是密钥文件损坏导致的）。
