# external

在 Dart 中，`external` 关键字主要用于以下两种重要场景：定义外部函数和外部类成员，下面为你详细介绍。

## 1. 外部函数

### 1.1 作用

`external` 关键字用于声明一个外部函数。外部函数是指其实现不在 Dart 代码中，而是由其他编程语言（如 C、C++）实现，或者由 Dart 运行时环境提供。这种机制允许 Dart 代码与底层系统进行交互，比如调用操作系统的 API 或使用原生库。

### 1.2 语法

```dart
// 返回类型 函数名(参数列表);
external 返回类型 函数名(参数列表);
```

### 1.3 示例

以下是一个简单示例，假设我们要调用一个外部的 C 语言函数来进行字符串的打印。

```dart
// 声明一个外部函数
external void printMessage(String message);

void main() {
  printMessage('Hello from Dart!');
}
```

在实际应用中，要让这个代码正常工作，还需要使用 FFI（Foreign Function Interface）来连接 Dart 代码和 C 代码。下面是一个完整的使用 FFI 的示例：

```dart
import 'dart:ffi';
import 'package:ffi/ffi.dart';

// 加载动态库
final DynamicLibrary nativeAddLib = Platform.isWindows
    ? DynamicLibrary.open('native_add.dll')
    : DynamicLibrary.open('libnative_add.so');

// 声明外部函数
typedef PrintMessageNative = Void Function(Pointer<Utf8>);
typedef PrintMessageDart = void Function(Pointer<Utf8>);

final PrintMessageDart printMessage = nativeAddLib
    .lookup<NativeFunction<PrintMessageNative>>('printMessage')
    .asFunction();

void callPrintMessage(String message) {
  final messagePointer = message.toNativeUtf8();
  printMessage(messagePointer);
  free(messagePointer);
}

void main() {
  callPrintMessage('Hello from Dart!');
}
```

在这个示例中，`printMessage` 是一个外部函数，它的实现是在 C 语言编写的动态库中。我们使用 FFI 来加载动态库并调用其中的函数。

## 2. 外部类成员

### 2.1 作用

`external` 关键字也可以用于类的成员（方法、字段等），表示这些成员的实现是外部的。这在实现一些与平台相关的功能时非常有用，例如 Flutter 中与原生平台的交互。

### 2.2 语法

```dart
class MyClass {
  // 外部方法声明
  external void myExternalMethod();

  // 外部字段声明
  external int myExternalField;
}
```

### 2.3 示例

```dart
class PlatformSpecific {
  // 声明一个外部方法
  external void showPlatformMessage();
}

void main() {
  PlatformSpecific platform = PlatformSpecific();
  platform.showPlatformMessage();
}
```

在 Flutter 中，这个外部方法可能会根据不同的平台（如 Android 或 iOS）调用不同的原生代码来显示消息。例如，在 Android 上可能调用 Android 的 Toast 来显示消息，在 iOS 上可能调用 UIAlertController 来显示消息。

## 3. 注意事项

- **实现依赖**：使用 `external` 关键字声明的函数或类成员必须有对应的实现，否则在运行时会出错。这些实现通常由外部库或运行时环境提供。
- **类型匹配**：在使用 FFI 调用外部函数时，要确保 Dart 代码中的函数类型和参数类型与外部实现中的类型相匹配，否则可能会导致运行时错误。
- **平台兼容性**：由于外部函数和类成员通常依赖于特定的平台或外部库，因此在不同的平台上可能需要不同的实现，需要考虑代码的跨平台兼容性。

总之，`external` 关键字为 Dart 提供了一种与外部代码和系统进行交互的方式，使得 Dart 能够利用其他语言的功能和底层系统的能力。
