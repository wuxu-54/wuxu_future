# 什么时候用external

在 Dart 中，`external` 关键字主要用于与外部代码（如原生代码、其他语言编写的库）进行交互，以下是一些常见的使用场景：

## 1. 调用原生系统 API

当你需要调用操作系统提供的原生 API 时，可以使用 `external` 关键字。例如，在 Flutter 应用中，你可能需要访问设备的硬件功能，如振动、相机、蓝牙等，而这些功能通常由操作系统的原生 API 提供。通过 `external` 结合 FFI（Foreign Function Interface），可以让 Dart 代码调用这些原生 API。

### 示例：调用系统的随机数生成器

假设操作系统提供了一个原生的随机数生成函数，你可以使用 `external` 关键字在 Dart 中声明该函数：

```dart
import 'dart:ffi';
import 'package:ffi/ffi.dart';

// 加载动态库（根据不同平台加载不同的库）
final DynamicLibrary randomLib = Platform.isWindows
    ? DynamicLibrary.open('random.dll')
    : DynamicLibrary.open('librandom.so');

// 声明外部函数
typedef GetRandomNumberNative = Int32 Function();
typedef GetRandomNumberDart = int Function();

final GetRandomNumberDart getRandomNumber = randomLib
    .lookup<NativeFunction<GetRandomNumberNative>>('getRandomNumber')
    .asFunction();

void main() {
  int randomNum = getRandomNumber();
  print('Random number: $randomNum');
}
```

## 2. 使用第三方原生库

如果你想在 Dart 项目中使用一些已经存在的第三方原生库（如 C、C++ 编写的库），可以使用 `external` 关键字声明这些库中的函数，然后通过 FFI 调用它们。

### 示例：使用一个 C 语言编写的数学库

假设你有一个 C 语言编写的数学库，其中包含一个计算平方的函数。你可以在 Dart 中这样使用：

```dart
import 'dart:ffi';
import 'package:ffi/ffi.dart';

// 加载动态库
final DynamicLibrary mathLib = Platform.isWindows
    ? DynamicLibrary.open('mathlib.dll')
    : DynamicLibrary.open('libmathlib.so');

// 声明外部函数
typedef SquareNative = Double Function(Double);
typedef SquareDart = double Function(double);

final SquareDart square = mathLib
    .lookup<NativeFunction<SquareNative>>('square')
    .asFunction();

void main() {
  double num = 5.0;
  double result = square(num);
  print('Square of $num is $result');
}
```

## 3. 实现平台特定的功能

在跨平台开发中，有些功能可能在不同的平台上有不同的实现方式。使用 `external` 关键字可以为不同的平台实现不同的代码逻辑。例如，在 Flutter 中，Android 和 iOS 系统的弹窗样式和实现方式可能不同，你可以使用 `external` 关键字分别实现不同平台的弹窗功能。

### 示例：显示不同平台的弹窗

```dart
class PlatformAlert {
  // 声明外部方法
  external void showAlert(String message);
}

void main() {
  PlatformAlert alert = PlatformAlert();
  alert.showAlert('This is an alert message.');
}
```

在 Android 和 iOS 平台上，你可以分别使用原生代码实现 `showAlert` 方法，然后通过 FFI 与 Dart 代码进行交互。

## 4. 优化性能关键部分

对于一些对性能要求极高的代码部分，你可以使用 C、C++ 等语言编写高性能的实现，然后通过 `external` 关键字在 Dart 中调用这些实现。例如，在处理大量数据的排序、加密解密等操作时，原生代码可能比 Dart 代码具有更好的性能。

总之，当你需要与外部的原生代码、系统 API 或第三方库进行交互，或者需要实现平台特定的功能时，`external` 关键字是一个非常有用的工具。但同时需要注意处理好类型转换和内存管理等问题，以确保代码的正确性和稳定性。
