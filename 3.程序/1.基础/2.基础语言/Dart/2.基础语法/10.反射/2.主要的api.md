# 主要api

Dart 的反射 API 主要由 `dart:mirrors` 库提供，它允许程序在运行时检查和修改其结构。：

主要API：

- InstanceMirror：表示一个对象实例的反射信息，可以调用方法、访问属性。
- ClassMirror：表示一个类的反射信息，可以创建实例、访问静态成员。
- LibraryMirror：表示一个库的反射信息。
- MethodMirror：表示一个方法的反射信息。
- VariableMirror：表示一个变量的反射信息。
- MirrorSystem：提供访问当前隔离域中所有镜像的入口。

## InstanceMirror

`InstanceMirror` 是对 Dart 对象实例的反射表示。它允许你访问和修改对象的属性，以及调用其方法。

- **获取 InstanceMirror**：

  ```dart
  Object object = 'Hello, Dart!';
  InstanceMirror instanceMirror = reflect(object);
  ```

- **调用方法**：

  ```dart
  instanceMirror.invoke(#toString, []); // 对应 object.toString()
  ```

- **访问属性**：

  ```dart
  var value = instanceMirror.getField(#hashCode); // 对应 object.hashCode
  instanceMirror.setField(#hashCode, 42); // 对应 object.hashCode = 42
  ```

## ClassMirror

`ClassMirror` 是对 Dart 类的反射表示。它允许你获取类的信息，如构造函数、实例方法、静态方法等，并可以创建类的实例。

- **获取 ClassMirror**：

  ```dart
  ClassMirror classMirror = reflectClass(Person);
  ```

- **创建实例**：

  ```dart
  InstanceMirror instance = classMirror.newInstance(#constructorName, [arg1, arg2]);
  ```

- **访问静态成员**：

  ```dart
  classMirror.invoke(#staticMethod, [arg1, arg2]); // 调用静态方法
  var staticField = classMirror.getField(#staticField); // 访问静态字段
  ```

## LibraryMirror

`LibraryMirror` 表示一个库的反射信息，允许你访问库中的类和其他资源。

- **获取 LibraryMirror**：

  ```dart
  LibraryMirror libraryMirror = reflectClass(Person).owner;
  ```

## MethodMirror 和 VariableMirror

`MethodMirror` 和 `VariableMirror` 分别表示方法和变量的反射信息。它们通常作为 `ClassMirror` 中 `declarations` 属性的一部分获取。

- **访问成员信息**：

  ```dart
  Map<Symbol, DeclarationMirror> declarations = classMirror.declarations;
  for (var key in declarations.keys) {
    print(MirrorSystem.getName(key));
  }
  ```

## MirrorSystem

`MirrorSystem` 是反射系统的入口点，提供了访问当前隔离域中所有镜像的机制。

- **获取当前库的镜像**：

  ```dart
  LibraryMirror currentLibrary = MirrorSystem.getCurrentLibrary();
  ```

## 使用元数据

Dart 允许在类、函数等上使用元数据。这些元数据可以通过反射读取：

```dart
class MyAnnotation {}
@MyAnnotation
class MyClass {}

// 反射读取元数据
InstanceMirror mirror = reflect(new MyClass());
var metadata = mirror.metadata;
```

## 注意事项

- 反射 API 仍在发展中，可能会随着 Dart 版本的更新而变化。
- 在使用 `dart2js` 编译时，未使用的反射代码可能会被排除，可以使用 `@MirrorsUsed` 注解来避免这种情况。
- 反射操作通常比直接代码调用要慢，因此在性能敏感的应用中应谨慎使用。
