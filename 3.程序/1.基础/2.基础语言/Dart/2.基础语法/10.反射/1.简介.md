# 反射简介

Dart 的反射（Reflection）机制允许程序在运行时检查和修改其自身的结构和行为。这包括但不限于获取类的信息、调用方法、访问属性等。Dart 的反射主要基于镜像（Mirrors）的概念，提供了 `dart:mirrors` 库来实现这些功能。

以下是使用 Dart 反射的一些关键点：

1. **导入反射库**：要使用反射，首先需要导入 `dart:mirrors` 库。

   ```dart
   import 'dart:mirrors';
   ```

2. **获取实例镜像**：使用 `reflect` 函数获取对象的 `InstanceMirror`，它表示一个对象实例的反射信息。

   ```dart
   InstanceMirror instanceMirror = reflect(object);
   ```

3. **调用方法**：通过 `InstanceMirror` 的 `invoke` 方法，可以调用对象的方法。

   ```dart
   instanceMirror.invoke(#methodName, argumentsList);
   ```

4. **访问属性**：可以使用 `InstanceMirror` 的 `getField` 和 `setField` 方法来访问和设置对象的属性。

   ```dart
   var value = instanceMirror.getField(#fieldSymbol);
   instanceMirror.setField(#fieldSymbol, newValue);
   ```

5. **获取类镜像**：使用 `reflectClass` 函数获取 `ClassMirror`，它表示类的反射信息。

   ```dart
   ClassMirror classMirror = reflectClass(ClassName);
   ```

6. **创建实例**：通过 `ClassMirror` 的 `newInstance` 方法，可以创建类的实例。

   ```dart
   InstanceMirror instance = classMirror.newInstance(#constructorName, argumentsList);
   ```

7. **使用元数据**：Dart 允许使用元数据来注解类、函数等，这些元数据可以通过反射读取。

   ```dart
   @MyAnnotation
   class MyClass {}
   ```

8. **反射的限制**：Dart 的反射有一些限制，比如跨 isolate 的反射操作可能不可用，以及在 dart2js 编译时，未使用的代码可能会被排除（tree-shaking），这可能会影响到反射操作。

9. **反射的性能**：反射操作通常比直接代码调用要慢，因此在性能敏感的应用中应谨慎使用。

10. **反射与序列化**：反射可以用于对象的序列化和反序列化，通过反射来动态地读取对象的状态。
