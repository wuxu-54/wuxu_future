# 访问权限控制

在 Dart 里，访问权限控制用于管理类、变量、方法等的可见性和可访问性，以此保证代码的封装性和安全性。Dart 采用简单的访问权限控制机制，主要通过命名约定来实现。以下是详细介绍：

## 公共访问（默认）

- **规则**：在 Dart 中，默认情况下，类、变量、方法等都是公共的，即它们可以在整个库（library）内以及被导入该库的其他代码中被访问。
- **示例代码**

```dart
// 定义一个公共类
class Person {
  // 公共属性
  String name;
  int age;

  // 公共方法
  void introduce() {
    print('我叫 $name，今年 $age 岁。');
  }
}

void main() {
  Person person = Person();
  person.name = '张三';
  person.age = 20;
  person.introduce(); 
}
```

在上述代码中，`Person` 类、`name` 和 `age` 属性以及 `introduce` 方法都是公共的，可在 `main` 函数里直接访问。

## 私有访问

- **规则**：在 Dart 中，若标识符（类名、变量名、方法名等）以单下划线 `_` 开头，就表示该标识符是私有的，只能在定义它的库内部访问。
- **示例代码**

```dart
// 定义一个库
library my_library;

// 私有类
class _PrivateClass {
  // 私有属性
  String _privateProperty = '私有属性';

  // 私有方法
  void _privateMethod() {
    print('这是一个私有方法');
  }
}

// 公共类
class PublicClass {
  // 公共方法，可访问私有类和私有成员
  void accessPrivate() {
    _PrivateClass privateObj = _PrivateClass();
    print(privateObj._privateProperty); 
    privateObj._privateMethod(); 
  }
}
```

```dart
// 导入库
import 'my_library.dart';

void main() {
  PublicClass publicObj = PublicClass();
  publicObj.accessPrivate(); 

  // 以下代码会报错，因为无法直接访问私有类和私有成员
  // _PrivateClass privateObj = _PrivateClass(); 
  // print(privateObj._privateProperty); 
  // privateObj._privateMethod(); 
}
```

在这个例子中，`_PrivateClass` 类、`_privateProperty` 属性和 `_privateMethod` 方法都是私有的，只能在 `my_library` 库内部访问，外部代码无法直接访问它们。

## 库级别的访问控制

- **规则**：Dart 中的库是代码组织和访问控制的重要单位。可以使用 `part` 和 `part of` 关键字将一个库拆分成多个文件，同时保持它们之间的访问权限。
- **示例代码**

```dart
// main.dart
library my_library;

part 'part1.dart';

void main() {
  PublicClass publicObj = PublicClass();
  publicObj.accessPrivate(); 
}
```

```dart
// part1.dart
part of my_library;

// 私有类
class _PrivateClass {
  // 私有属性
  String _privateProperty = '私有属性';

  // 私有方法
  void _privateMethod() {
    print('这是一个私有方法');
  }
}

// 公共类
class PublicClass {
  // 公共方法，可访问私有类和私有成员
  void accessPrivate() {
    _PrivateClass privateObj = _PrivateClass();
    print(privateObj._privateProperty); 
    privateObj._privateMethod(); 
  }
}
```

在这个示例中，`main.dart` 和 `part1.dart` 属于同一个库 `my_library`。`part1.dart` 中的私有类和私有成员可以被 `main.dart` 中的代码通过公共类间接访问，因为它们在同一个库内。

## 总结

Dart 的访问权限控制基于命名约定，使用单下划线 `_` 来区分公共和私有成员。这种简单的机制有助于开发者实现代码的封装和模块化，提高代码的可维护性和安全性。

---

## 更多

在 Dart 中，并没有像 Java、C++ 那样使用专门的关键字（如 `public`、`private`、`protected` 等）来显式地进行访问权限控制。Dart 采用命名约定的方式来实现访问权限的管理，虽然没有特定的访问权限控制关键字，但有一些与库和作用域相关的关键字对访问权限有间接影响，下面详细介绍。

### 单下划线 `_` 作为命名约定

在 Dart 里，使用单下划线 `_` 开头的标识符（类名、变量名、方法名等）被视为私有的，只能在定义它们的库内部访问。这是 Dart 实现访问权限控制的核心方式。

#### 示例代码

```dart
// 定义一个库
library my_library;

// 私有类
class _PrivateClass {
  // 私有属性
  String _privateProperty = '这是私有属性';

  // 私有方法
  void _privateMethod() {
    print('这是私有方法');
  }
}

// 公共类
class PublicClass {
  // 公共方法，可在库内访问私有类和私有成员
  void accessPrivate() {
    _PrivateClass privateObj = _PrivateClass();
    print(privateObj._privateProperty);
    privateObj._privateMethod();
  }
}
```

```dart
// 另一个 Dart 文件，导入上述库
import 'my_library.dart';

void main() {
  PublicClass publicObj = PublicClass();
  publicObj.accessPrivate();

  // 以下代码会报错，因为无法在库外部直接访问私有类和私有成员
  // _PrivateClass privateObj = _PrivateClass();
  // print(privateObj._privateProperty);
  // privateObj._privateMethod();
}
```

### 与库相关的关键字对访问权限的影响

#### 1. `library` 关键字

- **作用**：`library` 关键字用于定义一个库，库是 Dart 中代码组织和访问控制的基本单位。在同一个库内，私有成员可以被其他代码访问；而在库外部，私有成员无法直接访问。
- **示例代码**

```dart
// 定义一个名为 my_library 的库
library my_library;

class MyClass {
  // 私有属性
  String _privateField = '私有字段';

  // 公共方法
  void publicMethod() {
    print('公共方法访问私有字段: $_privateField');
  }
}
```

#### 2. `part` 和 `part of` 关键字

- **作用**：`part` 和 `part of` 关键字用于将一个库拆分成多个文件。使用 `part` 关键字在主文件中声明包含的部分文件，使用 `part of` 关键字在部分文件中声明属于哪个库。这样，拆分后的文件仍然属于同一个库，它们之间可以相互访问私有成员。
- **示例代码

```dart
// main.dart
library my_library;

part 'part1.dart';

void main() {
  PublicClass publicObj = PublicClass();
  publicObj.accessPrivate();
}
```

```dart
// part1.dart
part of my_library;

// 私有类
class _PrivateClass {
  // 私有属性
  String _privateProperty = '私有属性';

  // 私有方法
  void _privateMethod() {
    print('这是一个私有方法');
  }
}

// 公共类
class PublicClass {
  // 公共方法，可访问私有类和私有成员
  void accessPrivate() {
    _PrivateClass privateObj = _PrivateClass();
    print(privateObj._privateProperty);
    privateObj._privateMethod();
  }
}
```

### 总结2

Dart 没有传统意义上用于访问权限控制的关键字，而是通过单下划线 `_` 命名约定和 `library`、`part`、`part of` 等与库相关的关键字来实现代码的访问权限管理，这种方式简洁且灵活。
