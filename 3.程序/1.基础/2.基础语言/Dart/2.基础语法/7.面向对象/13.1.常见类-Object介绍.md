# Object

在 Dart 中，`Object` 类是所有 Dart 类的**根类**（除了 `Null` 类），所有其他类（包括自定义类）都直接或间接继承自 `Object`。理解 `Object` 类的方法和行为对于编写健壮、符合预期的 Dart 代码至关重要。以下是 `Object` 类的详细解析：

---

## **1. Object 类的核心方法**

`Object` 类提供了以下所有 Dart 对象共有的基础方法：

| 方法/属性              | 说明                                                                 |
|-----------------------|--------------------------------------------------------------------|
| **`toString()`**      | 返回对象的字符串表示（默认返回实例的类名和哈希码）                        |
| **`hashCode`**        | 返回对象的整型哈希码（用于哈希表，如 `HashMap` 或 `HashSet`）               |
| **`==` 操作符**       | 判断两个对象是否“相等”（默认比较对象是否为同一实例）                         |
| **`runtimeType`**     | 返回对象的运行时类型（`Type` 类型）                                      |
| **`noSuchMethod()`**  | 当调用未定义的方法时触发（用于动态处理未知方法）                             |

---

## **2. 方法的默认行为与覆盖**

### **(1) `toString()` 方法

**默认行为**：返回 `Instance of 'ClassName#hexHashCode'`。  
**覆盖场景**：需要提供更有意义的调试信息。  
**示例**：

```dart
class Person {
  final String name;
  final int age;

  Person(this.name, this.age);

  @override
  String toString() => 'Person(name: $name, age: $age)';
}

void main() {
  print(Person('Alice', 30)); // 输出: Person(name: Alice, age: 30)
}
```

---

### **(2) `hashCode` 与 `==` 操作符

**默认行为**：

- `==`：检查两个对象是否是同一实例（内存地址相同）。
- `hashCode`：基于对象的内存地址生成唯一哈希码。

**覆盖场景**：需要基于对象的内容（而非内存地址）判断相等性时，**必须同时覆盖 `==` 和 `hashCode`**。

**示例**：

```dart
class Point {
  final int x;
  final int y;

  Point(this.x, this.y);

  @override
  bool operator ==(Object other) {
    if (identical(this, other)) return true;
    return other is Point && x == other.x && y == other.y;
  }

  @override
  int get hashCode => x.hashCode ^ y.hashCode; // 使用 XOR 组合字段哈希
}

void main() {
  var p1 = Point(1, 2);
  var p2 = Point(1, 2);
  print(p1 == p2); // 输出: true（内容相同）
}
```

**最佳实践**：

- 使用 `equatable` 包简化相等性判断：

  ```dart
  import 'package:equatable/equatable.dart';

  class Point extends Equatable {
    final int x;
    final int y;
    Point(this.x, this.y);
    
    @override
    List<Object?> get props => [x, y]; // 自动生成 == 和 hashCode
  }
  ```

---

### **(3) `runtimeType`

**用途**：获取对象的运行时类型（如类型检查或反射）。  
**示例**：

```dart
var list = [1, 2, 3];
print(list.runtimeType); // 输出: List<int>
```

**注意**：Dart 的反射（通过 `dart:mirrors`）在 Flutter 中被禁用（出于代码体积优化），因此 `runtimeType` 的使用场景有限。

---

### **(4) `noSuchMethod()`**

**触发条件**：当调用对象未定义的方法时触发。  
**用途**：实现动态方法处理（如代理模式或 DSL）。  
**示例**：

```dart
class DynamicHandler {
  @override
  void noSuchMethod(Invocation invocation) {
    print('尝试调用未定义的方法: ${invocation.memberName}');
  }
}

void main() {
  DynamicHandler().unknownMethod(); // 输出: 尝试调用未定义的方法: Symbol("unknownMethod")
}
```

---

## **3. Object 与类型系统**

### **(1) Object 与 dynamic 的区别**

| 类型        | 说明                                                                 |
|------------|--------------------------------------------------------------------|
| **Object** | 所有 Dart 对象的基类，静态类型安全（需显式类型转换才能调用子类方法）。           |
| **dynamic** | 关闭静态类型检查，允许任何操作（编译时不报错，运行时可能抛出异常）。               |

**示例**：

```dart
Object obj = 'Hello';
// print(obj.length); // 编译错误：Object 没有 length 属性
print((obj as String).length); // 需要显式转换

dynamic dyn = 'Hello';
print(dyn.length); // 编译通过，运行时正常（dyn 是 String）
dyn = 42;
print(dyn.length); // 编译通过，运行时报错（dyn 变为 int）
```

---

### **(2) Object? 与 Null 安全**

- 在 Dart 的 **Null Safety** 中，`Object` 表示非空对象，`Object?` 表示可空对象。
- `Null` 类独立存在，不是 `Object` 的子类，因此 `null is Object` 返回 `false`。

**示例**：

```dart
Object nonNullable = 'Dart'; // 不能赋值为 null
Object? nullable = null;     // 允许赋值为 null
```

---

## **4. 常见问题与解决方案**

### **Q1：为什么覆盖 `==` 时必须覆盖 `hashCode`？**

- **哈希一致性原则**：如果两个对象相等（`==` 返回 `true`），它们的哈希码必须相同。
- **违反后果**：在 `HashSet` 或 `HashMap` 中，相等的对象可能无法正确匹配，导致数据重复或查找失败。

### **Q2：如何快速生成 `toString()`/`==`/`hashCode`？**

- **使用 IDE 插件**：Android Studio/VSCode 提供代码生成快捷操作。
- **使用代码生成库**：如 `equatable`、`freezed` 或 `json_serializable`。

### **Q3：如何判断对象是否为特定类型？**

- **`is` 操作符**：用于类型检查（`if (obj is String) { ... }`）。
- **`as` 操作符**：强制类型转换（可能抛出 `CastException`）。

---

## **5. 总结**

- `Object` 是 Dart 类型系统的基石，所有类均继承自它。
- **核心方法**：`toString()`、`hashCode`、`==`、`runtimeType`、`noSuchMethod()`。
- **覆盖方法时**：确保逻辑符合约定（如哈希一致性）。
- **类型安全**：优先使用 `Object` 和类型推断，谨慎使用 `dynamic`。

掌握 `Object` 类的细节，能够帮助你编写更健壮、可维护的 Dart 代码！
