# 可调用对象(Callable Object)

在Dart中，可调用对象（Callable Object）指的是那些可以像函数一样被调用的对象(ps：这个描述有点像c++中的对象函数)。这通常是通过实现 call 方法来实现的，call 方法是 Function 类的核心方法，任何类如果实现了 call 方法，那么它的实例就可以被当作函数来调用。

以下是创建可调用对象的一些关键点：

1. 实现 call 方法：一个类通过实现一个 call 方法，可以变成一个可调用对象。call 方法的语法与普通方法类似，但它没有指定返回类型，并且不需要在方法名前使用 returns 关键字。

2. 函数类型：在Dart中，函数也是对象，因此任何实现了 call 方法的类的实例可以被赋予函数类型的变量。

3. 闭包：函数字面量创建的闭包也是可调用对象。

4. Lambda 表达式：Lambda 表达式（或称匿名函数）也是可调用对象，它们提供了一种简洁的方式来定义简短的函数。

5. 类型推断：Dart 的类型推断系统可以自动识别并推断出可调用对象的类型。

6. 使用场景：可调用对象常用于实现回调函数、事件处理器、策略模式等场景。

## 示例

一个实现了call方法的类看起来像这样：

```dart
class MyCallable {
  //有这个方法，此类的实例就是可调用对象。 实例名() 像普通方法一样调用
  call(String argument) {
    print('Argument received: $argument');
  }
}

void main() {
  var callable = MyCallable();
  callable('Hello, World!'); // 使用call方法
}
```

在这个例子中，MyCallable类实现了一个call方法，它接受一个String类型的参数。在main函数中，我们创建了MyCallable的一个实例，并像调用函数一样调用了这个实例。

可调用对象在Dart中非常有用，因为它们允许你以函数式编程风格编写代码。例如，你可以将函数作为参数传递给其他函数，或者将它们存储在Map和List中。

## 函数作为参数

你可以将可调用对象作为参数传递给其他函数：

```dart
void performAction(MyCallable action) {
  action('Action performed!');
}

void main() {
  var callable = MyCallable();
  performAction(callable); // 传递可调用对象作为参数
}
```

## 函数作为返回值

一个函数可以返回一个可调用对象：

```dart
MyCallable createCallable() {
  return MyCallable();
}

void main() {
  var callable = createCallable();
  callable('Created callable object!');
}
```

## 匿名可调用对象

你也可以创建匿名可调用对象，这在需要临时实现call方法时非常有用：

```dart
void main() {
  var anonymousCallable = MyCallable.withName('Anonymous');
  anonymousCallable('Hello from anonymous callable!');
}

// 扩展MyCallable类以支持带有名称的调用
extension on MyCallable {
  factory MyCallable.withName(String name) = MyCallable._internal;
  MyCallable._internal(String name) : call = (arg) {
    print('$name says: $arg');
  };
}
```

在这个例子中，我们使用了一个扩展`extension` 来为`MyCallable`类添加一个工厂构造器，它返回一个匿名的可调用对象。

```dart
 MyCallable._internal(String name) : call = (arg) {
    print('$name says: $arg');
  };
```

这句解释：

* `_internal` 命名构造函数，下划线表示私有
* `(arg){}` 是匿名函数
* `:call` 是直接为当前类的`call`属性赋值

这个写法效果等同于下面例子：

```dart
class MyCallable {
  void Function(String)? _call;

  MyCallable.withName(String name) {
    _call = (String arg) {
      print('$name says: $arg');
    };
  }

  call(String argument) {
    if (_call != null) {
      _call!(argument);
    } else {
      throw Exception('Call method is not initialized.');
    }
  }
}

void main() {
  var callable = MyCallable.withName('Anonymous');
  callable('Hello from anonymous callable!'); // 输出: Anonymous says: Hello from anonymous callable!
}
```

## 总结

可调用对象是Dart语言灵活性的一个体现，它允许你以更动态和声明式的方式编写代码。
