# 扩展类型的构造函数

你可以把扩展类型，看成一个类，其本身有自己的构造函数。写法、用法同类一样。

## 不同类型的构造函数示例

### 1. 默认构造函数

默认构造函数会自动接收扩展类型定义中声明的参数。

```dart
// 定义一个扩展类型 NonZeroInt
extension type NonZeroInt(int value) {
  // 默认构造函数，验证值不为零
  NonZeroInt(int val) : this(val != 0 ? val : throw ArgumentError('Value cannot be zero'));

  // 定义一个方法，用于返回值的平方
  int square() => value * value;
}

void main() {
  try {
    // 创建 NonZeroInt 实例
    NonZeroInt num = NonZeroInt(5);
    print('The square of 5 is ${num.square()}');

    // 尝试创建值为零的实例，会抛出异常
    NonZeroInt zeroNum = NonZeroInt(0);
  } catch (e) {
    print('Error: $e');
  }
}
```

**解释**：

- `NonZeroInt(int val)` 是默认构造函数，它接收一个 `int` 类型的参数 `val`，并在初始化时检查该值是否不为零。如果为零，则抛出 `ArgumentError` 异常。
- `square()` 方法用于计算存储值的平方。

### 2. 命名构造函数

命名构造函数允许为不同的初始化方式提供不同的名称。

```dart
// 定义一个扩展类型 Temperature
extension type Temperature(double value) {
  // 从摄氏度创建实例
  Temperature.celsius(double celsius) : this(celsius);

  // 从华氏度创建实例
  Temperature.fahrenheit(double fahrenheit) : this((fahrenheit - 32) * 5 / 9);

  // 定义一个方法，返回摄氏度值
  double getCelsius() => value;
}

void main() {
  // 从摄氏度创建实例
  Temperature tempFromCelsius = Temperature.celsius(25);
  print('Temperature in Celsius: ${tempFromCelsius.getCelsius()}');

  // 从华氏度创建实例
  Temperature tempFromFahrenheit = Temperature.fahrenheit(77);
  print('Temperature in Celsius: ${tempFromFahrenheit.getCelsius()}');
}
```

**解释**：

- `Temperature.celsius(double celsius)` 是命名构造函数，用于直接从摄氏度值创建 `Temperature` 实例。
- `Temperature.fahrenheit(double fahrenheit)` 也是命名构造函数，它接收华氏度值，并将其转换为摄氏度后存储。
- `getCelsius()` 方法用于返回存储的摄氏度值。

### 3. 工厂构造函数

工厂构造函数可以返回一个已存在的实例，或者根据条件返回不同类型的实例。

```dart
// 定义一个扩展类型 PositiveOrZeroInt
extension type PositiveOrZeroInt(int value) {
  // 工厂构造函数，确保值为非负
  factory PositiveOrZeroInt(int val) {
    if (val < 0) {
      return PositiveOrZeroInt(0);
    }
    return PositiveOrZeroInt._(val);
  }

  // 私有默认构造函数
  PositiveOrZeroInt._(int val) : this(val);

  // 定义一个方法，返回值的绝对值
  int abs() => value.abs();
}

void main() {
  // 创建一个正数的实例
  PositiveOrZeroInt positiveNum = PositiveOrZeroInt(5);
  print('Absolute value: ${positiveNum.abs()}');

  // 创建一个负数的实例，会被转换为零
  PositiveOrZeroInt negativeNum = PositiveOrZeroInt(-3);
  print('Absolute value: ${negativeNum.abs()}');
}
```

**解释**：

- `factory PositiveOrZeroInt(int val)` 是工厂构造函数，它会检查输入值是否为负数。如果是负数，则返回值为 0 的实例；否则，调用私有默认构造函数创建实例。
- `PositiveOrZeroInt._(int val)` 是私有默认构造函数，用于实际的实例创建。
- `abs()` 方法用于返回存储值的绝对值。

## 构造函数注意事项

- 扩展类型的构造函数可以进行参数验证，确保存储的值满足特定条件。
- 私有构造函数可以用于封装内部实现，防止外部直接调用。
- 工厂构造函数可以根据不同的条件返回不同的实例，提供更灵活的实例创建方式。

通过合理使用扩展类型的构造函数，可以为现有的类型添加新的功能和约束，提高代码的安全性和可维护性。
