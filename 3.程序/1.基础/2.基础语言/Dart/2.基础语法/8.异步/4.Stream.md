# 事件驱动编程

在Dart中，`Stream`和`StreamController`是处理异步数据流的核心组件。`Stream`是一种可以异步地发出多个数据的序列，而`StreamController`是创建和管理Stream的控制器。

## Stream

Stream可以用于表示一系列的事件，比如用户输入、定时事件、HTTP请求的响应等。
它提供了一种异步的方式来监听和处理数据流。

## StreamController

StreamController是Stream的配套类，用于创建Stream。
它允许你添加数据到Stream中，以及控制Stream的关闭和错误处理。
StreamController有多种创建方式，包括默认创建、单次订阅、广播（broadcast）等。

## 示例代码

以下是一个简单的示例，展示了如何使用StreamController来创建和使用Stream：

```dart
import 'dart:async';

void main() {
  // 创建一个StreamController
  StreamController<String> controller = StreamController();

  // 从StreamController获取Stream
  Stream<String> stream = controller.stream;

  // 监听Stream中的事件
  stream.listen((data) {
    print('Received data: $data');
  });

  // 添加一些数据到Stream中
  controller.add('First data');
  controller.add('Second data');

  // 当不再需要StreamController时，关闭它
  controller.close();
}
```

在这个示例中，做了如下操作：

1. 创建了一个`StreamController`，并通过它获取了一个`Stream`。
2. 为这个Stream添加了一个监听器，它会打印出从Stream中接收到的数据。
3. 通过controller.add()方法向Stream中添加了一些数据。
4. 调用了controller.close()来关闭StreamController，这将导致Stream关闭，不再发出任何事件。

## 错误处理和取消监听

StreamController还支持错误处理和取消监听：

```dart
// 为Stream添加错误处理和取消监听
stream.listen((data) {
  print(data);
}, onError: (error) {
  print('Received error: $error');
}, onDone: () {
  print('Stream is done.');
}, cancelOnError: true);
```

在这个例子中，我们为Stream的监听器添加了错误处理逻辑，并且指定了当出现错误时取消监听`（cancelOnError: true）`。当Stream完成时，将调用onDone回调。

## 总结

使用Stream和StreamController可以方便地在Dart程序中处理异步数据流，它们广泛应用于Flutter和Dart的异步编程中。
