# Properties类

在 Java 中，`java.util.Properties` 是一个用于管理键值对配置文件的工具类，继承自 `Hashtable<Object, Object>`。它专为处理 `.properties` 文件（如 `config.properties`）设计，常用于存储程序的配置信息（如数据库连接参数、国际化资源等）。以下是 `Properties` 类的详细介绍和常见用法。

---

## **1. Properties 类的特点**

- **键值对格式**：以 `key=value` 形式存储数据。
- **文件编码**：默认使用 ISO 8859-1（Latin-1）字符编码，但可通过 Unicode 转义（如 `\u4e2d` 表示中文）。
- **文件结构**：支持注释（以 `#` 或 `!` 开头）。
- **线程安全**：继承自 `Hashtable`，方法是同步的，但现代 Java 中更推荐用 `ConcurrentHashMap` 或其他线程安全结构。

---

## **2. 核心方法**

### **2.1 加载配置文件**

- **从输入流加载**：

  ```java
  try (InputStream input = new FileInputStream("config.properties")) {
      Properties props = new Properties();
      props.load(input); // 加载文件内容
  } catch (IOException e) {
      e.printStackTrace();
  }
  ```

- **从类路径加载**（推荐）：

  ```java
  try (InputStream input = getClass().getClassLoader().getResourceAsStream("config.properties")) {
      Properties props = new Properties();
      props.load(input);
  } catch (IOException e) {
      e.printStackTrace();
  }
  ```

### **2.2 读取值**

```java
String value = props.getProperty("key"); // 返回 String 值
String valueWithDefault = props.getProperty("key", "default_value"); // 带默认值
```

### **2.3 设置值**

```java
props.setProperty("key", "value"); // 设置键值对（自动转为字符串）
props.put("key", "value"); // 继承自 Hashtable 的方法（不建议直接使用）
```

### **2.4 保存到文件**

```java
try (OutputStream output = new FileOutputStream("config.properties")) {
    props.store(output, "Comments here"); // 保存到文件（含注释）
} catch (IOException e) {
    e.printStackTrace();
}
```

### **2.5 其他方法**

```java
props.list(System.out);       // 打印所有键值对到输出流
props.stringPropertyNames();  // 获取所有键的集合（Set<String>）
props.containsKey("key");    // 检查键是否存在
```

---

## **3. 处理中文编码问题**

由于默认使用 ISO 8859-1 编码，直接写入中文会导致乱码。解决方案：

### **3.1 写入时使用 Unicode 转义**

Java 会自动将非 Latin-1 字符转为 Unicode 转义：

```properties
# config.properties
username=admin
password=123456
message=\u4e2d\u6587\u6d4b\u8bd5  # 中文测试
```

### **3.2 使用 UTF-8 读写（Java 8+）**

通过 `load` 和 `store` 的 `Reader`/`Writer` 方法支持 UTF-8：

```java
// 读取 UTF-8 文件
try (Reader reader = new InputStreamReader(
        new FileInputStream("config.properties"), StandardCharsets.UTF_8)) {
    props.load(reader);
}

// 写入 UTF-8 文件（保留中文）
try (Writer writer = new OutputStreamWriter(
        new FileOutputStream("config.properties"), StandardCharsets.UTF_8)) {
    props.store(writer, "UTF-8 配置文件");
}
```

---

## **4. 实际应用示例**

### **4.1 加载数据库配置**

```java
public class DatabaseConfig {
    private static final Properties props = new Properties();

    static {
        try (InputStream input = DatabaseConfig.class.getClassLoader()
                .getResourceAsStream("db.properties")) {
            props.load(input);
        } catch (IOException e) {
            throw new RuntimeException("Failed to load database config", e);
        }
    }

    public static String getUrl() {
        return props.getProperty("db.url");
    }

    public static String getUsername() {
        return props.getProperty("db.username");
    }

    public static String getPassword() {
        return props.getProperty("db.password");
    }
}
```

### **4.2 国际化（i18n）**

```java
// 加载不同语言的资源文件（如 messages_en.properties, messages_zh_CN.properties）
public class I18nDemo {
    public static void main(String[] args) {
        Locale locale = Locale.CHINA;
        ResourceBundle bundle = ResourceBundle.getBundle("messages", locale);
        String greeting = bundle.getString("greeting");
        System.out.println(greeting); // 输出：你好！
    }
}
```

---

## **5. 高级用法**

### **5.1 合并多个 Properties**

```java
Properties defaultProps = new Properties();
try (InputStream input = getClass().getResourceAsStream("default.properties")) {
    defaultProps.load(input);
}

Properties userProps = new Properties(defaultProps); // 设置默认值
try (InputStream input = getClass().getResourceAsStream("user.properties")) {
    userProps.load(input);
}

// userProps 会覆盖 defaultProps 中的同名键
```

### **5.2 使用 XML 格式**

Properties 支持 XML 格式的读写：

```java
// 保存为 XML
props.storeToXML(new FileOutputStream("config.xml"), "XML 配置");

// 从 XML 加载
props.loadFromXML(new FileInputStream("config.xml"));
```

---

## **6. 注意事项**

1. **路径问题**：在 Web 应用或 JAR 中，使用 `ClassLoader.getResourceAsStream()` 更可靠。
2. **线程安全**：虽然 `Properties` 是线程安全的，但现代应用更推荐用 `ConcurrentHashMap` 替代。
3. **性能**：频繁读写时，建议缓存配置，避免重复加载。
4. **替代方案**：
   - **Apache Commons Configuration**：支持更多格式（如 XML、JSON、YAML）。
   - **Java Preferences API**：适合用户级或系统级配置。
   - **Spring Framework**：提供 `@PropertySource` 和环境抽象。

---

## **7. 完整示例：读写配置文件**

```java
import java.io.*;
import java.nio.charset.StandardCharsets;
import java.util.Properties;

public class PropertiesDemo {
    public static void main(String[] args) {
        Properties props = new Properties();

        // 写入配置文件
        props.setProperty("db.url", "jdbc:mysql://localhost:3306/mydb");
        props.setProperty("db.username", "root");
        props.setProperty("db.password", "secret");
        props.setProperty("message", "你好，世界！");

        try (Writer writer = new OutputStreamWriter(
                new FileOutputStream("config.properties"), StandardCharsets.UTF_8)) {
            props.store(writer, "数据库配置");
        } catch (IOException e) {
            e.printStackTrace();
        }

        // 读取配置文件
        Properties loadedProps = new Properties();
        try (Reader reader = new InputStreamReader(
                new FileInputStream("config.properties"), StandardCharsets.UTF_8)) {
            loadedProps.load(reader);
            System.out.println(loadedProps.getProperty("message")); // 输出：你好，世界！
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

---

通过 `Properties` 类，你可以轻松管理键值对配置，但需注意编码和文件路径问题。对于复杂场景，建议使用更强大的配置库（如 Apache Commons Configuration 或 Spring Boot 的配置机制）。
