# Future

`Future` 是 Java 中一个非常重要的接口，它代表了异步计算的结果。在 Java 并发编程中，`Future` 允许你获取长时间运行的任务的结果，而不会阻塞当前线程。以下是 `Future` 的详细使用方法：

## 基本概念

- **异步计算**：`Future` 表示的是一个尚未完成的异步计算。
- **结果获取**：可以通过 `Future` 获取任务的结果。
- **取消任务**：`Future` 允许你尝试取消任务。
- **任务完成状态**：可以检查任务是否完成。

## 常用实现类

- **FutureTask**：`Future` 接口的一个实现，通常作为 `Callable` 任务的包装器。

## 常用方法

1. **get()**：
   - 获取计算结果，如果计算尚未完成，将阻塞调用线程直到计算完成。

2. **get(long timeout, TimeUnit unit)**：
   - 在指定的超时时间内获取计算结果，如果超时，则抛出 `TimeoutException`。

3. **cancel(boolean mayInterruptIfRunning)**：
   - 尝试取消任务。如果任务尚未开始或已经完成，则返回 `false`。

4. **isCancelled()**：
   - 检查任务是否已被取消。

5. **isDone()**：
   - 检查任务是否已完成。

## 使用示例

### 使用 `FutureTask` 包装 `Callable`

```java
import java.util.concurrent.Callable;
import java.util.concurrent.FutureTask;

Callable<Integer> callable = () -> {
    // 模拟长时间运行的任务
    try {
        Thread.sleep(5000);
    } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
    }
    return 42;
};

FutureTask<Integer> futureTask = new FutureTask<>(callable);

// 在新线程中执行任务
new Thread(futureTask).start();

// 获取任务结果
try {
    Integer result = futureTask.get(); // 等待结果
    System.out.println("Task result: " + result);
} catch (InterruptedException | ExecutionException e) {
    e.printStackTrace();
}
```

### 在 `ExecutorService` 中使用 `Future`

```java
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;

ExecutorService executorService = Executors.newSingleThreadExecutor();

// 提交一个任务并获取 Future 对象
Future<Integer> future = executorService.submit(callable);

// 在其他线程中处理结果
try {
    Integer result = future.get(); // 等待结果
    System.out.println("Task result: " + result);
} catch (InterruptedException | ExecutionException e) {
    e.printStackTrace();
}

// 关闭线程池
executorService.shutdown();
```

### 取消任务

```java
// 假设 future 是之前创建的 Future 对象
boolean isCancelled = future.cancel(true); // 尝试取消任务
if (isCancelled) {
    System.out.println("Task was cancelled");
}
```

### 检查任务状态

```java
if (future.isDone()) {
    System.out.println("Task is complete");
}
```

## 注意事项

- 使用 `Future.get()` 时，如果任务尚未完成，当前线程将被阻塞，直到任务完成或发生异常。
- `Future.get(long timeout, TimeUnit unit)` 方法允许设置超时时间，如果超时后任务仍未完成，将抛出 `TimeoutException`。
- 使用 `cancel(boolean mayInterruptIfRunning)` 方法可以请求取消任务，如果任务正在运行，且 `mayInterruptIfRunning` 为 `true`，则可以中断执行任务的线程。
- 任务一旦完成，就不能再被取消。
- 在使用 `ExecutorService` 时，确保在不再需要时正确关闭线程池，以释放资源。

`Future` 提供了一种机制来处理异步任务的结果，使得应用程序可以更加灵活地处理长时间运行的任务，同时提高程序的响应性和并发性。
