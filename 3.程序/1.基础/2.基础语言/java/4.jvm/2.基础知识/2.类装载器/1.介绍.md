# 类装载器（ClassLoader）

JVM（Java Virtual Machine）中的类装载器（ClassLoader）是Java程序运行的核心组件之一，它负责在运行时动态地加载Java类到JVM中。
>[java基础章节-类加载原理](../../../2.%E8%BF%9B%E9%98%B6/%E7%B1%BB%E5%8A%A0%E8%BD%BD/)

以下是关于JVM类装载器的详细解析：

## 一、类装载器的作用

类装载器的主要作用是将.class文件（即Java字节码文件）加载到JVM中，并转换成JVM能够识别的运行时数据结构。这个过程包括加载、验证、准备、解析和初始化等阶段，确保类文件被正确地加载并准备执行。

## 二、类装载器的分类

JVM提供了多种类装载器，以满足不同的加载需求。常见的类装载器包括：

1. **启动类加载器（Bootstrap ClassLoader）**：
   - 也称为根加载器，是嵌在JVM内核中的加载器。
   - 主要负责加载Java的核心类库，如rt.jar等。这些类库通常位于JAVA_HOME/lib目录下。
   - 启动类加载器是用C++语言实现的，无法被应用程序直接使用。

2. **扩展类加载器（Extension ClassLoader）**：
   - 主要负责加载Java的扩展类库。
   - 这些类库通常位于JAVA_HOME/lib/ext目录下，或者由java.ext.dirs系统属性指定的路径中。
   - 扩展类加载器是用Java语言实现的，是应用程序类加载器的父加载器。

3. **应用程序类加载器（Application ClassLoader）**：
   - 也称为系统类加载器，主要负责加载应用程序的类路径（CLASSPATH）下的所有类。
   - 它是扩展类加载器的子加载器，用于加载用户编写的代码以及第三方库。

4. **自定义类加载器**：
   - 允许开发者根据需要自定义类加载器，以满足特殊需求，如热部署、代码加密等。
   - 自定义类加载器可以通过继承ClassLoader类并重写其中的方法来实现。

## 三、类装载器的加载机制

类装载器采用双亲委派机制来加载类。当一个类加载器收到类加载请求时，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成。这种机制保证了Java核心类库的类型安全，避免了类的重复加载，并且使得Java应用更加稳定。具体过程如下：

1. **加载请求**：当一个类需要被加载时，JVM会首先将这个请求交给应用程序类加载器。
2. **委派给父类加载器**：应用程序类加载器不会自己加载这个类，而是将请求委派给它的父加载器（即扩展类加载器）。
3. **递归委派**：扩展类加载器同样不会自己加载这个类，而是将请求继续委派给它的父加载器（即启动类加载器）。
4. **启动类加载器加载**：如果启动类加载器能够找到并加载这个类，则加载过程结束。如果启动类加载器无法加载这个类，则依次递归地将请求回传给子加载器。
5. **子加载器加载**：如果父类加载器无法加载这个类，则子类加载器会尝试自己加载这个类。

## 四、类装载器的特点

1. **层次结构**：类装载器具有层次结构，父加载器可以加载子加载器无法加载的类，但子加载器无法加载父加载器已经加载的类（除非通过特殊手段）。
2. **隔离性**：不同的类加载器加载的类是相互隔离的，这避免了类冲突和不安全行为。例如，两个不同的应用程序可能都使用了一个名为`com.example.Utils`的类，但这两个类实际上可能是完全不同的。通过为每个应用程序使用不同的类加载器，可以确保每个应用程序加载和使用它自己的`com.example.Utils`类版本。
3. **委托模型**：双亲委派模型确保了Java核心类库的类型安全，避免了类的重复加载，并使得Java应用更加稳定。

## 五、类装载器的应用场景

1. **热部署**：通过自定义类加载器，可以在不重启JVM的情况下更新应用程序的类文件。
2. **代码加密**：自定义类加载器可以用于加载经过加密的类文件，并在加载时进行解密。
3. **动态代理**：Java的动态代理机制依赖于自定义类加载器来加载代理类。
4. **模块化开发**：在一些模块化开发的框架中，可以使用自定义类加载器来加载不同模块中的类。

综上所述，JVM的类装载器是Java程序运行的核心组件之一，它负责动态地加载Java类到JVM中，并确保类的正确性和安全性。通过双亲委派机制、层次结构和隔离性等特点，类装载器为Java应用程序提供了灵活且可靠的类加载机制。
