# IO

Rust 的输入输出（I/O）操作围绕安全性和高效性设计，主要通过标准库的 `std::io` 和 `std::fs` 模块实现。以下是核心内容的分点总结：

---

## 一、标准输入输出（Stdin/Stdout）

1. **读取输入**  
   - 使用 `std::io::stdin().read_line` 从命令行读取输入：  

     ```rust
     use std::io;
     let mut input = String::new();
     io::stdin().read_line(&mut input)?; // ? 自动处理错误,会将错误抛出去
     //io::stdin().read_line(&mut input).expect("读取失败"); // 主动消化错误
     println!("输入内容：{}", input.trim());
     ```

2. **写入输出**  
   - 通过 `println!` 宏或 `stdout().write` 输出：  

     ```rust
     use std::io::{self, Write};
     let stdout = io::stdout();
     let mut handle = stdout.lock();
     handle.write_all(b"Hello World\n")?;
     ```

---

## 二、文件操作

1. **读取文件**  
   - 一次性读取全部内容：  

     ```rust
     let content = std::fs::read_to_string("file.txt")?;
     ```

   - 流式读取（适合大文件）：  

     ```rust
     use std::io::BufReader;
     let file = File::open("file.txt")?;
     let mut reader = BufReader::new(file);
     let mut buffer = String::new();
     reader.read_to_string(&mut buffer)?;
     ```

2. **写入文件**  
   - 覆盖写入：  

     ```rust
     std::fs::write("output.txt", "内容")?;
     ```

   - 追加写入：  

     ```rust
     use std::fs::OpenOptions;
     let mut file = OpenOptions::new()
         .append(true)
         .open("output.txt")?;
     file.write_all(b"追加内容\n")?;
     ```

---

## 三、缓冲读写（BufReader/BufWriter）

- **提升性能**：通过缓冲减少系统调用次数。  

  ```rust
  use std::io::{BufReader, BufWriter};
  
  // 缓冲读取
  let file = File::open("file.txt")?;
  let reader = BufReader::new(file);
  
  // 缓冲写入
  let file = File::create("output.txt")?;
  let mut writer = BufWriter::new(file);
  writer.write_all(b"高效写入")?;
  ```

---

## 四、命令行参数处理

- 使用 `std::env::args()` 获取参数：  

  ```rust
  fn main() {
      let args: Vec<String> = std::env::args().collect();
      println!("程序名：{}，参数：{:?}", args[0], &args[1..]);
  }
  ```

---

## 五、错误处理

- **Result 类型**：所有 I/O 操作返回 `Result<T, std::io::Error>`，强制处理潜在错误。  

  ```rust
  use std::io;
  fn read_file() -> io::Result<()> {
      let content = std::fs::read_to_string("file.txt")?; // 错误自动传播
      Ok(())
  }
  ```

---

## 六、异步 I/O（如 Tokio）

- 使用异步运行时（如 Tokio）实现非阻塞操作：  

  ```rust
  use tokio::fs::File;
  use tokio::io::{AsyncReadExt, AsyncWriteExt};
  
  #[tokio::main]
  async fn main() -> Result<(), Box<dyn std::error::Error>> {
      let mut file = File::open("file.txt").await?;
      let mut buffer = Vec::new();
      file.read_to_end(&mut buffer).await?;
      Ok(())
  }
  ```

---

## 总结

- **核心 Trait**：`Read`（字节流读取）、`BufRead`（缓冲读取）、`Write`（写入）。
- **常见类型**：`File`、`Stdin`、`Stdout`、`TcpStream`。
- **设计优势**：通过所有权和生命周期确保资源安全，结合 `Result` 强制错误处理，提供同步/异步两种模式。

通过组合这些模块和方法，Rust 能够高效且安全地处理各种 I/O 场景。
