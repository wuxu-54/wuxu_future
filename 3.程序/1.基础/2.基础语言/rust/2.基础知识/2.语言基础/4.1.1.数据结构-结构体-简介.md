# 数据结构-结构体

在 Rust 中，结构体（`struct`）是一种自定义数据类型，用于将多个相关值组合成一个有意义的复合类型。以下是结构体的定义、使用及实现方法的详细说明：

---

## 一、结构体的定义

结构体有下面三中类型：

1. 具名结构体：
    - 最常用的结构体形式
    - 有明确命名的字段
    - 适用于需要多个相关属性的数据结构

    ```rust
    struct Person {
        name: String,
        age: u32,
    }
    ```

2. 元组结构体：
    - 字段没有名字，只有类型
    - 适用于需要给元组添加语义的场景

    ```rust
    struct Point(i32, i32);
    ```

3. 单元结构体：
    - 没有任何字段
    - 适用于需要在类型上实现trait，但不需要存储数据的场景

    ```rust
    struct Unit;
    ```

---

## 二、结构体的实例化

### 1. 基本实例化

通过直接赋值创建实例：

```rust
let rect = Rectangle {
    width: 30,
    height: 50,
};
```

### 2. 可变实例化

使用 `mut` 关键字声明可变实例，允许修改字段：

```rust
let mut rect = Rectangle { width: 10, height: 20 };
rect.width = 30;  // 修改字段值
```

### 3. 字段初始化简写

当变量名与字段名相同时，可简化赋值：

```rust
fn build_rectangle(width: u32, height: u32) -> Rectangle {
    Rectangle { width, height }  // 等同于 width: width, height: height
}
```

### 4. 结构体更新语法

基于已有实例创建新实例：

```rust
let rect2 = Rectangle {
    width: 40,
    ..rect  // 继承 rect 的其他字段（此处 height 被复制）
};
```

---

## 三、结构体的方法

通过 `impl` 块为结构体定义方法：

```rust
impl Rectangle {
    // 实例方法：通过引用访问字段
    fn area(&self) -> u32 {
        self.width * self.height
    }

    // 关联函数（类似静态方法）：用于构造函数
    fn square(size: u32) -> Self {
        Rectangle {
            width: size,
            height: size,
        }
    }
}
```

### 方法调用

```rust
let rect = Rectangle { width: 10, height: 20 };
println!("Area: {}", rect.area());  // 输出：200

let square = Rectangle::square(5);  // 调用关联函数
```

---

## 四、其他类型结构体

### 1. 元组结构体

适用于字段名不重要的场景：

```rust
struct Point(i32, i32);
let origin = Point(0, 0);
println!("x: {}, y: {}", origin.0, origin.1);  // 通过索引访问
```

### 2. 类单元结构体

用于标记或占位：

```rust
struct Marker;
let marker = Marker;
```

---

## 五、高级特性

### 1. 可见性控制

字段默认私有，可通过 `pub` 设为公有：

```rust
pub struct User {
    pub username: String,
    pub age: u32,
}
```

### 2. 模式匹配

解构结构体字段：

```rust
let rect = Rectangle { width: 30, height: 50 };
match rect {
    Rectangle { width, height } => println!("Size: {}x{}", width, height),
}
```

### 3. 打印结构体

通过 `#[derive(Debug)]` 自动实现调试打印：

```rust
#[derive(Debug)]
struct Point { x: i32, y: i32 }

let p = Point { x: 10, y: 20 };
println!("Point: {:?}", p);  // 输出：Point { x: 10, y: 20 }
```

---

## 六、完整示例

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }

    fn square(size: u32) -> Self {
        Self { width: size, height: size }
    }
}

fn main() {
    let rect = Rectangle { width: 30, height: 50 };
    println!("Area: {}", rect.area());  // 输出：1500

    let square = Rectangle::square(20);
    println!("Square: {:?}", square);  // 输出：Square { width: 20, height: 20 }
}
```

---

## 总结

- **定义**：使用 `struct` 关键字，指定字段类型。
- **实例化**：通过直接赋值或更新语法创建实例。
- **方法**：通过 `impl` 定义实例方法和关联函数。
- **类型**：常规结构体、元组结构体、类单元结构体。
- **高级特性**：可见性控制、模式匹配、调试输出。

结构体是 Rust 组织数据的核心工具，结合所有权和借用规则，能有效提升代码的安全性和可维护性。
