# 流程控制-条件判断

以下是 Rust 中控制流程的条件判断机制详解，包含语法、使用场景及注意事项：

---

## 一、**基本语法：`if` 表达式**

Rust 的 `if` 是一个 **表达式**（有返回值），而非语句，且条件必须为布尔类型（`true`/`false`）。

### 1. 单条件判断

```rust
let num = 5;

if num < 10 {
    println!("num 小于 10");
}
```

### 2. `else` 分支

```rust
if num % 2 == 0 {
    println!("偶数");
} else {
    println!("奇数");
}
```

---

## 二、**多条件分支：`else if`**

```rust
let score = 85;

if score >= 90 {
    println!("A");
} else if score >= 80 {
    println!("B"); // 输出 B
} else if score >= 60 {
    println!("C");
} else {
    println!("D");
}
```

---

## 三、**`if` 作为表达式返回值**

每个分支的返回值类型必须 **一致**，且以最后一个表达式为结果（无需分号）。

### 示例：三元运算替代

```rust
let is_ok = true;
let result = if is_ok { "成功" } else { "失败" };
println!("{}", result); // 输出 "成功"
```

### 复杂返回值

```rust
let value = 42;
let description = if value == 0 {
    "零"
} else if value > 0 {
    "正数"
} else {
    "负数"
};
```

---

## 四、**作用域与变量遮蔽**

### 1. 条件分支中的变量作用域

```rust
let condition = true;
let x = if condition {
    let y = 5;   // y 在此代码块内有效
    y + 1        // 返回 6
} else {
    0
};
// println!("{}", y); // 错误！y 已离开作用域
println!("x = {}", x); // 输出 x = 6
```

### 2. 利用变量遮蔽简化代码

```rust
let mut value = Some(5);  //解释：Some(5) 是 Option 枚举类型的一个实例，表示存在一个整数值 5。因此，这行代码声明了一个可变变量 value，并将其初始化为 Some(5)。
if let Some(v) = value { // 解释：进行模式匹配，如果匹配成功，那么将整数值5给到变量v，并执行方法体
    println!("值为 {}", v); // 输出 5
}
value = None;
if let Some(v) = value {
    println!("值为 {}", v);
} else {
    println!("无值");
}
```

---

## 五、**常见错误与注意事项**

### 1. 条件必须为布尔类型

```rust
// 错误示例：非布尔条件
let num = 5;
if num {   // 编译错误！Rust 不会自动将整数转为布尔值
    println!("非零");
}
```

### 2. 分支返回值类型一致

```rust
// 错误示例：类型不匹配
let result = if true { 42 } else { "错误" }; // 编译错误！i32 和 &str 类型不一致
```

### 3. 空块默认返回 `()`（单元类型）

```rust
let x = if false { }; // x 的类型为 ()
```

---

## 六、**与 `match` 的对比**

对于多分支场景，`match` 更清晰且支持模式匹配：

```rust
let grade = 'B';
match grade {
    'A' => println!("优秀"),
    'B' | 'C' => println!("良好"),
    _ => println!("其他"),
}
```

---

## 七、**总结**

1. **核心特性**：
   - `if` 是表达式，可返回值。
   - 条件必须为布尔类型（严格类型系统）。
   - 分支代码块的最后一行表达式为返回值（无分号）。
2. **适用场景**：
   - 简单条件判断：`if`/`else`。
   - 多分支逻辑：优先考虑 `match`。
3. **最佳实践**：
   - 避免深层嵌套的 `else if`，改用 `match` 或函数拆分。
   - 利用 `if let` 简化单分支模式匹配（见后续教程）。
