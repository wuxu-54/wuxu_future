# rustc命令

以下是 **`rustc` 命令的完整指南**，涵盖编译、调试、优化等常用功能及参数说明：

---

## **一、基础编译**

| 命令 | 说明 | 示例 |
|------|------|------|
| `rustc [file].rs` | 编译单个 Rust 文件生成可执行文件 | `rustc main.rs` → 生成 `main`（Linux）或 `main.exe`（Windows） |
| `rustc [file].rs -o [output]` | 指定输出文件名 | `rustc main.rs -o myapp` → 输出 `myapp` |
| `rustc --version` | 查看编译器版本 | `rustc --version` → 显示版本信息（如 `rustc 1.76.0`） |
| `rustc --verbose` | 显示编译详细过程 | `rustc main.rs --verbose` |

---

## **二、输出类型控制**

| 参数 | 说明 | 示例 |
|------|------|------|
| `--emit=[type]` | 指定输出类型：<br>`asm`（汇编）、`llvm-bc`（LLVM 字节码）、<br>`obj`（对象文件）、`link`（可执行文件，默认） | `rustc main.rs --emit=asm` → 生成 `main.s` |
| `--crate-type=lib` | 编译为库（默认生成 `.rlib`） | `rustc lib.rs --crate-type=lib` → `liblib.rlib` |
| `--crate-type=cdylib` | 生成动态链接库（`.so`/`.dll`） | `rustc lib.rs --crate-type=cdylib` |

---

## **三、优化与性能**

| 参数 | 说明 | 示例 |
|------|------|------|
| `-O` | 启用基础优化（等价于 `-C opt-level=2`） | `rustc main.rs -O` |
| `-C opt-level=[0-3]` | 指定优化级别（0：无优化，3：最高） | `rustc main.rs -C opt-level=3` |
| `-C lto` | 启用链接时优化（提高运行时性能） | `rustc main.rs -C lto` |
| `-C target-cpu=native` | 为当前 CPU 架构优化 | `rustc main.rs -C target-cpu=native` |

---

## **四、调试与符号**

| 参数 | 说明 | 示例 |
|------|------|------|
| `-g` | 生成调试符号（等价于 `-C debuginfo=2`） | `rustc main.rs -g` → 支持 GDB/LLDB 调试 |
| `-C debuginfo=[0-2]` | 控制调试信息级别（0：无，2：完整） | `rustc main.rs -C debuginfo=1` |
| `--test` | 生成测试可执行文件（结合 `#[test]` 使用） | `rustc test.rs --test` → 运行 `./test` 执行测试 |

---

## **五、警告与错误控制**

| 参数 | 说明 | 示例 |
|------|------|------|
| `-W [lint]` | 启用特定警告 | `rustc main.rs -W dead_code` |
| `-A [lint]` | 忽略特定警告 | `rustc main.rs -A unused_variables` |
| `-D warnings` | 将警告视为错误 | `rustc main.rs -D warnings` |

---

## **六、依赖与链接**

| 参数 | 说明 | 示例 |
|------|------|------|
| `-L [path]` | 添加库搜索路径 | `rustc main.rs -L /path/to/libs` |
| `-l [lib]` | 链接外部库（如 `-l m` 链接数学库） | `rustc main.rs -l m` |
| `--extern [name]=[path]` | 显式指定依赖库 | `rustc main.rs --extern mylib=libmylib.rlib` |

---

## **七、其他实用参数**

| 参数 | 说明 | 示例 |
|------|------|------|
| `--edition [2015/2018/2021]` | 指定 Rust 版本 | `rustc main.rs --edition 2021` |
| `-C panic=abort` | 发生 panic 时直接终止程序 | `rustc main.rs -C panic=abort` |
| `-C incremental` | 启用增量编译（加快后续编译速度） | `rustc main.rs -C incremental` |

---

## **八、调试示例**

```bash
# 编译带调试信息的可执行文件
rustc main.rs -g -o debug_app

# 使用 GDB 调试
gdb ./debug_app
```

---

## **九、优化示例**

```bash
# 最高优化级别 + 链接时优化
rustc main.rs -C opt-level=3 -C lto -o optimized_app
```

---

## **附：常用组合命令**

```bash
# 生成汇编代码并优化
rustc main.rs --emit=asm -O -o main.s

# 编译为静态库
rustc lib.rs --crate-type=staticlib
```

通过灵活组合参数，可满足不同场景需求。对于复杂项目，推荐使用 **`Cargo`** 管理依赖和构建流程。
