# Trait常见分类

Rust 中的 Trait 是其类型系统的核心机制，用于定义共享行为、实现多态和泛型约束。以下是 Rust 中主要的 Trait 分类及核心特性：

---

## **一、基础 Trait 用法**

1. **定义共享行为**
   - **示例**：`Animal` Trait 定义 `speak` 方法，由 `Dog` 和 `Cat` 实现。

   ```rust
   trait Animal {
       fn speak(&self);
   }
   ```

2. **默认方法实现**
   - Trait 可提供默认实现，实现者可选择覆盖。

   ```rust
   trait Summary {
       fn summarize(&self) -> String {
           String::from("默认摘要")
       }
   }
   ```

3. **泛型约束**
   - 通过 `T: Trait` 约束泛型类型的行为。

   ```rust
   fn notify<T: Summary>(item: T) {
       println!("摘要: {}", item.summarize());
   }
   ```

4. **Trait 对象（动态分发）**
   - 使用 `dyn Trait` 实现运行时多态。

   ```rust
   let animals: Vec<Box<dyn Animal>> = vec![Box::new(Dog), Box::new(Cat)];
   ```

---

## **二、标准库核心 Trait**

1. **标记 Trait**
   - **`Sized`**：表示类型大小在编译期已知（Rust 自动为多数类型实现）。
   - **`Copy`**：允许按位复制（仅适用于无资源持有的简单类型）。
   - **`Clone`**：显式复制对象（需手动调用 `clone` 方法）。

2. **转换 Trait**
   - **`From`/`Into`**：类型安全的值转换。

   ```rust
   impl From<i32> for MyType { /* ... */ }
   let x = MyType::from(42);
   ```

   - **`TryFrom`/`TryInto`**：可能失败的转换。

3. **智能指针 Trait**
   - **`Deref`/`DerefMut`**：重载解引用运算符 `*` 和 `*mut`。

   ```rust
   impl Deref for MyBox {
       type Target = T;
       fn deref(&self) -> &T { &self.0 }
   }
   ```

4. **析构 Trait**
   - **`Drop`**：定义值离开作用域时的清理逻辑。

   ```rust
   impl Drop for File {
       fn drop(&mut self) { /* 关闭文件 */ }
   }
   ```

5. **迭代器 Trait**
   - **`Iterator`**：定义迭代行为，含关联类型 `Item`。

   ```rust
   impl Iterator for Counter {
       type Item = u32;
       fn next(&mut self) -> Option<Self::Item> { /* ... */ }
   }
   ```

---

## **三、闭包相关 Trait**

1. **`Fn`/`FnMut`/`FnOnce`**
   - **`Fn`**：不可变借用捕获环境（可多次调用）。
   - **`FnMut`**：可变借用捕获环境（可多次调用）。
   - **`FnOnce`**：获取所有权（仅能调用一次）。

   ```rust
   let closure = |x| x + 1; // 自动实现 Fn Trait
   ```

---

## **四、特殊用途 Trait**

1. **`Default`**：提供类型的默认值。

   ```rust
   impl Default for Config {
       fn default() -> Self { Config { /* ... */ } }
   }
   ```

2. **`Borrow`/`BorrowMut`**：抽象借用行为（确保哈希一致性）。

   ```rust
   use std::borrow::Borrow;
   fn get_hash<T: Borrow<str>>(s: T) -> u64 { /* ... */ }
   ```

3. **`AsRef`/`AsMut`**：低成本引用转换。

   ```rust
   fn read_file(path: impl AsRef<Path>) { /* ... */ }
   ```

---

## **五、规则与模式**

1. **孤儿规则**  
   - 不允许为外部类型实现外部 Trait（需通过 `newtype` 模式绕开限制）。

   ```rust
   struct Wrapper(Vec<String>);
   impl fmt::Display for Wrapper { /* ... */ }
   ```

2. **关联类型 vs 泛型参数**  
   - 关联类型（`type Item`）确保一个类型仅实现一次 Trait，泛型参数允许多次实现。

---

## **总结**

Rust 的 Trait 涵盖了从基础行为抽象到系统级控制的广泛场景，包括：

- **行为抽象**：`Animal`、`Summary`
- **泛型约束**：`T: Clone + Debug`
- **动态分发**：`dyn Write`
- **类型转换**：`From`、`Into`
- **资源管理**：`Drop`、`Deref`
- **闭包控制**：`Fn`、`FnMut`、`FnOnce`

熟悉这些 Trait 能帮助编写高效、符合 Rust 惯用法的代码。
