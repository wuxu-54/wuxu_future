# 注释

以下是 Rust 中 **注释（Comments）** 的详细说明，分为代码注释和文档注释两类：

---

## **1. 代码注释**

用于解释代码逻辑，**不会被编译**，仅供开发者阅读。

### **(1) 单行注释**

- 以 `//` 开头，到行尾结束。
- 可以放在代码行末尾或独立成行。

```rust
fn main() {
    // 这是一个单行注释
    let x = 5; // 定义变量 x
}
```

### **(2) 块注释**

- 用 `/* ... */` 包裹多行内容。
- **不推荐常用**（Rust 更倾向单行注释）。

```rust
fn main() {
    /*
    这是一个
    多行块注释
    */
    let x = 5;
}
```

---

## **2. 文档注释**

用于生成 **HTML 文档**（通过 `cargo doc`），支持 Markdown 格式，是 Rust 生态的重要部分。

### **(1) 外部文档注释：`///`**

- 写在 **函数、结构体、模块等定义之前**。
- 描述其功能、参数、返回值等。
- 支持 Markdown 和代码示例。

```rust
/// 计算两个数的和
/// 
/// # 示例
/// ```
/// let result = add(2, 3);
/// assert_eq!(result, 5);
/// ```
fn add(a: i32, b: i32) -> i32 {
    a + b
}
```

### **(2) 内部文档注释：`//!`**

- 写在 **模块或 crate 内部**，描述整个模块或 crate 的功能。
- 通常放在 `lib.rs` 或 `main.rs` 文件顶部。

```rust
//! 这是 crate 级别的文档
//! 
//! 这个 crate 提供了一些基础数学运算函数。

pub mod math {
    // ...
}
```

---

## **3. 文档注释的特殊功能**

### **(1) 代码测试**

- 写在 `///` 注释中的代码块会被视为 **文档测试**（Doctest），运行 `cargo test` 时会自动执行。
- 确保示例代码与真实功能一致。

### **(2) 章节标题**

- 使用 `#` 标记标题，常见约定：
  - `# Examples`：用法示例
  - `# Panics`：函数可能触发 panic 的场景
  - `# Safety`：不安全代码的约束条件
  - `# Errors`：可能返回的错误类型

```rust
/// 除以一个数
/// 
/// # Panics
/// 如果除数为 0，会触发 panic。
/// 
/// # Examples
/// ```
/// let result = divide(10, 2);
/// assert_eq!(result, 5);
/// ```
fn divide(a: i32, b: i32) -> i32 {
    if b == 0 {
        panic!("除数不能为 0");
    }
    a / b
}
```

---

## **4. 注释的注意事项**

1. **避免冗余注释**  
   代码本身应尽量自解释，注释应解释“为什么”而不是“做什么”。

   ```rust
   // 坏注释：重复代码行为
   let x = x + 1; // 将 x 加 1

   // 好注释：解释复杂逻辑的原因
   // 因边界条件需要调整索引
   let idx = (idx + 1) % buffer.len();
   ```

2. **文档注释的可见性**  
   文档注释遵循 Rust 的可见性规则，私有项（非 `pub`）的文档注释不会出现在公开文档中。

3. **隐藏文档内容**  
   用 `#[doc(hidden)]` 隐藏特定项，不生成文档：

   ```rust
   #[doc(hidden)]
   pub(crate) fn internal_helper() {
       // ...
   }
   ```

---

## **总结**

| 类型       | 语法      | 用途                   | 是否生成文档 |
|------------|-----------|------------------------|--------------|
| 单行注释   | `//`      | 解释代码逻辑           | 否           |
| 块注释     | `/* */`   | 多行解释               | 否           |
| 外部文档   | `///`     | 描述函数、结构体等     | 是           |
| 内部文档   | `//!`     | 描述模块或 crate       | 是           |

通过 `cargo doc` 生成文档，让代码更易维护和协作！
