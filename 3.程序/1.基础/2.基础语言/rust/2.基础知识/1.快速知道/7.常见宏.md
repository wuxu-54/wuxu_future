# 常见宏

在 Rust 里，宏调用时默认要加 !，这是 Rust 为了区分宏调用和函数调用而设计的语法规则。原因：

- **语法清晰**：宏和函数在行为上有明显区别
- **避免命名冲突**：由于宏和函数可以使用相同的名称，加 ! 能避免因命名冲突而产生的歧义。

特殊情况：虽然大多数宏调用需要加 !，但 Rust 中有一个特殊的宏 vec，在 Rust 2024 版本及之后，它支持省略 ! 的调用方式。例如：

```rust
let v = vec[1, 2, 3];
```

## 1. 集合初始化宏

- **`vec!`**：用来创建并初始化 `Vec` 动态数组。

```rust
let v = vec![1, 2, 3];
```

- **`HashMap!`**：用于创建并初始化 `HashMap`。

```rust
use std::collections::HashMap;
let mut map = HashMap! {
    "a" => 1,
    "b" => 2
};
```

- **`BTreeMap!`**：创建并初始化 `BTreeMap`。

```rust
use std::collections::BTreeMap;
let mut btree_map = BTreeMap! {
    1 => "one",
    2 => "two"
};
```

## 2. 打印输出宏

- **`println!`**：把格式化的字符串输出到标准输出并换行。

```rust
println!("Hello, world!");
```

- **`print!`**：把格式化的字符串输出到标准输出但不换行。

```rust
print!("This is a line without a newline.");
```

- **`eprintln!`**：把格式化的字符串输出到标准错误输出并换行。

```rust
eprintln!("This is an error message.");
```

- **`eprint!`**：把格式化的字符串输出到标准错误输出但不换行。

```rust
eprint!("Error occurred.");
```

## 3. 调试相关宏

- **`dbg!`**：打印表达式的值和所在的文件、行号，然后返回表达式的值。

```rust
let x = 5;
let y = dbg!(x * 2);
```

- **`assert!`**：在条件为 `false` 时触发 panic，可用于调试时进行条件检查。

```rust
let x = 5;
assert!(x > 3);
```

- **`assert_eq!`**：在两个值不相等时触发 panic，常用于调试时比较两个值是否相等。

```rust
let a = 1 + 2;
assert_eq!(a, 3);
```

- **`assert_ne!`**：在两个值相等时触发 panic，用于调试时检查两个值是否不相等。

```rust
let a = 1;
let b = 2;
assert_ne!(a, b);
```

## 4. 内存分配宏

- **`Box!`**：在堆上分配内存并返回一个智能指针 `Box`。

```rust
let b = Box! { 42 };
```

## 5. 字符串操作宏

- **`format!`**：生成格式化的字符串。

```rust
let name = "Alice";
let greeting = format!("Hello, {}!", name);
```

- **`concat!`**：在编译时连接多个字符串字面量。

```rust
let s = concat!("Hello", ", ", "world!");
```

- **`join!`**：在编译时用分隔符连接多个字符串字面量。

```rust
let s = join!["a", "b", "c", separator = ", "];
```

## 6. 条件编译宏

- **`cfg!`**：用于在编译时根据配置选项来判断条件。

```rust
if cfg!(target_os = "linux") {
    println!("Running on Linux!");
}
```

## 7. 自定义派生宏

- **`#[derive]`**：为结构体、枚举等类型自动派生一些常用的 trait 实现，像 `Debug`、`Clone`、`Copy`、`PartialEq` 等。

```rust
#[derive(Debug, Clone, Copy, PartialEq)]
struct Point {
    x: i32,
    y: i32,
}
```

这些宏是 Rust 编程里比较常用的，借助它们可以让代码更简洁、高效，并且增强代码的可读性与可维护性。
