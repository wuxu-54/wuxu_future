# 库

库类型分为：全局库、模块化库

## 全局库

全局库是指能在全局命名空间下访问的（例如：不需要使用任何形式的import）

### 全局库模版

模版文件global.d.ts

### 识别全局库

当你查看全局库的源代码时，你通常会看到：

* 顶级的var语句或function声明
* 一个或多个赋值语句到window.someName
* 假设DOM原始值像document或window是存在的

你不会看到：

* 检查是否使用或如何使用模块加载器，比如require或define
* CommonJS/Node.js风格的导入如var fs = require("fs");
* define(...)调用
* 文档里说明了如何去require或导入这个库

### 注意

书写全局声明文件时，允许在全局作用域里定义很多类型，所以需要防止命名冲突

如何做？

使用命名空间，避免冲突

```typescript
declare namespace cats {
    interface KittySettings { }
}
```

---

## 模块化库

一些库只能工作在模块加载器的环境下。（简单来说就是局部的，需要通过导入使用）

### 识别模块化库

从代码上识别模块化库

模块库至少会包含下列具有代表性的条目之一：

* 无条件的调用require或define
* 像import * as a from 'b'; or export c;这样的声明
* 赋值给exports或module.exports

它们极少包含：

* 对window或global的赋值

## UMD库

UMD模块是指那些既可以作为模块使用（通过导入）又可以作为全局（在没有模块加载器的环境里）使用的模块。

### 识别UMD库

* UMD模块会检查是否存在`模块加载器`环境。

    ```typescript
    (function (root, factory) {
        if (typeof define === "function" && define.amd) {
            define(["libName"], factory);
        } else if (typeof module === "object" && module.exports) {
            module.exports = factory(require("libName"));
        } else {
            root.returnExports = factory(root.libName);
        }
    }(this, function (b) {
    ```

* 如果你在库的源码里看到了`typeof define`，`typeof window`，或`typeof module`这样的测试，尤其是在文件的顶端，那么它几乎就是一个UMD库。

* UMD库的文档里经常会包含通过require“在Node.js里使用”例子， 和“在浏览器里使用”的例子，展示如何使用 `<script>`标签去加载脚本。

---

## 全局插件

一个全局插件是全局代码，它们会改变全局对象的结构。

### 识别

```typescript
var x = "hello, world";
// Creates new methods on built-in types
console.log(x.startsWithHello());

var y = [1, 2, 3];
// Creates new methods on built-in types
console.log(y.reverseAndSort());
```

---

## 使用依赖

1. 如果你的库依赖于某个全局库，使用`/// <reference types="..." />`指令
2. 如果你的库依赖于模块，使用import语句
3. 如果你的全局库依赖于某个UMD模块，使用`/// <reference types`指令
4. 如果你的模块或UMD库依赖于一个UMD库，使用import语句,不要使用`/// <reference`指令去声明UMD库的依赖！
