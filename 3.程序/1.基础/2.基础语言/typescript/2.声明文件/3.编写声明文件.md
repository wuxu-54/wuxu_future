# 编写声明文件

啥是声明文件？

答：声明文件就是对库API的使用文件。使用外部API，编译时会报错，此时增加相同结构的声明`declare`，表示向编译器保证此API一定有定义，别报错。

---

如何书写高质量的TypeScript声明文件?

[传送门](https://www.tslang.cn/docs/handbook/declaration-files/by-example.html)

---

以下这些例子是按复杂度递增的顺序组织的。

## 例子-全局变量

目的：全局变量foo包含了存在组件总数。

声明

```typescript
declare var foo: number;
```

使用

```typescript
console.log("Half the number of widgets is " + (foo / 2));
```

## 例子-全局函数

目的：用一个字符串参数调用greet函数向用户显示一条欢迎信息。

声明

```typescript
declare function greet(greeting: string): void;
```

使用

```typescript
greet("hello, world");
```

## 例子-带属性的对象

目的：全局变量myLib包含一个makeGreeting函数， 还有一个属性 numberOfGreetings指示目前为止欢迎数量。

声明

```typescript
declare namespace myLib {
    function makeGreeting(s: string): string;
    let numberOfGreetings: number;
}
```

使用

```typescript
    let result = myLib.makeGreeting("hello, world");
    console.log("The computed greeting is:" + result);

    let count = myLib.numberOfGreetings;
```

## 例子-函数重载

目的：getWidget函数接收一个数字，返回一个组件，或接收一个字符串并返回一个组件数组。

声明

```typescript
declare function getWidget(n: number): Widget;
declare function getWidget(s: string): Widget[];
```

使用

```typescript
let x: Widget = getWidget(43);
let arr: Widget[] = getWidget("all of them");
```

## 可重用类型（接口）

目的：
当指定一个欢迎词时，你必须传入一个GreetingSettings对象。 这个对象具有以下几个属性：

1. greeting：必需的字符串
2. duration: 可靠的时长（毫秒表示）
3. color: 可选字符串，比如‘#ff00ff’

声明

```typescript
interface GreetingSettings {
greeting: string;
duration?: number;
color?: string;
}

declare function greet(setting: GreetingSettings): void;
```

使用

```typescript
greet({
  greeting: "hello world",
  duration: 4000
});
```

* 可重用类型（类型别名）

目的：在任何需要欢迎词的地方，你可以提供一个string，一个返回string的函数或一个Greeter实例。

声明

```typescript
type GreetingLike = string | (() => string) | MyGreeter;
declare function greet(g: GreetingLike): void;
```

使用

```typescript
function getGreeting() {
    return "howdy";
}
class MyGreeter extends Greeter { }

greet("hello");
greet(getGreeting);
greet(new MyGreeter());
```

* 组织类型

目的: greeter对象能够记录到文件或显示一个警告。 你可以为 .log(...)提供LogOptions和为.alert(...)提供选项。

声明

```typescript
declare namespace GreetingLib {//其实就是声明合并，可以看声明合并章节，有详细描述
    interface LogOptions {
        verbose?: boolean;
    }
    interface AlertOptions {
        modal: boolean;
        title?: string;
        color?: string;
    }
}
```

使用

```typescript
const g = new Greeter("Hello");
g.log({ verbose: true });
g.alert({ modal: false, title: "Current Greeting" });
```

## 类

目的：你可以通过实例化Greeter对象来创建欢迎词，或者继承Greeter对象来自定义欢迎词。

声明

```typescript
//使用declare class描述一个类或像类一样的对象。 类可以有属性和方法，就和构造函数一样。
declare class Greeter {
    constructor(greeting: string);

    greeting: string;
    showGreeting(): void;
}
```

使用

```typescript
const myGreeter = new Greeter("hello, world");
myGreeter.greeting = "howdy";
myGreeter.showGreeting();

class SpecialGreeter extends Greeter {
    constructor() {
        super("Very special greetings");
    }
}
```

---
