# 元数据

`reflect-metadata`库,此库提供了一些方便的API，配合装饰器函数。目前是实验性的，可能会有修改。

## 安装库

npm i reflect-metadata --save

## 配置

你需要在命令行或 tsconfig.json里启用emitDecoratorMetadata编译器选项。

1. 命令行

    tsc --target ES5 --experimentalDecorators --emitDecoratorMetadata

2. tsconfig.json

    ```json
    {
        "compilerOptions": {
            "target": "ES5",
            "experimentalDecorators": true,
            "emitDecoratorMetadata": true
        }
    }
    ```

## 使用

示例：

```typescript
import "reflect-metadata";

class Point {
    x: number;
    y: number;
}

class Line {
    private _p0: Point;
    private _p1: Point;

    @validate
    set p0(value: Point) { this._p0 = value; }
    get p0() { return this._p0; }

    @validate
    set p1(value: Point) { this._p1 = value; }
    get p1() { return this._p1; }
}

function validate<T>(target: any, propertyKey: string, descriptor: TypedPropertyDescriptor<T>) {
    let set = descriptor.set;
    descriptor.set = function (value: T) {
        let type = Reflect.getMetadata("design:type", target, propertyKey);//这就是库里面一些api
        if (!(value instanceof type)) {
            throw new TypeError("Invalid type.");
        }
        set(value);
    }
}
```