# 外部模块

要想描述非TypeScript编写的类库的类型，我们需要声明类库所暴露出的API。它们通常是在`.d.ts文件`里定义的(相当于把声明放到此类文件，TS文件中可以直接用无需引入具体文件)。 如果你熟悉C/C++，你可以把它们当做 .h文件。

> `.d.ts` 只包含声明，不包含实现。 目的是加快编译速度和减小体积，让TS文件直接使用。
---

## .d.ts封装及引入

使用顶级的 export声明来为每个模块都定义一个.d.ts文件，但最好还是写在一个大的.d.ts文件里。

```typescript
//node.d.ts 文件
declare module "url" {
    export interface Url {
        protocol?: string;
        hostname?: string;
        pathname?: string;
    }

    export function parse(urlStr: string, parseQueryString?, slashesDenoteHost?): Url;
}

declare module "path" {
    export function normalize(p: string): string;
    export function join(...paths: any[]): string;
    export let sep: string;
}
```

可以`/// <reference> node.d.ts`并且使用`import url = require("url");或import * as URL from "url"`加载模块。

```typescript
/// <reference path="node.d.ts"/>
import * as URL from "url";
let myUrl = URL.parse("http://www.typescriptlang.org");
```

`///`是三斜线指令，后面会细讲

---

## 外部模块简写

假如使用一个新模块之前花时间不提前声明，可以采用声明的简写形式以便能够快速使用它。

```typescript
// declarations.d.ts
declare module "hot-new-module";
```

简写模块里所有导出的类型将是any。

```typescript
import x, {y} from "hot-new-module";
x(y);
```

---

在 TypeScript 中，`.d.ts` 文件扮演着非常重要的角色。这类文件被称为声明文件（Declaration Files），它们的主要功能是为现有的 JavaScript 代码提供类型信息。这使得 TypeScript 编译器能够理解这些 JavaScript 代码的结构和意图，即使这些代码本身并不包含任何类型注解。下面将详细介绍 `.d.ts` 文件的作用、编写方式及其重要性。

### 什么是 `.d.ts` 文件？

`.d.ts` 文件是一种特殊的 TypeScript 文件，它不包含任何实际的可执行代码，只包含类型声明。它的存在是为了让 TypeScript 能够识别那些没有类型信息的 JavaScript 库或模块，并且可以在编译时进行静态类型检查。这意味着你可以在保持原有 JavaScript 代码不变的情况下，享受到 TypeScript 强大的类型系统带来的好处，比如更好的代码补全、错误提示以及类型安全保证。

### `.d.ts` 文件的作用

1. **提供类型信息**：最核心的功能是为 TypeScript 提供有关 JavaScript API 的类型信息。当你使用第三方库时，如果没有对应的 `.d.ts` 文件，TypeScript 将无法知道这些库中定义的函数、类、接口等的具体类型，导致编译器无法完成有效的类型检查。

2. **无需执行代码即可获得类型校验**：通过 `.d.ts` 文件，TypeScript 可以在编译阶段就对代码进行类型校验，而不需要运行代码。这样可以提前发现潜在的类型错误，提高开发效率和代码质量。

3. **帮助 IDE 提供代码补全和提示**：IDE（如 VSCode）可以利用 `.d.ts` 文件提供的类型信息来增强代码编辑体验，包括自动补全、跳转到定义等功能，极大地提高了开发者的生产力。

4. **促进社区协作**：随着越来越多的流行 JavaScript 库有了对应的 `.d.ts` 文件，这促进了开发者之间的合作。社区成员共同维护这些类型声明文件，确保了它们的更新和准确性。

### 如何使用 `.d.ts` 文件？

- **通过 npm 安装**：对于许多流行的 JavaScript 库，TypeScript 社区已经提供了相应的 `@types` 包。你可以直接通过 npm 或 yarn 安装这些包，例如 `npm install @types/jquery --save-dev`，这会自动下载并配置好 jQuery 的类型声明文件。
  
- **手动创建**：如果某个库没有现成的 `.d.ts` 文件，或者你需要为自己的 JavaScript 模块添加类型信息，那么就需要手动创建一个 `.d.ts` 文件。在这个文件中，你需要使用 `declare` 关键字来声明全局变量、函数、类、接口等，并指定它们的类型。

### `.ts` vs `.d.ts`

虽然 `.ts` 和 `.d.ts` 都是 TypeScript 文件的一部分，但它们有着不同的用途。`.ts` 文件包含了实际的应用逻辑和类型注解，最终会被编译成 JavaScript 代码；而 `.d.ts` 文件则纯粹用于提供类型信息，不会被编译成 JavaScript，仅用于静态类型检查。

### 实例分析

假设我们有一个简单的 JavaScript 函数库 `typescript-desc`，其中包含一个名为 `getName` 的函数。为了在 TypeScript 中使用这个函数库，我们需要为其创建一个 `.d.ts` 文件，例如：

```javascript
// typescript-desc/index.js
const getName = (name) => {
    console.log(name);
};
export { getName };
```

接下来，在同一个目录下创建 `index.d.ts` 文件，并定义 `getName` 函数的类型声明：

```typescript
// typescript-desc/index.d.ts
/** 一个获取名字的函数 */
export declare function getName(name: string): void;
```

现在，在另一个 TypeScript 项目中引入 `typescript-desc` 并调用 `getName` 函数时，TypeScript 编译器就能根据 `.d.ts` 文件中的类型声明提供智能感知支持。

总之，`.d.ts` 文件是连接 TypeScript 与现有 JavaScript 生态系统的桥梁，它不仅增强了 TypeScript 的实用性，也使得从 JavaScript 迁移到 TypeScript 的过程变得更加平滑。无论是个人项目还是大型企业应用，合理利用 `.d.ts` 文件都能带来显著的好处。
