# require.js使用

## 引入

1. [官网](http://requirejs.org/docs/download.html)下载
2. 本地script配置。加载这个文件，也可能造成网页失去响应。解决办法有两个：
    * 一个是把它放在网页底部加载
    * 配置异步加载属性
3. 设置主模块，网页入口：`<script src="js/require.js" data-main="js/main"></script>`

---

## 基本api

require 三个变量：

* `define` ： 定义一个模块
* `require` ： 加载以来模块，执行加载完成后的回调函数
* `requirejs`。`require` ===`requirejs`，一般直接使用`require`

### js加载示例

在 **localjs/a.js**文件中定义一个模块

```js
define(function(){
    function fun1(){
        alert("ttt");
    }
    fun1();
})
```

在另一个文件中使用

```js
//不需要回调函数
require(["localjs/a"]);

//增加回调函数，a加载完后会收到回调
require(["localjs/a"],function(){
    alert("load finished");
})
```

---

## require函数

* require 第一个参数：**不能带有.js后缀**的模块路径的**数组**
* require 第二个参数：回调函数

### 回调函数的参数

在RequireJS中，模块的加载通常通过require函数完成，并且可以接受一个回调函数作为参数。这个回调函数将在所有指定的模块加载完成后执行。这个回调函数的参数与你在require中指定的模块数量相关。

如果你在require中指定了单个模块，回调函数将只有一个参数，它是加载的模块的导出值。

如果你在require中指定了多个模块，回调函数将按照你指定的顺序接收到每个模块的导出值作为参数。如果某个模块不输出变量值，则没有，所以尽量将输出的模块写在前面，防止位置错乱引发误解。

以下是使用RequireJS的示例代码：

单个模块：

```js
require(['myModule'], function(myModule) {
    // 使用myModule做一些事情
});
```

多个模块：

```js
require(['moduleA', 'moduleB'], function(moduleA, moduleB) {
    // 使用moduleA和moduleB做一些事情
});
```

如果你需要确保所有模块都加载完成，并且要求它们以特定的顺序加载，你可以使用`shim`配置来指定依赖关系和加载顺序。

如果你想要在加载完成后不关心模块的具体内容，只关心加载成功与否，可以不在回调函数中使用参数：

```js
require(['moduleA', 'moduleB'], function() {
    console.log('所有模块都加载完成');
});
```

以上代码展示了如何在RequireJS中使用回调函数的参数，并且提供了不同场景下的示例。

---

## require.config

require.config是用来配置模块,例如设置包括网络地址的加载位置

```js
require.config({
    // 设定模块路径
    paths : {
        // 相当于给路径起个别名
        "jquery" : ["http://libs.baidu.com/jquery/2.0.3/jquery"]   
    }
})

// 使用时，直接使用config paths中设定的别名。注意不要有 .js 后缀
require(["jquery","js/a"],function($){
    $(function(){
        alert("load finished");  
    })
})
```

paths还有一个重要的功能，就是可以配置多个路径，如果远程cdn库没有加载成功，可以加载本地的库，如：

```js
require.config({
    paths : {
        //在这里，又增加了个本地js，在第一个元素加载失败后，会自动去加载第二个元素。如果第一个加载成功，后面就不会再加载了。
        "jquery" : ["http://libs.baidu.com/jquery/2.0.3/jquery", "js/jquery"],
        "a" : "js/a"   
    }
})
require(["jquery","a"],function(ttt){
    ttt(function(){
        alert("load finished");  
    })
})
```

---

## 全局配置

上面示例，会重复出现`require.config`，requirejs提供了主数据功能：

script标签通过`data-main="js/main"`属性指定主数据（也叫根路径）

```js
// 创建main js
require.config({
    paths : {
        "jquery" : ["http://libs.baidu.com/jquery/2.0.3/jquery", "js/jquery"],
        "a" : "js/a"   
    }
})
//script data-main属性指定根路径
<script data-main="js/main" src="js/require.js"></script>
```

主数据的config，相当于全局配置，其他config会受这个影响会采用全局配置的内容，除非自己设置了。

---

## 第三方模块

符合AMD规范的模块，可以通过define声明，通过require直接引入。但不符合AMD规范的模块需要使用 `shim` property。

比如要是用`underscore类库，但是他并没有实现AMD规范，那我们可以这样配置：

```js
require.config({
    shim: {
        "underscore" : {
            exports : "_";
        }
    }
})

// 其他模块引入
require(["underscore"], function(_){
    _.each([1,2,3], alert);
})
```
