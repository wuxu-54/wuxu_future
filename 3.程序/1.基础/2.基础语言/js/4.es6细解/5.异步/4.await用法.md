# js中await用法

在JavaScript中，`await`关键字与`async`函数一起使用，可以使异步代码的编写和阅读更接近于同步代码。await可以使代码在执行到该语句时暂停，等待`Promise`解决（resolve）或拒绝（reject），然后继续执行下一行代码。以下是await的一些使用方法和注意事项：

## 使用方法

### 定义async函数

要使用await，首先需要在一个函数声明前添加async关键字。这样，该函数就可以使用await，并且它的返回值会自动包装成一个Promise。

```js
async function fetchData() {
    try {
        const response = await fetch('https://api.example.com/data');
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('There was a problem with the fetch operation:', error);
        return null;
    }
}
```

### 等待Promise解决

await后面通常跟随一个返回Promise对象的函数调用。执行到await时，如果Promise已经解决，await会立即返回解决的值；如果Promise还在等待，await会使代码暂停，直到Promise解决。

```js
const result = await someAsyncFunction();
```

### 错误处理

当await的Promise被拒绝时，会抛出一个错误。这个错误可以被包含await的try...catch块捕获。

```js
try {
    const data = await fetchData();
    console.log(data);
} catch (error) {
    console.error('An error occurred:', error);
}
```

### 并行执行异步任务

可以使用Promise.all与await结合，等待多个异步任务同时完成。

```js
async function fetchAllData() {
    try {
        const [data1, data2, data3] = await Promise.all([
            fetch('url1'),
            fetch('url2'),
            fetch('url3')
        ]);
        const [data1Json, data2Json, data3Json] = await Promise.all(data1.map(response => response.json()));
        return {
            data1: data1Json,
            data2: data2Json,
            data3: data3Json
        };
    } catch (error) {
        console.error('An error occurred during fetchAllData:', error);
        return null;
    }
}
```

## 注意事项

1. **只能在async函数中使用**：await只能在用async修饰的函数内部使用。在普通函数或全局作用域中使用await会导致语法错误。

2. **返回值**：await会返回Promise解决时传递的值。如果Promise被拒绝，await会抛出一个错误，除非它位于try...catch结构中。

3. **不能与箭头函数一起使用**：箭头函数没有自己的this上下文，而async函数需要有自己的this上下文。因此，你不能在一个箭头函数内部使用async关键字。

4. **性能考虑**：虽然await可以让异步代码看起来像同步代码，但它并不改变JavaScript的事件循环和非阻塞I/O模型。正确使用await可以提高代码的可读性和可维护性，但滥用await可能会导致不必要的等待和性能问题。

通过合理使用await，你可以编写出更加简洁、易于理解的异步代码，同时保持JavaScript的非阻塞特性和高性能。
