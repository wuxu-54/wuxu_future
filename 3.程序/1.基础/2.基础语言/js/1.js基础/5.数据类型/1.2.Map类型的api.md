# Map详解

与java不同，JavaScript中的Map是**有序的**。这意味着Map中的元素会按照它们被插入的顺序进行存储和遍历。

[TOC]

## 底层原理

在JavaScript中，`Map`的底层原理通常依赖于哈希表（Hash Table）或红黑树等高效的数据结构来实现。以下是对`Map`底层原理的详细解释：

### 哈希表实现

1. **哈希函数**：
   - 哈希表是一种基于数组的数据结构，它通过哈希函数将键转化为数组的索引。
   - 哈希函数的设计是关键，它应该能够将键均匀地映射到数组的索引上，以减少哈希冲突（即不同的键映射到相同的索引）的可能性。

2. **哈希冲突处理**：
   - 当发生哈希冲突时，即两个键映射到同一个索引时，需要采取一定的策略来处理。常见的策略包括链地址法（使用链表存储冲突的元素）和开放地址法（寻找下一个可用的空槽）。
   - 在JavaScript的`Map`实现中，通常会使用链地址法来处理哈希冲突。即当发生冲突时，会在该索引位置存储一个链表，链表中的每个节点都包含一个键-值对。

3. **查找、插入和删除操作**：
   - 查找操作：通过哈希函数计算键的哈希值，然后定位到数组中的索引位置。如果该位置是一个链表，则遍历链表以找到匹配的键。
   - 插入操作：同样通过哈希函数计算键的哈希值，并定位到数组中的索引位置。如果该位置为空，则直接存储键-值对；如果该位置已有元素（可能是链表），则将新的键-值对添加到链表中。
   - 删除操作：通过哈希函数找到键对应的索引位置，然后遍历链表以找到要删除的键-值对，并将其从链表中移除。

### 红黑树实现（某些特定情况或引擎中）

虽然哈希表是`Map`的常见实现方式，但在某些特定情况或JavaScript引擎中，`Map`也可能使用红黑树等平衡二叉树来实现。红黑树是一种自平衡的二叉查找树，它能够在O(log n)的时间复杂度内完成查找、插入和删除操作。

- 当`Map`中的元素数量较少时，使用红黑树可能不是最优的选择，因为红黑树的维护成本（如旋转和重新着色）相对较高。然而，在某些特定情况下（如需要保持元素的有序性），红黑树可能是一个更好的选择。
- 需要注意的是，并非所有的JavaScript引擎都使用红黑树来实现`Map`。这取决于引擎的具体实现和性能优化策略。

## js中那map怎么保证有序呢？

在JavaScript中，尽管`Map`是基于哈希表实现的，但它确实保证了元素的插入顺序。这意味着当你遍历一个`Map`对象时，元素会按照它们被插入的顺序返回。

`Map`之所以能够保持有序性，是因为其内部实现不仅依赖于哈希表来快速定位元素，还额外维护了一个顺序列表（或类似的数据结构）。这个顺序列表记录了元素的插入顺序，使得在遍历时能够按照这个顺序来返回元素。

具体来说，当你向`Map`中插入一个新元素时，哈希表会负责将键映射到一个特定的位置（桶或链表节点），同时顺序列表也会记录这个新元素的插入。在遍历时，`Map`会按照顺序列表中的记录来依次访问元素，而不是仅仅依赖于哈希表的键值对存储。

这种设计使得`Map`既能够保持高效的查找、插入和删除操作（得益于哈希表的性能），又能够保持元素的插入顺序（得益于顺序列表的维护）。因此，`Map`成为了JavaScript中一个非常有用和灵活的数据结构，特别适用于需要按顺序存储和访问键值对的场景。

总的来说，尽管`Map`是基于哈希表实现的，但它通过额外的数据结构（如顺序列表）来维护元素的插入顺序，从而保证了遍历时的有序性。

## 通用api

在 JavaScript 中，`Map` 是一种内置的数据结构，它允许你存储键值对，并且任何值（对象或原始值）都可以作为键。这与普通的对象不同，普通的对象只能使用字符串或 Symbol 作为键。

下面是一些关于 `Map` 数据结构的示例和用法：

### 创建 Map

你可以使用 `new Map()` 来创建一个新的 `Map` 对象：

```javascript
let map = new Map();
```

### 添加元素

你可以使用 `set` 方法来向 `Map` 中添加元素：

```javascript
map.set('name', 'Alice');
map.set('age', 25);
map.set('city', 'New York');
```

或者，你也可以在创建 `Map` 时传入一个二维数组来初始化它：

```javascript
let map = new Map([
  ['name', 'Alice'],
  ['age', 25],
  ['city', 'New York']
]);
```

### 获取元素

你可以使用 `get` 方法来获取 `Map` 中的元素：

```javascript
let name = map.get('name'); // 'Alice'
let age = map.get('age');   // 25
```

### 检查键是否存在

你可以使用 `has` 方法来检查 `Map` 中是否包含某个键：

```javascript
let hasName = map.has('name'); // true
let hasCountry = map.has('country'); // false
```

### 获取键和值的迭代器

你可以使用 `keys`、`values` 和 `entries` 方法来获取 `Map` 的键、值或键值对的迭代器：

```javascript
for (let key of map.keys()) {
  console.log(key); // 'name', 'age', 'city'
}

for (let value of map.values()) {
  console.log(value); // 'Alice', 25, 'New York'
}

for (let [key, value] of map.entries()) {
  console.log(key, value); // 'name' 'Alice', 'age' 25, 'city' 'New York'
}
```

### 删除元素

你可以使用 `delete` 方法来从 `Map` 中删除元素：

```javascript
map.delete('age');
let ageAfterDelete = map.get('age'); // undefined
```

### 获取 Map 的大小

你可以使用 `size` 属性来获取 `Map` 中元素的数量：

```javascript
let size = map.size; // 2（因为我们删除了一个元素）
```

### 清空 Map

你可以使用 `clear` 方法来清空 `Map` 中的所有元素：

```javascript
map.clear();
let isEmpty = map.size === 0; // true
```

### 遍历 Map

除了使用迭代器方法外，你还可以使用 `forEach` 方法来遍历 `Map`：

```javascript
map.forEach((value, key, map) => {
  console.log(key, value);
});
```

这里的回调函数接收三个参数：值、键和 `Map` 对象本身。

### 注意事项

- `Map` 中的键是唯一的，就像对象中的键一样。如果你尝试使用相同的键来设置两个值，后面的值会覆盖前面的值。
- `Map` 记住元素的插入顺序，因此你可以按照插入顺序来遍历它们。这与普通的对象不同，对象的属性没有固定的顺序。
