# 垃圾回收机制

## 内存生命周期

1.内存分配：声明变量、函数、对象时，系统自动分配内存。  
2.内存使用：读写内存，使用变量、函数  
3.内存回收：使用完成，系统自动回收无用的内存。  

说明：  
1.全局变量一般不回收，关闭页面时回收  
2.局部变量，随函数或块域执行完成，会被自动回收。

## 内存泄漏

程序分配的内存因某种原因导致程序未释放，叫内存泄漏。

## 内存分配

1.栈：系统自动分配释放函数的参数、局部变量等，基础数据类型放在栈中  
2.堆：由程序员控制分配释放，若程序员不释放，由垃圾回收机制回收。复制数据类型在堆里

## 垃圾回收算法

算法：引用计数法和标记清除法，还有其他算法，不做介绍了

### 引用计数法

1. 记录被引用次数  
2. 引用一次就加一，减少一个就减一  
3. 如果引用次数为0，释放。

问题：两个对象相互引用，垃圾不会回收，导致内存泄漏。java中也有这个问题，后面gc回收的机制也不是引用计数，也采用标记清除法

### 标记清除法

原理

1. 从引用根节点对象出发
2. 标记: 可达的对象
3. 清除: 对堆内存从头到尾线性变量，清除所有未标记的对象。（清除并不是置空，而是放在空闲地址列表，当有新对象加载，会判断空闲地址列表内存，如果可用会覆盖原内存地址数据）

问题  

* 标记清除算法的效率不算高。
* 在进行GC的时候，需要停止整个应用程序，用户体验较差。
* 这种方式清理出来的空闲内存是不连续的，产生内碎片，需要维护一个空闲列表。
