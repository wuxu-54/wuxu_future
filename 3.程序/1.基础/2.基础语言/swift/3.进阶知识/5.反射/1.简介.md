# 反射

在 Swift 中，反射是指程序在运行时检查和修改其自身的结构和行为的能力。Swift 提供了几种机制来实现反射，主要包括：

1. **`Mirror` 类**：这是 Swift 标准库中提供的一个反射工具，可以用来检查实例的属性和类型信息。

2. **`CustomReflectable` 协议**：允许自定义类型提供更多控制其在反射时显示的信息。

3. **`dump` 函数**：一个快捷方式，用于打印一个对象的属性和值。

## 使用 `Mirror` 类

`Mirror` 类可以用来反射任何类型的实例，包括类、结构体和枚举。它提供了一种方法来遍历实例的所有属性。

下面是一个使用 `Mirror` 类的示例：

```swift
class Person {
    var name: String
    var age: Int

    init(name: String, age: Int) {
        self.name = name
        self.age = age
    }
}

let person = Person(name: "John", age: 30)
let mirror = Mirror(reflecting: person)

for child in mirror.children {
    print("\(child.label ?? "unknown"): \(child.value)")
}
// 输出：
// name: John
// age: 30
```

在这个例子中，`Mirror` 对象被用来反射 `Person` 类的实例。通过遍历 `mirror.children`，我们可以访问每个属性的标签（如果有的话）和值。

## 使用 `CustomReflectable` 协议

`CustomReflectable` 协议允许你自定义类型在反射时的行为。这在你需要控制反射输出时非常有用。

```swift
struct Rectangle: CustomReflectable {
    var width: Int
    var height: Int

    // 定义反射时显示的属性
    var customMirror: Mirror {
        return Mirror(CustomReflectableWrapper(width, height))
    }
}

struct CustomReflectableWrapper<T, U>: CustomReflectable {
    var width: T
    var height: U

    // 定义反射时显示的属性
    var customMirror: Mirror {
        return Mirror(CustomReflectableWrapper(width, height))
    }
}

let rectangle = Rectangle(width: 10, height: 20)
dump(rectangle)
// 输出：
// Rectangle
//   - width: 10
//   - height: 20
```

在这个例子中，`Rectangle` 结构体实现了 `CustomReflectable` 协议，并提供了一个自定义的 `customMirror` 属性。这样，当使用 `dump` 函数时，它会显示我们定义的属性。

## 使用 `dump` 函数

`dump` 函数是一个快捷方式，用于打印一个对象的属性和值。它内部使用了 `Mirror` 类。

```swift
struct Point {
    var x: Int
    var y: Int
}

let point = Point(x: 5, y: 10)
dump(point)
// 输出：
// ▿ Point
//   - x: 5
//   - y: 10
```

在这个例子中，`dump` 函数被用来打印 `Point` 结构体的实例。它提供了一种快速查看对象属性和值的方法。

Swift 的反射机制虽然不如一些其他语言（如 Java 或 Python）那么强大，但它提供了足够的功能来支持许多常见的反射需求。
