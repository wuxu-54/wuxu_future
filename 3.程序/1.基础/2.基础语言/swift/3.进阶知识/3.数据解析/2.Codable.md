# `Codable`

在 Swift 中，`Codable` 是一个协议，它合并了 `Encodable` 和 `Decodable` 两个协议，用于在 Swift 标准库中提供对数据的序列化（编码）和反序列化（解码）的支持。这个协议主要用于简化对象与外部数据格式（如 JSON、Property List）之间的转换。

## 基本概念

- **Encodable**:
  - 用于将数据结构转换为外部表示（如 JSON、XML）。
  - 你需要实现 `encode(to:)` 方法来指定如何将数据转换为编码器可以理解的形式。

- **Decodable**:
  - 用于将外部数据（如 JSON、XML）转换回数据结构。
  - 你需要实现 `init(from:)` 方法来指定如何从解码器中提取数据并创建实例。

## 使用 Codable

当你的自定义类型遵循 `Codable` 协议时，Swift 提供了自动合成的实现，你不需要手动实现 `encode(to:)` 和 `init(from:)` 方法。这使得序列化和反序列化变得非常简单。

### 示例：定义 Codable 模型

```swift
struct User: Codable {
    var name: String
    var age: Int
}
```

### 编码（序列化）

将 `User` 实例转换为 JSON：

```swift
import Foundation

let user = User(name: "John", age: 30)
let encoder = JSONEncoder()
encoder.outputFormatting = .prettyPrinted

do {
    let data = try encoder.encode(user)
    if let jsonString = String(data: data, encoding: .utf8) {
        print(jsonString)
    }
} catch {
    print("Error encoding JSON: \(error)")
}
```

### 解码（反序列化）

将 JSON 字符串转换回 `User` 实例：

```swift
let json = """
{
    "name": "John",
    "age": 30
}
""".data(using: .utf8)!

let decoder = JSONDecoder()

do {
    let user = try decoder.decode(User.self, from: json)
    print("Name: \(user.name), Age: \(user.age)")
} catch {
    print("Error decoding JSON: \(error)")
}
```

## 自定义 Codable 转换

如果你需要自定义编码或解码过程，可以通过实现 `encode(to:)` 和 `init(from:)` 方法来实现。例如，你可能希望在编码时修改某些属性的名称，或者在解码时进行额外的数据验证。

### 自定义编码

```swift
struct User: Codable {
    var name: String
    var age: Int

    enum CodingKeys: String, CodingKey {
        case name
        case age
        case customName = "username"
    }

    func encode(to encoder: Encoder) throws {
        var container = encoder.container(keyedBy: CodingKeys.self)
        try container.encode(name, forKey: .customName)
        try container.encode(age, forKey: .age)
    }
}
```

### 自定义解码

```swift
init(from decoder: Decoder) throws {
    let container = try decoder.container(keyedBy: CodingKeys.self)
    name = try container.decode(String.self, forKey: .customName)
    age = try container.decode(Int.self, forKey: .age)
}
```

## 注意事项

- `Codable` 是 `NSCoding` 的现代替代品，专门用于 Swift。
- 确保所有需要序列化的属性都是可选的或有默认值，以避免在解码时出现错误。
- 自定义 `Codable` 转换可以让你更灵活地处理数据，但也需要更多的代码。

`Codable` 协议是 Swift 标准库中处理数据序列化和反序列化的强大工具，它简化了与外部数据格式的交互，使得数据模型更加灵活和强大。
