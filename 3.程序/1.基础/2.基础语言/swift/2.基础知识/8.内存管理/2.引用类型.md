# 弱引用与强引用

在Swift的自动引用计数（ARC）系统中，强引用、弱引用和无主引用是管理内存的三种主要方式。以下是它们的使用详解：

## 强引用（Strong Reference）

默认引用，可以使用`strong`关键字明确写明

- 强引用是最常见的引用类型，会增加对象的引用计数。
- 强引用可能导致循环引用，尤其是当两个对象相互持有强引用时。

**使用场景**：

- 通常用于对象的正常生命周期管理，确保对象在被引用时不会被销毁。

**示例**：

```swift
class Person {
    var name: String
    init(name: String) {
        self.name = name
    }
}

class Car {
    var owner: Person?
    init(owner: Person) {
        self.owner = owner
    }
}

let person = Person(name: "Alice")
let car = Car(owner: person)
// person 和 car 相互持有强引用，但不会形成循环引用，因为 car 是 person 的属性。
```

## 弱引用（Weak Reference）

`weak` 关键字修饰

- 弱引用不会增加对象的引用计数。
- 弱引用在对象被销毁时会自动置为`nil`，因此可以打破循环引用。

**使用场景**：

- 用于避免循环引用，尤其是在对象之间存在相互引用的情况。

**示例**：

```swift
class Person {
    weak var spouse: Person?
    var name: String
    init(name: String) {
        self.name = name
    }
}

let alice = Person(name: "Alice")
let bob = Person(name: "Bob")
alice.spouse = bob
bob.spouse = alice
// alice 和 bob 通过弱引用相互引用，不会造成循环引用。
```

## 无主引用（Unowned Reference）

`unowned` 关键字修饰

- 无主引用也不会增加对象的引用计数。
- 与弱引用不同，无主引用假定它引用的对象一直存在，直到引用本身被销毁。如果无主引用的对象提前被销毁，访问无主引用将导致运行时错误。

**使用场景**：

- 用于确保对象的生命周期比引用它的对象更长，或者在相同的生命周期内。

**示例**：

```swift
class Building {
    unowned var tenant: Company
    init(tenant: Company) {
        self.tenant = tenant
    }
}

class Company {
    var name: String
    init(name: String) {
        self.name = name
    }
}

let company = Company(name: "Swift Inc.")
let building = Building(tenant: company)
// building 持有对 company 的无主引用，因为 company 的生命周期比 building 长。
```

## 使用注意事项

- 使用弱引用或无主引用时，要确保引用的对象在引用期间保持有效，否则可能会导致程序崩溃。
- 在使用弱引用和无主引用时，通常需要配合`if let`或`guard let`来进行可选绑定，以安全地解包。
- 强引用是默认的引用类型，如果需要，可以显式地使用`strong`关键字来指定。

通过合理使用强引用、弱引用和无主引用，可以有效地管理内存，避免循环引用，并确保应用程序的稳定性和性能。
