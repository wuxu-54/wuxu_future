# 异常

在Swift中，异常处理是通过错误（Error）和断言（Assertion）来实现的，而不是使用传统意义上的“异常”（Exception）概念。以下是Swift中处理错误的几种方式：

1. **错误（Error）**：
   - Swift使用`Error`协议来表示执行过程中可能遇到的错误情况。任何遵循`Error`协议的类型都可以作为错误处理。

   ```swift
   enum MyError: Error {
       case invalidInput
       case operationFailed
   }
   ```

2. **抛出和捕获错误（Throwing and Catching）**：
   - 函数或方法可以使用`throws`关键字来声明它们可能会抛出错误。
   - 使用`try`关键字来调用可能抛出错误的函数，并使用`catch`来捕获并处理错误。

   ```swift
   func performTask() throws {
       // 如果发生错误，使用`throw`来抛出错误
       throw MyError.invalidInput
   }

   do {
       try performTask()
   } catch MyError.invalidInput {
       print("Invalid input provided.")
   } catch {
       print("An unknown error occurred.")
   }
   ```

3. **错误传播**：
   - 使用`throws`关键字的函数可以在其内部捕获错误并重新抛出，或者直接传递错误到调用者。

   ```swift
   func wrapperFunction() throws {
       do {
           try performTask()
       } catch MyError.invalidInput {
           // 处理错误或重新抛出
           throw
       }
   }
   ```

4. **断言（Assertion）**：
   - Swift中的断言用于调试目的，确保程序在开发期间满足某些条件。断言在发布版本中默认是禁用的。

   ```swift
   assert(condition, "Message if condition is false")
   ```

5. **先决条件（Precondition）**：
   - `precondition`用于确保函数或方法在执行前满足某些条件。如果条件不满足，程序将崩溃并显示提供的错误消息。

   ```swift
   precondition(condition, "Message if condition is false")
   ```

6. **后置条件（Postcondition）**：
   - `postcondition`用于确保函数或方法执行后满足某些条件。这有助于验证函数的实现是否正确。

   ```swift
   postcondition(condition, "Message if condition is false")
   ```

7. **失败构造器（Failable Initializers）**：
   - 可失败构造器是使用`init?`声明的构造器，它们可以返回`nil`以表示初始化失败。

   ```swift
   init?(data: Data) {
       guard let decoded = decode(data) else {
           return nil
       }
       self.decodedData = decoded
   }
   ```

8. **可选类型（Optionals）**：
   - 可选类型（Optionals）是Swift中处理可能不存在值的一种方式。它们经常用于防止因缺少值而导致的运行时错误。

Swift的错误处理模型鼓励开发者明确地表达和处理潜在的错误情况。通过使用`Error`协议和相关的关键字，开发者可以编写出更健壮、更易于维护的代码。

---

## `throw`与`rethrow`

在 Swift 中，`throws` 和 `rethrows` 关键字用于处理错误，它们是 Swift 错误处理的核心部分。错误处理允许你定义、抛出、捕获和处理错误，从而提高代码的健壮性和可维护性。

### throws

`throws` 关键字用于声明一个函数、方法或构造器可以抛出错误。当你在函数签名中使用 `throws` 时，你告诉调用者这个函数可能会抛出错误，调用者需要适当地处理这些错误。

#### 声明抛出错误的函数

```swift
enum FileError: Error {
    case fileNotFound
    case cannotReadFile
}

func readFile(at path: String) throws -> String {
    guard let content = try? String(contentsOfFile: path) else {
        throw FileError.fileNotFound
    }
    return content
}
```

在这个例子中，`readFile` 函数可能会抛出 `FileError` 类型的错误。任何调用 `readFile` 的代码都必须处理这些潜在的错误。

#### 处理抛出的错误

```swift
do {
    let content = try readFile(at: "/path/to/file.txt")
    print(content)
} catch FileError.fileNotFound {
    print("The file was not found.")
} catch {
    print("An unknown error occurred.")
}
```

在这个例子中，我们使用 `do-catch` 块来捕获和处理 `readFile` 函数抛出的错误。

### rethrows

`rethrows` 关键字用于声明一个函数、方法或构造器可能会抛出错误，但这些错误不是由该函数直接抛出的，而是由它调用的其他 `throws` 函数抛出的。这意味着函数本身不会进行任何错误处理，它只是将错误传递出去。

#### 声明可能抛出错误的函数

```swift
func processFile(at path: String) rethrows -> String {
    let content = try readFile(at: path)
    // 处理文件内容
    return content
}
```

在这个例子中，`processFile` 函数可能会抛出错误，因为它调用了 `readFile` 函数，后者可能会抛出错误。由于 `processFile` 没有添加任何额外的错误处理逻辑，它使用 `rethrows` 来表明它可能会抛出 `readFile` 抛出的错误。

### 区别

- **throws**: 表示函数可能会抛出错误，这些错误可以是函数内部产生的，也可以是它调用的其他 `throws` 函数产生的。
- **rethrows**: 表示函数可能会抛出错误，但这些错误完全是它调用的其他 `throws` 函数产生的，函数本身不会进行任何错误处理。

### 注意事项

- 使用错误处理时，确保你的错误是符合 `Error` 协议的类型。
- 适当地处理所有可能的错误情况，以避免程序崩溃或不可预测的行为。
- 考虑使用自定义错误类型来提供更丰富的错误信息。

通过使用 `throws` 和 `rethrows`，你可以创建更健壮的 Swift 应用程序，更好地处理运行时可能出现的各种错误情况。
