# 扩展

在Swift中，扩展（Extension）是一种向现有类、结构体、枚举或协议类型添加新功能的方式，而不需要修改原始的类型定义。扩展可以用来增加新的属性、方法、下标、协议的遵守，甚至是新的构造器。
>dart、ts、kotlin等都有

以下是Swift中扩展的一些关键特性：

1. **添加属性**：
   - 扩展可以添加计算属性和静态属性，但不能添加存储属性。

   ```swift
   extension Int {
       var isEven: Bool {
           return self % 2 == 0
       }
   }
   ```

2. **添加方法**：
   - 扩展可以为类型添加新的实例方法和类方法。

   ```swift
   extension String {
       func countWords() -> Int {
           return self.components(separatedBy: " ").count
       }
   }
   ```

3. **实现协议**：
   - 扩展可以用来为类型实现一个或多个协议。

   ```swift
   extension Int: Equatable {}

   extension String: CustomStringConvertible {
       var description: String {
           return self.uppercased()
       }
   }
   ```

4. **添加下标**：
   - 扩展可以为类型添加下标脚本。

   ```swift
   extension Array {
       subscript(safe index: Int) -> Element? {
           return indices.contains(index) ? self[index] : nil
       }
   }
   ```

5. **扩展构造器**：
   - 扩展可以添加新的构造器，但它们必须是可失败构造器（failable initializers）或便利构造器（convenience initializers）。

   ```swift
   extension Int {
       init?(string: String) {
           if let num = Int(string) {
               self.init(num)
           } else {
               return nil
           }
       }
   }
   ```

6. **扩展协议**：
   - 扩展可以用来为协议添加默认实现，这使得任何遵循协议的类型自动获得这些实现。

   ```swift
   protocol MyProtocol {
       var data: String { get }
   }

   extension MyProtocol {
       var data: String {
           return "Default data"
       }
   }
   ```

7. **扩展泛型**：
   - 为泛型类型添加功能
     如果你有一个泛型类或结构体，你可以扩展它来添加新的泛型方法。

     ```swift
        struct Stack<Element> {
            var elements = [Element]()
            mutating func push(_ element: Element) {
                elements.append(element)
            }
            func pop() -> Element {
                return elements.removeLast()
            }
        }

        extension Stack where Element: Numeric {
            var sum: Element {
                return elements.reduce(0 as Element, +)
            }
        }

        var stack = Stack<Int>()
        stack.push(1)
        stack.push(2)
        stack.push(3)
        print(stack.sum) // 输出 6
     ```

     在这个例子中，Stack 是一个泛型结构体，我们为它添加了一个泛型扩展，这个扩展只适用于元素类型遵循 Numeric 协议的 Stack 实例。

   - 为非泛型类型添加泛型功能
    你也可以为非泛型类型添加处理泛型数据的方法。

        ```swift
        extension Array {
            func contains<T: Equatable>(_ element: T) -> Bool {
                return self.contains { $0 as? T == element }
            }
        }

        let array = [1, 2, 3, 4, 5]
        print(array.contains(3)) // 输出 true
        print(array.contains("3")) // 输出 false
        ```

        在这个例子中，我们扩展了 Array 类型，添加了一个泛型方法 contains，它可以检查数组是否包含某个泛型元素。

   - 使用泛型扩展的条件
        - 添加通用功能：为多种类型的实例添加通用的方法或属性。
        - 遵守协议：为泛型类型添加协议遵守，或者为非泛型类型添加处理泛型数据时需要的协议遵守。
        - 限制类型：使用 where 子句来限制泛型参数必须遵守特定的协议或继承自特定的类。
        - 提高代码复用性：减少代码重复，通过泛型扩展来处理不同类型的数据。

8. **扩展运算符**：
   - 扩展可以为已有类型添加自定义运算符。

   ```swift
   extension String {
       static func +(lhs: String, rhs: String) -> String {
           return lhs + " " + rhs
       }
   }
   ```

9. **扩展访问级别**：
   - 扩展可以有访问级别限制，例如`public`、`internal`、`fileprivate`等。

10. **扩展的继承**：
    - 扩展本身不能被继承，但扩展可以添加到已经继承自其他类型的子类上。

11. **扩展的元组**：
    - 扩展可以用于元组，以添加自定义行为。

   ```swift
   extension Tuple {
       var firstValue: Element {
           return self.0
       }
   }
   ```

扩展是Swift中非常强大的特性，它允许开发者在不修改原始类型定义的情况下，增加新功能或改变类型的行为。这使得代码更加模块化，易于维护和扩展。
