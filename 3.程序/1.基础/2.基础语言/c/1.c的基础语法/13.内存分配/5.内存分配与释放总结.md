# 内存分配与释放总结

在C语言中，内存分配和释放是动态内存管理的关键部分。C语言提供了几种方法来分配和释放内存，这些方法允许你在程序运行时创建和销毁数据结构。

## 内存分配

1. **栈内存**：
   - 栈内存通过局部变量自动分配和释放。当函数调用结束时，其局部变量占用的栈内存被自动释放。

2. **堆内存**：
   - 堆内存需要手动分配和释放。使用标准库函数`malloc`、`calloc`、`realloc`来分配堆内存。

   - `malloc`：分配指定大小的内存块，返回指向该内存块的指针。

     ```c
     void *malloc(size_t size);
     ```

   - `calloc`：分配一个初始化为零的内存块，返回指向该内存块的指针。

     ```c
     void *calloc(size_t num, size_t size);
     ```

   - `realloc`：重新分配内存块的大小，可以增加或减少内存大小，并返回指向新内存块的指针。

     ```c
     void *realloc(void *ptr, size_t new_size);
     ```

## 内存释放

- 使用`free`函数来释放之前使用`malloc`、`calloc`或`realloc`分配的内存。

  ```c
  void free(void *ptr);
  ```

## 示例代码

```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    // 分配整数的堆内存
    int *dynamicInt = (int *)malloc(sizeof(int));
    if (dynamicInt != NULL) {
        *dynamicInt = 10;
        printf("Value: %d\n", *dynamicInt);
        
        // 释放分配的内存
        free(dynamicInt);
    }

    // 分配整数数组的堆内存
    int *array = (int *)calloc(10, sizeof(int));
    if (array != NULL) {
        // 使用数组...

        // 释放分配的内存
        free(array);
    }

    // 错误示例：忘记释放内存将导致内存泄漏
    int *anotherInt = (int *)malloc(sizeof(int));
    *anotherInt = 20; // 使用分配的内存
    // 错误：未释放内存
    // 正确做法是添加 free(anotherInt);
    
    return 0;
}
```

## 注意事项

- 总是检查`malloc`、`calloc`和`realloc`的返回值，因为如果请求的内存无法分配，它们将返回`NULL`。
- 使用`free`函数释放内存后，应将指针设置为`NULL`，避免悬垂指针问题。
- 避免内存泄漏，确保所有分配的内存最终都被释放。
- 避免多次释放同一块内存，这可能导致未定义行为。
- 使用`realloc`时要小心，因为它可能会失败并返回`NULL`，此时原始内存仍然需要使用`free`来释放。

正确管理内存分配和释放对于编写稳健的C程序至关重要。不当的内存管理可能导致内存泄漏、程序崩溃或其他难以追踪的错误。
