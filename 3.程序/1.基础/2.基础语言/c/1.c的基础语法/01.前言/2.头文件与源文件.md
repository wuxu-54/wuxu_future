# 头文件与源文件

在C/C++编程中，.h（头文件）和.c/.cpp（源文件）的分工是代码组织的核心机制，其核心目的是实现**声明与定义分离**，提高代码复用性并避免编译冲突。下面详细解释其作用及函数、变量的处理方式：

## 一、.h头文件与.c/.cpp源文件的核心作用

- **.h头文件**：主要用于**声明（declaration）**，告诉编译器“存在什么”（如函数原型、变量类型、宏定义等），不负责具体实现。  
  作用：让其他源文件知道如何使用这些资源（函数、变量等），相当于“接口说明”。

- **.c（C语言）/.cpp（C++）源文件**：主要用于**定义（definition）**，负责具体实现（如函数体、变量的内存分配等）。  
  作用：实现头文件中声明的内容，是代码的“具体逻辑”。

## 二、函数的声明与定义

函数的使用必须遵循“先声明，后使用”的原则，通常将声明放在.h中，定义放在.c/.cpp中。

### 1. 函数声明（放.h文件）

函数声明仅说明函数的“接口”：返回值类型、函数名、参数列表，不包含函数体（{}及内部逻辑）。  
格式：`返回值类型 函数名(参数类型1 参数名1, 参数类型2 参数名2, ...);`  

示例（`add.h`）：

```c
#ifndef ADD_H  // 头文件保护符（防止重复包含）
#define ADD_H

// 声明一个加法函数：接收两个int，返回int
int add(int a, int b);  // 注意末尾的分号

#endif  // ADD_H
```

> 头文件保护符（`#ifndef/#define/#endif`）：  
> 当多个文件同时包含同一个.h时，会避免重复声明导致的编译错误（如“重定义”），是必须的规范。

### 2. 函数定义（放.c/.cpp文件）

函数定义是函数的具体实现，包含函数体，需要与头文件中的声明完全匹配（返回值、函数名、参数列表一致）。  

示例（`add.c`）：

```c
#include "add.h"  // 包含对应的头文件（确保声明与定义一致）

// 定义add函数：实现加法逻辑
int add(int a, int b) {  // 无分号，后面接函数体
    return a + b;
}
```

### 3. 函数的使用（在其他文件中）

当其他源文件需要使用`add`函数时，只需包含其头文件，即可直接调用（编译器通过头文件知道函数的接口）。  

示例（`main.c`）：

```c
#include <stdio.h>
#include "add.h"  // 包含add函数的声明

int main() {
    int result = add(3, 5);  // 直接调用，编译器通过add.h知道如何调用
    printf("3 + 5 = %d\n", result);  // 输出：3 + 5 = 8
    return 0;
}
```

## 三、变量的声明与定义

变量的处理比函数更需要注意：**不能在头文件中直接定义全局变量**（会导致重复分配内存），需用`extern`声明。

### 1. 全局变量的声明（放.h文件）

用`extern`关键字声明变量，表示“该变量在其他地方定义”，不分配内存。  

示例（`global.h`）：

```c
#ifndef GLOBAL_H
#define GLOBAL_H

// 声明全局变量：表示g_count在其他.c中定义
extern int g_count;  // 仅声明，不分配内存

#endif  // GLOBAL_H
```

### 2. 全局变量的定义（放.c/.cpp文件）

在**一个且仅一个**源文件中定义变量（分配内存），无需`extern`。  

示例（`global.c`）：

```c
#include "global.h"

// 定义全局变量：分配内存，初始值为0
int g_count = 0;  // 若不初始化，默认值为0
```

### 3. 变量的使用（在其他文件中）

包含头文件后，即可使用该全局变量（编译器通过`extern`声明知道变量的存在）。  

示例（`main.c`）：

```c
#include <stdio.h>
#include "global.h"

int main() {
    g_count = 10;  // 使用全局变量
    printf("g_count = %d\n", g_count);  // 输出：g_count = 10
    return 0;
}
```

### 4. 局部变量与静态变量

- **局部变量**：定义在函数内部，仅在函数内有效，直接在函数内定义即可（无需头文件）。  
- **静态全局变量**（`static int var;`）：仅在当前.c文件中有效，定义在.c文件中（不放在.h中，避免其他文件访问）。  
- **静态函数**（`static int func() {}`）：仅在当前.c文件中有效，声明和定义都放在.c中（无需头文件暴露）。

## 四、核心原则总结

1. **.h头文件**：放声明（函数原型、`extern`变量、宏、类型定义等），必须加保护符。  
2. **.c/.cpp源文件**：放定义（函数体、全局变量的初始化等），需包含对应的.h文件。  
3. **禁止**：在.h中定义函数或全局变量（会导致多文件包含时重复定义，编译报错）。  
4. **匹配性**：声明与定义必须完全一致（返回值、参数、类型等），否则会导致链接错误。

通过这种分离机制，既能实现代码模块化（如多个文件复用同一个函数），又能避免编译冲突，是C/C++大型项目的基础组织方式。
