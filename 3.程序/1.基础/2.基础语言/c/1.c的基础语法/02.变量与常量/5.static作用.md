# static

在 C 语言中，`static` 是一个多功能的关键字，其作用取决于它的使用场景。它主要用于控制变量和函数的**存储周期**和**作用域**，具体可以分为以下几种情况：
>static作用域要求和java中的定义不一样

## 1. 修饰局部变量（函数内的变量）

- **作用**：改变局部变量的存储位置和生命周期
- **特点**：
  - 变量存储在**静态存储区**（而非栈区），程序启动时分配内存，程序结束时释放
  - 只在**第一次进入函数时初始化**，后续调用不会重新初始化
  - 作用域仍局限于所在函数（出了函数就不能直接访问）

**示例**：

```c
#include <stdio.h>

void count() {
    static int num = 0;  // 静态局部变量，只初始化一次
    num++;
    printf("num = %d\n", num);
}

int main() {
    count();  // 输出: num = 1
    count();  // 输出: num = 2
    count();  // 输出: num = 3
    return 0;
}
```

- 普通局部变量每次调用函数都会重新初始化，而静态局部变量会保留上次的值

## 2. 修饰全局变量

- **作用**：限制全局变量的作用域
- **特点**：
  - 全局变量默认可以被**整个程序的所有文件访问**（通过 `extern` 声明）
  - 被 `static` 修饰后，只能在**定义它的当前文件中访问**，其他文件无法访问

**示例**：

```c
// file1.c
static int global_data = 100;  // 静态全局变量，仅file1.c可见

// file2.c
#include <stdio.h>

extern int global_data;  // 错误！无法访问file1.c中的static全局变量

int main() {
    printf("%d", global_data);  // 编译报错：未定义的引用
    return 0;
}
```

- 用途：避免不同文件中的全局变量重名冲突

## 3. 修饰函数

- **作用**：限制函数的作用域
- **特点**：
  - 普通函数默认可以被**整个程序的所有文件调用**（通过声明）
  - 被 `static` 修饰后，函数只能在**定义它的当前文件中被调用**，其他文件无法调用

**示例**：

```c
// file1.c
static void private_func() {  // 静态函数，仅file1.c可用
    printf("这是文件内部的私有函数\n");
}

// file2.c
#include <stdio.h>

void private_func();  // 声明无效

int main() {
    private_func();  // 编译报错：未定义的引用
    return 0;
}
```

- 用途：实现文件内部的辅助函数，避免函数名冲突

## 总结：`static` 的核心作用

| 使用场景       | 主要作用                                  |
|----------------|-------------------------------------------|
| 局部变量       | 延长生命周期（整个程序运行期间），保持值   |
| 全局变量/函数  | 限制作用域（仅当前文件可见），实现封装    |

`static` 的本质是**改变标识符的链接属性**：

- 全局变量/函数默认是**外部链接**（可跨文件访问）
- 被 `static` 修饰后变为**内部链接**（仅当前文件访问）
- 局部变量默认无链接属性，`static` 仅改变其存储方式
