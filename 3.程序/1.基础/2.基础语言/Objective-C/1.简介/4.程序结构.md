# 程序结构

- OC 里面的函数需要依赖对象，也就是说都是方法。
- OC 支持C语言风格。

## 普通结构

Objective-C 程序基本上由以下部分组成:

- 预处理器命令
- 接口
- 实现
- 方法
- 变量
- 语句 & 表达式
- 注释

示例：

```objective-c
#import <Foundation/Foundation.h>
@interface SampleClass:NSObject
- (void)sampleMethod;
@end
@implementation SampleClass
- (void)sampleMethod {
  NSLog(@"Hello, World! \n");
}
@end
int main() {
  /* my first program in Objective-C */
  SampleClass *sampleClass = [[SampleClass alloc]init];
  [sampleClass sampleMethod];
  return 0;
}
```

上述程序的各个部分:

- 程序第一行 `#import <Foundation/Foundation.h>` 是一个预处理器命令，它告诉 Objective-C 编译器包含 `Foundation.h` 文件，然后再进行实际编译。
- 下一行 `@interface SampleClass:NSObject` 演示如何创建接口。它继承了 `NSObject`，它是所有对象的基类。
- 下一行 `(void)sampleMethod;` 演示如何声明方法。
- 下一行 `@end` 标记接口的结束。
- 下一行 `@implementation SampleClass` 演示如何实现接口 `SampleClass`。
- 下一行 `- (void)sampleMethod{}` 演示了 `sampleMethod` 的实现。
- 下一行 `@end` 标记实现的结束。
- 下一行 `int main()` 是程序执行开始的 main 函数。
- 下一行 `/…/` 将被编译器忽略，并已将其放入程序中以添加其他注释。这样的行在程序中称为注释。
- 下一行 `NSLog(…)` 表示 Objective-C 中是否有另一个函数，它会在屏幕上显示消息 `"Hello, World!"` 。
- 下一行 `return 0;` 终止 `main` 函数并返回值 `0`。

---

## 基本结构和组成部分

Objective-C程序结构主要基于C语言的结构，并加入了面向对象编程的特性。以下是Objective-C程序的基本结构和组成部分：

1. **头文件（Header Files）**：
   使用`.h`扩展名，包含类、枚举、宏定义和其他类型的定义。
   >.h文件中的方法都是公共方法，可被外部访问

   ```objc
   // MyObject.h
   #import <Foundation/Foundation.h>

   @interface MyObject : NSObject
   - (void)doSomething;
   @end
   ```

2. **实现文件（Implementation Files）**：
   使用`.m`扩展名，包含头文件中声明的类的实现。

   ```objc
   // MyObject.m
   #import "MyObject.h"

   @implementation MyObject

   - (void)doSomething {
       NSLog(@"Doing something");
   }

   @end
   ```

3. **Foundation框架**：
   几乎所有Objective-C程序都依赖于Foundation框架，它提供了基本的数据类型、集合、文件操作等。

4. **导入和包含**：
   使用`#import`或`#include`来导入其他头文件或包含标准库。

5. **类和对象**：
   类是Objective-C中定义数据结构和行为的蓝图。对象是类的实例。

6. **接口（@interface）**：
   使用`@interface`关键字定义类的公共接口，包括属性和方法的声明。

7. **实现（@implementation）**：
   使用`@implementation`关键字定义类的实现，包括方法的具体实现和属性的定义。

8. **属性（Properties）**：
   使用`@property`关键字声明属性，可以指定属性的内存管理语义和访问控制。

9. **方法（Methods）**：
   类的方法定义了对象的行为。实例方法使用`-`标记，类方法使用`+`标记。

10. **初始化和析构**：
    使用`init`方法进行对象的初始化，使用`dealloc`方法进行对象的清理。

11. **消息传递**：
    对象之间的通信通过发送消息的方式进行，这是Objective-C中对象交互的核心机制。

12. **内存管理**：
    在非ARC环境下，需要手动管理内存，使用`retain`、`release`、`autorelease`等方法。

13. **协议（Protocols）**：
    使用`@protocol`定义协议，规定了对象应实现的方法和属性。

14. **错误处理**：
    使用`NSError`对象传递错误信息。

15. **编译和链接**：
    使用编译器（如clang）编译`.m`文件，使用链接器链接生成可执行文件。

16. **应用程序入口点**：
    对于iOS和macOS应用，`main.m`文件通常包含程序的入口点。

17. **框架和库**：
    使用框架（如UIKit、AppKit）和库来构建用户界面和访问系统服务。

Objective-C程序结构清晰地分离了接口和实现，使得代码易于维护和扩展。面向对象的特性和消息传递机制为构建复杂的应用程序提供了强大的支持。

---

## 应用程序结构

Objective-C 程序结构通常遵循 MVC（Model-View-Controller）设计模式，将应用程序分为三个主要组件：模型（Model），视图（View）和控制器（Controller）。下面是一个简单的 Objective-C 程序示例，展示了这三个组件的基本结构。

### 1. 模型（Model）

模型通常负责数据和业务逻辑。以下是一个简单的 `Person` 类的示例：

```objective-c
// Person.h
#import <Foundation/Foundation.h>

@interface Person : NSObject

@property (nonatomic, strong) NSString *name;
@property (nonatomic, assign) NSInteger age;

- (instancetype)initWithName:(NSString *)name age:(NSInteger)age;
- (void)introduce;

@end

// Person.m
#import "Person.h"

@implementation Person

- (instancetype)initWithName:(NSString *)name age:(NSInteger)age {
    self = [super init];
    if (self) {
        _name = name;
        _age = age;
    }
    return self;
}

- (void)introduce {
    NSLog(@"Hello, my name is %@ and I am %ld years old.", self.name, (long)self.age);
}

@end
```

### 2. 视图（View）

视图负责显示内容。在 macOS 或 iOS 中，视图通常是通过 Interface Builder 设计的，但这里我们只展示一个简单的视图控制器的接口：

```objective-c
// ViewController.h
#import <Cocoa/Cocoa.h>

@interface ViewController : NSViewController

@property (weak) IBOutlet NSTextField *nameTextField;
@property (weak) IBOutlet NSTextField *ageTextField;

- (void)updateUI;

@end
```

### 3. 控制器（Controller）

控制器负责接收用户的输入并更新模型和视图。以下是一个简单的 `ViewController` 的实现：

```objective-c
// ViewController.m
#import "ViewController.h"
#import "Person.h"

@interface ViewController ()

@property (nonatomic, strong) Person *person;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.person = [[Person alloc] initWithName:@"John Doe" age:30];
    [self updateUI];
}

- (void)updateUI {
    [self.nameTextField setStringValue:self.person.name];
    [self.ageTextField setStringValue:[NSString stringWithFormat:@"%ld", (long)self.person.age]];
}

- (IBAction)introduceButtonPressed:(id)sender {
    [self.person introduce];
}

@end
```

### 4. 主函数和应用委托（AppDelegate）

`AppDelegate` 负责处理应用程序的生命周期事件：

```objective-c
// AppDelegate.h
#import <Cocoa/Cocoa.h>

@interface AppDelegate : NSObject <NSApplicationDelegate>

@end

// AppDelegate.m
#import "AppDelegate.h"

@implementation AppDelegate

- (void)applicationDidFinishLaunching:(NSNotification *)aNotification {
    // Insert code here to initialize your application
}

@end
```

### 5. main.m

`main.m` 是程序的入口点：

```objective-c
// main.m
#import <Cocoa/Cocoa.h>

int main(int argc, const char * argv[]) {
    return NSApplicationMain(argc, argv);
}
```

这个示例展示了一个简单的 Objective-C 应用程序，其中包含一个 `Person` 模型，一个 `ViewController` 控制器，以及一个 `AppDelegate` 来处理应用程序的生命周期事件。在实际的应用程序中，这些组件会更加复杂，并且通常会包含更多的类和方法。此外，视图通常会通过 Interface Builder 来设计和连接到控制器。
