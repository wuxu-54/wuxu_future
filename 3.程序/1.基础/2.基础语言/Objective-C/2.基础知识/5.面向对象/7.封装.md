# 封装

在Objective-C中，封装（Encapsulation）是面向对象编程（OOP）的一个基本原则，它涉及将对象的数据（属性）和行为（方法）组合在一起，并隐藏内部实现的细节。以下是Objective-C封装的一些关键概念：

1. **属性封装**：
   使用`@property`声明来定义对象的属性，并通过`@synthesize`自动生成存储属性的实现。

   ```objc
   @interface MyClass : NSObject
   @property (nonatomic, strong) NSString *name;
   @end
   ```

2. **访问控制**：
   使用访问修饰符来限制对属性和方法的访问。Objective-C 并不直接支持以下几种访问操作符（C中有，所以OC中可以用，但不直接支持）：
   - `public`：可以在任何地方访问。
   - `protected`：只能在同一个类及其子类中访问。
   - `private`：只能在定义它的类中访问。

   可以通过约定、头文件等实现，具体看下面的访问控制详解。

3. **Getter和Setter**：
   为属性提供Getter和Setter方法，以便控制对属性的访问和赋值。

   ```objc
   @interface MyClass : NSObject
   @property (nonatomic, strong, readonly) NSString *name;
   @end

   @implementation MyClass
   - (NSString *)name {
       return _name;
   }
   @end
   ```

4. **内存管理**：
   封装还包括内存管理的职责。使用`strong`、`weak`、`assign`等修饰符来明确属性的内存管理语义。

5. **构造器**：
   使用构造器（`init`方法）来创建对象并初始化其属性。

   ```objc
   - (instancetype)init {
       self = [super init];
       if (self) {
           // 初始化代码
       }
       return self;
   }
   ```

6. **不可变对象**：
   通过使用`readonly`修饰符，可以创建不可变对象，其属性一旦被赋值就不能被修改。

7. **隐藏实现细节**：
   将实现细节隐藏在类的内部，只暴露必要的接口给外部。

8. **协议封装**：
   使用协议（Protocols）来定义对象必须遵循的接口，而不暴露具体的实现。

9. **方法封装**：
   将相关的行为封装在类的方法中，这些方法可以访问和修改对象的属性。

10. **类簇**：
    使用类簇（Class Clusters）设计模式，将一组相关的类组织在一起，以提供更丰富的功能和更好的封装。

## 示例代码

```objc
@interface Person : NSObject
@property (nonatomic, strong) NSString *firstName;
@property (nonatomic, strong) NSString *lastName;

- (void)setNameWithFirstName:(NSString *)firstName andLastName:(NSString *)lastName;
- (NSString *)fullName;
@end

@implementation Person
@synthesize firstName;
@synthesize lastName;

- (void)setNameWithFirstName:(NSString *)firstName andLastName:(NSString *)lastName {
    self.firstName = firstName;
    self.lastName = lastName;
}

- (NSString *)fullName {
    return [NSString stringWithFormat:@"%@ %@", self.firstName, self.lastName];
}
@end

// 使用
Person *person = [[Person alloc] init];
[person setNameWithFirstName:@"John" andLastName:@"Doe"];
NSLog(@"%@", [person fullName]); // 输出 "John Doe"
```

在这个示例中，`Person`类封装了人的`firstName`和`lastName`属性，提供了设置名字的方法和获取全名的方法。封装使得类的使用者可以方便地操作对象的状态，而不需要了解内部的具体实现。

封装是Objective-C中提高代码可维护性、可读性和安全性的重要手段。通过封装，开发者可以将数据和行为组织在一起，同时保护对象的内部状态不受外部直接修改。

---

## 访问权限控制

Objective-C 是一种动态、面向对象的编程语言，它扩展了 C 语言的功能。在 Objective-C 中，访问权限控制不像其他一些面向对象的语言（如 Java 或 C#）那样严格，因为 Objective-C 并没有内置的访问修饰符（如 `public`、`private` 或 `protected`）。然而，Objective-C 通过以下方式来模拟访问权限控制：

1. **头文件（.h）和实现文件（.m）分离**：
   - 在 Objective-C 中，类的接口通常在头文件（.h）中声明，而实现则在实现文件（.m）中定义。不在头文件中声明的方法和属性默认是私有的，因为它们不会暴露给其他源文件。

2. **命名约定**：
   - **私有方法**：通常，以下划线 `_` 开头的方法名被约定为私有方法。例如，`- (void)_methodName`。如果方法名以下划线 `__` 开头，则表示它更加私有，通常用于实现内部的辅助方法。
   - **私有属性**：以下划线 `_` 开头的属性名通常被认为是私有属性。

3. **类扩展（Class Extensions）**：
   - Objective-C 允许在实现文件中使用类扩展来声明私有方法和属性。类扩展不会在头文件中公开，因此它们是私有的。

   ```objective-c
   @interface MyClass ()
   - (void)privateMethod;
   @end
   ```

4. **类别（Categories）**：
   - 类别允许你向现有类添加方法，这些方法可以是公共的也可以是私有的。私有类别通常与类扩展一起使用，以隐藏实现细节。

5. **协议（Protocols）**：
   - 协议定义了一组方法签名，但不实现这些方法。你可以在协议中定义私有方法，这些方法只在实现协议的类中可见。

### 示例

```objective-c
// MyClass.h
@interface MyClass : NSObject

@property (nonatomic, strong) NSString *publicProperty;  // 公开属性
- (void)publicMethod;  // 公开方法

@end

// MyClass.m
@interface MyClass ()

@property (nonatomic, strong) NSString *privateProperty;  // 私有属性
- (void)privateMethod;  // 私有方法

@end

@implementation MyClass

- (void)publicMethod {
    [self privateMethod];  // 调用私有方法
}

- (void)privateMethod {
    NSLog(@"This is a private method.");
}

@end
```

在这个例子中，`privateProperty` 和 `privateMethod` 是私有的，因为它们只在 `.m` 文件中声明。而 `publicProperty` 和 `publicMethod` 是公开的，因为它们在 `.h` 文件中声明。

Objective-C 的这种访问控制机制更多是基于约定和最佳实践，而不是语言强制的规则。这要求开发者遵守约定，以确保代码的封装性和安全性。
