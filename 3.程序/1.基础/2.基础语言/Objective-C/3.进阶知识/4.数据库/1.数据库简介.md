# 数据库

Objective-C 通常用于开发 macOS 和 iOS 应用程序，而在这个平台上，最常用的本地数据库是 SQLite。Core Data 是另一个常用的框架，它提供了一个抽象层来管理模型层的数据，并且可以与 SQLite 或其他类型的持久化存储进行交互。

## SQLite

SQLite 是一个轻量级的、文件系统基础的数据库，它被许多应用程序用作本地存储解决方案。在 Objective-C 中使用 SQLite 通常涉及以下几个步骤：

1. **创建数据库连接**：使用 `sqlite3_open` 函数打开或创建一个 SQLite 数据库文件。
2. **准备 SQL 语句**：使用 `sqlite3_prepare_v2` 函数准备一个 SQL 语句。
3. **绑定参数**：如果 SQL 语句包含参数（例如，用于查询的条件），使用 `sqlite3_bind_*` 系列函数来绑定这些参数。
4. **执行 SQL 语句**：使用 `sqlite3_step` 函数执行 SQL 语句。
5. **处理结果**：如果执行的是 SELECT 语句，使用 `sqlite3_column_*` 系列函数来检索结果。
6. **关闭数据库连接**：使用 `sqlite3_close` 函数关闭数据库连接。

## Core Data

Core Data 是 Apple 提供的一个框架，用于对象图和数据库之间的持久化。它提供了更多的抽象和灵活性，可以自动处理许多底层的数据库操作。使用 Core Data 通常涉及以下几个步骤：

1. **配置 Core Data Stack**：设置 `NSPersistentContainer` 或者 `NSPersistentStoreCoordinator`，以及其他必要的组件，如 `NSManagedObjectContext`。
2. **定义数据模型**：使用 Xcode 的数据模型编辑器定义你的数据模型，包括实体（Entity）、属性（Attributes）和关系（Relationships）。
3. **创建 NSManagedObject 实例**：基于你的数据模型创建 `NSManagedObject` 的子类实例。
4. **插入、查询、更新和删除数据**：使用 `NSManagedObjectContext` 来插入新数据、查询现有数据、更新或删除数据。
5. **保存上下文**：使用 `-save:` 方法保存 `NSManagedObjectContext` 中的更改到持久化存储。

## 示例代码

### SQLite 示例

```objective-c
// 打开或创建数据库
sqlite3 *db;
if (sqlite3_open("myDatabase.sqlite", &db) == SQLITE_OK) {
    // 准备 SQL 语句
    const char *sql = "CREATE TABLE IF NOT EXISTS People (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT);";
    
    // 执行 SQL 语句
    sqlite3_stmt *stmt;
    sqlite3_prepare_v2(db, sql, -1, &stmt, NULL);
    sqlite3_step(stmt);
    
    // 插入数据
    const char *insertSQL = "INSERT INTO People (name) VALUES (?);";
    sqlite3_prepare_v2(db, insertSQL, -1, &stmt, NULL);
    sqlite3_bind_text(stmt, 1, "John Doe", -1, SQLITE_TRANSIENT);
    sqlite3_step(stmt);
    
    // 清理
    sqlite3_finalize(stmt);
    
    // 关闭数据库
    sqlite3_close(db);
}
```

### Core Data 示例

```objective-c
// 配置 Core Data Stack
NSPersistentContainer *container = [[NSPersistentContainer alloc] initWithName:@"MyApp"];
container.loadPersistentStorescompletionHandler:^(NSPersistentStoreDescription *storeDescription, NSError *error) {
    if (error != nil) {
        // 处理错误
    }
    // Core Data Stack 配置完成
};

// 获取上下文
NSManagedObjectContext *context = container.viewContext;

// 创建 NSManagedObject 实例
NSEntityDescription *entity = [NSEntityDescription entityForName:@"Person" inManagedObjectContext:context];
NSManagedObject *newPerson = [[NSManagedObject alloc] initWithEntity:entity insertIntoManagedObjectContext:context];

// 设置属性
[newPerson setValue:@"John Doe" forKey:@"name"];

// 保存更改
NSError *error;
if ([context save:&error]) {
    // 保存成功
} else {
    // 处理错误
}
```

请注意，这些示例仅用于展示基本概念，实际应用中的数据库操作会更复杂，并且需要考虑错误处理、事务管理、性能优化等因素。
