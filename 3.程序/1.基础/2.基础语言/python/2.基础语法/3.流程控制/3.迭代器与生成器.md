# 迭代器和生成器

在 Python 中，迭代器和生成器是处理数据集合的重要概念，它们允许你以一种非常灵活和高效的方式来遍历数据。

## 迭代器（Iterator）

迭代器是一个可以记住遍历位置的对象。迭代器对象必须实现两个方法：`__iter__()` 和 `__next__()`。

- `__iter__()`：当迭代一个对象时，这个方法会被调用，它应该返回迭代器对象本身。
- `__next__()`：当需要获取下一个元素时，这个方法会被调用。

迭代器协议要求迭代器有两个基本的方法，这样你就可以使用 `for` 循环或 `next()` 函数来遍历迭代器。

### 示例1

字符串，列表或元组对象都可用于创建迭代器：

```python
>>> list=[1,2,3,4]
>>> it = iter(list)    # 创建迭代器对象
>>> print (next(it))   # 输出迭代器的下一个元素
1
>>> print (next(it))
2
>>>
```

迭代器对象可以使用常规for语句进行遍历：

```python
#!/usr/bin/python3
 
list=[1,2,3,4]
it = iter(list)    # 创建迭代器对象
for x in it:
    print (x, end=" ")

while True:
    try:
        print (next(it)) # 使用next()
    except StopIteration: # StopIteration异常，标识迭代完成
        sys.exit()
```

`StopIteration` 异常用于标识迭代的完成，防止出现无限循环的情况，在 `__next__()` 方法中我们可以设置在完成指定循环次数后触发 `StopIteration` 异常来结束迭代。

### 示例2 自定义迭代器

自定义一个迭代器类来遍历斐波那契数列的前 `n` 个数字：

```python
class FibonacciIterator:
    def __init__(self, count):
        self.count = count
        self.a, self.b = 0, 1

    def __iter__(self):
        return self

    def __next__(self):
        if self.count == 0:
            raise StopIteration
        self.count -= 1
        fib = self.a
        self.a, self.b = self.b, self.a + self.b
        return fib

# 使用自定义迭代器
for fib in FibonacciIterator(10):
    print(fib)
```

## 生成器（Generator）

使用了 yield 的函数被称为生成器（generator），它使用 `yield` 语句来返回值，返回值是迭代器，只能用于迭代操作，更简单点理解生成器就是一个迭代器。
> Java没有这个函数, Java中的yeild是Thread中的方法,用于暂停线程资源占用,跟python完全不是一个概念。

每次调用生成器的 `__next__()` 方法时，它会从上次 `yield` 表达式处恢复执行。

生成器非常适合于处理大数据集或无限序列，因为它们不需要一次性将所有数据加载到内存中。

**示例**：使用生成器函数来生成斐波那契数列的前 `n` 个数字：

```python
def fibonacci(count):
    a, b = 0, 1
    for _ in range(count):
        yield a
        a, b = b, a + b

# 使用生成器函数
for fib in fibonacci(10):
    print(fib)
```

生成器还可以使用 `for` 循环直接遍历，或者使用 `next()` 函数逐个获取元素。

## 迭代器和生成器的区别

- **内存使用**：生成器通常比迭代器更节省内存，因为它们不需要存储整个序列，而是一次生成一个元素。
- **可重用性**：迭代器可以被多次重用，而生成器只能被遍历一次，一旦迭代完成，生成器就会耗尽。
- **实现方式**：迭代器需要实现 `__iter__()` 和 `__next__()` 方法，而生成器是通过 `yield` 语句实现的。

## 总结

迭代器和生成器都是 Python 中处理序列数据的强大工具。迭代器适用于需要显式控制迭代过程的情况，而生成器则适用于需要按需生成数据的情况，特别是在处理大数据集或无限序列时。通过使用迭代器和生成器，你可以编写出更高效、更易读的代码。
