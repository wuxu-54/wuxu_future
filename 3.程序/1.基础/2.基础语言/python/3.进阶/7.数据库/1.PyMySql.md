# pymysql

`pymysql` 是一个 Python 3 的 MySQL 数据库接口，它是纯 Python 实现的 MySQL 客户端库，兼容 `MySQLdb` 模块。以下是使用 `pymysql` 库进行数据库操作的详解和示例。

## 安装 `pymysql`

首先，确保安装了 `pymysql`：

```sh
pip install pymysql
```

## 连接 MySQL 数据库

使用 `pymysql` 连接数据库的基本代码：

```python
import pymysql

# 连接数据库
connection = pymysql.connect(host='localhost',
                             user='your_username',
                             password='your_password',
                             database='your_database',
                             charset='utf8mb4',
                             cursorclass=pymysql.cursors.DictCursor)
```

- `host`: 数据库服务器地址，通常是 `'localhost'`。
- `user`: 数据库用户名。
- `password`: 用户密码。
- `database`: 要连接的数据库名。
- `charset`: 指定字符集，`'utf8mb4'` 是一个常用选择。
- `cursorclass`: 指定游标类，默认为 `pymysql.cursors.Cursor`，这里使用 `DictCursor` 可以返回字典形式的查询结果。

## 创建游标对象并执行 SQL 语句

```python
# 创建游标对象
cursor = connection.cursor()

# 执行 SQL 语句
sql = "SELECT * FROM your_table"
try:
    cursor.execute(sql)
    # 获取所有查询结果
    results = cursor.fetchall()
    for row in results:
        print(row)
except Exception as e:
    print(e)
```

## 插入数据

使用 `execute()` 方法插入数据：

```python
insert_sql = "INSERT INTO your_table (column1, column2) VALUES (%s, %s)"
values = ('value1', 'value2')

try:
    cursor.execute(insert_sql, values)
    connection.commit()  # 提交事务
except Exception as e:
    connection.rollback()  # 回滚事务
    print(e)
```

## 更新和删除数据

更新和删除操作与插入类似，需要提交事务：

```python
update_sql = "UPDATE your_table SET column1 = %s WHERE column2 = %s"
delete_sql = "DELETE FROM your_table WHERE column1 = %s"

try:
    cursor.execute(update_sql, ('new_value', 'condition'))
    cursor.execute(delete_sql, ('condition',))
    connection.commit()
except Exception as e:
    connection.rollback()
    print(e)
```

## 完整的数据库操作示例

```python
import pymysql

# 连接数据库
connection = pymysql.connect(host='localhost',
                             user='username',
                             password='password',
                             database='database_name',
                             charset='utf8mb4',
                             cursorclass=pymysql.cursors.DictCursor)

try:
    with connection.cursor() as cursor:
        # 创建表
        create_table_sql = "CREATE TABLE IF NOT EXISTS employees (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(100), age INT)"
        cursor.execute(create_table_sql)

        # 插入数据
        insert_sql = "INSERT INTO employees (name, age) VALUES (%s, %s)"
        employees_data = [
            ('John Doe', 30),
            ('Jane Smith', 25),
            ('Emily Jones', 35)
        ]
        cursor.executemany(insert_sql, employees_data)
        connection.commit()

        # 查询数据
        select_sql = "SELECT * FROM employees"
        cursor.execute(select_sql)
        rows = cursor.fetchall()
        for row in rows:
            print(row)

finally:
    connection.close()
```

## 注意事项

- 确保使用参数化查询来防止 SQL 注入。
- 使用 `try...except` 语句来处理可能发生的异常。
- 事务需要显式提交或回滚。
- 使用 `with` 语句可以自动管理游标的关闭和连接的提交或回滚。

通过上述示例，你可以使用 `pymysql` 库在 Python 3 中进行 MySQL 数据库的各种操作。
