# socket

Python 的 `socket` 模块提供了对 BSD 套接字接口的访问，允许你进行网络编程。套接字是网络通信的端点，可以用于构建客户端和服务器程序。

## 基本概念

- **套接字地址**：由一个 IP 地址和一个端口号组成。
- **协议家族**：通常使用 `AF_INET` 表示 IPv4 地址，`AF_INET6` 表示 IPv6 地址。
- **套接字类型**：常用的类型有 `SOCK_STREAM`（TCP），`SOCK_DGRAM`（UDP）。

## 常用方法

- `socket()``：创建一个新的套接字。
- `bind(address)`：将套接字绑定到一个地址。
- `listen([n])`：使套接字成为服务器端，`n` 是未完成连接队列的最大长度。
- `accept()`：在服务器端接受客户端的连接请求，返回一个新的套接字和一个地址信息。
- `connect(address)`：在客户端连接到服务器。
- `send(data)`：发送数据。
- `recv(bufsize)`：接收数据，`bufsize` 是缓冲区的大小。
- `close()`：关闭套接字。

## 示例

### TCP 服务器和客户端

**服务器端示例**：

```python
import socket

server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server_socket.bind(('localhost', 9999))
server_socket.listen(5)
print("服务器启动，等待连接...")

while True:
    client_socket, addr = server_socket.accept()
    print(f"接收到来自 {addr} 的连接")
    while True:
        data = client_socket.recv(1024)
        if not data:
            break
        client_socket.sendall(data)  # 回显客户端发送的数据
    client_socket.close()

server_socket.close()
```

**客户端示例**：

```python
import socket

client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client_socket.connect(('localhost', 9999))

message = 'Hello, Server!'
client_socket.sendall(message.encode())

response = client_socket.recv(1024)
print('服务器响应:', response.decode())

client_socket.close()
```

### UDP 服务器和客户端

**UDP 服务器示例**：

```python
import socket

server_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
server_socket.bind(('localhost', 9999))
print("UDP 服务器启动")

while True:
    data, addr = server_socket.recvfrom(1024)
    print(f"收到来自 {addr} 的数据: {data.decode()}")
    server_socket.sendto(data, addr)  # 回显数据
```

**UDP 客户端示例**：

```python
import socket

client_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

message = 'Hello, UDP Server!'
client_socket.sendto(message.encode(), ('localhost', 9999))

data, server = client_socket.recvfrom(1024)
print('服务器响应:', data.decode())

client_socket.close()
```

## 注意事项

- 套接字编程中，错误处理很重要，要确保捕获并处理可能的异常。
- TCP 连接是可靠的、面向连接的，而 UDP 是不可靠的、无连接的。
- 在使用 `recv()` 方法时，可能需要循环接收数据，直到接收完所有数据或接收到特定的结束标记。
- 使用 `with` 语句可以自动管理套接字的关闭。

通过使用 `socket` 模块，你可以实现自定义的网络通信协议，构建各种网络应用程序。
