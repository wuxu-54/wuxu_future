# requests

`requests` 是一个 Python 的第三方 HTTP 库，它以简单易用而广受欢迎。由于它不是 Python 标准库的一部分，因此在使用之前需要先安装，可以通过 `pip` 命令安装：

```sh
pip install requests
```

## 主要特性

- **人性化的 API**：`requests` 提供了简洁的 API，使得发送 HTTP 请求变得非常容易。
- **支持多种 HTTP 请求**：GET、POST、PUT、DELETE 等。
- **自动处理 Cookies**：自动处理客户端的 Cookies。
- **自动解码内容**：自动解码来自服务器的响应内容。
- **保持连接**：支持连接持久化。
- **支持 Sessions**：可以跨请求保持某些参数和 Cookies。
- **可自定义 Headers**：可以自定义 HTTP 请求的 Headers。
- **支持文件上传**：可以上传二进制文件和文本文件。
- **流式下载**：支持流式上传和下载，适合大文件。

## 常用方法

- `get(url, params=None, **kwargs)`：发送 GET 请求。
- `post(url, data=None, **kwargs)`：发送 POST 请求。
- `put(url, data=None, **kwargs)`：发送 PUT 请求。
- `delete(url, **kwargs)`：发送 DELETE 请求。
- `head(url, **kwargs)`：发送 HEAD 请求。
- `options(url, **kwargs)`：发送 OPTIONS 请求。
- `patch(url, data=None, **kwargs)`：发送 PATCH 请求。

## 示例：使用 `requests` 发送 GET 请求

```python
import requests

response = requests.get('http://www.example.com')
print(response.text)  # 打印响应内容
print(response.status_code)  # 打印状态码
```

## 示例：使用 `requests` 发送 POST 请求

```python
import requests

data = {'key1': 'value1', 'key2': 'value2'}
response = requests.post('http://www.example.com', data=data)

print(response.json())  # 假设响应内容是 JSON 格式
```

## 示例：使用 Sessions

```python
import requests

with requests.Session() as session:
    session.headers.update({'x-api-key': 'your-api-key'})
    response = session.get('http://www.example.com/api')
    print(response.text)
```

## 示例：设置请求头

```python
import requests

# 目标 URL
url = 'http://example.com'

# 设置请求头
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3',
    'Accept': 'application/json',
    'Authorization': 'Bearer YOUR_ACCESS_TOKEN'
}

# 发送 GET 请求
response = requests.get(url, headers=headers)

print(response.text)
```

有时候你可能需要根据特定情况动态设置请求头：

```python
# 基础请求头
base_headers = {
    'User-Agent': 'My App v1.0',
    'Accept': 'application/json'
}

# 根据特定条件添加或修改请求头
if condition:
    base_headers['Custom-Header'] = 'Custom Value'

response = requests.get(url, headers=base_headers)
```

## 示例：响应解析

```python
import requests

url = 'http://example.com/api/post'
headers = {'Content-Type': 'application/json'}
data = {'key': 'value'}

response = requests.post(url, json=data, headers=headers)

# 检查响应状态码
if response.status_code == 200:
    # 尝试解析 JSON 数据
    try:
        json_response = response.json()
        print("响应的 JSON 数据:", json_response)
    except ValueError:
        print("响应内容不是有效的 JSON 格式")
        # 处理非 JSON 响应
        print("响应文本:", response.text)
else:
    print("请求失败，状态码:", response.status_code)
```

## 注意事项

- **错误处理**：使用 `requests` 时，应该捕获并处理可能发生的异常，如 `ConnectionError`、`HTTPError`、`Timeout` 等。
- **超时设置**：为了防止请求无限期挂起，可以设置超时时间。
- **安全性**：`requests` 库默认不发送敏感的个人信息，如 Cookies。如果需要，可以在请求中明确包含这些信息。
- **流式上传/下载**：对于大文件，使用流式上传或下载可以节省内存。

`requests` 库因其易用性和强大的功能，已成为 Python 中处理 HTTP 请求的首选库之一。
