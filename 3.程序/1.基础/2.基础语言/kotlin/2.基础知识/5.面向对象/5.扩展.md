# 扩展

在 Kotlin 中，扩展（Extensions）是一种非常有用的功能，它允许你为已存在的类添加新的函数或属性，而无需修改原有类的代码或使用继承。这使得代码更加灵活和模块化。

## 扩展函数

扩展函数是为现有类添加新函数的方式。它们看起来像是类的一部分，但实际上是在类外部定义的。

### 基本语法

```kotlin
fun <接收者类型>.<函数名>(<参数列表>) {
    // 函数体
}
```

- **接收者类型**：你想要扩展的类。
- **函数名**：你添加的函数名。
- **参数列表**：函数的参数。

### 示例

```kotlin
fun String.lastChar(): Char {
    return this.get(this.length - 1)
}

fun main() {
    val str = "Hello"
    println(str.lastChar()) // 输出 'o'
}
```

在这个例子中，我们为 `String` 类添加了一个 `lastChar` 函数，它返回字符串的最后一个字符。

## 扩展属性

扩展属性允许你为现有类添加新的属性。

### 扩展属性基本语法

```kotlin
val/var <接收者类型>.<属性名>: <类型> = <初始化表达式>
```

- **接收者类型**：你想要扩展的类。
- **属性名**：你添加的属性名。
- **类型**：属性的类型。
- **初始化表达式**：属性的初始值。

### 扩展属性示例

```kotlin
val String.isEvenLength: Boolean
    get() = this.length % 2 == 0

fun main() {
    val str = "Hello"
    println(str.isEvenLength) // 输出 true
}
```

在这个例子中，我们为 `String` 类添加了一个名为 `isEvenLength` 的只读属性，它返回字符串的长度是否为偶数。

## 扩展的可见性

扩展函数和属性可以有它们自己的可见性修饰符，如 `public`、`private` 等。

```kotlin
private fun String的秘密() {
    println("这是一个秘密")
}

fun main() {
    val str = "Hello"
    str.秘密() // 可以访问，因为 main 在同一文件中
}
```

## 扩展与泛型

扩展也可以与泛型一起使用。

```kotlin
fun <T> List<T>.getOrNull(index: Int): T? {
    return if (index >= 0 && index < this.size) this[index] else null
}

fun main() {
    val list = listOf(1, 2, 3)
    println(list.getOrNull(5)) // 输出 null
}
```

## 扩展与数据类

扩展函数可以简化数据类的操作。

```kotlin
data class Person(val name: String, val age: Int)

fun Person.describe(): String {
    return "Name: $name, Age: $age"
}

fun main() {
    val person = Person("Alice", 30)
    println(person.describe()) // 输出 "Name: Alice, Age: 30"
}
```

## 扩展与委托

扩展可以与委托一起使用，以实现懒加载或其他逻辑。

```kotlin
val String.exclaim: String
    get() = this + "!"

fun main() {
    val str = "Hello"
    println(str.exclaim) // 输出 "Hello!"
}
```

## 扩展的实际应用

扩展在实际开发中非常有用，例如：

- 为第三方库中的类添加额外的功能。
- 简化常见操作，如 `Int` 类型的 `times` 函数。
- 实现设计模式，如装饰者模式。

扩展是 Kotlin 语言的一个强大特性，它提高了代码的可读性和可维护性，同时减少了代码的冗余。
