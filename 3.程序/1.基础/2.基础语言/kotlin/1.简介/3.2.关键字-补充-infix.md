# 中缀关键字`infix`

Kotlin 中的 `infix` 关键字允许你以更简洁的语法调用某些函数，称为**中缀表示法**（Infix Notation）。这种语法让函数调用看起来更像内置运算符，提高代码的可读性。

## **1. 中缀函数的定义条件**

要将函数声明为中缀函数，必须满足以下条件：

- **必须是成员函数或扩展函数**
- **必须只有一个参数**
- **参数不能有默认值**
- **参数不能是可变参数**
- **必须使用 `infix` 关键字修饰**

## **2. 基本语法**

### 普通函数调用

```kotlin
a.function(b)
```

### 中缀函数调用

```kotlin
a function b
```

## **3. 示例**

### 3.1 扩展函数作为中缀函数

```kotlin
// 定义一个中缀扩展函数
infix fun String.withPrefix(prefix: String): String {
    return "$prefix$this"
}

// 使用中缀表示法调用
val result = "World" withPrefix "Hello, "
println(result) // 输出: Hello, World
```

### 3.2 成员函数作为中缀函数

```kotlin
class Calculator {
    infix fun add(num: Int): Int {
        return this + num // 假设 this 是当前 Calculator 实例的数值
    }
}

// 使用中缀表示法调用
val calc = Calculator()
val result = calc add 5
```

## **4. 中缀函数的实际应用**

### 4.1 集合操作

```kotlin
// 自定义中缀函数：检查元素是否在集合中
infix fun <T> Collection<T>.has(element: T): Boolean {
    return contains(element)
}

// 使用示例
val numbers = listOf(1, 2, 3)
if (numbers has 2) {
    println("集合包含 2")
}
```

### 4.2 构建 DSL

```kotlin
// 构建一个简单的路由 DSL
class Router {
    private val routes = mutableMapOf<String, String>()
    
    infix fun route(path: String) {
        routes[path] = path // 简化实现
    }
    
    infix fun String.to(handler: String) {
        routes[this] = handler
    }
}

// 使用中缀表示法构建路由
val router = Router()
router route "/home"
"/login" to "LoginHandler"
```

## **5. 与运算符重载的区别**

- **运算符重载**：使用预定义的运算符符号（如 `+`、`*`），需要实现特定接口。
- **中缀函数**：使用自定义函数名，但语法更接近运算符。

```kotlin
// 运算符重载
operator fun Int.plus(other: Int): Int = this + other

// 中缀函数
infix fun Int.add(other: Int): Int = this + other

// 调用方式
val a = 1 + 2     // 运算符重载
val b = 1 add 2   // 中缀函数
```

## **6. 注意事项**

1. **优先级**：中缀函数的优先级低于算术运算符，但高于布尔运算符。

   ```kotlin
   1 + 2 add 3  // 等价于 (1 + 2) add 3
   ```

2. **适用场景**：仅用于增强可读性的场景，避免滥用导致代码晦涩。

3. **命名规范**：中缀函数名应简洁且表意明确（如 `to`、`with`、`on`）。

## **总结**

中缀函数是 Kotlin 的语法糖，通过更简洁的调用方式提升代码可读性，尤其适用于构建 DSL 或简化集合操作。但需谨慎使用，确保代码既简洁又易于理解。
