# SharePreference

在 Android 开发中，`SharedPreferences` 是一种轻量级存储解决方案，用于保存和检索少量的数据，如用户偏好设置。在 Kotlin 中使用 `SharedPreferences` 与在 Java 中使用非常相似，但 Kotlin 提供了更简洁的语法。

以下是如何在 Kotlin 中使用 `SharedPreferences` 的基本步骤：

## 1. 获取 `SharedPreferences` 实例

你可以通过调用 `getSharedPreferences` 方法获取 `SharedPreferences` 的实例，该方法通常在 `Context` 对象上调用。

```kotlin
val sharedPreferences: SharedPreferences = context.getSharedPreferences("my_prefs", Context.MODE_PRIVATE)
```

这里，`"my_prefs"` 是存储文件的名称，`Context.MODE_PRIVATE` 表示文件只能被当前应用访问。

## 2. 存储数据

要保存数据，你可以使用 `edit` 方法开始编辑，然后使用 `put` 方法保存不同类型的数据。

```kotlin
with(sharedPreferences.edit()) {
    putString("username", "JohnDoe")
    putInt("age", 30)
    putBoolean("isPro", true)
    apply() // 或者使用 commit()，它返回一个布尔值表示操作是否成功
}
```

## 3. 检索数据

要从 `SharedPreferences` 中检索数据，使用相应的 `get` 方法。

```kotlin
val username: String? = sharedPreferences.getString("username", null)
val age: Int = sharedPreferences.getInt("age", 0)
val isPro: Boolean = sharedPreferences.getBoolean("isPro", false)
```

## 4. 删除数据

要删除 `SharedPreferences` 中的数据，使用 `remove` 方法。

```kotlin
with(sharedPreferences.edit()) {
    remove("username")
    apply() // 或者使用 commit()
}
```

## 5. 清除所有数据

要清除所有数据，使用 `clear` 方法。

```kotlin
with(sharedPreferences.edit()) {
    clear()
    apply() // 或者使用 commit()
}
```

## 6. 监听数据变化

在 Android 中，你可以注册一个 `SharedPreferences.OnSharedPreferenceChangeListener` 来监听 `SharedPreferences` 文件的变化。

```kotlin
sharedPreferences.registerOnSharedPreferenceChangeListener { sharedPreferences, key ->
    if (key == "username") {
        val newUsername = sharedPreferences.getString(key, null)
        // 处理用户名变化
    }
}

// 当不再需要监听时，记得注销
sharedPreferences.unregisterOnSharedPreferenceChangeListener(listener)
```

## 注意事项

- `apply()` 方法是异步的，它将编辑操作放入队列，然后同步地执行它们。它没有返回值。
- `commit()` 方法是同步的，它立即执行编辑操作，并返回一个布尔值表示操作是否成功。
- 从 Android 12（API 31）开始，`SharedPreferences` 被官方标记为过时，推荐使用 `DataStore` 作为替代方案。

`SharedPreferences` 是一个简单且有效的存储解决方案，适用于保存少量数据，如用户偏好设置。然而，对于更复杂的数据存储需求，你可能需要考虑使用数据库或其他存储解决方案。
