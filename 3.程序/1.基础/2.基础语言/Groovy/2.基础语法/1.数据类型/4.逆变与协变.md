# 逆变与协变

在泛型编程中，**协变（covariance）** 和 **逆变（contravariance）** 是两种类型变化的规则，它们允许在子类型和超类型之间进行更灵活的转换。这两个概念主要用于类型安全地重用现有的代码。以下是协变和逆变的详解和它们之间的区别：

## 协变（Covariance）

- **定义**：协变允许子类型的引用被当作超类型的引用使用。换句话说，如果 `B` 是 `A` 的子类型（`B <: A`），那么协变允许 `B[]` 可以被当作 `A[]` 使用。
- **用途**：协变主要用于读取操作，例如，如果你有一个 `List<B>` 的列表，并且 `B` 继承自 `A`，那么这个列表可以安全地当作 `List<A>` 使用，因为你不会添加任何新元素到列表中，只是从中读取。
- **示例**：

  ```java
  List<String> strings = new ArrayList<String>();
  List<Object> objects = strings; // 协变：子类型 String 可以作为超类型 Object 使用
  ```

## 逆变（Contravariance）

- **定义**：逆变允许超类型的引用被当作子类型的引用使用。如果 `B` 是 `A` 的子类型（`B <: A`），那么逆变允许 `List<A>` 可以被当作 `List<B>` 使用。
- **用途**：逆变主要用于写入操作，例如，如果你有一个 `List<A>` 的列表，并且 `B` 继承自 `A`，那么这个列表可以安全地当作 `List<B>` 使用，因为你添加到列表中的元素都是 `A` 类型的，而 `B` 作为 `A` 的子类型，可以被添加到 `List<B>` 中。
- **示例**：

  ```java
  void processList(List<? super B> list) {
    // 可以向 list 中添加 B 或 B 的超类型
    list.add(new B());
    // 或者
    list.add(new Object());
  }
  ```

## 区别

- **方向**：协变是子类型向上转换，逆变是超类型向下转换。
- **安全性**：协变主要用于读取操作，逆变主要用于写入操作。协变在读操作上是安全的，因为它保证了你不会违反类型安全地写入不正确的类型。逆变在写操作上是安全的，因为它保证了你不会违反类型安全地读取不正确的类型。
- **应用场景**：协变通常用于返回值，逆变通常用于参数。

## 注意

- Java 在泛型中对协变和逆变的支持有限。Java 的泛型数组不是协变的，所以不能直接将子类型的数组当作超类型的数组使用。但是，Java 允许有限的协变在返回值的上下文中使用（称为协变返回类型）。
- 逆变在 Java 中使用较少，通常需要通过通配符（如 `List<? super B>`）来实现。

在设计泛型 API 时，理解协变和逆变的概念对于决定如何设计类型参数以实现最大的灵活性和安全性至关重要。
