# 文件处理

Groovy 提供了简洁高效的语法来处理文件操作，相比 Java 更加精简。以下是常见的文件操作示例：

---

## **1. 读取文件**

### 读取全部内容

```groovy
def content = new File("example.txt").text
println(content)
```

### 逐行读取

```groovy
new File("example.txt").eachLine { line ->
    println(line)
}
```

### 读取为行列表

```groovy
List lines = new File("example.txt").readLines()
lines.each { println(it) }
```

---

## **2. 写入文件**

### 覆盖写入

```groovy
new File("output.txt").text = "Hello, Groovy!"
```

### 追加写入

```groovy
new File("output.txt").append("\nAnother line.")
```

### 使用 `withWriter` 自动管理资源

```groovy
new File("output.txt").withWriter { writer ->
    writer.writeLine("Line 1")
    writer.writeLine("Line 2")
}
```

---

## **3. 遍历目录和文件**

### 遍历目录下所有文件

```groovy
new File(".").eachFile { file ->
    println(file.name)
}
```

### 递归遍历所有文件（包括子目录）

```groovy
new File(".").eachFileRecurse { file ->
    println(file.absolutePath)
}
```

### 过滤特定类型文件

```groovy
new File(".").eachFileMatch(~/.*\.txt/) { txtFile ->
    println(txtFile.name)
}
```

---

## **4. 文件操作工具方法**

### 检查文件/目录是否存在

```groovy
def file = new File("example.txt")
println file.exists() ? "Exists" : "Not found"
```

### 创建目录

```groovy
new File("new_dir").mkdir()      // 创建单级目录
new File("parent/child").mkdirs() // 创建多级目录
```

### 复制文件

```groovy
def src = new File("source.txt")
def dest = new File("destination.txt")
dest << src.text // 简单复制内容
```

或使用 `AntBuilder` 进行高级复制：

```groovy
def ant = new AntBuilder()
ant.copy(file: "source.txt", tofile: "destination.txt")
```

### 删除文件/目录

```groovy
new File("temp.txt").delete() // 删除文件
new File("empty_dir").deleteDir() // 删除空目录
new File("non_empty_dir").deleteDir() // 强制删除非空目录
```

---

## **5. 临时文件处理**

```groovy
def tempFile = File.createTempFile("prefix", ".txt")
tempFile.text = "Temporary content"
println("Temp file path: ${tempFile.absolutePath}")

// 使用后删除
tempFile.deleteOnExit()
```

---

## **6. 处理文件属性**

### 获取文件信息

```groovy
def file = new File("example.txt")
println "Size: ${file.length()} bytes"
println "Last modified: ${new Date(file.lastModified())}"
println "Is directory? ${file.isDirectory()}"
```

### 修改文件权限（Unix系统）

```groovy
def file = new File("script.sh")
file.setExecutable(true) // 设为可执行
```

---

## **7. 高级操作**

### 处理 CSV 文件

```groovy
def csv = new File("data.csv")
def rows = csv.readLines().collect { it.split(',') }
rows.each { println("Row: $it") }
```

### 处理 JSON 文件

```groovy
import groovy.json.JsonSlurper
def jsonFile = new File("data.json")
def data = new JsonSlurper().parse(jsonFile)
println(data.key)
```

---

## **8. 异常处理**

```groovy
try {
    new File("missing.txt").text
} catch (FileNotFoundException e) {
    println("File not found!")
}
```

---

## **总结**

Groovy 文件操作的优势：

- 使用 `text` 和 `eachLine` 简化读写。
- 通过 `eachFile` 和 `eachFileRecurse` 轻松遍历目录。
- 链式调用和闭包使代码更简洁。
- 整合了 AntBuilder 等工具增强功能。

如果需要更底层控制，可结合 Java 的 `java.nio.file.Files` 类使用。
