# 函数

在Shell脚本中，函数是一组可以重复使用的命令序列。使用函数可以提高脚本的模块化程度，使代码更加清晰、易于维护。以下是如何在Shell脚本中定义和使用函数的基本指南：

## 定义函数

```bash
#!/bin/bash

# 定义一个简单的函数
my_function() {
    echo "Hello from the function!"
}

# 调用函数
my_function
```

## 参数和返回值

```bash
#!/bin/bash

# 定义一个带参数的函数
greet() {
    local name=$1
    echo "Hello, $name!"
}

# 调用函数并传递参数
greet "Alice"

# 定义一个返回计算结果的函数
calculate() {
    local result=$(( $1 + $2 ))
    echo $result
}

# 使用函数的输出
result=$(calculate 5 3)
echo "The result is $result"
```

## 默认参数

```bash
#!/bin/bash

# 定义一个带有默认参数的函数
default_greet() {
    local name=${1:-"World"}
    echo "Hello, $name!"
}

# 调用函数，使用默认参数
default_greet
```

## 函数返回状态码

```bash
#!/bin/bash

# 定义一个可以返回状态码的函数
check_file() {
    if [ -f "$1" ]; then
        echo "File exists."
        return 0 # 成功
    else
        echo "File does not exist."
        return 1 # 失败
    fi
}

# 调用函数并检查返回状态码
check_file "somefile.txt"
status=$?
if [ $status -eq 0 ]; then
    echo "Success: check_file returned $status"
else
    echo "Error: check_file returned $status"
fi
```

## 递归函数

```bash
#!/bin/bash

# 定义一个递归函数
recursive_function() {
    local count=$1
    if [ $count -gt 0 ]; then
        echo "Count: $count"
        recursive_function $(( $count - 1 ))
    fi
}

# 调用递归函数
recursive_function 5
```

## 局部变量

```bash
#!/bin/bash

# 定义一个使用局部变量的函数
process_data() {
    local data=$1
    # 在这里处理 $data，外部无法访问 $data
}

# 调用函数
process_data "some data"
```

## 函数类型

Bash支持两种类型的函数：

- **普通函数**：使用`function`关键字或大括号 `{}` 定义。
- **匿名函数**（也称为Lambda函数）：使用大括号直接定义，不需要`function`关键字。

```bash
#!/bin/bash

# 匿名函数
my_lambda=() {
    echo "Hello from a lambda!"
}

# 调用匿名函数
my_lambda
```

## 注意事项

- 尽量使用局部变量（使用`local`关键字）来避免变量污染。
- 函数返回值使用`return`命令设置，但`return`仅用于退出函数；命令的退出状态（也称为退出状态码）需要使用`$?`来捕获。
- 递归函数可以帮助解决一些问题，但要注意递归深度限制和性能问题。

使用函数可以提高Shell脚本的可读性和可维护性，是编写复杂脚本时不可或缺的工具。
