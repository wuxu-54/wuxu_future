# vim

Vim（Vi Improved）是 Vi 编辑器的增强版，继承了 Vi 的所有功能并新增了大量实用特性（如语法高亮、多级撤销、代码折叠、插件支持等），是 Linux 环境下程序员和系统管理员的首选文本编辑器。Vim 的核心仍是**模式化操作**，但扩展了更多模式和功能，以下是详细解析：

## 一、Vim 与 Vi 的核心差异

Vim 在 Vi 基础上增加的关键特性：

- 语法高亮（支持多种编程语言）
- 多级撤销/重做（而非 Vi 的单级撤销）
- 可视模式细分（字符/行/块级选择）
- 代码折叠（折叠/展开代码块）
- 寄存器系统（多缓冲区存储复制内容）
- 宏录制（重复执行一系列操作）
- 插件支持（通过插件扩展功能）
- 会话管理（保存/加载编辑状态）
- 拼写检查、自动补全、标签页等

## 二、Vim 的模式详解（扩展自 Vi）

Vim 保留了 Vi 的核心模式，并扩展了更多细分模式，共 6 种主要模式：

| 模式               | 进入方式                          | 功能描述                                                                 |
|--------------------|-----------------------------------|--------------------------------------------------------------------------|
| **命令模式**       | 启动 Vim 默认进入；其他模式按 `Esc` | 执行光标移动、删除、复制、粘贴等基础操作                                 |
| **插入模式**       | 命令模式按 `i/a/o/I/A/O` 等       | 输入文本（同 Vi，但 Vim 增加了自动缩进、括号补全等辅助功能）             |
| **末行模式**       | 命令模式按 `:`                    | 执行保存、退出、查找、替换、配置等高级命令                               |
| **可视模式（字符）** | 命令模式按 `v`                    | 按字符选中文本（拖动光标选择任意字符范围）                               |
| **可视模式（行）**   | 命令模式按 `V`（大写）            | 按行选中文本（选中整行，适合批量处理行）                                 |
| **可视模式（块）**   | 命令模式按 `Ctrl+v`               | 按列选中文本（垂直块选择，适合批量在多行相同位置插入/删除内容）           |
| **替换模式**       | 命令模式按 `R`                    | 持续替换光标后的字符（与 `r` 单字符替换不同，`R` 进入模式后可连续替换）   |

## 三、Vim 启动与退出（扩展选项）

### 1. 启动 Vim

除了 Vi 的基础启动方式，Vim 增加了更多实用参数：

```bash
vim [选项] 文件名

# 常用选项
vim +n 文件名        # 打开文件并定位到第 n 行（如 `vim +10 test.txt`）
vim +/pattern 文件名 # 打开文件并定位到第一个匹配 pattern 的位置
vim -O 文件1 文件2   # 垂直分屏打开多个文件（O 大写）
vim -o 文件1 文件2   # 水平分屏打开多个文件（o 小写）
vim -R 文件名        # 以只读模式打开（防止误编辑）
vim -S 会话文件     # 加载保存的会话（恢复之前的编辑状态）
vim -d 文件1 文件2   # 以 diff 模式打开，对比两个文件差异
```

### 2. 退出 Vim（末行模式命令）

除了 Vi 的 `:q`/`:wq` 等，Vim 增加了会话保存：

| 命令          | 功能描述                     |
|---------------|------------------------------|
| `:q`/`:quit`  | 退出（未修改时）             |
| `:q!`/`:quit!`| 强制退出，不保存             |
| `:wq`/`:x`    | 保存并退出                   |
| `:wq!`        | 强制保存并退出（针对只读文件）|
| `:wall`       | 保存所有已打开的文件         |
| `:qall`       | 退出所有分屏/标签页          |
| `:wqall`      | 保存所有文件并退出           |
| `:session save 会话名` | 保存当前编辑状态（分屏、打开的文件等） |
| `:session load 会话名` | 加载之前保存的会话           |

## 四、命令模式核心操作（含 Vim 新增功能）

命令模式是 Vim 操作的核心，以下是基础操作及 Vim 特有功能：

### 1. 光标移动（扩展 Vi 的移动方式）

| 按键/组合键       | 功能描述（新增功能标★）                     |
|-------------------|----------------------------------------------|
| `h/j/k/l` 或方向键 | 基础移动（左/下/上/右）                       |
| `0`/`$`/`^`       | 行首/行尾/行首非空字符                       |
| `w`/`b`/`e`       | 单词级移动（下一词首/上一词首/当前词尾）     |
| `gg`/`G`          | 文件首行/尾行                                |
| `nG`/`:n`         | 跳转到第 n 行（如 `5G` 或 `:5`）              |
| `Ctrl+f`/`Ctrl+b` | 翻页（向前/向后）                            |
| `Ctrl+d`/`Ctrl+u` | 翻半页（向下/向上）                          |
| `H`/`M`/`L`       | 跳转到屏幕顶部/中间/底部行★                  |
| `zt`/`zz`/`zb`    | 将当前行滚动到屏幕顶部/中间/底部★            |
| `%`               | 在成对符号（括号/引号等）间跳转（如 `()` `{}`）★ |
| `*`/`#`           | 向下/向上查找当前光标所在单词的下一个匹配项★  |

### 2. 文本编辑（删除/复制/粘贴）

| 按键/组合键       | 功能描述（新增功能标★）                     |
|-------------------|----------------------------------------------|
| `x`/`nx`          | 删除光标处/后 n 个字符                       |
| `dd`/`ndd`        | 删除当前行/连续 n 行（剪切）                 |
| `yy`/`nyy`        | 复制当前行/连续 n 行                         |
| `p`/`P`           | 粘贴到光标后/前                              |
| `d`+移动命令      | 删除指定范围（如 `d$` 删除到行尾）           |
| `y`+移动命令      | 复制指定范围（如 `y3w` 复制3个单词）         |
| `D`               | 等价于 `d$`（删除到行尾）                    |
| `Y`               | 等价于 `yy`（复制当前行）                    |
| `c`+移动命令      | 删除指定范围并进入插入模式（如 `cw` 改单词）★ |
| `cc`/`ncc`        | 删除当前行/连续 n 行并进入插入模式★          |
| `s`               | 删除光标处字符并进入插入模式（等价于 `cl`）★ |
| `S`               | 删除当前行并进入插入模式（等价于 `cc`）★     |

### 3. 撤销与重做（Vim 多级支持）

Vi 仅支持单级撤销（`u`），Vim 支持多级：

| 按键/命令          | 功能描述                     |
|---------------------|------------------------------|
| `u`                 | 撤销上一步操作（可多次按）   |
| `Ctrl+r`            | 重做被撤销的操作（反撤销）   |
| `:undo n`           | 撤销前 n 步操作（如 `:undo 5`）|
| `:redo n`           | 重做前 n 步被撤销的操作      |
| `:earlier 10m`      | 恢复到 10 分钟前的状态★      |
| `:later 5m`         | 前进到 5 分钟后的状态★       |

### 4. 可视模式操作（Vim 核心增强）

进入可视模式（`v`/`V`/`Ctrl+v`）后，选中内容可执行以下操作：

| 按键       | 功能描述                     |
|------------|------------------------------|
| `d`        | 删除选中内容                 |
| `y`        | 复制选中内容                 |
| `c`        | 删除选中内容并进入插入模式   |
| `>`        | 向右缩进选中内容（按 `Tab`） |
| `<`        | 向左缩进选中内容（按 `Shift+Tab`）|
| `~`        | 切换选中内容的大小写         |
| `U`        | 将选中内容转为大写           |
| `u`        | 将选中内容转为小写           |

**块可视模式（`Ctrl+v`）经典用法**：  
批量在多行前加注释（如 Python 的 `#`）：  

1. 按 `Ctrl+v` 进入块模式  
2. 按 `j` 选中需要注释的行  
3. 按 `I`（大写）进入插入模式，输入 `#`  
4. 按 `Esc`，所有选中行的行首会自动添加 `#`  

## 五、末行模式高级命令（Vim 扩展）

末行模式（`:` 进入）支持更多复杂命令，以下是 Vim 特有功能：

### 1. 查找与替换（增强正则支持）

| 命令格式                  | 功能描述（新增功能标★）                     |
|---------------------------|----------------------------------------------|
| `/pattern`/`?pattern`     | 向下/向上查找 pattern                        |
| `n`/`N`                   | 继续查找下一个/上一个匹配项                  |
| `:set hlsearch`           | 高亮显示所有匹配项★（默认关闭）              |
| `:set nohlsearch`         | 关闭高亮显示                                 |
| `:nohl`                   | 临时取消当前高亮（不关闭 `hlsearch`）★       |
| `:s/old/new/g`            | 当前行替换所有 old 为 new                    |
| `:n1,n2s/old/new/g`       | 第 n1 到 n2 行替换所有 old 为 new            |
| `:%s/old/new/g`           | 全文件替换（`%` 代表所有行）                 |
| `:%s/old/new/gc`          | 全文件替换并逐次确认（c=confirm）             |
| `:%s/old/new/gi`          | 全文件替换，忽略大小写（i=ignorecase）★      |

### 2. 多文件与分屏操作（Vim 核心功能）

Vim 支持同时编辑多个文件，通过分屏或标签页管理：

| 命令/快捷键               | 功能描述                     |
|---------------------------|------------------------------|
| `:e 文件名`               | 在当前窗口打开新文件         |
| `:bn`/`:bp`               | 切换到下一个/上一个打开的文件（bn=buffer next）|
| `:ls`                     | 列出所有打开的文件（缓冲区） |
| `:split 文件名`/`:sp 文件名` | 水平分屏打开文件             |
| `:vsplit 文件名`/`:vsp 文件名` | 垂直分屏打开文件           |
| `Ctrl+w+方向键`           | 在分屏窗口间切换（上/下/左/右）|
| `Ctrl+w+w`                | 循环切换分屏窗口             |
| `Ctrl+w+q`                | 关闭当前分屏窗口             |
| `Ctrl+w+=`                | 使所有分屏窗口高度/宽度相等  |
| `:tabnew 文件名`          | 新建标签页打开文件           |
| `:tabn`/`:tabp`           | 切换到下一个/上一个标签页    |
| `:tabclose`               | 关闭当前标签页               |

### 3. 配置与显示设置（`~/.vimrc` 常用配置）

Vim 可通过末行命令临时配置，或写入 `~/.vimrc` 文件永久生效：

| 命令/配置项               | 功能描述                     |
|---------------------------|------------------------------|
| `:set number`/`:set nu`    | 显示行号（`set nonu` 关闭）  |
| `:set relativenumber`/`:set rnu` | 显示相对行号（当前行是绝对行号，其他行是与当前行的差值）★ |
| `:set autoindent`/`:set ai` | 自动缩进（与上一行对齐）     |
| `:set smartindent`         | 智能缩进（代码块自动增加缩进）★ |
| `:set expandtab`           | 将 `Tab` 键转为空格（`set noexpandtab` 关闭）|
| `:set tabstop=4`           | 设置 `Tab` 键宽度为 4 个空格 |
| `:set shiftwidth=4`        | 设置自动缩进的宽度为 4 个空格 |
| `:set syntax on`           | 开启语法高亮（默认开启）     |
| `:set background=dark`     | 适配深色背景（`light` 为浅色）|
| `:set cursorline`          | 高亮当前行（方便定位）★     |
| `:set mouse=a`             | 启用鼠标操作（选中文本、点击切换窗口等）★ |

## 六、Vim 高级功能（特有特性）

### 1. 寄存器（多缓冲区存储）

Vim 有 26 个字母寄存器（`a-z`）和特殊寄存器，可存储多个复制内容：

- 复制到指定寄存器：`"[寄存器名]y`（如 `"ayy` 复制当前行到 `a` 寄存器）
- 从指定寄存器粘贴：`"[寄存器名]p`（如 `"ap` 粘贴 `a` 寄存器内容）
- 常用特殊寄存器：
  - `""`：默认寄存器（最后一次复制/删除的内容）
  - `"+`：系统剪贴板寄存器（与外部程序共享内容，需 Vim 支持 `+clipboard` 特性）
  - `"%`：当前文件名寄存器

### 2. 宏录制（重复执行操作）

宏可录制一系列操作并重复执行，适合批量处理：

1. 命令模式按 `q[寄存器名]` 开始录制（如 `qa` 用 `a` 寄存器存宏）
2. 执行需要重复的操作（如删除行首空格、修改格式等）
3. 按 `q` 结束录制
4. 按 `@[寄存器名]` 执行宏（如 `@a` 执行 `a` 寄存器的宏）
5. 按 `n@[寄存器名]` 重复执行 n 次（如 `10@a` 执行 10 次）

### 3. 代码折叠（编程必备）

Vim 支持折叠代码块（函数、循环等），方便浏览长文件：

| 命令          | 功能描述                     |
|---------------|------------------------------|
| `zc`          | 折叠当前代码块               |
| `zo`          | 展开当前代码块               |
| `zC`          | 折叠当前代码块及嵌套块       |
| `zO`          | 展开当前代码块及嵌套块       |
| `za`          | 切换折叠/展开状态            |
| `zM`          | 折叠所有代码块               |
| `zR`          | 展开所有代码块               |
| `:set foldmethod=indent` | 按缩进折叠（适合大多数语言）★ |
| `:set foldmethod=syntax` | 按语法折叠（根据代码语法）★  |

### 4. 拼写检查（文本编辑辅助）

| 命令          | 功能描述                     |
|---------------|------------------------------|
| `:set spell`  | 开启拼写检查（默认关闭）     |
| `:set spelllang=en_us` | 设置拼写检查语言（如英语） |
| `]s`          | 跳转到下一个拼写错误         |
| `[s`          | 跳转到上一个拼写错误         |
| `z=`          | 显示错误单词的纠正建议       |

## 七、Vim 插件与扩展

Vim 的强大之处在于可通过插件扩展功能，常用插件管理器：

- **Vundle**：简单易用的插件管理器
- **Plug**：快速并行安装插件的管理器

常用插件推荐：

- `NERDTree`：文件浏览器（侧边栏显示目录结构）
- `vim-airline`：美化状态栏（显示文件名、行号、模式等）
- `YouCompleteMe`：智能代码补全（支持多语言）
- `vim-syntastic`：实时语法检查
- `fzf`：快速文件搜索

## 总结

Vim 是一个“入门难，精通后效率极高”的编辑器，其核心价值在于：

- 纯键盘操作，减少鼠标依赖，编辑效率远超图形化编辑器
- 高度可定制（通过 `.vimrc` 和插件），可适配个人习惯
- 跨平台（Linux/macOS/Windows），掌握后可在所有环境高效工作

建议初学者从基础模式和常用命令练起，逐步熟悉高级功能，最终通过自定义配置打造专属编辑器。
