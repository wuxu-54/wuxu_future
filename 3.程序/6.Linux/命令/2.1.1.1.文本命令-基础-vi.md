# 文本编辑命令-vi

vi 是 Linux 系统中最经典的文本编辑器，几乎所有 Linux 发行版都预装了 vi，它以轻量、高效、纯键盘操作著称。vi 的核心特点是**模式化操作**，不同模式下按键功能不同，掌握模式切换是使用 vi 的基础。

## 一、vi 的三种核心模式

vi 有三种基本模式，所有操作都在这三种模式间切换：

1. **命令模式（Command Mode）**  
   - 启动 vi 后默认进入的模式，用于执行光标移动、删除、复制、粘贴等操作。
   - 其他模式下按 `Esc` 键可返回命令模式（按一次无效可多按几次）。

2. **插入模式（Insert Mode）**  
   - 用于输入文本内容，类似普通编辑器的编辑状态。
   - 命令模式下按 `i/a/o` 等键可进入插入模式，左下角会显示 `-- INSERT --`。

3. **末行模式（Last Line Mode）**  
   - 用于执行保存、退出、查找、替换等高级命令。
   - 命令模式下按 `:` 键可进入末行模式，光标会移到屏幕底部等待输入命令。

## 二、vi 启动与退出

### 1. 启动 vi

```bash
vi [文件名]  # 打开指定文件，文件不存在则创建
vi +n [文件名]  # 打开文件并定位到第 n 行
vi +/pattern [文件名]  # 打开文件并定位到第一个匹配 pattern 的位置
```

### 2. 退出 vi（末行模式命令）

| 命令       | 功能描述                     |
|------------|------------------------------|
| `:q`       | 退出 vi（未修改文件时有效）  |
| `:q!`      | 强制退出，不保存修改         |
| `:w`       | 保存当前文件                 |
| `:w 文件名` | 另存为指定文件               |
| `:wq` 或 `:x` | 保存并退出（两者等价）       |

## 三、命令模式操作（核心）

命令模式下无需按 `:`，直接按键盘按键执行操作，主要包括光标移动、文本编辑、复制粘贴等。

### 1. 光标移动

| 按键       | 功能描述                     |
|------------|------------------------------|
| `h` 或 ←   | 向左移动 1 个字符            |
| `l` 或 →   | 向右移动 1 个字符            |
| `j` 或 ↓   | 向下移动 1 行                |
| `k` 或 ↑   | 向上移动 1 行                |
| `0`（数字）| 移动到当前行首               |
| `$`        | 移动到当前行尾               |
| `^`        | 移动到当前行第一个非空字符   |
| `w`        | 向右移动到下一个单词首       |
| `b`        | 向左移动到上一个单词首       |
| `e`        | 移动到当前单词尾             |
| `gg`       | 移动到文件首行               |
| `G`        | 移动到文件尾行               |
| `nG`       | 移动到第 n 行（如 `5G` 到第5行）|
| `Ctrl+f`   | 向下翻一页（forward）        |
| `Ctrl+b`   | 向上翻一页（backward）       |
| `Ctrl+d`   | 向下翻半页（down）           |
| `Ctrl+u`   | 向上翻半页（up）             |

### 2. 文本删除

| 按键       | 功能描述                     |
|------------|------------------------------|
| `x`        | 删除当前光标处的字符         |
| `nx`       | 删除光标后 n 个字符（如 `3x` 删除3个）|
| `X`        | 删除光标前的字符             |
| `dd`       | 删除当前行（剪切行）         |
| `ndd`      | 删除从当前行开始的 n 行（如 `5dd` 删除5行）|
| `d^`       | 删除从光标到行首的内容       |
| `d$`       | 删除从光标到行尾的内容       |
| `dw`       | 删除从光标到下一个单词首的内容 |
| `db`       | 删除从光标到上一个单词首的内容 |

### 3. 复制与粘贴

| 按键       | 功能描述                     |
|------------|------------------------------|
| `yy`       | 复制当前行                   |
| `nyy`      | 复制从当前行开始的 n 行（如 `3yy` 复制3行）|
| `p`        | 将复制/删除的内容粘贴到光标后 |
| `P`（大写）| 将复制/删除的内容粘贴到光标前 |

### 4. 撤销与重做

| 按键       | 功能描述                     |
|------------|------------------------------|
| `u`        | 撤销上一步操作               |
| `Ctrl+r`   | 重做被撤销的操作（反撤销）   |

### 5. 替换操作

| 按键       | 功能描述                     |
|------------|------------------------------|
| `r`        | 替换当前光标处的单个字符（按 `r` 后输入新字符）|
| `R`        | 进入替换模式（持续替换光标后的字符，按 `Esc` 退出）|

### 6. 其他常用命令

| 按键       | 功能描述                     |
|------------|------------------------------|
| `J`        | 将当前行与下一行合并         |
| `~`        | 切换光标处字符的大小写       |
| `.`（点）  | 重复执行上一次编辑操作       |
| `Ctrl+g`   | 显示当前行信息（行号、总行数）|

## 四、插入模式（输入文本）

命令模式下按以下键进入插入模式，区别在于光标位置不同：

| 按键       | 功能描述                     |
|------------|------------------------------|
| `i`        | 在当前光标前插入             |
| `I`（大写）| 在当前行首插入（忽略行首空格）|
| `a`        | 在当前光标后插入             |
| `A`（大写）| 在当前行尾插入               |
| `o`（小写）| 在当前行下方新建一行并插入   |
| `O`（大写）| 在当前行上方新建一行并插入   |

## 五、末行模式（高级命令）

命令模式下按 `:` 进入末行模式，输入命令后按回车执行。

### 1. 查找与替换

| 命令格式                  | 功能描述                     |
|---------------------------|------------------------------|
| `/pattern`                | 从当前位置向下查找 pattern（支持正则）|
| `?pattern`                | 从当前位置向上查找 pattern   |
| `n`                       | 继续查找下一个匹配项         |
| `N`                       | 反向查找上一个匹配项         |
| `:s/old/new`              | 替换当前行第一个 old 为 new  |
| `:s/old/new/g`            | 替换当前行所有 old 为 new    |
| `:n1,n2s/old/new/g`       | 替换第 n1 到 n2 行所有 old 为 new |
| `:%s/old/new/g`           | 替换整个文件所有 old 为 new  |
| `:%s/old/new/gc`          | 替换整个文件，每次替换前确认（c=confirm）|

### 2. 行号与显示设置

| 命令              | 功能描述                     |
|-------------------|------------------------------|
| `:set number` 或 `:set nu` | 显示行号                     |
| `:set nonumber` 或 `:set nonu` | 隐藏行号                  |
| `:set autoindent` 或 `:set ai` | 自动缩进（与上一行对齐）|
| `:set noautoindent` 或 `:set noai` | 关闭自动缩进          |
| `:set syntax on`  | 开启语法高亮（vim 支持）     |
| `:set ignorecase` 或 `:set ic` | 查找时忽略大小写       |
| `:set noignorecase` 或 `:set noic` | 关闭忽略大小写        |

### 3. 文件操作

| 命令              | 功能描述                     |
|-------------------|------------------------------|
| `:e 文件名`       | 在当前窗口打开另一个文件     |
| `:split 文件名`   | 水平分屏显示当前文件和指定文件 |
| `:vsplit 文件名`  | 垂直分屏显示当前文件和指定文件 |
| `Ctrl+w+w`        | 在分屏窗口间切换             |
| `:close`          | 关闭当前分屏窗口             |

## 六、进阶：可视块模式（批量编辑）

命令模式下按 `Ctrl+v` 进入可视块模式（左下角显示 `-- VISUAL BLOCK --`），可按列选中文本，适合批量操作：

1. 按 `Ctrl+v` 进入可视块模式
2. 按 `j/k` 选中多行的同一列
3. 执行操作：
   - 按 `d`：删除选中的块
   - 按 `y`：复制选中的块
   - 按 `I`（大写）+ 输入内容 + `Esc`：在选中块的每行前插入相同内容

## 七、vi 与 vim 的区别

- **vi**：基础版本，功能简单，所有 Linux 系统预装。
- **vim**（Vi Improved）：vi 的增强版，支持语法高亮、代码补全、多级撤销等高级功能，建议优先使用 `vim`（用法与 vi 完全兼容）。

掌握 vi 的核心是熟悉模式切换和常用命令，初期可能觉得繁琐，但熟练后效率极高，是 Linux 运维和开发的必备技能。
