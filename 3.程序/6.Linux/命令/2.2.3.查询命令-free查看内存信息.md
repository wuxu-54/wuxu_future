# free

`free` 是 Linux 系统中用于查看内存使用状态的核心命令，能实时显示物理内存、交换内存（Swap）的总容量、已用容量、空闲容量及缓存情况。以下是其详细用法及全选项说明：

## 一、基础用法

```bash
free  # 直接运行，默认以KB为单位显示内存信息
```

默认输出示例：

```txt
              total        used        free      shared  buff/cache   available
Mem:        8167968     2345600     1234568      123456     4587800     5432100
Swap:       2097152          0     2097152
```

字段含义：

- `total`：总内存容量（物理内存/交换分区的总大小）
- `used`：已使用的内存（`total - free - buff/cache`）
- `free`：完全空闲的内存（未被任何进程使用）
- `shared`：被多个进程共享的内存（如 tmpfs 共享内存）
- `buff/cache`：用于缓冲区（buffer）和缓存（cache）的内存（可释放）
- `available`：可用内存（含空闲内存 + 可释放的缓存，更贴近实际可用值）
- `Mem`：物理内存信息
- `Swap`：交换分区（虚拟内存）信息

## 二、常用选项（按功能分类）

### 1. 单位转换选项（最常用）

`free` 默认以 **KB** 为单位，可通过选项切换为更易读的单位：

| 选项 | 功能说明 | 示例输出（以8GB内存为例） |
|------|----------|--------------------------|
| `-b` | 以 **字节（Bytes）** 为单位 | `Mem: 8563689472 ...` |
| `-k` | 以 **KB（千字节）** 为单位（默认） | `Mem: 8363000 ...` |
| `-m` | 以 **MB（兆字节）** 为单位 | `Mem: 8167 ...` |
| `-g` | 以 **GB（千兆字节）** 为单位 | `Mem: 7 ...` |
| `-h` | 以 **人类可读格式** 自动选择单位（推荐，显示为 K/M/G） | `Mem: 7.8Gi ...` |
| `--si` | 与 `-h` 类似，但使用国际单位制（1K=1000，而非1024） | `Mem: 8.2G ...`（1G=1000^3字节） |

### 2. 显示细节控制选项

| 选项 | 功能说明 | 示例 |
|------|----------|------|
| `-t` | 在输出末尾增加 **总计行**（Total：Mem + Swap 的总和） | `free -t -h` → 最后一行显示 `Total: 9.8Gi ...` |
| `-s <秒数>` | 持续刷新内存信息，间隔为指定秒数（按 `Ctrl+C` 退出） | `free -s 2 -h` → 每2秒刷新一次，以人类可读格式显示 |
| `-c <次数>` | 刷新指定次数后自动退出（配合 `-s` 使用） | `free -s 1 -c 3 -m` → 每秒刷新一次，共3次，以MB为单位 |
| `-w` | 显示 **缓冲区（buffer）和缓存（cache）的细分项**（默认合并为 `buff/cache`） | 输出会拆分 `buffers` 和 `cache` 两列，而非合并项 |
| `-V` | 显示 `free` 命令的版本信息 | `free -V` → 输出 `free from procps-ng 3.3.17` |

## 三、完整选项示例

### 1. 基础查看（人类可读格式）

```bash
free -h
```

输出：

```txt
              total        used        free      shared  buff/cache   available
Mem:           7.8Gi       2.2Gi       1.2Gi       120Mi       4.4Gi       5.2Gi
Swap:          2.0Gi          0B       2.0Gi
```

### 2. 显示缓冲区和缓存的细分

```bash
free -wh
```

输出（拆分 `buffers` 和 `cache`）：

```txt
              total        used        free      shared     buffers       cache   available
Mem:           7.8Gi       2.2Gi       1.2Gi       120Mi       300Mi       4.1Gi       5.2Gi
Swap:          2.0Gi          0B       2.0Gi
```

- `buffers`：用于块设备（如磁盘）的缓冲区（临时存储即将写入磁盘的数据）
- `cache`：用于文件系统的缓存（临时存储从磁盘读取的数据，加速下次访问）

### 3. 持续监控并显示总计

```bash
free -s 3 -c 4 -th  # 每3秒刷新一次，共4次，显示总计，人类可读格式
```

输出（最后一行含总计）：

```txt
              total        used        free      shared  buff/cache   available
Mem:           7.8Gi       2.2Gi       1.2Gi       120Mi       4.4Gi       5.2Gi
Swap:          2.0Gi          0B       2.0Gi
Total:         9.8Gi       2.2Gi       3.2Gi

# （省略中间2次刷新）

              total        used        free      shared  buff/cache   available
Mem:           7.8Gi       2.3Gi       1.1Gi       120Mi       4.4Gi       5.1Gi
Swap:          2.0Gi          0B       2.0Gi
Total:         9.8Gi       2.3Gi       3.1Gi
```

### 4. 国际单位制（1K=1000）

```bash
free -h --si
```

输出（与 `-h` 的区别在于单位换算，1G=1000^3字节）：

```txt
              total        used        free      shared  buff/cache   available
Mem:           8.4G        2.4G        1.3G        123M        4.7G        5.6G
Swap:          2.2G          0B        2.2G
```

## 四、关键字段解读

- **`used` vs `available`**：  
  - `used` 是传统意义上的“已用内存”，但包含了系统缓存（实际可释放），参考价值较低。  
  - `available` 是 Linux 3.3+ 新增字段，更准确反映“可立即分配给新进程的内存”（含空闲内存 + 可释放的缓存），推荐以此作为内存是否充足的判断依据。

- **`buff/cache` 的意义**：  
  缓冲区（buffer）和缓存（cache）是系统为加速IO而设计的，看似“已用”，但当进程需要内存时，系统会自动释放这部分资源，因此不必担心其占用过高。

- **Swap 分区**：  
  当物理内存不足时，系统会将部分不常用的内存数据写入 Swap 分区（通常在磁盘上），但 Swap 速度远慢于物理内存，若 `Swap used` 持续增长，可能表示物理内存不足。

## 五、注意事项

- **适用系统**：`free` 是 Linux 特有命令，macOS 需用 `vm_stat` 或 `top -l 1 | grep PhysMem` 替代。
- **权限**：所有用户均可使用，无需 root 权限。
- **与 `top`/`htop` 的区别**：`free` 专注于内存汇总信息，`top`/`htop` 更侧重进程级的内存占用。

通过 `free` 命令的选项组合，可灵活查看内存状态，是系统内存监控和故障排查（如内存泄漏、OOM 问题）的基础工具。
