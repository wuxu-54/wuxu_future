# grep

grep 是一个功能强大的命令行工具，用于在文本文件或标准输入中搜索匹配特定模式的行。以下是 grep 的一些详细命令和选项：

## 基本语法

`grep [options] pattern [file...]`

- grep 的options 可以组合处理

### 一、匹配控制（基础搜索选项）

| 选项 | 全称 | 功能说明 | 示例 |
|------|------|----------|------|
| `-i` | `--ignore-case` | 忽略大小写匹配（不区分大小写） | `grep -i "apple" file.txt` → 匹配 "Apple"、"APPLE" 等 |
| `-w` | `--word-regexp` | 只匹配**完整单词**（避免部分匹配，如搜索 "cat" 不匹配 "category"） | `grep -w "cat" file.txt` |
| `-x` | `--line-regexp` | 只匹配**整行完全相同**的内容（整行与模式完全一致） | `grep -x "hello world" file.txt` → 仅匹配内容为 "hello world" 的行 |
| `-v` | `--invert-match` | 反向匹配：输出**不包含**模式的行 | `grep -v "error" log.txt` → 输出不含 "error" 的行 |
| `-m <n>` | `--max-count=<n>` | 最多匹配 `n` 行后停止搜索（如 `-m1` 取第一个匹配） | `grep -m3 "warning" log.txt` → 只输出前3个含 "warning" 的行 |

### 二、输出格式控制（调整显示内容）

| 选项 | 全称 | 功能说明 | 示例 |
|------|------|----------|------|
| `-n` | `--line-number` | 显示匹配行的**行号** | `grep -n "apple" file.txt` → 输出 `3:apple pie`（第3行） |
| `-H` | `--with-filename` | 显示匹配行所在的**文件名**（多文件搜索时默认开启，单文件需显式指定） | `grep -H "error" *.log` → 输出 `app.log:error occurs` |
| `-h` | `--no-filename` | 不显示文件名（多文件搜索时隐藏文件名） | `grep -h "info" *.log` → 只输出匹配内容，不显示来自哪个文件 |
| `-o` | `--only-matching` | 只输出**匹配模式的部分**（而非整行） | `grep -o "apple" "I like apple pie"` → 只输出 `apple` |
| `-c` | `--count` | 统计**匹配的行数**（不显示具体内容，只输出数量） | `grep -c "error" log.txt` → 输出 `5`（表示有5行含 "error"） |
| `-B <n>` | `--before-context=<n>` | 除匹配行外，额外显示**前n行**上下文 | `grep -B2 "error" log.txt` → 显示匹配行及前2行 |
| `-A <n>` | `--after-context=<n>` | 除匹配行外，额外显示**后n行**上下文 | `grep -A2 "error" log.txt` → 显示匹配行及后2行 |
| `-C <n>` | `--context=<n>` | 除匹配行外，额外显示**前后各n行**上下文（等价于 `-Bn -An`） | `grep -C1 "error" log.txt` → 显示匹配行及前后各1行 |

### 三、正则表达式相关（高级模式匹配）

| 选项 | 全称 | 功能说明 | 示例 |
|------|------|----------|------|
| `-E` | `--extended-regexp` | 启用**扩展正则表达式**（支持 `|`、`()`、`+` 等元字符，无需转义） | `grep -E "apple|banana" file.txt` → 匹配含 "apple" 或 "banana" 的行 |
| `-F` | `--fixed-strings` | 按**固定字符串**匹配（不解析正则表达式，将模式视为纯文本） | `grep -F "a.b" file.txt` → 匹配字面量 "a.b"，而非正则 "a任意字符b" |
| `-P` | `--perl-regexp` | 启用**Perl兼容正则表达式**（支持更复杂的语法，如 `\d` 匹配数字） | `grep -P "\d{3}-\d{4}" file.txt` → 匹配 "123-4567" 格式 |
| `-e <pattern>` | `--regexp=<pattern>` | 指定**多个搜索模式**（可多次使用 `-e` 添加模式） | `grep -e "apple" -e "banana" file.txt` → 匹配含 "apple" 或 "banana" 的行 |
| `-f <file>` | `--file=<file>` | 从文件中读取**多个模式**（每行一个模式，等价于多个 `-e`） | `grep -f patterns.txt file.txt` → 用 `patterns.txt` 中的每行作为模式搜索 |

### 四、文件/目录搜索控制

| 选项 | 全称 | 功能说明 | 示例 |
|------|------|----------|------|
| `-r`/`-R` | `--recursive` | 递归搜索**目录下的所有文件** | `grep -r "config" /etc/` → 递归搜索 `/etc` 目录中含 "config" 的文件 |
| `-l` | `--files-with-matches` | 只显示**包含匹配内容的文件名**（不显示具体行） | `grep -l "error" *.log` → 输出所有含 "error" 的日志文件名 |
| `-L` | `--files-without-match` | 只显示**不包含匹配内容的文件名** | `grep -L "success" *.log` → 输出所有不含 "success" 的日志文件名 |
| `-s` | `--no-messages` | 不显示**文件不存在或无权限**的错误信息 | `grep -s "test" /root/file` → 即使无权限，也不输出错误提示 |
| `--include=<pattern>` | 递归搜索时，只包含**符合模式的文件**（如只搜 `.txt` 文件） | `grep -r --include="*.txt" "hello" ./` → 只在 `.txt` 文件中搜索 "hello" |
| `--exclude=<pattern>` | 递归搜索时，排除**符合模式的文件**（如排除 `.log` 文件） | `grep -r --exclude="*.log" "error" ./` → 搜索时跳过 `.log` 文件 |

### 五、其他实用选项

| 选项 | 功能说明 | 示例 |
|------|----------|------|
| `-q` | `--quiet`/`--silent` | 静默模式：不输出任何内容，仅通过退出码判断是否匹配（0=有匹配，1=无匹配） | `if grep -q "error" log.txt; then echo "有错误"; fi` |
| `--color=auto` | 为匹配的文本**着色**（多数系统默认开启，可手动指定） | `grep --color=auto "apple" file.txt` → 匹配的 "apple" 会标色 |

### 常用组合示例

1. 搜索目录中所有 `.sh` 文件，忽略大小写，显示行号和上下文：  

   ```bash
   grep -rniC2 --include="*.sh" "function" ./
   ```

2. 统计日志中 "error" 或 "warning" 的总行数：  

   ```bash
   grep -Ec "error|warning" app.log
   ```

3. 查找包含 "user" 但不含 "root" 的行，并显示文件名和行号：  

   ```bash
   grep -Hn "user" *.txt | grep -v "root"
   ```

通过组合这些选项，`grep` 可以灵活应对各种文本搜索场景，从简单的字符串匹配到复杂的日志分析都能胜任。
