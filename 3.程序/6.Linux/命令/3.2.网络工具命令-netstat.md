# Linux netstat 命令详解：网络状态查询利器

`netstat`（Network Statistics）是Linux系统中用于显示网络连接、路由表、网络接口状态等信息的强大工具，是系统管理员和网络工程师排查网络问题的必备工具之一。虽然现代系统中逐渐推荐使用`ss`命令，但`netstat`因其全面性和兼容性仍被广泛使用。

## 一、netstat 基本功能与安装

### 功能概述

- 查看活跃的网络连接及其状态
- 显示路由表信息
- 统计各网络协议（TCP/UDP/ICMP等）的使用情况
- 查看网络接口的接收/发送数据统计
- 检测端口监听状态和端口占用情况

### 安装方法

```bash
# CentOS/RHEL系统
sudo yum install net-tools

# Ubuntu/Debian系统
sudo apt-get install net-tools
```

## 二、netstat 常用选项与参数

### 1. 网络连接相关选项

- `-a`（all）：显示所有连接（包括监听和非监听状态）
- `-t`（tcp）：仅显示TCP连接
- `-u`（udp）：仅显示UDP连接
- `-n`（numeric）：以数字形式显示IP和端口（不解析域名/服务名）
- `-l`（listening）：仅显示监听状态的连接
- `-p`（program）：显示占用端口的进程及其PID

### 2. 路由表与接口选项

- `-r`（route）：显示路由表信息
- `-i`（interfaces）：显示网络接口统计信息
- `-c`（continuous）：持续刷新显示网络状态

### 3. 协议统计选项

- `-s`（statistics）：显示各网络协议的统计信息
- `-o`（timers）：显示TCP连接的定时器信息

## 三、netstat 实用案例与输出解析

### 1. 查看所有TCP连接（含状态）

```bash
netstat -tan
```

**输出解析：**

```txt
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN
tcp        0     52 192.168.1.100:22        10.1.1.200:58946        ESTABLISHED
```

- `Proto`：协议类型（TCP/UDP）
- `Recv-Q`：接收队列中未被应用程序读取的数据量
- `Send-Q`：发送队列中未被确认的数据量
- `Local Address`：本地IP和端口
- `Foreign Address`：远程IP和端口（`*`表示任意）
- `State`：连接状态（常见状态：LISTEN、ESTABLISHED、TIME_WAIT等）

### 2. 查看监听中的端口及对应进程

```bash
netstat -tulnp
```

**用途：** 排查端口占用问题，例如查看80端口是否被Nginx占用：

```bash
netstat -tulnp | grep :80
```

### 3. 显示路由表信息

```bash
netstat -rn
```

**输出解析：**

```txt
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG        0 0          0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0
127.0.0.0       0.0.0.0         255.0.0.0       U         0 0          0 lo
```

- `Destination`：目标网络/主机
- `Gateway`：网关IP（`0.0.0.0`表示直连）
- `Genmask`：子网掩码
- `Flags`：路由标志（`U`=启用，`G`=网关，`H`=主机）
- `Iface`：网络接口

### 4. 查看网络接口统计

```bash
netstat -i
```

**输出解析：**

```txt
Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
eth0      1500  123456      0      0      0    76543      0      0      0 BMRU
lo        65536  987654      0      0      0    987654      0      0      0 LRU
```

- `Iface`：接口名称
- `RX-OK`：接收的正确数据包数
- `RX-ERR`：接收错误的数据包数
- `TX-OK`：发送的正确数据包数
- `Flg`：接口标志（`B`=广播，`M`=多播，`L`=回环，`U`=启用）

### 5. 统计各协议网络流量

```bash
netstat -s
```

**输出示例：**

```txt
Ip:
    123456 total packets received
    789010 forwarded
    12345 incoming packets discarded
    67890 incoming packets delivered
Tcp:
    1234 active connections openings
    5678 passive connection openings
    123 connection resets received
    456 connections established
```

可用于分析TCP/UDP/ICMP等协议的整体流量情况。

## 四、netstat 高级用法与实战场景

### 1. 排查端口占用

```bash
# 查找占用8080端口的进程
netstat -tulnp | grep 8080

# 查找所有ESTABLISHED状态的连接（活跃连接）
netstat -tan | grep ESTABLISHED
```

### 2. 监控网络连接变化

```bash
# 每秒刷新一次网络连接状态
netstat -tcn
```

### 3. 分析网络连接数

```bash
# 统计各状态的TCP连接数量
netstat -tan | awk '{print $6}' | sort | uniq -c
```

### 4. 查看UDP监听端口

```bash
netstat -ulnp
```

## 五、netstat 与 ss 命令的对比

虽然`netstat`功能强大，但现代Linux系统更推荐使用`ss`（socket statistics）命令，因其：

- **性能更高**：直接从内核获取数据，速度更快
- **功能更全面**：支持更多过滤条件和高级选项
- **输出更简洁**：格式更现代化

**对比示例：**

```bash
# netstat 查看TCP监听端口
netstat -tlnp

# ss 等效命令（更高效）
ss -tlnp
```

**ss 优势场景：**

- 过滤复杂条件：`ss -t '( dport = :80 or sport = :80 )'`
- 查看TCP连接详细信息：`ss -ta state established`
- 统计套接字数量：`ss -s`

## 六、总结与最佳实践

1. **常用组合推荐**：
   - 查看监听端口：`netstat -tulnp`
   - 查看路由表：`netstat -rn`
   - 查看接口状态：`netstat -i`
   - 查看协议统计：`netstat -s`

2. **性能考虑**：
   - 大规模服务器环境中，优先使用`ss`命令
   - 避免频繁执行带`-p`选项的命令（需查询进程信息，消耗资源）

3. **安全排查**：
   - 定期检查非预期的监听端口（`netstat -tuln | grep LISTEN`）
   - 分析异常的外部连接（`netstat -tan | grep FOREIGN_IP`）

通过熟练掌握`netstat`的各项功能，你可以快速定位网络连接问题、端口占用情况和路由配置错误，成为Linux网络管理的能手！
