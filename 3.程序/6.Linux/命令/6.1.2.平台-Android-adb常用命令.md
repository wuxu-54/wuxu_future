# adb命令

android基于linux，所以支持linux命令。

## adb 常用命令

ADB（Android Debug Bridge）是一个多功能命令行工具，它允许你与连接的Android设备进行通信。以下是一些常用的ADB命令及其解释，这些命令可用于执行各种设备管理和调试任务：

* **查看连接的设备**：

   ```sh
   adb devices
   ```

   列出所有连接的设备和对应的序列号。

* **安装APK**：

   ```sh
   adb install <apk-file>
   ```

   安装指定的Android应用包。

* **卸载应用**：

   ```sh
   adb uninstall <package-name>
   ```

   卸载设备上指定的应用。

* **运行Monkey测试**：

   ```sh
   adb shell monkey -p <package-name> -v 500
   ```

   向指定的应用发送随机事件，用于压力测试。

* **清除应用数据和缓存**：

   ```sh
   adb shell pm clear <package-name>
   ```

   清除应用的数据和缓存，不卸载应用。

* **查看系统日志**：

   ```sh
   adb logcat
   ```

   显示设备的日志信息。

* **重启设备**：

   ```sh
   adb reboot
   ```

   重启Android设备。

* **获取设备信息**：

   ```sh
   adb shell getprop ro.build.version.release
   ```

   查看设备的Android系统版本。

* **查看当前运行的Activity**：

   ```sh
   adb shell dumpsys activity | grep mFocusedActivity
   ```

   显示当前在前台运行的Activity。

* **启动Activity**：

   启动指定的Activity。

   ```sh
   adb shell am start -n 完整Activity路径
   ```
  
    启动指定的Activity，并输出执行时间。

   ```sh
   adb shell am start -W 完整Activity路径
   ```

   执行时间输出结果：

   ```txt
   ThisTime: 1042
   TotalTime: 1042
   WaitTime: 1077
   ```

   >ThisTime：一般和 TotalTime 时间一样，如果在应用启动时开了一个过度的全透明的页面（Activity）预先处理一些事，再显示出主页面（Activity），这样将比 TotalTime 小。
   >TotalTime：应用的启动时间，包括创建进程+Application 初始化+Activity
   >WaitTime：一般比 TotalTime 大些，包括系统影响的耗时。

   但这个方法只能得到固定的某一个阶段的耗时，不能得到具体哪个方法的耗时。

* **查看应用包信息**：

   ```sh
   adb shell dumpsys package <package-name>
   ```

   显示指定应用的包信息。

* **复制文件到设备**：

   ```sh
   adb push <local> <remote>
   ```

   将本地文件复制到设备。

* **从设备复制文件**：

   ```sh
    adb pull <remote> <local>
    ```

    从设备复制文件到本地。

* **查看设备的内存使用情况**：

   ```sh
    adb shell dumpsys meminfo
    ```

    显示设备的内存使用情况。

* **查看设备的CPU使用情况**：

   ```sh
    adb shell top
    ```

    实时显示设备的CPU使用情况。

* **录制屏幕**：

   ```sh
    adb shell screenrecord /sdcard/filename.mp4
    ```

    开始屏幕录制，文件保存在设备的SD卡上。

* **截屏**：

   ```sh
    adb exec-out screencap -p > screenshot.png
    ```

    截取屏幕图像并保存为PNG文件。

* **查看电池状态**：

   ```sh
    adb shell dumpsys battery
    ```

    显示电池的状态信息。

* **重启到Recovery模式**：

   ```sh
    adb reboot recovery
    ```

    重启设备到Recovery模式。

* **重启到Bootloader模式**：

   ```sh
    adb reboot bootloader
    ```

    重启设备到Bootloader模式。

* **查看设备上运行的服务**：

   ```sh
    adb shell service list
    ```

    列出设备上所有运行的服务。

* **发送短信**：

   ```sh
    adb shell am broadcast -a android.intent.action.SENDTO --es "sms_body" "Hello World" --es "address" "1234567890"
    ```

    发送一条短信到指定的手机号码。

* **获取设备的IMEI号**：

   ```sh
    adb shell dumpsys iphonesubinfo | grep unique-identifier
    ```

    获取设备的IMEI号。

* **查看设备的MAC地址**：

   ```sh
    adb shell cat /sys/class/net/wlan0/address
    ```

    获取设备的MAC地址。

* **查看设备的序列号**：

   ```sh
    adb get-serialno
    ```

    获取设备的序列号。

ADB (Android Debug Bridge) 提供了丰富的命令集，可以帮助开发者进行应用开发、测试和调试。以下是一些常用的 ADB 命令，它们在 Android 应用开发中非常有用：

### 1. 查看设备和应用信息

* `adb devices`：列出连接的设备。
* `adb shell pm list packages`：列出设备上安装的所有应用包。
* `adb shell pm list packages -f`：显示应用包的详细信息，包括 APK 路径。

### 2. 安装和卸载应用

* `adb install <apk-path>`：在设备上安装 APK。
* `adb uninstall <package-name>`：从设备上卸载应用。

### 3. 日志和调试

* `adb logcat`：查看设备的日志输出，这对于调试应用非常有用。
* `adb logcat -c`：清除当前的日志缓冲区。

### 4. 文件传输

* `adb push <local> <remote>`：将文件从开发机复制到设备。
* `adb pull <remote> <local>`：将文件从设备复制到开发机。

### 5. 屏幕录制

* `adb shell screencap -p /path/on/device/screenshot.png`：捕获设备的屏幕截图。
* `adb shell screenrecord /path/on/device/record.mp4`：开始录制设备的屏幕。

### 6. 端口转发

* `adb forward tcp:<local-port> tcp:<remote-port>`：将请求从开发机的某个端口转发到设备上的对应端口，这对于调试网络应用非常有用。

### 7. 启动和停止服务

* `adb shell am start -n <package-name>/<component-name>`：启动一个 Activity。
* `adb shell am startservice -n <package-name>/<service-name>`：启动一个服务。
* `adb shell am stopservice -n <package-name>/<service-name>`：停止一个服务。

### 8. 应用管理

* `adb shell pm clear <package-name>`：清除应用的数据和缓存。
* `adb shell pm grant <package-name> <permission-name>`：授予应用权限。

### 9. 性能分析

* `adb shell dumpsys meminfo <package-name>`：获取应用的内存使用信息。
* `adb shell top`：显示设备当前的内存和 CPU 使用情况。

### 10. 网络操作

* `adb shell setprop sys.usb.config usb0,adb`：更改设备的 USB 配置，确保 ADB 通信不被其他 USB 功能干扰。
* `adb shell ip link set <interface> up`：激活设备的网络接口。

### 11. 系统设置

* `adb shell settings put global <setting-name> <value>`：修改系统设置。

### 12. 重启设备

* `adb reboot`：重启设备。

---

## adb logcat

`adb logcat` 是 Android 开发者调试应用和系统问题时常用的命令行工具，它可以捕获和显示设备的日志消息。

>`adb shell logcat` 输出文件时针对的是设备自身。

以下是一些 `adb logcat` 的常用命令和选项，这些信息综合了搜索结果中的相关内容：

* **查看所有日志**：

   ```sh
   adb logcat
   ```

* **清除日志缓冲区**：

   ```sh
   adb logcat -c
   ```

* **将日志输出到文件**：

   ```bash
   adb logcat -f /path/to/logfile.txt
   ```

* **将日志输出到手机设备文件**：`adb shell logcat`

   ```bash
   adb logcat -c && adb shell logcat -f /sdcard/my_log.txt
   ```

* **实时更新日志并追加到文件**：

   ```bash
   adb logcat >> /path/to/logfile.txt
   ```

* **查看日志缓冲区大小**：

   ```bash
   adb logcat -g
   ```

* **设置日志缓冲区的最大数目**（与 `-r` 选项一起使用）：

   ```bash
   adb logcat -n 10
   ```

* **设置日志缓冲区大小（千字节）**（与 `-f` 选项一起使用）：

   ```bash
   adb logcat -r 8
   ```

* **指定日志级别**：
   错误日志：`adb logcat *:E`
   调试日志：`adb logcat *:D`

* **过滤特定标签的日志**：

   ```bash
   adb logcat ActivityManager:I MyApp:D
   ```

* **使用管道过滤日志**：

    ```bash
    adb logcat | grep -E "android|system"
    ```

* **格式化输出**：
    显示时间：`adb logcat -v time`
    仅显示PID：`adb logcat -v process`
    显示原始日志：`adb logcat -v raw`

* **输出最近的几行日志**：

    ```bash
    adb logcat -t 5
    ```

* **以二进制形式输出日志**：

    ```bash
    adb logcat -B
    ```

* **帮助命令**：

    ```bash
    adb logcat -help
    ```

* **过滤日志级别和标签**：

    ```bash
    adb logcat *:W
    ```

* **输出日志到标准输出**：

    ```bash
    adb logcat -d
    ```

这些命令可以根据需要组合使用，以定制日志的输出和过滤。例如，如果你想要将错误日志输出到文件并立即清除日志缓冲区，可以使用以下命令：

```bash
adb logcat -f /path/to/logfile.txt *:E && adb logcat -c
```

---

## adb shell

--shell 操作应用
adb shell pm install xxxx.apk - 代码安装，可以查看安装错误原因
adb shell pm clear 应用包名  - 清除应用缓存
adb shell top - 查看当前所有应用资源占用 cpu、memory
adb shell force-stop 包名 - 强杀应用
adb shell am broadcast -a action值 应用包名 - 模拟发送广播
adb shell am start -n 包名/启动Activity完整类名 - start Activity

### 更多

以下是一些常用的`adb shell`命令，这些命令可用于执行各种设备管理和调试任务：

* **查看连接的设备**：

   ```sh
   adb devices
   ```

* **安装APK**：

   ```sh
   adb install <apk-file>
   ```

* **卸载应用**：

   ```sh
   adb uninstall <package-name>
   ```

* **运行Monkey测试**：

   ```sh
   adb shell monkey -p <package-name> -v 500
   ```

* **清除应用数据和缓存**：

   ```sh
   adb shell pm clear <package-name>
   ```

* **查看系统日志**：

   ```sh
   adb logcat
   ```

* **运行Shell命令**：

   ```sh
   adb shell <command>
   ```

* **复制文件到设备**：

   ```sh
   adb push <local-file> <remote-file>
   ```

* **从设备复制文件**：

   ```sh
   adb pull <remote-file> <local-file>
   ```

* **重启设备**：

   ```sh
    adb reboot
    ```

* **重启到Recovery模式**：

   ```sh
    adb reboot recovery
    ```

* **查看设备信息**：

   ```sh
    adb shell getprop ro.build.version.release
    ```

* **查看电池状态**：

   ```sh
    adb shell dumpsys battery
    ```

* **查看屏幕分辨率**：

   ```sh
    adb shell wm size
    ```

* **查看屏幕密度**：

   ```sh
    adb shell wm density
    ```

* **查看MAC地址**：

   ```sh
    adb shell cat /sys/class/net/wlan0/address
    ```

* **查看CPU信息**：

   ```sh
    adb shell cat /proc/cpuinfo
    ```

* **模拟按键事件**：

   ```sh
    adb shell input keyevent <keycode>
    ```

* **模拟触摸滑动**：

   ```sh
    adb shell input swipe <x1> <y1> <x2> <y2>
    ```

* **模拟文本输入**：

   ```sh
    adb shell input text <text>
    ```

* **查看当前运行的Activity**：

   ```sh
    adb shell dumpsys activity | grep mFocusedActivity
    ```

* **启动Activity**：

   ```sh
    adb shell am start -n <package-name>/.<Activity-class>
    ```

* **启动Service**：

   ```sh
    adb shell am startservice -n <package-name>/.<Service-class>
    ```

* **发送广播**：

   ```sh
    adb shell am broadcast -a <action>
    ```

* **强制停止应用**：

   ```sh
    adb shell am force-stop <package-name>
    ```

* **获取系统属性**：

   ```sh
    adb shell getprop <property-name>
    ```

* **设置系统属性**：

   ```sh
    adb shell setprop <property-name> <value>
    ```

* **查看进程列表**：

   ```sh
    adb shell ps
    ```

* **截图**：

   ```sh
    adb shell screencap -p > screenshot.png
    ```

* **录制屏幕**：

   ```sh
    adb shell screenrecord /sdcard/filename.mp4
    ```

* **布局边框**

   开启，更改设置后，通常需要重启设备才能使设置生效。

   ```sh
   adb shell settings put global debug_hw_overdraw 1
   ```

   关闭：

   ```sh
   adb shell settings put global debug_hw_overdraw 0
   ```

   >请注意，这些命令需要设备的 root 权限，如果你的设备没有 root，这些命令可能不会起作用。此外，开启布局边框可能会影响设备的性能，因此仅在需要调试布局时使用。
   >如果你的设备运行的是 Android 9 (Pie) 或更高版本，你可能需要使用不同的方法来开启布局边框，因为从 Android 9 开始，debug_hw_overdraw 设置已经被移除。在这种情况下，你可以尝试使用 Developer options 中的 Show layout bounds 选项，或者使用 Android Studio 的 Layout Inspector 工具来进行布局调试。

* **针对单个应用**

   开启，需要重启应用。

   ```sh

   adb shell setprop debug.layout 1
   # 或者
   adb shell setprop debug.layout true
   ```

   关闭

   ```sh
   adb shell setprop debug.layout 0
   # 或者
   adb shell setprop debug.layout false
   ```

这些命令覆盖了从应用管理到设备信息查看、系统监控和用户交互模拟的各个方面。使用时，根据需要替换命令中的占位符（通常为尖括号包围的单词，如`<apk-file>`、`<package-name>`等）为实际的参数值。

---

## adb shell dumpsys

`adb shell dumpsys` 是一个非常强大的命令，它提供了关于 Android 设备当前状态的详细信息。这个命令可以与不同的服务和系统组件一起使用，以获取它们的内部状态和配置信息。这对于开发和调试 Android 应用非常有用。

### 基本用法

基本的 `adb shell dumpsys` 命令格式如下：

```bash
adb shell dumpsys [服务名]
```

如果你不指定任何服务名，它会列出所有可用的服务。

### 常用服务和选项

以下是一些常用的 `adb shell dumpsys` 命令和服务，它们可以帮助你获取不同的系统信息：

1. **获取窗口管理服务的信息**：

   ```bash
   adb shell dumpsys window windows
   ```

   这会显示当前所有窗口的状态，包括可见的和隐藏的窗口。

2. **获取活动管理服务的信息**：

   ```bash
   adb shell dumpsys activity activities
   ```

   这会显示当前所有运行的 Activity 以及它们的状态。

3. **获取内存使用情况**：

   ```bash
   adb shell dumpsys meminfo <package-name>
   ```

   这会显示指定应用的内存使用情况。

4. **获取电池使用情况**：

   ```bash
   adb shell dumpsys battery
   ```

   这会显示设备的电池使用情况。

5. **获取网络状态**：

   ```bash
   adb shell dumpsys connectivity
   ```

   这会显示设备的网络连接状态。

6. **获取 CPU 使用情况**：

   ```bash
   adb shell dumpsys cpuinfo
   ```

   这会显示设备的 CPU 使用情况。

7. **获取显示信息**：

   ```bash
   adb shell dumpsys display
   ```

   这会显示设备的显示配置信息。

8. **获取输入设备信息**：

   ```bash
   adb shell dumpsys input
   ```

   这会显示设备的输入设备状态。

9. **获取电源管理器信息**：

   ```bash
   adb shell dumpsys power
   ```

   这会显示设备的电源管理器状态。

10. **获取应用的启动时间**：

    ```bash
    adb shell dumpsys usagestats
    ```

    这会显示设备上应用的启动时间和使用情况。

### 示例：获取特定应用的内存使用情况

假设你想要获取名为 `com.example.app` 的应用的内存使用情况，可以使用以下命令：

```bash
adb shell dumpsys meminfo com.example.app
```

### 注意事项

* 某些 `dumpsys` 命令可能需要设备具有 root 权限才能访问所有信息。
* 输出可能非常详细，因此你可能需要使用 `grep` 等工具来过滤特定的信息。

`adb shell dumpsys` 是一个非常强大的工具，可以帮助你深入了解 Android 设备的内部工作机制，从而更好地开发和调试你的应用。

---

## 补充

--连接
adb kill-server 断开adb连接
adb connect ip wifi连接设备

--日志
adb logcat *:V > 输出到本地文件地址 - 日志获取
adb logcat -c - 清除本地日志及缓存记录
adb logcat -G 20M - 扩充日志缓存大小
adb logcat -g  - 查看当前日志缓存大小

---

## Android adb shell 将命令抓到设备本地，并且不受网络断开影响

在使用Android的`adb shell`命令时，如果你想要将命令行的结果抓取到设备本地，并且确保这些结果不受网络断开的影响，你可以使用以下几种方法：

1. **重定向输出到文件**：
   使用重定向操作符`>`或`>>`将命令的输出保存到设备上的文件中。`>`会覆盖文件内容，而`>>`会将输出追加到文件末尾。

   ```sh
   adb shell <command> > /sdcard/output.txt
   ```

2. **使用管道**：
   如果需要对输出进行处理，可以使用管道`|`将一个命令的输出传递给另一个命令。

   ```sh
   adb shell <command> | tee /sdcard/processed_output.txt
   ```

3. **使用`tee`命令**：
   `tee`命令可以同时将输出显示在控制台并写入到文件中。这在Android设备上可能不可用，取决于具体的Android版本和ROM。

   ```sh
   adb shell <command> | tee /sdcard/tee_output.txt
   ```

4. **使用`adb pull`**：
   如果你想要将文件从设备拉取到本地计算机，可以使用`adb pull`命令。

   ```sh
   adb pull /sdcard/output.txt /path/to/local/directory
   ```

5. **使用`adb logcat`**：
   对于日志信息，你可以使用`adb logcat`命令，并通过重定向将输出保存到本地文件。

   ```sh
   adb logcat > logcat_output.txt
   ```

6. **确保命令执行完成**：
   在执行命令后，确保命令执行完毕并获取到所有输出。如果你从脚本中执行`adb shell`命令，确保命令执行完成后再进行下一步操作。

7. **处理网络断开的情况**：
   如果担心在执行命令期间网络断开，可以在脚本中添加检查网络状态的逻辑，或者使用`adb shell`执行不需要网络连接的命令。

8. **使用`nohup`命令**：
   如果你需要在设备上执行长时间运行的命令，并且担心网络断开或设备重启，可以使用`nohup`命令来忽略挂起信号，并将输出重定向到文件。
   >`&` 是会将命令放入后台执行，但退出当前 shell 时可能会终止进程。

   ```sh
   adb shell "nohup <command> > /sdcard/long_output.txt &"
   ```

9. **使用`screen`或`tmux`**：
   如果你有访问设备的shell，并且需要在会话中执行多个命令，可以使用`screen`或`tmux`来创建一个会话，这样即使网络断开，你的命令仍然可以在会话中继续运行。

使用上述方法，你可以将`adb shell`命令的输出抓取到设备本地，并且通过适当的命令和工具确保这些输出不受网络状态的影响。

---

## 更多命令

* 开启悬浮窗权限：`adb shell appops set <package_name> SYSTEM_ALERT_WINDOW allow`
  * appops 是 Android 应用操作权限的命令行工具。
  * set 是设置操作。
  * `<package_name>` 是要操作的应用的包名。
  * SYSTEM_ALERT_WINDOW 是悬浮窗权限的名称。
  * allow 是将该权限设置为允许。
