# df

`df`（disk free）是 Linux/Unix 系统中用于查看**文件系统磁盘空间使用情况**的核心命令，能显示各挂载分区的总容量、已用容量、可用容量及挂载点等信息。以下是其详细用法及全选项说明：

## 一、基础用法

```bash
df  # 直接运行，默认以KB为单位显示所有已挂载文件系统的信息
```

默认输出示例：

```sh
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/sda1       51475068 8523456  42951612  17% /
tmpfs            4083980       0   4083980   0% /dev/shm
/dev/sdb1      102400000 2560000  99840000   3% /data
```

字段含义：

- `Filesystem`：文件系统（通常是设备路径，如 `/dev/sda1`）
- `1K-blocks`：总容量（以1KB为单位）
- `Used`：已使用容量（KB）
- `Available`：可用容量（KB）
- `Use%`：使用率
- `Mounted on`：挂载点（文件系统挂载到的目录）

## 二、常用选项（按功能分类）

### 1. 单位转换选项（最常用）

`df` 默认以 **1KB** 为单位，可通过选项切换为更易读的单位：

| 选项 | 功能说明 | 示例输出（以50GB分区为例） |
|------|----------|--------------------------|
| `-B <单位>` | 以指定单位显示（支持 `K`、`M`、`G`、`T` 等，或具体字节数如 `1024`） | `df -BM` → 以1MB为单位显示；`df -B1G` → 以1GB为单位 |
| `-k` | 以 **KB（1024字节）** 为单位（默认，与不指定单位效果相同） | `51475068 1K-blocks` → 约50GB |
| `-m` | 以 **MB（1024^2字节）** 为单位 | `50268M`（总容量） |
| `-g` | 以 **GB（1024^3字节）** 为单位 | `49G`（总容量） |
| `-h` | 以 **人类可读格式** 自动选择单位（推荐，显示为 K/M/G/T） | `50G`（总容量）、`8.1G`（已用） |
| `--si` | 与 `-h` 类似，但使用国际单位制（1K=1000字节，而非1024） | `54G`（总容量，1000^3字节换算） |

### 2. 显示范围控制选项

| 选项 | 功能说明 | 示例 |
|------|----------|------|
| `-a`/`--all` | 显示**所有文件系统**，包括容量为0的特殊文件系统（如 `/sys`、`/proc`） | `df -a` → 会列出 `sysfs`、`proc` 等虚拟文件系统 |
| `-t <类型>` | 只显示**指定类型**的文件系统（如 `ext4`、`xfs`、`tmpfs`） | `df -t ext4` → 仅显示ext4格式的分区 |
| `-x <类型>` | 排除**指定类型**的文件系统（与 `-t` 相反） | `df -x tmpfs` → 不显示tmpfs类型的临时文件系统 |
| `--output=<字段>` | 自定义输出字段（指定需要显示的列，用逗号分隔） | `df --output=source,fstype,size,used,pcent` → 只显示文件系统、类型、大小、已用、使用率 |

### 3. 细节信息选项

| 选项 | 功能说明 | 示例 |
|------|----------|------|
| `-P`/`--portability` | 以POSIX标准格式输出（字段对齐，适合脚本解析） | `df -P` → 输出格式更规整，避免字段换行 |
| `-T`/`--print-type` | 显示文件系统**类型**（如 `ext4`、`xfs`） | `df -T` → 新增 `Type` 列，显示每个分区的文件系统格式 |
| `-i`/`--inodes` | 显示**inode使用情况**（而非磁盘容量，用于排查inode耗尽问题） | `df -i` → 输出 `Inodes`（总inode数）、`IUsed`（已用）、`IFree`（空闲）、`IUse%`（inode使用率） |
| `-l`/`--local` | 只显示**本地文件系统**（排除网络挂载的文件系统，如NFS） | `df -l` → 不显示远程挂载的分区 |
| `-h --total` | 在输出末尾增加**总计行**（所有文件系统的容量总和） | `df -h --total` → 最后一行显示 `total` 汇总信息 |

### 4. 其他实用选项

| 选项 | 功能说明 | 示例 |
|------|----------|------|
| `-v` | 显示版本信息（部分系统支持） | `df -v` → 输出 `df (GNU coreutils) 8.32` 等版本信息 |
| `--help` | 显示帮助文档（所有选项说明） | `df --help` → 详细列出所有选项及用法 |

## 三、完整选项示例

### 1. 基础查看（人类可读格式）

```bash
df -h
```

输出（自动选择最合适的单位）：

```sh
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        50G  8.1G   42G  17% /
tmpfs           3.9G     0  3.9G   0% /dev/shm
/dev/sdb1       100G  2.5G   98G   3% /data
```

### 2. 查看inode使用情况（排查“磁盘未满但无法创建文件”问题）

```bash
df -i
```

输出（inode是文件系统中用于存储文件元数据的索引节点，耗尽后无法创建新文件）：

```sh
Filesystem      Inodes  IUsed   IFree IUse% Mounted on
/dev/sda1      3276800 123456 3153344    4% /
tmpfs           1020995      1 1020994    1% /dev/shm
/dev/sdb1      6553600   5678 6547922    1% /data
```

### 3. 只显示ext4类型的本地文件系统，带类型信息

```bash
df -lTt ext4
```

输出（过滤出本地ext4格式的分区）：

```sh
Filesystem     Type 1K-blocks    Used Available Use% Mounted on
/dev/sda1      ext4  51475068 8523456  42951612  17% /
```

### 4. 自定义输出字段（文件系统、挂载点、使用率）

```bash
df --output=source,target,pcent -h
```

输出（只显示需要的列）：

```sh
Filesystem     Mounted on Use%
/dev/sda1      /          17%
tmpfs          /dev/shm   0%
/dev/sdb1      /data      3%
```

### 5. 显示所有文件系统（包括虚拟文件系统）

```bash
df -a
```

输出（包含 `/sys`、`/proc` 等虚拟文件系统，容量通常为0）：

```sh
Filesystem         1K-blocks    Used Available Use% Mounted on
sysfs                      0       0         0    - /sys
proc                       0       0         0    - /proc
/dev/sda1        51475068 8523456  42951612  17% /
...
```

## 四、关键字段解读

- **`Use%` 使用率**：分区的已用空间占比，超过90%可能导致写入缓慢或无法创建文件。
- **`Available` 可用容量**：实际可写入的空间（非 `总容量-已用容量`，因为部分空间会预留为root用户紧急使用）。
- **虚拟文件系统**：如 `tmpfs`（临时内存文件系统）、`sysfs`、`proc` 等，不占用磁盘空间，其容量通常与内存相关。
- **inode 与容量的区别**：磁盘空间由“块（block）”和“inode”共同决定，块用于存储文件内容，inode用于存储文件名、权限等元数据。两者任一耗尽，都会导致无法创建新文件（需用 `df -i` 检查inode）。

## 五、注意事项

- **权限问题**：普通用户可查看所有挂载点，但部分特殊文件系统可能显示权限不足。
- **网络文件系统**：如NFS、SMB挂载的远程分区，`df` 也会显示，但可能因网络延迟导致响应缓慢。
- **与 `du` 的区别**：`df` 查看**分区整体使用情况**，`du` 查看**具体文件/目录的大小**，两者结合可定位磁盘占用异常的原因（如删除的文件被进程占用导致 `df` 与 `du` 结果不一致）。

通过 `df` 命令的选项组合，可快速掌握磁盘空间使用状态，是系统存储管理和故障排查（如磁盘满、inode耗尽）的必备工具。
