# 提示函数

封装的提示可以被视为形成一个函数，我们只需要像普通编程方式调用这个函数，大模型会根据此函数执行具体的任务，并输出结果。
>发散一下，以后提示工程针对可以作为一个project工程，像开发软件一样去编写，并交由大模型运行。

## 提示函数的一般结构及示例

```txt
function_name: [trans_word]
input: ["文本"]
rule: [我希望你能扮演英文翻译员、拼写纠正员和改进员的角色。我将提供包含任何语言中"文本"的输入形式，你将检测语言，翻译并用英文纠正我的文本，并给出答案。]
```

### 多参数函数

```txt
function_name: [pg]
input: ["length", "capitalized", "lowercase", "numbers", "special"]
rule: [作为一个密码生成器，我将为需要一个安全密码的个人提供帮助。我会提供包括"length"（长度）、"capitalized"（大写字母）、"lowercase"（小写字母）、"numbers"（数字）和"special"（特殊字符）在内的输入形式。你的任务是使用这些输入形式生成一个复杂的密码，并将其提供给我。在你的回答中，请不要包含任何解释或额外的信息，只需提供生成的密码即可。例如，如果输入形式是length = 8、capitalized = 1、lowercase = 5、numbers = 2、special = 1，你的回答应该是一个类似于"D5%t9Bgf"的密码。]
```

在大模型输入框中执行：

```txt
pg(length = 10, capitalized = 1, lowercase = 5, numbers = 2, special = 1)
pg(10,1,5,2,1)
```

---

提示工程中的「提示函数」是设计和优化提示词（Prompt）的核心方法论，旨在通过结构化指令引导模型生成更精准、可控的输出。以下从概念到实践进行系统性解析：

---

## AI给的解释

### **提示函数（Prompt Function）详解**  

在提示工程（Prompt Engineering）中，**提示函数**是一种将自然语言提示结构化、参数化的工具，通过定义明确的输入参数和输出格式，引导大模型生成符合预期的响应。它本质上是一种“标准化提示模板”，旨在提升模型输出的可控性、一致性和可复用性，尤其适用于需要频繁调用模型的工程化场景（如API集成、自动化任务）。

### **一、核心定义与本质**  

#### **1. 本质：结构化的提示模板**  

- **参数化设计**：将提示拆解为可配置的参数（如`query`、`context`、`format`），避免自然语言歧义。  
- **格式约束**：通过指定输出格式（如JSON、Markdown、代码块），便于下游系统解析或集成。  
- **函数思维**：类比编程中的函数，输入参数决定输出结果，符合开发者习惯。  

#### **2. 与传统提示的区别**  

| **传统提示**               | **提示函数**                     |  
|----------------------------|----------------------------------|  
| 自然语言描述，灵活性高      | 结构化参数+格式约束，可控性强    |  
| 难以复用，易因表述差异导致结果波动 | 可复用模板，结果一致性高       |  
| 适用于一次性、非结构化场景  | 适用于工程化、高频调用场景       |  

### **二、提示函数的组成要素**  

一个完整的提示函数通常包含以下部分：  

#### **1. 参数定义（Input Parameters）**  

- **必填参数**：如`text`（输入文本）、`task`（任务类型），是生成内容的核心依据。  
- **可选参数**：如`length`（长度控制）、`tone`（语气风格），用于精细化调整输出。  
- **示例**：  

  ```python  
  def generate_email(  
      recipient: str,  # 收件人（必填）  
      subject: str,    # 主题（必填）  
      content: str,    # 正文（必填）  
      tone: str = "formal"  # 语气（可选，默认正式）  
  ):  
      ...  
  ```  

#### **2. 提示模板（Prompt Template）**  

- 基于参数拼接的自然语言指令，包含任务描述、示例或约束条件。  
- **示例**：  

  ```python  
  prompt = f"""  
  请以{tone}语气给{recipient}写一封主题为"{subject}"的邮件，内容如下：  
  {content}  
  注意：结尾需添加礼貌用语。  
  """  
  ```  

#### **3. 格式说明（Output Format）**  

- 强制要求输出格式（如JSON、XML、Markdown），或通过函数参数指定。  
- **示例**：  

  ```python  
  # 要求返回JSON格式的摘要  
  prompt += "\n输出格式：JSON"  
  ```  

### **三、提示函数的类型与应用场景**  

#### **1. 基础模板型（Static Template）**  

- **特点**：固定结构，参数仅用于填充模板。  
- **场景**：标准化内容生成（如报告摘要、邮件撰写）。  
- **示例**：  

  ```python  
  def generate_summary(text: str, length: str = "short"):  
      template = f"请生成一段{length}摘要，概括以下内容：{text}"  
      return template  
  ```  

#### **2. 条件判断型（Conditional Logic）**  

- **特点**：根据参数动态调整提示内容（如分支逻辑）。  
- **场景**：多场景适配（如根据用户身份生成不同回答）。  
- **示例**：  

  ```python  
  def answer_question(question: str, user_role: str):  
      if user_role == "student":  
          template = f"请用简单易懂的语言回答：{question}"  
      elif user_role == "expert":  
          template = f"请深入分析并引用数据回答：{question}"  
      return template  
  ```  

#### **3. 多轮对话型（Multi-turn Context）**  

- **特点**：包含历史对话上下文参数，支持长对话管理。  
- **场景**：客服机器人、知识问答系统。  
- **示例**：  

  ```python  
  def continue_conversation(history: list, new_query: str):  
      context = "\n".join([f"用户：{h['user']}\n模型：{h['model']}" for h in history])  
      template = f"""  
      历史对话：  
      {context}  
      用户新问题：{new_query}  
      请继续回答，保持语气一致。  
      """  
      return template  
  ```  

#### **4. 工具调用型（Tool Integration）**  

- **特点**：结合函数调用（Function Calling），指定外部工具参数。  
- **场景**：调用API、数据库或计算器（如获取实时数据）。  
- **示例**：  

  ```python  
  def query_database(table: str, condition: str, format: str = "sql"):  
      template = f"""  
      请用{format}语法查询{table}表，条件为：{condition}  
      注意：严格遵循SQL语法规范。  
      """  
      return template  
  ```  

### **四、设计提示函数的核心原则**  

#### **1. 清晰性（Clarity）**  

- 参数命名直观（如`product_name`而非`pn`），模板指令避免歧义。  
- **反例**：`generate_content(data)` → **正例**：`generate_product_description(product_name, features)`  

#### **2. 模块化（Modularity）**  

- 拆分独立功能（如摘要生成、情感分析），避免单一函数承担过多任务。  
- **示例**：  

  ```python  
  # 拆分前：  
  def complex_task(text, mode, format): ...  
  # 拆分后：  
  def generate_summary(text): ...  
  def analyze_sentiment(text): ...  
  ```  

#### **3. 约束性（Constraints）**  

- 明确输出边界（如字数限制、格式要求），减少模型“幻觉”。  
- **示例**：  

  ```python  
  prompt = "请用3句话以内回答，输出格式为纯文本。"  
  ```  

#### **4. 复用性（Reusability）**  

- 设计通用参数（如`language`支持多语言），适配同类任务。  
- **示例**：  

  ```python  
  def translate(text, target_lang="en"): ...  # 支持中英互译、多语言扩展  
  ```  

#### **5. 迭代优化（Iteration）**  

- 通过A/B测试调整参数默认值、模板结构，基于反馈持续改进。  
- **工具推荐**：使用OpenAI Playground、LangChain调试提示效果。  

### **五、典型应用场景**  

#### **1. 结构化数据生成**  

- **场景**：生成API接口文档、JSON配置文件。  
- **示例函数**：  

  ```python  
  def generate_api_spec(endpoint: str, method: str, parameters: list):  
      template = f"""  
      请生成{method}请求的API文档，端点为{endpoint}，参数如下：  
      {", ".join([f"{p['name']}（{p['type']}，{p['description']}）" for p in parameters])}  
      输出格式：JSON（包含endpoint、method、parameters字段）  
      """  
      return template  
  ```  

#### **2. 多轮对话管理**  

- **场景**：客服系统中维护对话上下文。  
- **实现逻辑**：  

  ```python  
  # 存储历史对话列表  
  conversation_history = [  
      {"user": "如何退货？", "model": "请提供订单号和退货原因..."},  
      {"user": "订单号是12345，原因是尺寸不符", "model": ""}  # 待填充  
  ]  
  # 调用提示函数生成回复  
  prompt = continue_conversation(conversation_history, new_query="")  
  ```  

#### **3. 工具调用参数化**  

- **场景**：通过大模型调用外部计算器接口。  
- **函数与工具联动**：  

  ```python  
  def calculate(expression: str):  
      prompt = f"""  
      请计算以下表达式，并返回JSON格式结果：  
      {{ "expression": "{expression}", "result": 计算结果 }}  
      """  
      # 调用模型生成函数调用指令，再触发计算器API  
  ```  

### **六、优缺点分析**  

#### **优点**  

- **可控性强**：参数和格式约束确保输出符合预期。  
- **工程友好**：适合集成到软件系统中，支持自动化流程。  
- **降低成本**：复用模板减少提示设计时间，提升开发效率。  

#### **缺点**  

- **灵活性受限**：固定结构可能无法应对极端长尾场景。  
- **调试成本**：复杂函数需测试参数组合，避免逻辑漏洞。  
- **模型依赖**：不同模型对提示的敏感度不同，需针对性优化。  

### **七、实战示例：电商评论分析**  

**需求**：分析用户评论的情感倾向，并生成结构化总结。  

#### **1. 定义提示函数**  

```python  
def analyze_review(  
    review_text: str,  
    detail_level: str = "medium",  # 分析详细程度（simple/medium/detail）  
    format: str = "json"           # 输出格式  
):  
    template = f"""  
    请对以下电商评论进行情感分析，详细程度为{detail_level}，输出格式为{format}：  
    ---  
    评论：{review_text}  
    ---  
    要求：  
    1. 判断情感倾向（正面/负面/中性）；  
    2. 提取关键观点（如产品质量、物流速度）；  
    3. 若为负面，建议改进点。  
    """  
    return template  
```  

#### **2. 调用示例**  

```python  
# 输入参数  
review = "手机续航不错，但摄像头成像效果一般，夜景模糊。"  
prompt = analyze_review(review_text=review, detail_level="detail")  

# 模型输出（JSON格式）  
{  
  "sentiment": "中性",  
  "key_points": {  
    "positive": ["续航不错"],  
    "negative": ["摄像头成像效果一般，夜景模糊"]  
  },  
  "suggestions": ["优化摄像头夜景算法"]  
}  
```  

### **八、总结**  

**提示函数**是提示工程从“经验性设计”迈向“工程化开发”的关键工具，尤其适合需要规模化、标准化使用大模型的场景（如企业级应用、API服务）。通过参数化、模块化设计，它既能提升模型输出的可控性，又能降低开发和维护成本。实际应用中，需结合具体模型特性（如GPT-4、Claude）和业务需求，灵活调整模板结构，并通过持续迭代优化效果。
