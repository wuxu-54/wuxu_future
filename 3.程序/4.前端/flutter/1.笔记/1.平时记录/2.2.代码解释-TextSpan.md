# 代码解释

## 疑问代码

1：

```dart
class MyTextSpan {
  static TextSpan textSpan(
      {required String text,
      required double fontSize,
      required Color color,
      double? height,
      FontWeight? fontWeight,
      List<InlineSpan>? children}) {
    return TextSpan(
      text: text,
      style: TextStyle(
        fontSize: fontSize,
        fontWeight: fontWeight,
        color: color,
        height: height,
        leadingDistribution: TextLeadingDistribution.even,
        fontFamilyFallback: fontFamilyFallback(),
      ),
      children: children,
    );
  }
}
```

2：

```dart
  RichText(
    maxLines: 1,
    textAlign: TextAlign.center,
    overflow: TextOverflow.ellipsis,
    text: MyTextSpan.textSpan(
    text: _floatValue(_currentValue)
        ? _intPartValue(_currentValue)
        : _currentValue,
    fontSize: 24,
    fontWeight: FontWeight.w600,
    color: const Color(0xff111111),
    children: <InlineSpan>[ // 这里是疑问点
        if (_floatValue(_currentValue))
        MyTextSpan.textSpan(
            text: _floatPartValue(_currentValue),
            fontSize: 12,
            fontWeight: FontWeight.w600,
            color: const Color(0xff111111)),
        const WidgetSpan(
        child: SizedBox(
            width: 4,
        ),
        ),
        MyTextSpan.textSpan(
        text: _unit,
        fontSize: 12,
        fontWeight: FontWeight.w500,
        color: const Color(0xff111111),
        ),
    ],
    ),
),
```

疑问点：为啥要封装设立TextSpan。

答：用来加载多个不同样式的文本。

## 解释

这段代码的主要功能是构建一个 `RichText` 小部件，用于显示当前值（`_currentValue`）及其单位（`_unit`）。以下是代码的详细解释：

### 1. **整体结构**

```dart
RichText(
  maxLines: 1,
  textAlign: TextAlign.center,
  overflow: TextOverflow.ellipsis,
  text: MyTextSpan.textSpan(...),
)
```

- **`RichText`**：Flutter 中的一个小部件，用于显示带有不同样式或格式的文本。
- **`maxLines: 1`**：限制文本只显示一行。
- **`textAlign: TextAlign.center`**：文本居中对齐。
- **`overflow: TextOverflow.ellipsis`**：当文本超出一行时，显示省略号（...）。

---

### 2. **主文本内容**

```dart
text: MyTextSpan.textSpan(
  text: _floatValue(_currentValue) ? _intPartValue(_currentValue) : _currentValue,
  fontSize: 24,
  fontWeight: FontWeight.w600,
  color: const Color(0xff111111),
  children: <InlineSpan>[...],
)
```

- **`MyTextSpan.textSpan`**：自定义方法，生成一个 `TextSpan` 对象。
- **`text`**：
  - 如果 `_currentValue` 是浮点数（通过 `_floatValue` 判断），则显示整数部分（通过 `_intPartValue` 提取）。
  - 否则直接显示 `_currentValue`。
- **`fontSize: 24`**：主文本字体大小为 24。
- **`fontWeight: FontWeight.w600`**：主文本字体加粗。
- **`color: const Color(0xff111111)`**：主文本颜色为深灰色（#111111）。
- **`children`**：包含子级 `InlineSpan`，用于显示附加内容（如小数部分和单位）。

---

### 3. **子级内容**

#### (1) **小数部分**

```dart
if (_floatValue(_currentValue))
  MyTextSpan.textSpan(
    text: _floatPartValue(_currentValue),
    fontSize: 12,
    fontWeight: FontWeight.w600,
    color: const Color(0xff111111),
  ),
```

- 如果 `_currentValue` 是浮点数，则显示小数部分（通过 `_floatPartValue` 提取）。
- **`fontSize: 12`**：小数部分字体大小为 12。
- **`fontWeight: FontWeight.w600`**：小数部分字体加粗。
- **`color: const Color(0xff111111)`**：小数部分颜色为深灰色。

#### (2) **间距**

```dart
const WidgetSpan(
  child: SizedBox(
    width: 4,
  ),
),
```

- 在主文本和单位之间插入一个宽度为 4 的空白区域，用于分隔。

#### (3) **单位**

```dart
MyTextSpan.textSpan(
  text: _unit,
  fontSize: 12,
  fontWeight: FontWeight.w500,
  color: const Color(0xff111111),
),
```

- 显示单位（`_unit`）。
- **`fontSize: 12`**：单位字体大小为 12。
- **`fontWeight: FontWeight.w500`**：单位字体稍微加粗。
- **`color: const Color(0xff111111)`**：单位颜色为深灰色。

---

### 4. **辅助方法**

#### (1) **判断是否为浮点数**

```dart
bool _floatValue(String value) {
  return value.contains('.');
}
```

- 检查字符串是否包含小数点，从而判断是否为浮点数。

#### (2) **提取整数部分**

```dart
String _intPartValue(String value) {
  final int index = value.indexOf('.');
  return value.substring(0, index);
}
```

- 找到小数点的位置，并返回小数点前的部分。

#### (3) **提取小数部分**

```dart
String _floatPartValue(String value) {
  final int index = value.indexOf('.');
  return value.substring(index);
}
```

- 找到小数点的位置，并返回小数点及之后的部分。

---

### 5. **总结**

这段代码的核心功能是动态生成一个富文本（`RichText`），用于显示当前值（`_currentValue`）及其单位（`_unit`）。它根据值是否为浮点数，分别显示整数部分、小数部分和单位，并通过不同的字体大小和样式进行区分。
