# 编译问题

## Installed Build Tools revision _.0.0 is corrupted

### 1. 问题

编译应用时遇到如下报错：

Installed Build Tools revision 33.0.0 is corrupted. Remove and install again using the SDK Manager.

### 2. 原因

在Sync project with gradle files时，会收到如下warning

```txt
Task :prepareKotlinBuildScriptModel UP-TO-DATE
Build-tool 33.0.0 is missing DX at D:\Programs\Android\sdk\build-tools\33.0.0\dx.bat
Build-tool 33.0.0 is missing DX at D:\Programs\Android\sdk\build-tools\33.0.0\dx.bat
```

这个warning说明build tools中缺少`dx.bat`这个批处理文件。
实际上是因为在31版本之后的build tools中，`dx.bat`被`d8.bat`替代了。

### 3. 解决

有如下两种方案：

* 更改批处理文件名称
  * 找到build tools目录中的d8.bat，将文件名修改为dx.bat。
  * 找到build tools目录中的lib/d8.jar，将文件名修改为dx.jar。
  * 回到Android Studio重新打包。

* 降级build tools
  * 打开项目的build.gradle，将buildToolsVersion降级到30.0.0或者更老的版本，targetSdkVersion与compileSdkVersion同理。
