# ChangeNotifier

`ChangeNotifier` 是 Flutter 中的一个核心类，用于实现响应式编程模式。它是一个通用的类，允许你将数据变化通知给订阅了这些变化的组件。

注意：

这个类与`NotificationListener`完全不是一个东西，这个类不是Widget，本质是个观察者模式的回调工具类，可以随便使用，而`NotificationListener`是个Widget，在需要监听子部件时使用。

应用举例：

`ScrollView`中的`ScrollController`是`ChangeNotifier`子类，它会调用`notifyListeners()`将变化如滚动等发送出去，我们使用`ScrollView`时可以通过`addListener`进行注册监听变化。

---

## 1. 作用

- **数据变化通知**：当数据发生变化时，使用 `ChangeNotifier` 通知依赖于这些数据的组件，以便它们可以更新自己的 UI。

## 2. 使用方法

- **继承 `ChangeNotifier`**：创建一个类继承自 `ChangeNotifier`。
- **实现数据变更逻辑**：在数据变化时调用 `notifyListeners` 方法。

## 3. 主要方法

- **addListener**：添加一个监听器，用于接收数据变化的通知。
- **removeListener**：移除一个监听器。
- **notifyListeners**：通知所有监听器数据已更改。

## 4. 示例代码

```dart
import 'package:flutter/foundation.dart';

class MyModel with ChangeNotifier {
  int _counter = 0;

  int get counter => _counter;

  void incrementCounter() {
    _counter++;
    notifyListeners(); // 通知数据变化
  }
}

// 在 Widget 中使用
class MyWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final model = ChangeNotifierProvider.of<MyModel>(context);

    return Scaffold(
      appBar: AppBar(
        title: Text('ChangeNotifier Example'),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text('You have pushed the button this many times:'),
            Text(
              model.counter.toString(),
              style: TextStyle(fontSize: 20),
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          model.incrementCounter(); // 调用模型的更改方法
        },
        tooltip: 'Increment',
        child: Icon(Icons.add),
      ),
    );
  }
}
```

## 5. 注意事项

- **性能考虑**：避免在 `ChangeNotifier` 中执行耗时操作，因为这会影响 UI 的响应性。
- **正确的线程使用**：数据更改通常在主线程之外发生，但通知和 UI 更新应在主线程中进行。
- **使用 `Provider`**：`ChangeNotifier` 通常与 `Provider` 包一起使用，以简化状态管理和数据传递。

## 6. 与 `Provider` 结合使用

`ChangeNotifier` 经常与 `Provider` 包结合使用，`Provider` 提供了一种简单的方式将数据模型传递给组件树。

- **`ChangeNotifierProvider`**：一个 `InheritedWidget`，用于将 `ChangeNotifier` 作为依赖项提供给组件树。
- **`Provider.of<T>(context)`**：获取上下文中的 `ChangeNotifier` 实例。

通过使用 `ChangeNotifier`，你可以构建出响应数据变化的动态 UI，使得用户界面能够实时反映数据模型的状态。这是 Flutter 响应式编程的核心部分之一。
