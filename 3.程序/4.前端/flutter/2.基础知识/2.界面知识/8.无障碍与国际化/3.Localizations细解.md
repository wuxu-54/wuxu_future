# Localizations细解

Flutter 提供了一套完整的国际化和本地化支持，允许你构建支持多语言的应用。`Localizations` 是这个支持的核心类之一，用于访问当前区域设置的本地化资源。

以下是 `Localizations` 的基本用法：

## 1. 定义本地化资源

首先，你需要为每种支持的语言定义本地化资源。这些资源可以是字符串、日期格式、数字格式等。通常，这些资源放在专门的本地化目录中，例如：

```sh
lib/
├── l10n/
│   ├── messages_en.dart
│   ├── messages_es.dart
│   └── messages_zh.dart
```

每个语言文件会使用 `intl` 包提供的 `MessageFormatter` 来定义本地化的字符串。

## 2. 创建 Localizations 类

然后，你需要创建一个继承自 `LocalizationsDelegate` 的类，用于构建和查找本地化资源。

```dart
import 'package:flutter_localizations/flutter_localizations.dart';
import 'l10n/messages_en.dart';
import 'l10n/messages_es.dart';
import 'l10n/messages_zh.dart';

class AppLocalizations {
  static AppLocalizations? _instance;

  late String welcomeTitle;

  AppLocalizations(String locale) {
    switch (locale) {
      case 'en':
        _instance = MessagesEn();
        break;
      case 'es':
        _instance = MessagesEs();
        break;
      case 'zh':
        _instance = MessagesZh();
        break;
    }
  }

  static AppLocalizations of(BuildContext context) {
    return Localizations.of<AppLocalizations>(context, AppLocalizations);
  }
}

class AppLocalizationsDelegate extends LocalizationsDelegate<AppLocalizations> {
  @override
  bool isSupported(Locale locale) => ['en', 'es', 'zh'].contains(locale.languageCode);

  @override
  Future<AppLocalizations> load(Locale locale) async {
    await initializeMessages(locale.languageCode);
    return AppLocalizations(locale.languageCode);
  }

  @override
  bool shouldReload(covariant LocalizationsDelegate<AppLocalizations> old) => false;
}
```

## 3. 使用 Localizations

在你的 Flutter 应用中，使用 `Localizations` 来访问当前区域设置的本地化资源。

```dart
import 'package:flutter/material.dart';
import 'l10n/app_localizations.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      localizationsDelegates: [
        AppLocalizationsDelegate(),
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
      ],
      supportedLocales: [
        Locale('en', ''), // English
        Locale('es', ''), // Spanish
        Locale('zh', ''), // Chinese
      ],
      home: MyHomePage(),
    );
  }
}

class MyHomePage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(AppLocalizations.of(context).welcomeTitle),
      ),
      body: Center(
        child: Text('Hello, world!'),
      ),
    );
  }
}
```

## 4. 访问本地化资源

在 Widget 中，使用 `AppLocalizations.of(context)` 来访问本地化的资源，如字符串。

## 注意事项

- 确保在 `pubspec.yaml` 文件中添加了 `intl` 包依赖。
- 使用 `initializeMessages()` 函数来加载本地化资源，通常在 `AppLocalizations` 类的构造函数中调用。
- `LocalizationsDelegate` 需要实现 `isSupported`、`load` 和 `shouldReload` 方法。
- 在 `MaterialApp` 中使用 `localizationsDelegates` 和 `supportedLocales` 来配置支持的本地化资源和区域设置。

通过使用 `Localizations` 和 `AppLocalizationsDelegate`，你可以轻松地为 Flutter 应用添加多语言支持，提供更好的用户体验。
