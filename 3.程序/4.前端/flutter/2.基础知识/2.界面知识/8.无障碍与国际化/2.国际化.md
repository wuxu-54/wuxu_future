# 国际化

国际化（Internationalization，简称 i18n）是设计和开发软件的过程，使其能够容易地适应不同的语言和地区而无需进行重大的结构更改。Flutter 支持国际化，允许开发者创建多语言应用。

以下是 Flutter 应用国际化的基本步骤：

## 1. 添加依赖

首先，你需要在 `pubspec.yaml` 文件中添加 `intl` 包作为依赖。

```python
dependencies:
  flutter:
    sdk: flutter
  intl: ^0.17.0 # 请检查最新版本并使用最新版本
```

然后运行 `flutter pub get` 来安装包。

## 2. 准备翻译资源

翻译资源通常是通过 `intl` 包提供的 `intl_translation` 工具生成的。你需要为每种支持的语言准备翻译文件（通常为 `.arb` 文件）。

## 3. 生成本地化资源

使用 `intl` 包提供的 `generate_from_arb` 脚本来生成本地化资源类。

```shell
flutter pub pub run intl_translation:extract_to_arb --output-dir=lib/l10n lib/localization_en_US.dart lib/main.dart
flutter pub pub run intl_translation:create --output-dir=lib/l10n --arb-dir=lib/l10n
```

这将生成一个本地化资源类，如 `messages_all.dart`，其中包含了所有的翻译字符串。

## 4. 使用 Localizations

在 Flutter 中，`Localizations` 是一个提供访问本地化资源的类。你可以通过 MaterialApp 或 WidgetsApp 的 `localizationsDelegates` 属性来添加你的本地化代理。

```dart
MaterialApp(
  onGenerateTitle: (context) => Localization.of(context, AppLocalizations).title,
  localizationsDelegates: [
    AppLocalizations.delegate, // 自定义的本地化代理
    GlobalMaterialLocalizations.delegate,
    GlobalWidgetsLocalizations.delegate,
  ],
  supportedLocales: [
    Locale('en', 'US'),
    Locale('es', ''), // 添加支持的本地
  ],
  // ...
)
```

## 5. 使用 Intl 实现翻译

使用 `intl` 包中的 `Intl.message` 来标记要翻译的字符串。

```dart
import 'package:intl/intl.dart';

class AppLocalizations {
  static AppLocalizations of(BuildContext context) {
    return Localizations.of<AppLocalizations>(context, AppLocalizations);
  }

  String get title {
    return Intl.message(
      'My App',
      name: 'title',
      desc: 'The title of the app',
    );
  }
}
```

## 6. 切换 Locale

你可以通过更改 `Localizations.localeOf(context)` 的值来切换应用的语言环境。

```dart
void _changeLocale(Locale newLocale) {
  Localizations.localeOf(context).then((locale) {
    if (locale != newLocale) {
      Localizations.localeOf(context) = newLocale;
    }
  });
}
```

## 7. 测试

确保测试你的应用在不同的语言环境下的表现，包括文本换行、布局调整等。

## 注意事项

* 确保所有可翻译的字符串都使用 Intl.message 进行标记。
* 考虑使用工具或服务来管理翻译，尤其是当支持的语言数量增加时。
* 一些文本可能需要根据目标语言的阅读习惯进行调整，而不仅仅是直接翻译。

通过这些步骤，你可以创建一个支持多语言的 Flutter 应用，使其能够适应不同地区和文化的用户。
