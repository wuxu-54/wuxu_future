# martix4

在Flutter中，Matrix4类是dart:ui库提供的，用于表示一个4x4的仿射变换矩阵，广泛应用于2D和3D图形变换中。这个类提供了多种方法来操作和构建变换矩阵，比如旋转、平移、缩放和错切（skew）。

以下是一些基本的Matrix4操作：

## 创建Matrix4

创建一个4x4单位矩阵，它表示没有任何变换：

```dart
import 'dart:ui';

Matrix4 matrix = Matrix4.identity();
```

## 应用变换

你可以使用`multiply`方法来组合多个变换，或者直接使用类中提供的方法来应用特定的变换：

```dart
// 平移变换
matrix.translate(10, 20, 30);

// 旋转变换，绕Z轴旋转radians弧度
matrix.rotateZ(1.0);

// 缩放变换
matrix.scale(2.0, 3.0, 4.0);

// 错切变换，绕X轴错切sx，绕Y轴错切sy
matrix.skew(0.3, 0.4);
```

## 矩阵乘法

Matrix4类还提供了multiply方法来进行矩阵乘法，这在组合多个变换时非常有用：

```dart
Matrix4 anotherMatrix = Matrix4.identity();
anotherMatrix.translate(50, 100, 0);

// 将当前矩阵与anotherMatrix相乘
matrix.multiply(anotherMatrix);
```

## 应用到Canvas

在自定义绘制时，你可以使用Matrix4来变换Canvas：

```dart
void paint(Canvas canvas, Size size) {
  final paint = Paint();
  final matrix = Matrix4.identity()..translate(100, 100);

  canvas.save();
  // 应用矩阵变换
  canvas.transform(matrix.storage);
  // 绘制一个位于(100, 100)的矩形
  canvas.drawRect(Rect.fromLTWH(0, 0, 100, 100), paint);
  canvas.restore();
}
```

## 逆变换

如果你需要将一个变换撤销，可以使用`tryInvert`方法来获取逆矩阵：

```dart
Matrix4 invertedMatrix = matrix.tryInvert();
if (invertedMatrix != null) {
  // 使用invertedMatrix来撤销变换
}
```

## 注意事项

* 变换的顺序很重要，因为矩阵乘法是不可交换的。
* 在使用transform方法时，记得调用canvas.save和canvas.restore来保存和恢复画布状态。
* 过度使用复杂的矩阵变换可能会影响性能，特别是在动画中。

Matrix4是Flutter中处理图形变换的强大工具，通过它，你可以实现各种复杂的动画和视觉效果。
