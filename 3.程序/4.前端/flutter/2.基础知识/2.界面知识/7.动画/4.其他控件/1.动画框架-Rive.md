# rive动画控件

`.riv`是动画文件，支持很多平台，可以在官网或官方工具创建动画。[官网](https://editor.rive.app/home)，[flutter接入文档](https://help.rive.app/runtimes/overview/flutter)
>别看下面写了一大坨，我建议还是直接看官网文档。

flutter中有单独的控件来处理`.riv`动画文件。

## flutter中使用

Rive 是一个强大的实时交互设计和动画工具，它为 Flutter 提供了 `rive` 包，允许开发者在 Flutter 应用中集成复杂的动画。以下是一些主要的 API 及其示例：

### 1. 添加 Rive 依赖

首先，在 `pubspec.yaml` 文件中添加 Rive 包的依赖：

```yaml
dependencies:
  rive: ^latest_version
```

### 2. 导入 Rive 包

在 Dart 文件中导入 Rive 包：

```dart
import 'package:rive/rive.dart';
```

### 3. 加载 Rive 文件

加载 `.riv` 文件并获取 `Artboard` 对象：

```dart
Future<void> loadRiveFile() async {
  final data = await rootBundle.load('assets/your_animation.riv');
  final file = RiveFile.import(data);
  final artboard = file.mainArtboard;
  // 使用 artboard 来显示动画
}
```

### 4. 使用 Rive 控件显示动画

在 Flutter Widget 中使用 `Rive` 控件来显示动画：

```dart
@override
Widget build(BuildContext context) {
  return Scaffold(
    body: RiveFile.import('assets/your_animation.riv').then((file) {
      return Rive(artboard: file.mainArtboard);
    }),
  );
}
```

### 5. 控制动画播放

使用 `RiveAnimationController` 控制动画播放：

```dart
class MyAnimation extends StatelessWidget {
  final RiveAnimationController controller;

  MyAnimation(this.controller);

  @override
  Widget build(BuildContext context) {
    return Rive(
      artboard: controller.artboard,
      controller: controller,
    );
  }
}
```

### 6. 状态机和输入控制

如果 Rive 文件包含状态机，可以通过 `StateMachineController` 控制动画状态：

```dart
StateMachineController? stateMachineController;

void initState() {
  super.initState();
  final file = RiveFile.import('assets/your_animation.riv');
  final artboard = file.mainArtboard;
  stateMachineController = StateMachineController.fromArtboard(artboard, 'YourStateMachineName');
  artboard.addController(stateMachineController!);
}

void playAnimation() {
  stateMachineController?.play('YourAnimationName');
}
```

### 7. 监听动画事件

可以使用 `RiveAnimationController` 的 `addListener` 方法来监听动画事件：

```dart
controller.addListener(() {
  // 动画更新时执行的代码
});
```

### 8. 动画的暂停、停止和重置

控制动画的暂停、停止和重置：

```dart
// 暂停动画
controller.pause();

// 停止动画
controller.stop();

// 重置动画到初始状态
controller.reset();
```

### 9. 动画速度控制

设置播放速度：

```dart
controller.speed = 1.0; // 正常速度
controller.speed = 2.0; // 两倍速度
```

### 10. 动画播放一次

播放动画一次后停止：

```dart
controller.playOnce();
```

### 示例项目

要查看完整的示例项目，可以访问 Rive 的 GitHub 仓库：

```plaintext
https://github.com/rive-app/rive-flutter/tree/master/example
```

或者查看 Rive 的官方文档和指南：

```plaintext
https://help.rive.app/runtimes/overview/flutter
```

---

## Rive中的API

RiveAnimation 是 Flutter 中用于展示 Rive 动画的 widget。以下是对 RiveAnimation API 的详细解释和示例。

### API 详细解释

1. **Rive**: 这是主要的 widget，用于加载和显示 Rive 动画。
   - `artboard`: 要显示的 Rive 动画的 artboard。
   - `controller`: 控制动画播放的 RiveAnimationController。

2. **RiveAnimationController**: 控制 Rive 动画播放的控制器。
   - `play`: 开始播放动画。
   - `pause`: 暂停动画。
   - `stop`: 停止动画。
   - `reset`: 重置动画到起始位置。
   - `seekTo`: 跳转到动画的特定时间点。
   - `setProgress`: 设置动画的播放进度。

3. **StateMachineController**: 如果 Rive 文件包含状态机，这个控制器可以用来管理状态转换。
   - `stateMachines`: 获取状态机列表。
   - `activeState`: 获取当前激活的状态。

4. **RiveFile**: 表示加载的 Rive 文件。
   - `mainArtboard`: 文件的主 artboard。
   - `artboards`: 文件中所有的 artboards 列表。

5. **Artboard**: Rive 文件中的一个 artboard，包含了动画和图形元素。
   - `addController`: 向 artboard 添加控制器。

### 示例

假设你已经有一个 Rive 动画文件（`.riv` 格式），下面是如何在 Flutter 中使用 RiveAnimation widget 来加载和控制动画的基本步骤：

#### 加载 Rive 文件

加载 Rive 文件并获取 `Artboard` 对象：

```dart
Future<void> loadRiveFile() async {
  final data = await rootBundle.load('assets/your_animation.riv');
  final file = RiveFile.import(data);
  final artboard = file.mainArtboard;
  // 使用 artboard 来显示动画
}
```

#### 使用 RiveAnimation widget 显示动画

在 Flutter Widget 中使用 RiveAnimation widget 来显示动画：

```dart
class RiveAnimationWidget extends StatefulWidget {
  @override
  _RiveAnimationWidgetState createState() => _RiveAnimationWidgetState();
}

class _RiveAnimationWidgetState extends State<RiveAnimationWidget> {
  late final Artboard artboard;

  @override
  void initState() {
    super.initState();
    loadRiveFile().then((value) => setState(() => artboard = value));
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Rive Animation Example'),
      ),
      body: Center(
        child: artboard == null
            ? CircularProgressIndicator()
            : Rive(artboard: artboard),
      ),
    );
  }
}
```

#### 控制动画播放

使用 `RiveAnimationController` 控制动画播放：

```dart
class RiveAnimationControllerWidget extends StatefulWidget {
  final Artboard artboard;

  RiveAnimationControllerWidget({required this.artboard});

  @override
  _RiveAnimationControllerWidgetState createState() =>
      _RiveAnimationControllerWidgetState();
}

class _RiveAnimationControllerWidgetState
    extends State<RiveAnimationControllerWidget> {
  late RiveAnimationController controller;

  @override
  void initState() {
    super.initState();
    controller = RiveAnimationController(widget.artboard);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Rive Animation Controller Example'),
      ),
      body: Center(
        child: Rive(
          artboard: widget.artboard,
          controller: controller,
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          controller.play();
        },
        child: Icon(Icons.play_arrow),
      ),
    );
  }
}
```

在这个示例中，我们首先在 `initState` 方法中初始化了 `RiveAnimationController`。然后，我们使用 `Rive` widget 并传入 `artboard` 和 `controller` 来显示和控制动画。我们还添加了一个 FloatingActionButton 来开始播放动画。

---

## 注意事项

- 确保 Rive 动画文件 `.riv` 已经包含在 Flutter 的资源目录中，并且在 `pubspec.yaml` 中正确配置。
- 使用 `Rive` 控件时，需要先加载 Rive 文件并获取 `Artboard`。
- 通过 `StateMachineController` 可以控制 Rive 动画的状态机。
- 在应用中使用 Rive 动画时，注意资源的加载和释放，避免内存泄漏。

---

## 补充

rive工具制作中，状态机及数值的意思如下图：

![Alt text](../../../../images/rive%E5%88%B6%E4%BD%9C.png)
