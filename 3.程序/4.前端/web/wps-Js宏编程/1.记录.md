# 记录excel 按行生成

```js
let lock = false;

function acquireLock() {
    while (lock) {
        WPS.SheetUtil.sleep(100); // 等待100毫秒
    }
    lock = true;
}

function releaseLock() {
    lock = false;
}

// 定义一个函数来处理选中的单元格
function processSelectedCells() {
Application.EnableEvents = false;
 let selectedRange = Selection;
    // 输出选中单元格的范围地址
//    console.log("选中的单元格范围: " + Cells(selectedRange.Row+1,selectedRange.Column));

let copyTimesMin = 4;
let copyTimesMax = 5;

let index = 0;

const newColumn = selectedRange.Column+3;

//    // 循环遍历选中的每个单元格
    for (let row =0; row < 152; row++) {
        let copyTimes = Math.floor(Math.random() * (copyTimesMax - copyTimesMin + 1)) + copyTimesMin;     
        let value = Cells(selectedRange.Row+row, selectedRange.Column)
    
        for (let i = 0;i<copyTimes;i++){
            Cells(selectedRange.Row+index, selectedRange.Column+3).Value2 = value;
            index++;
        }

    }

  Application.EnableEvents = true;
}



function safeWriteOperation() {
    acquireLock();
    try {
        processSelectedCells();
    } finally {
        releaseLock();
    }
}
```
