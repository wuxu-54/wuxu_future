# 副作用是什么

在Vue 3中，副作用（Side Effects）通常指的是那些不直接依赖于响应式数据，但可能会影响应用状态或外部环境的操作。副作用可能包括API请求、修改全局状态、操作DOM等。在Vue的Composition API中，副作用的处理变得更加重要，因为它们可能不会自动响应数据的变化。

## 副作用的特点

* **非响应式**：副作用可能不直接依赖于响应式数据，因此它们不会在数据变化时自动重新执行。
* **外部影响**：副作用会对组件之外的环境产生影响，比如发起网络请求、修改全局变量等。
* **不可预测性**：由于副作用不总是与响应式数据直接关联，它们的行为可能难以追踪和预测。

## 处理副作用的方法

### 使用 watchEffect

watchEffect 是Vue 3中用于处理副作用的API之一。它会根据响应式状态的变化自动执行副作用函数。watchEffect内部使用Vue的响应式系统来追踪依赖，并在依赖变化时重新运行。

```javascript
import { watchEffect } from 'vue';

watchEffect(() => {
  // 这里的代码会在响应式状态变化时自动执行
  apiCall();
});
使用 onMounted 和 onUnmounted 生命周期钩子：
对于只在组件挂载或卸载时执行一次的副作用，可以使用onMounted和onUnmounted生命周期钩子。

import { onMounted, onUnmounted } from 'vue';

onMounted(() => {
  // 组件挂载时执行的副作用
  apiCall();
});

onUnmounted(() => {
  // 组件卸载时执行的副作用
  cleanup();
});
```

### 手动管理副作用

如果副作用需要根据特定的响应式状态变化来执行，或者需要执行复杂的逻辑，可以手动管理副作用。这通常涉及到使用ref或reactive来跟踪状态，并在适当的时候执行副作用。

```javascript
import { ref, watch } from 'vue';

const someState = ref(null);

watch(someState, (newValue, oldValue) => {
  if (newValue !== oldValue) {
    // 根据someState的变化执行副作用
  }
});
```

## 总结

副作用是Vue 3中一个重要的概念，它们代表了那些可能会影响应用状态或外部环境的操作。处理副作用是确保应用正确运行的关键。通过使用watchEffect、生命周期钩子或手动管理副作用，你可以确保副作用在正确的时机执行，并且与响应式数据的变化保持同步。正确处理副作用有助于提高应用程序的可维护性和性能。
