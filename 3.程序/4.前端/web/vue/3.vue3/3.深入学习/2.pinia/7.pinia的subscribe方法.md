# $subscribe

在Pinia中，`$subscribe` 是一个强大的API，它允许开发者监听store中状态的变化。这个方法可以用于替代Vue的响应式系统提供的watch或computed属性，特别是在你需要更细粒度控制或者需要响应非响应式数据变化时。当你调用$subscribe时，你可以提供一个回调函数，这个函数会在store的状态发生变化时被调用。你可以在这个回调函数中执行任何你需要的操作，比如更新UI、发送请求、记录日志等。

## 基本用法

```js
timport { useMyStore } from 'path/to/my-store';

const myStore = useMyStore();
myStore.$subscribe((mutation, state) => {
    console.log(State changed:, mutation, state);
});
```

在这个例子中，每当`myStore`的状态发生变化时，控制台都会打印出变化的详情和当前的状态。

## 参数

`$subscribe`方法接受两个参数：

1. `callback`: 这是一个函数，当store的状态发生变化时会被调用。它接收两个参数：  
    - `mutation`: 一个对象，包含了变化的详细信息，包括变化的类型（如`set`、`add`等）和变化的路径（如`count`）。  
    - `state`: 当前store的状态副本。

2. `options`: 这是一个可选的配置对象，提供了一些额外的选项来自定义订阅的行为。目前，这个对象可以包含一个`flush`属性，用于控制回调函数的触发时机。它可以是`'pre'`、`'post'`或`'sync'`。

- `flush: 'pre'`: 回调函数会在变化发生之前被调用。
- `flush: 'post'`: 回调函数会在变化发生之后被调用（默认值）。
- `flush: 'sync'`: 回调函数会同步地在变化发生时被调用。

## 应用场景

`$subscribe`方法在以下场景中非常有用：

- 当你需要在状态变化时执行一些副作用，而这些副作用不是简单的响应式更新。
- 当你想要在状态变化时执行一些不依赖于Vue响应式系统的逻辑。
- 当你需要监听非响应式数据的变化，比如通过`pinia-plugin`插件添加的数据。

## 注意事项

- `$subscribe`是一个低级别的API，它提供了对状态变化的直接监听能力。使用`$subscribe`时，需要注意不要引入不必要的性能开销，尤其是在回调函数中执行复杂操作时。
- 由于`$subscribe`是Pinia的内部API，虽然它相对稳定，但在未来的版本更新中可能会有所变化。在使用时，应参考最新的Pinia文档。通过`$subscribe`，你可以灵活地响应和处理Pinia store中的状态变化，从而构建出更加动态和响应式的应用程序。
