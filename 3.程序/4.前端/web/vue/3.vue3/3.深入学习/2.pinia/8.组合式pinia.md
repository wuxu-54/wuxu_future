# 组合式pinia

在Vue 3中，使用Pinia状态管理库结合组合式API（Composition API）可以让你更加灵活地管理组件状态。以下是如何在Vue 3组件中使用Pinia和组合式API的步骤和最佳实践。

## 1. 创建Pinia Store

首先，你需要定义一个Pinia store来管理状态。这通常在一个单独的文件或目录中完成。

```js
// stores/counterStore.js
import { defineStore } from 'pinia';

export const useCounterStore = defineStore('counter', {
  state: () => ({
    count: 0,
  }),
  getters: {
    doubleCount: (state) => state.count * 2,
  },
  actions: {
    increment() {
      this.count++;
    },
  },
});
```

## 2. 在Vue 3组件中使用组合式API

在组件中，你可以使用`<script setup>`语法来简洁地使用组合式API。通过使用`useStore`函数，你可以访问之前定义的Pinia store。

```html
<!-- MyComponent.vue -->
<script setup>
import { useCounterStore } from '@/stores/counterStore';

// 使用useStore来访问store的属性和方法
const { count, doubleCount, increment } = useCounterStore();

// 你可以使用响应式引用来跟踪store中的状态
const countRef = ref(count);

// 定义一个本地方法来触发store的action
function handleIncrement() {
  increment();
  // 你也可以同步更新本地响应式引用
  countRef.value++;
}
</script>

<template>
  <div>
    <p>Count: {{ countRef }}</p>
    <p>Double Count: {{ doubleCount }}</p>
    <button @click="handleIncrement">Increment</button>
  </div>
</template>
```

## 3. 使用useStore函数

`useStore`是一个Pinia插件提供的函数，它允许你在组合式API中访问store。当你使用useStore时，你可以直接返回store的state、getters和actions。

```js
// 使用useStore函数
const useMyStore = () => {
  const store = useCounterStore();
  return {
    ...store,
    // 你也可以添加本地计算属性或方法
    quadrupleCount: computed(() => store.count * 4),
    handleIncrement: () => store.increment(),
  };
};

// 在组件中使用useMyStore
const { count, doubleCount, quadrupleCount, handleIncrement } = useMyStore();
```

## 4. 组合式API的进一步使用

在组合式API中，你可以定义自己的响应式状态、计算属性和方法。这些可以在store的基础上进一步封装逻辑，使得组件更加模块化和可重用。

```js
// 定义本地响应式状态和计算属性
const useMyComponent = () => {
  const countRef = ref(0);
  const doubleCountRef = computed(() => countRef.value * 2);

  // 定义本地方法
  function increment() {
    countRef.value++;
  }

  // 返回所有需要的值
  return {
    countRef,
    doubleCountRef,
    increment,
  };
};

// 在组件中使用
const { countRef, doubleCountRef, increment } = useMyComponent();
```

通过这种方式，你可以将Pinia store的逻辑与组件的本地逻辑结合起来，创建出更加强大和可维护的组件。这种组合式写法不仅提高了代码的可读性和可维护性，而且使得状态逻辑的复用变得更加容易。
