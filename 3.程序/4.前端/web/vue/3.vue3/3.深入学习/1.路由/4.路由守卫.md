# 路由守卫(又叫导航守卫)

Vue Router提供了路由守卫，用于在路由【进入】或【离开】时执行逻辑。

## 守卫细讲

Vue Router中的导航守卫主要有以下几种：

* 全局守卫
* 路由独享守卫
* 组件内守卫

所有导航守卫都接收三个参数：

* `to`：即将要进入的目标路由对象。
* `from`：当前导航正要离开的路由。
* `next`：一个函数，必须调用以解析这个钩子。执行效果依赖next的调用方式。

### 全局守卫

全局守卫是作用于所有路由的守卫，可以全局处理路由跳转前的逻辑。

* `router.beforeEach(to, from, next)`：在路由进入前全局调用。如果返回`false`或调用`next(false)`将中断导航，如果调用`next('/')`将跳转到一个不同的地址（类似于`next({ path: '/' })`）。

```javascript
import { createRouter, createWebHistory } from 'vue-router';

const router = createRouter({
  history: createWebHistory(),
  routes: [...], // 路由配置
});

router.beforeEach((to, from, next) => {
  // 检查是否有token，作为登录验证
  if (to.meta.requiresAuth) {
    if (store.state.isAuthenticated) {
      next();
    } else {
      next('/login');
    }
  } else {
    next();
  }
});
```

### 路由独享守卫

路由独享守卫是针对某个特定路由的守卫。

```javascript
beforeEnter(to, from, next)：在路由配置上直接定义守卫函数。
const routes = [
  {
    path: '/protected',
    component: ProtectedComponent,
    beforeEnter: (to, from, next) => {
      // 逻辑
      next();
    },
  },
];
```

### 组件内守卫

组件内守卫是针对某个特定组件的守卫，可以在组件的`beforeRouteEnter`和`beforeRouteLeave`钩子中使用。

* `beforeRouteEnter(to, from, next)`：在路由进入前调用。
* `beforeRouteUpdate(to, from, next)`：在路由改变但该组件被复用时调用（例如，对于一个带有动态参数的路径）。
* `beforeRouteLeave(to, from, next)`：在离开该组件的路由时调用。

```javascript
export default {
  beforeRouteEnter(to, from, next) {
    next(); // 允许进入
  },
  beforeRouteLeave(to, from, next) {
    // 离开时的逻辑
    next(); // 必须调用next()以允许导航离开
  },
};
```

## 总结

导航守卫是Vue Router中非常强大的功能，它允许你在路由跳转过程中执行逻辑，提供了一种优雅的方式来处理路由相关的逻辑。通过合理使用【全局守卫】、【路由独享守卫】和【组件内守卫】，你可以构建出更加灵活和强大的路由系统，满足各种复杂的业务需求。在Vue 3中，这些守卫的使用方式与Vue 2类似，但享受到了Vue 3的新特性和改进，使得它们更加易于使用和维护。
