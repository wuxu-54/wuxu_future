# 组件间通信

在Vue 3中，组件之间的通信可以通过多种方式实现，这些方式根据通信的来源和目标的不同而有所区别。

## 常见的组件通信方式

### 1. 父子组件通信

父组件向子组件传递数据通过props，子组件通过props接收来自父组件的数据。
> props通信，组件可以通过`defineExpose()`控制传给其他组件的property属性。可以使用`$attrs`接收props传递的对象全部的属性，前文讲过具体用法。

```html
<!-- 父组件 -->
<template>
  <ChildComponent :parentMessage="message" />
</template>

<script setup>
import { ref } from 'vue';
import ChildComponent from './ChildComponent.vue';

const message = ref('Hello from parent');
</script>
```

子组件通过props接收数据。

```html
<!-- 子组件 -->
<template>
  <div>{{ parentMessage }}</div>
</template>

<script setup>
import { defineProps } from 'vue';
const props = defineProps({
  parentMessage: String,
});
</script>
```

子组件向父组件发送消息可以通过触发事件来实现。

```html
<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits(['childEvent']);

function sendToParent() {
  emit('childEvent', 'Hello from child');
}
</script>
```

#### 补充写法

通过父组件获取子组件对象，子组件获取父组件对象两种方式，达到通信效果。

1. `$parent`

    子组件模版中使用`$parent`，子组件可以直接获取到父组件对象，这样子组件可以获取父组件内容或调用对应方法。

    ```html
    <template>
        <button @click="minusHouse($parent)">点击</button>
    </template>

    <script setup lang="ts" name="child">

    function minusHouse(p:any){
        //p 就是上面的 $parent ,是父组件的对象。
    }
    </script>
    ```

2. `$refs`或`$ref`

    父组件标签中传入`$refs`，可以获取所有子组件的对象，父组件可以通过子组件对象获取其内容或方法。
    > `$ref` 就是绑定单个子组件，获取的是绑定子组件的对象。前文写过这里不多说了。

    ```html
    <template>
        <div ref="child">这是个子组件</div>
        <button @click="getAllChild($refs)">点击</button>
    </template>

    <script setup lang="ts" name="child">
    
    const child = ref();// 这里会查找已经在dom中的名为child的元素，最终会绑定到当前页面的元素上，child就是找到的子组件对象

    function getAllChild(childs:object){
        //childs 就是上面的 $refs ,是所有子组件的对象数组。
        for(let key in childs){
            console.log(childs[key])
        }
    }
    </script>
    ```

### 2. 兄弟组件通信

兄弟组件之间的通信可以通过共同的父组件来实现，或者使用事件和全局状态管理（如Pinia）。

### 3. 事件总线/全局事件

在Vue 3中，由于官方不再推荐使用Vue 2中的全局事件总线（EventBus），因此开发者需要寻找替代方案来实现跨组件的通信。**Mitt**是一个轻量级的事件库，它可以作为Vue 3中的事件总线来使用

### 4. Vuex/Pinia（全局状态管理）

Vuex和Pinia是Vue的官方状态管理库，适用于管理全局状态。它们通过集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。

### 5. 提供/注入（provide/inject）

provide和inject是Vue提供的一对API，允许父组件向所有子孙组件注入一个依赖，而不论组件层级有多深。

```html
<script setup>
import { ref, provide } from 'vue';

const data = ref('This is provided data');

// 提供数据
provide('injectedData', data);
</script>
```

子孙组件通过inject来接收注入的数据。

```html
<script setup>
import { inject } from 'vue';

// 注入数据
const injectedData = inject('injectedData');
</script>
```

### 6. 插槽（Slots）

插槽允许子组件向父组件传递内容，这在某些情况下可以看作是一种通信方式。

### 7. 非响应式状态

有时候，组件需要共享一些不需要响应式的数据，例如常量或工具函数。这些可以通过全局对象或单例模式来共享。

## 总结

组件通信是Vue开发中常见的需求，Vue 3提供了多种方式来实现这一点。选择合适的通信方式取决于具体的应用场景和组件结构：

* 对于全局状态管理，推荐使用`Pinia或Vuex`；
* 对于局部通信，`props和事件`是最直接的方式；
* 对于跨层级的复杂通信，`provide/inject`可以是一个好的选择。
