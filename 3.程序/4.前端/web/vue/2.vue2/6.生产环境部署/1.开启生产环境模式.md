# 开启生产环境模式

>了解就行，以后会专门学习webpack、vite等构建工具的，这里直接copy官网
生产环境，需要进行相关配置，比如压缩js等

## 不用构建工具

手动进行配置，比如：将`.js`压缩为 `.min.js`。

## 使用构建工具

使用 `webpack` 或 `Browserify` 或 `vite` 类似的构建工具。通过配置文件中的`process.env.NODE_ENV` 决定是否启用生产环境模式。代码中获取env的值进行相关处理，如网络接口baseurl 访问验收还是生产的切换。

### webpack 示例

webpack4+ 示例：

```js
module.exports = {
  mode: 'production'
}
```

webpack 3 及其更低版本中，你需要使用 DefinePlugin

```js
var webpack = require('webpack')

module.exports = {
  // ...
  plugins: [
    // ...
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify('production')
    })
  ]
}
```

### Browserify

* 在运行打包命令时将 `NODE_ENV` 设置为 `"production"`。这等于告诉 `vueify` 避免引入热重载和开发相关的代码。
* 对打包后的文件进行一次全局的 `envify` 转换。这使得压缩工具能清除掉 Vue 源码中所有用环境变量条件包裹起来的警告语句。例如：

    ```shell
    NODE_ENV=production browserify -g envify -e main.js | uglifyjs -c -m > build.js
    ```

* 或者在 Gulp 中使用 `envify`：

```js
// 使用 envify 自定义模块指定环境变量
var envify = require('envify/custom')

browserify(browserifyOptions)
  .transform(vueify)
  .transform(
    // 必填项，以处理 node_modules 里的文件
    { global: true },
    envify({ NODE_ENV: 'production' })
  )
  .bundle()
```

* 或者配合 `Grunt` 和 `grunt-browserify` 使用 `envify`：

```js
// 使用 envify 自定义模块指定环境变量
var envify = require('envify/custom')

browserify: {
  dist: {
    options: {
        // 该函数用来调整 grunt-browserify 的默认指令
        configure: b => b
        .transform('vueify')
        .transform(
            // 必填项，以处理 node_modules 里的文件
          { global: true },
          envify({ NODE_ENV: 'production' })
        )
        .bundle()
    }
  }
}
```

### Rollup

使用 @rollup/plugin-replace：

```js
const replace = require('@rollup/plugin-replace')
rollup({
  // ...
  plugins: [
    replace({
      'process.env.NODE_ENV': JSON.stringify( 'production' )
    })
  ]
}).then(...)
```
