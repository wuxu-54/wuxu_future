# 虚拟DOM

Vue仿照真实DOM建立了一个虚拟DOM，通过算法最终确定真实DOM展示内容。虚拟DOM中的节点就是虚拟节点
>本章节是Vue的基础知识，学习前需要了解HTML的一些知识概念：DOM、节点、树。具体可看HTML DOM相关章节。

通过代码：`return createElement('h1', this.blogTitle)` 来分析，`createElement` 到底会返回什么呢？其实不是一个实际的 DOM 元素。它更准确的名字可能是 `createNodeDescription`，因为它所包含的信息会告诉 Vue 页面上需要渲染什么样的节点，包括及其子节点的描述信息。我们把这样的节点描述为`“虚拟节点 (virtual node)”`，也常简写它为`“VNode”`。`“虚拟 DOM”`是我们对由 Vue 组件树建立起来的整个 `VNode` 树的称呼。

---

## `createElement` 函数的参数

1. **标签名或组件选项对象**：如果是一个字符串，它表示一个 HTML 标签。如果是一个对象，它表示一个组件，并且可以包含 props、children 等属性。
2. **属性对象**：包含虚拟节点的属性，如 class、style 等。
3. **子节点数组**：包含该节点的子节点，可以是字符串、虚拟节点或其他组件。

下面展示了`createElement` 函数的参数及意义

```javascript
// @returns {VNode} 返回一个 VNode 对象，是个组件
createElement(
  // {String | Object | Function}
  // 一个 HTML 标签名、组件选项对象，或者
  // resolve 了上述任何一种的一个 async 函数。必填项。
  'div',

  // {Object}
  // 一个与模板中 attribute 对应的数据对象。可选。
  {
    // (详情见下一节)
  },

  // {String | Array}
  // 子级虚拟节点 (VNodes)，由 `createElement()` 构建而成，
  // 也可以使用字符串来生成“文本虚拟节点”。可选。
  [
    '先写一些文字',
    createElement('h1', '一则头条'),
    createElement(MyComponent, {
      props: {
        someProp: 'foobar'
      }
    })
  ]
)
```

---

## VNode对象的结构

下面展示了VNode对象的属性

```javascript
{
  // 与 `v-bind:class` 的 API 相同，
  // 接受一个字符串、对象或字符串和对象组成的数组
  'class': {
    foo: true,
    bar: false
  },
  // 与 `v-bind:style` 的 API 相同，
  // 接受一个字符串、对象，或对象组成的数组
  style: {
    color: 'red',
    fontSize: '14px'
  },
  // 普通的 HTML attribute
  attrs: {
    id: 'foo'
  },
  // 组件 prop
  props: {
    myProp: 'bar'
  },
  // DOM property
  domProps: {
    innerHTML: 'baz'
  },
  // 事件监听器在 `on` 内，
  // 但不再支持如 `v-on:keyup.enter` 这样的修饰器。
  // 需要在处理函数中手动检查 keyCode。
  on: {
    click: this.clickHandler
  },
  // 仅用于组件，用于监听原生事件，而不是组件内部使用
  // `vm.$emit` 触发的事件。
  nativeOn: {
    click: this.nativeClickHandler
  },
  // 自定义指令。注意，你无法对 `binding` 中的 `oldValue`
  // 赋值，因为 Vue 已经自动为你进行了同步。
  directives: [
    {
      name: 'my-custom-directive',
      value: '2',
      expression: '1 + 1',
      arg: 'foo',
      modifiers: {
        bar: true
      }
    }
  ],
  // 作用域插槽的格式为
  // { name: props => VNode | Array<VNode> }
  scopedSlots: {
    default: props => createElement('span', props.text)
  },
  // 如果组件是其它组件的子组件，需为插槽指定名称
  slot: 'name-of-slot',
  // 其它特殊顶层 property
  key: 'myKey',
  ref: 'myRef',
  // 如果你在渲染函数中给多个元素都应用了相同的 ref 名，
  // 那么 `$refs.myRef` 会变成一个数组。
  refInFor: true
}
```

## 约束条件

VNode 必须唯一

解释：同层级，节点必须是唯一的，不能出现重复的多个，如果需要重复可通过工厂函数实现。

错误示例：

```javascript
render: function (createElement) {
  var myParagraphVNode = createElement('p', 'hi')
  return createElement('div', [
    // 错误 - 重复的 VNode
    myParagraphVNode, myParagraphVNode
  ])
}
```

工厂函数实现重复节点

```javascript
render: function (createElement) {
  var myParagraphVNode = createElement('p', 'hi')
  return createElement('div',
    //通过数组，创建多个组件对象
   Array.apply(null, { length: 20 }).map(function () {
      return createElement('p', 'hi')
    })
  )
}
```

---

## 示例补充

### 渲染列表

渲染函数也可以用来渲染基于数组的数据列表。你可以使用 v-for 指令或 JavaScript 逻辑来循环渲染列表项。

```js
new Vue({
  el: '#app',
  data: {
    items: [
      { message: 'Foo' },
      { message: 'Bar' }
    ]
  },
  render(h) {
    return h('ul', this.items.map(item => {
      return h('li', item.message);
    }));
  }
});
```

在这个例子中，我们使用 map 函数遍历 items 数组，并为每个项目创建一个 li 节点。

### 使用模板字符串的渲染函数

`在 Vue 2 中，你可以在组件对象中使用 template 属性来定义渲染函数，这通常是一个包含 HTML 模板的字符串。

```js
Vue.component('todo-item', {
  template: '<li>这是个待办项</li>'
});
```

### 使用渲染函数的组件

如果你的组件更复杂，或者你更喜欢使用 JavaScript 来编写模板，你可以定义一个渲染函数。这个函数接收一个 h 作为参数（这是 createElement 函数的别名），并返回一个 VNode。

```js
Vue.component('todo-item', {
  render(h) {
    return h('li', '这是个待办项');
  }
});
```

在这个例子中，h 函数用于创建一个虚拟节点，它告诉 Vue 如何构建真实的 DOM 节点。h 函数的第一个参数是标签名，随后是任何属性和子节点。
