# setData

## 1. `setData` 的作用

在微信小程序里，`setData` 是一个非常关键的方法，它主要用于更新页面的数据并触发视图的重新渲染。具体而言，其作用体现在以下几个方面：

### 1.1 更新 `data` 中的数据

在小程序的 `Page` 或 `Component` 实例中，`data` 对象用于存储页面或组件的数据。当你需要修改这些数据时，就可以使用 `setData` 方法。例如：

```javascript
Page({
  data: {
    message: 'Hello, World!'
  },
  changeMessage: function() {
    this.setData({
      message: 'New Message!'
    });
  }
});
```

上述代码中，当调用 `changeMessage` 方法时，会通过 `setData` 把 `data` 里的 `message` 属性更新为 `'New Message!'`。

### 1.2 触发视图更新

当使用 `setData` 更新 `data` 中的数据后，小程序框架会自动对比新旧数据，找出有变化的数据，然后更新对应的 WXML 视图。这样，用户就能看到页面上的数据发生了改变。

## 2. 未在 `data` 中声明的属性能否通过 `setData` 绑定到 WXML 中

可以，没有在 `data` 中声明的属性能够通过 `setData` 绑定到 WXML 中。具体分析如下：

### 2.1 动态添加属性

在小程序里，`setData` 允许你动态地给 `data` 对象添加新的属性。例如：

```javascript
Page({
  data: {
    // 初始 data 中没有 newProperty
  },
  addProperty: function() {
    this.setData({
      newProperty: 'This is a new property'
    });
  }
});
```

在上述代码中，`addProperty` 方法通过 `setData` 给 `data` 对象添加了一个新的属性 `newProperty`。

### 2.2 在 WXML 中使用动态添加的属性

一旦使用 `setData` 动态添加了属性，就可以在 WXML 中直接使用这个属性。例如：

```xml
<!-- page.wxml -->
<view>
  <button bindtap="addProperty">Add Property</button>
  <view>{{newProperty}}</view>
</view>
```

当点击按钮触发 `addProperty` 方法后，`newProperty` 就会被添加到 `data` 中，同时 WXML 中的 `{{newProperty}}` 会显示出对应的值。

### 注意事项

- **性能影响**：虽然可以动态添加属性，但频繁地动态添加属性可能会影响性能，因为每次调用 `setData` 都会触发视图的重新渲染。所以，建议尽量在 `data` 中预先声明可能会用到的属性。
- **数据绑定**：要确保 WXML 中的数据绑定语法正确，这样才能正确显示动态添加的属性值。

---

## Vue2与Vue3类似动态添加属性操作

在 Vue 中可以直接动态设置属性并引用，不过在不同版本（Vue 2 和 Vue 3）中的处理方式存在一些差异，下面为你详细介绍：

### Vue 2

#### 1. vue2响应式系统基础

在 Vue 2 里，当一个 Vue 实例创建时，Vue 会遍历 `data` 选项中的所有属性，使用 `Object.defineProperty()` 将这些属性转换为 `getter/setter`，从而让这些属性具备响应式特性。也就是说，当这些属性的值发生变化时，Vue 会自动更新与之绑定的 DOM。

#### 2. vue2动态添加响应式属性

如果要给已经创建的实例动态添加新的响应式属性，需要使用 `Vue.set()` 或者其别名 `this.$set()` 方法。若直接添加属性，该属性不会触发视图更新。

**示例代码**：

```vue
<template>
  <div>
    <!-- 引用动态添加的属性 -->
    <p>{{ newProperty }}</p>
    <button @click="addProperty">Add Property</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      // 初始时没有 newProperty
    };
  },
  methods: {
    addProperty() {
      // 使用 this.$set 动态添加响应式属性
      this.$set(this, 'newProperty', 'This is a new property');
    }
  }
};
</script>
```

**代码解释**：

- 在 `data` 选项中，初始并没有 `newProperty` 属性。
- 当点击按钮触发 `addProperty` 方法时，使用 `this.$set()` 方法动态添加 `newProperty` 属性，这样该属性就具备了响应式特性，视图会随着属性值的变化而更新。

#### 3. 直接添加非响应式属性

如果直接给实例添加属性，该属性不会是响应式的，即属性值的变化不会触发视图更新。

```javascript
export default {
  data() {
    return {};
  },
  methods: {
    addNonReactiveProperty() {
      this.nonReactiveProperty = 'This is a non - reactive property';
    }
  }
};
```

### Vue 3

#### 1. vue3响应式系统基础

Vue 3 使用 `Proxy` 来实现响应式系统，它比 Vue 2 的 `Object.defineProperty()` 更加强大，能够检测到属性的添加和删除。

#### 2. vue3动态添加响应式属性

在 Vue 3 中，可以直接给响应式对象添加新属性，新属性会自动具备响应式特性。

**示例代码**：

```vue
<template>
  <div>
    <!-- 引用动态添加的属性 -->
    <p>{{ state.newProperty }}</p>
    <button @click="addProperty">Add Property</button>
  </div>
</template>

<script setup>
import { reactive } from 'vue';

// 创建响应式对象
const state = reactive({});

const addProperty = () => {
  // 直接添加属性，该属性会自动具备响应式特性
  state.newProperty = 'This is a new property';
};
</script>
```

**代码解释**：

- 使用 `reactive` 函数创建一个响应式对象 `state`。
- 当点击按钮触发 `addProperty` 方法时，直接给 `state` 对象添加 `newProperty` 属性，该属性会自动成为响应式属性，视图会随着属性值的变化而更新。

综上所述，Vue 中可以动态设置属性并引用，不过在 Vue 2 和 Vue 3 中处理方式有所不同，开发者需要根据具体的版本来选择合适的方法。
