# 渲染列表

以js数组方式，通过`map()`渲染列表，通过`filter()`可以过滤数据。

```js
import { people } from './data.js';
import { getImageUrl } from './utils.js';

export default function List() {

  const chemists = people.filter(person => //过滤
    person.profession === 'chemist'
  );
  const listItems = chemists.map(person => //渲染
    <li>
      <img
        src={getImageUrl(person)}
        alt={person.name}
      />
      <p>
        <b>{person.name}:</b>
        {' ' + person.profession + ' '}
        known for {person.accomplishment}
      </p>
    </li>
  );
  return <ul>{listItems}</ul>;
}

```

易犯错误

箭头函数在 `=>` 之后隐式返回表达式，因此你不需要 return 语句：

```js
const listItems = chemists.map(person =>
  <li>...</li> // Implicit return!
);
```

但是，如果 `=>` 后跟 `{`大括号，则必须显式写入 `return`！

```js
const listItems = chemists.map(person => { // Curly brace
  return <li>...</li>;
});
```

包含 `=> {` 的箭头函数据说有一个 “块主体”。，它们让你多写一行代码，但你必须自己写一个 `return` 语句。如果你忘记了它，将一无所获！

## 唯一标识

同Flutter、Compose一样，列表条目需要唯一标识`key`，用于条目的操作。直接在 `map()` 调用中的 `JSX` 元素总是需要键！
>键告诉 React 每个组件对应于哪个数组项，以便稍后匹配它们。如果你的数组项可以移动（例如由于排序）、插入或删除，这就变得很重要。精心选择的 key 帮助 React 推断到底发生了什么，并对 DOM 树进行正确的更新。

与其即时生成键，不如将它们包含在数据中。

不同的数据来源提供不同的键来源：

- 来自数据库的数据：如果你的数据来自数据库，你可以使用本质上唯一的数据库键/ID。
- 本地生成的数据：如果你的数据是在本地生成和保存的（例如注意应用中的注意），请在创建项目时使用`递增计数器`、`crypto.randomUUID()` 或类似 `uuid` 的包。

### 为每个列表项显示多个 DOM 节点

当每个条目需要渲染的不是一个而是多个 DOM 节点时，你会怎么做？

短的 `<>...</>` 分段 语法不允许你传递键，因此你需要将它们组合成一个 `<div>`，或者使用稍长的 更明确的 ![`<Fragment>`](https://react.nodejs.cn/reference/react/Fragment#rendering-a-list-of-fragments) 语法：

```js
import { Fragment } from 'react';

// ...

const listItems = people.map(person =>
  <Fragment key={person.id}>
    <h1>{person.name}</h1>
    <p>{person.bio}</p>
  </Fragment>
);
```

片段从 DOM 中消失，因此这将生成 `<h1>、<p>、<h1>、<p>` 等的扁平列表。

### 键的规则

1. 键在兄弟项中必须是唯一的。但是，可以为不同数组中的 JSX 节点使用相同的键。
2. 键不得更改，否则就达不到其目的！不要在渲染时生成它们。

### 易犯错误

你可能会想使用数组中条目的索引作为其键。事实上，如果你根本不指定 key，这就是 React 将使用的内容。但是如果一个项目被插入、删除或者数组被重新排序，你渲染项目的顺序会随着时间的推移而改变。索引作为键通常会导致微妙且令人困惑的错误。

同样，不要即时生成键，例如 与 key={Math.random()}。这将导致键在渲染之间永远不会匹配，从而导致每次都重新创建所有组件和 DOM。这不仅速度慢，而且还会丢失列表项内的任何用户输入。而是，使用基于数据的稳定 ID。

请注意，你的组件不会收到 key 作为属性。它仅用作 React 本身的提示。如果你的组件需要一个 ID，你必须将它作为一个单独的属性传递：<Profile key={id} userId={id} />。
