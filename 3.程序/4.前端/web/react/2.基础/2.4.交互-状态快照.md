# 状态快照

状态变量可能看起来像你可以读取和写入的常规 JavaScript 变量。但是，状态的行为更像是快照。设置它不会更改你已有的状态变量，而是会触发重新渲染。

>快照：snapshot,编程里指记录系统、数据或者对象在特定时刻的状态。具体解释：![snapshot](/3.程序/1.基础/3.小知识早知道/3.9.解释-编程中的snapshot.md)

## 渲染

设置状态，会触发重新渲染UI。”渲染” 表示 React 正在调用你的组件，这是一个函数。从该函数返回的 JSX 就像 UI 的及时快照。它的属性、事件处理程序和局部变量都是使用渲染时的状态来计算的。

与照片或电影画面不同，你返回的 UI “快照” 是**交互式**的。它包括类似事件处理程序的逻辑，用于指定响应输入时发生的事情。React 更新屏幕以匹配此快照并连接事件处理程序。因此，按下按钮将触发来自 JSX 的点击处理程序。

当 React 重新渲染一个组件时：

1. React 再次调用你的函数。
2. 你的函数返回一个新的 JSX 快照。
3. 然后 React 更新屏幕以匹配函数返回的快照。

作为组件的内存，状态不像一个常规变量，在你的函数返回后就消失了。实际上在 React 本身中声明 “存在” - 就像束之高阁一样！ - 在你的函数之外。当 React 调用你的组件时，它会为你提供该特定渲染的状态快照。你的组件返回 UI 的快照，并在其 JSX 中包含一组新的属性和事件处理程序，所有这些都使用该渲染中的状态值进行计算！

## 特别记录（重点）

设置状态只会在下一次渲染更改它，也就是说，多次**直接**调用状态修改，react只会基于当前值做处理。

```js
import { useState } from 'react';

export default function Counter() {
  const [number, setNumber] = useState(0);

  return (
    <>
      <h1>{number}</h1>
      <button onClick={() => {
        setNumber(number + 1);
        setNumber(number + 1);
        setNumber(number + 1);
      }}>+3</button>
    </>
  )
}
```

这里点击按钮后，最终显示的是`1`，这是为什么？明明调用了三次状态设置啊。

答：同我开始说的，多次直接调用状态修改，react之后基于当前值也就是`number=0`做处理。以下是此按钮的点击处理程序告诉 React 执行的操作：

1. setNumber(number + 1)：number 是 0 所以 setNumber(0 + 1)。
    - React 准备在下一次渲染时将 number 更改为 1。
2. setNumber(number + 1)：number 是 0 所以 setNumber(0 + 1)。
    - React 准备在下一次渲染时将 number 更改为 1。
3. setNumber(number + 1)：number 是 0 所以 setNumber(0 + 1)。
    - React 准备在下一次渲染时将 number 更改为 1。

即使你调用了 setNumber(number + 1) 三次，在此渲染的事件处理程序中，number 始终是 0，因此你将状态设置为 1 三次。这就是为什么在事件处理程序完成后，React 会重新渲染 number 等于 1 而不是 3 的组件。

后面章节会将，状态设置时react处理流程已经上面这个问题的解决方法。
