# jni

## java函数关联native

* 让虚拟机找到native中对应函数的指针地址并存储起来，下载直接加载
* JNI函数与java层函数时一一对应的，包名+函数名（jni中包名的`.`变成了`_`,原`_`变成了`_1`）

### 静态注册

1. java层调用函数，jni库按【包名+函数名】匹配查询，查不到会报错。
2. 虚拟机保存联系和native函数指针内存地址，下次不用在匹配，直接返回函数指针。

弊端：

1. java层代码会编译成.class文件，每个class文件都必须通过javah生成头文件
2. javah生成的JNI函数名很长，书写不方便
3. 初次java层调用native函数时，需要匹配，影响运行效率

### 动态注册

1. JNINativeMethod 结构体，存储java层函数结构
2. AndroidRuntime中的registerNative方法，完成注册java层与native层的关联关系。
3. 注册时机：Java层System.loadLibary 加载完成后，会紧接着调用`JNI_OnLoad`函数。所以注册可以在这个函数中完成。（静态注册没这要求）
