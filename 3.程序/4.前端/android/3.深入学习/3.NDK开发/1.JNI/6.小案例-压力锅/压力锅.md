# 压力锅案例

本案例是对c调用java的简单实现。java触发c循环代码获取随机数，c先反射获取java层代码，然后将随机数传递过去并展示到ui上。

## 代码

* java

```java
class MeituActivity:Activity() {

    companion object{
      init {
          System.loadLibrary("ndk1")
      }
    }

    private val binding: ActivityMeituBinding by lazy {ActivityMeituBinding.inflate(layoutInflater)}

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(binding.root)

        binding.btnSelectPicture.setOnClickListener{
            Thread(Runnable {
                startMonitor()
            }).start()
        }

        binding.btnPicSet.setOnClickListener{
            stopMonitor()
        }
    }

    fun updatePressure(pressure:Int){
        Log.d("ndk1", "updatePressure $pressure")
        binding.pbProgress.post {
            binding.pbProgress.progress = pressure
        }
    }


    external fun startMonitor()

    external fun stopMonitor()
```

* c

```c
//压力锅，数据获取
#include <jni.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int getPressure(){
    return rand() % 100 + 1;
}

int start_monit_pressure = 0;

JNIEXPORT void JNICALL
Java_com_wuxu_ndk1_meitu_MeituActivity_startMonitor(JNIEnv *env, jobject thiz) {
    start_monit_pressure = 1;
    jclass  clazz = (**env).FindClass(env, "com/wuxu/ndk1/meitu/MeituActivity");
    jmethodID  mid =(**env).GetMethodID(env,clazz,"updatePressure", "(I)V");

    while (start_monit_pressure) {
       int pressure =  getPressure();
       (**env).CallVoidMethod(env,thiz, mid,pressure);
       sleep(2);
    }
}

JNIEXPORT void JNICALL
Java_com_wuxu_ndk1_meitu_MeituActivity_stopMonitor(JNIEnv *env, jobject thiz) {
    start_monit_pressure = 0;
}
```
