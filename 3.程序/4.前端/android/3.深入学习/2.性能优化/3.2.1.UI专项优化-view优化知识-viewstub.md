# ViewStub

`ViewStub` 是 Android 提供的一个轻量级的视图加载机制，它允许你在需要时才加载某个视图布局，而不是在布局文件加载时就将其全部加载到内存中。这有助于减少应用的初始内存占用和提升性能，特别是在处理复杂或较大的布局时。
>简单来说`ViewStub`就是懒加载视图

以下是 `ViewStub` 的详细用法：

## 1. 在 XML 布局文件中定义 ViewStub

首先，你需要在你的 XML 布局文件中定义一个 `ViewStub`。`ViewStub` 本质上是一个不可见的占位符，你可以通过 `android:layout` 属性指定它将要加载的布局文件。

```xml
<!-- activity_main.xml -->
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <!-- 其他布局元素 -->

    <ViewStub
        android:id="@+id/viewStub"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout="@layout/stub_layout" />
</RelativeLayout>
```

这里，`stub_layout.xml` 是你希望按需加载的布局文件。

```xml
<!-- stub_layout.xml -->
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical">

    <!-- 具体的布局元素 -->
    <TextView
        android:id="@+id/textView"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Hello from stub layout!" />

</LinearLayout>
```

## 2. 在 Activity 或 Fragment 中使用 ViewStub

在需要时，你可以在 Activity 或 Fragment 中通过 `findViewById` 找到 `ViewStub` 并调用 `inflate()` 方法来加载布局。

```java
// MainActivity.java
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        // 假设你在某个事件（如按钮点击）后需要加载 ViewStub
        Button showStubButton = findViewById(R.id.showStubButton);
        showStubButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                ViewStub viewStub = findViewById(R.id.viewStub);
                // 调用 inflate() 方法加载布局
                View inflatedView = viewStub.inflate();

                // 现在你可以找到并操作 stub_layout.xml 中的元素
                TextView textView = inflatedView.findViewById(R.id.textView);
                textView.setText("Stub layout is inflated!");
            }
        });
    }
}
```

## 3. 注意事项

- **一次性加载**：`ViewStub` 只能被 `inflate()` 一次。一旦布局被加载，`ViewStub` 将被替换为加载的布局，并且再次调用 `inflate()` 会抛出异常。
- **ID 传递**：`ViewStub` 加载的布局中的根视图的 ID 会被传递给 `ViewStub` 本身，因此你可以通过 `ViewStub` 的 ID 访问加载的布局的根视图。
- **布局优化**：使用 `ViewStub` 可以减少初始加载时的内存占用，特别适用于那些只在特定条件下才需要显示的布局。

## 4. 动态设置布局

你还可以在代码中动态设置 `ViewStub` 的布局资源，而不是在 XML 中静态指定。

```java
ViewStub viewStub = findViewById(R.id.viewStub);
// 动态设置要加载的布局
viewStub.setLayoutResource(R.layout.another_stub_layout);
View inflatedView = viewStub.inflate();
```

通过这种方式，你可以根据应用的状态或用户的行为动态决定加载哪个布局。

`ViewStub` 是一个非常有用的工具，可以帮助你优化应用的内存使用和提高性能。希望这个指南能帮助你更好地理解和使用 `ViewStub`。
