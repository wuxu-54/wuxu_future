
# 动画修饰符和可组合项  

原地址：<https://developer.android.google.cn/develop/ui/compose/animation/composables-modifiers?hl=zh-cn>  

## 一、内置动画可组合项  

### 1. `AnimatedVisibility`：显隐动画  

**功能**：控制可组合项的显示/隐藏，并提供进入/退出动画。  
**核心参数**：  

- `visible`：显示状态（`Boolean` 或 `MutableTransitionState<Boolean>`）。  
- `enter`：进入过渡（如 `fadeIn`、`slideInVertically`）。  
- `exit`：退出过渡（如 `fadeOut`、`slideOutVertically`）。  

**示例：自定义组合过渡**  

```kotlin  
var visible by remember { mutableStateOf(true) }  
AnimatedVisibility(  
    visible = visible,  
    enter = slideInVertically { -40.dp.roundToPx() } + expandVertically() + fadeIn(initialAlpha = 0.3f),  
    exit = slideOutVertically() + shrinkVertically() + fadeOut()  
) { Text("Hello") }  
```  

**过渡类型**：  

| 进入过渡         | 退出过渡         | 说明                     |  
|------------------|------------------|--------------------------|  
| `fadeIn`         | `fadeOut`        | 淡入/淡出                |  
| `slideInVertically` | `slideOutVertically` | 垂直滑动                 |  
| `expandIn`       | `shrinkOut`      | 展开/收缩                 |  
| `scaleIn`        | `scaleOut`       | 缩放进入/退出             |  

**子项动画**：  
通过 `Modifier.animateEnterExit()` 为子项单独指定动画：  

```kotlin  
AnimatedVisibility(visible) {  
    Box(Modifier.animateEnterExit(  
        enter = slideInVertically(),  
        exit = slideOutVertically()  
    )) { Text("子项动画") }  
}  
```  

**高级用法**：  

- 使用 `MutableTransitionState` 监听动画状态：  

  ```kotlin  
  val state = remember { MutableTransitionState(false).apply { targetState = true } }  
  AnimatedVisibility(visibleState = state) { /* ... */ }  
  ```  

- 通过 `transition` 添加自定义动画：  

  ```kotlin  
  AnimatedVisibility(visible) {  
      val color by transition.animateColor { state -> if (state == EnterExitState.Visible) Color.Blue else Color.Gray }  
      Box(Modifier.background(color))  
  }  
  ```  

### 2. `AnimatedContent`：内容切换动画  

**功能**：在不同状态的内容之间添加过渡动画（如计数器变化）。  
**核心参数**：  

- `targetState`：目标状态（触发内容更新）。  
- `transitionSpec`：过渡规格（组合进入/退出动画）。  

**示例：数字增减动画**  

```kotlin  
var count by remember { mutableIntStateOf(0) }  
AnimatedContent(targetState = count, transitionSpec = {  
    if (targetState > initialState) {  
        slideInVertically { height -> height } + fadeIn() togetherWith slideOutVertically { height -> -height } + fadeOut()  
    } else {  
        slideInVertically { height -> -height } + fadeIn() togetherWith slideOutVertically { height -> height } + fadeOut()  
    }  
}) { targetCount ->  
    Text("Count: $targetCount")  
}  
```  

**尺寸变换（`SizeTransform`）**：  
控制内容尺寸变化的动画逻辑：  

```kotlin  
AnimatedContent(targetState = expanded) {  
    transitionSpec = {  
        fadeIn() togetherWith fadeOut() using SizeTransform { initialSize, targetSize ->  
            if (targetState) {  
                keyframes { IntSize(targetSize.width, initialSize.height) at 150 } // 先水平展开  
            } else {  
                keyframes { IntSize(initialSize.width, targetSize.height) at 150 } // 先垂直收缩  
            }  
        }  
    }  
}  
```  

### 3. `Crossfade`：简单淡入淡出切换  

**功能**：在两个布局之间通过淡入淡出过渡（适用于简单状态切换）。  
**示例**：  

```kotlin  
var currentPage by remember { mutableStateOf("A") }  
Crossfade(targetState = currentPage) { screen ->  
    when (screen) {  
        "A" -> Text("Page A")  
        "B" -> Text("Page B")  
    }  
}  
```  

## 二、内置动画修饰符  

### `animateContentSize`：尺寸变化动画  

**功能**：自动为可组合项的尺寸变化添加动画（如文本行数变化、容器展开/收缩）。  
**注意事项**：  

- **修饰符顺序**：需放在尺寸修饰符（如 `size`、`height`）**前面**。  
- **性能优势**：自动处理布局阶段的尺寸过渡，避免手动计算。  

**示例：高度变化动画**  

```kotlin  
var expanded by remember { mutableStateOf(false) }  
Box(  
    modifier = Modifier  
        .animateContentSize() // 必须在尺寸修饰符前  
        .height(if (expanded) 400.dp else 200.dp)  
        .background(Color.Blue)  
) { /* ... */ }  
```  

## 三、列表项动画  

**场景**：为延迟列表（如 `LazyColumn`）中的项重新排序、增删添加动画。  
**实现方式**：  

- 使用 `animateItemPlacement()` 修饰符（需结合延迟布局）。  
- 文档建议参考“延迟布局项动画”进一步学习。  

## 四、流程图（mermaid）  

```mermaid  
graph LR  
A[动画修饰符和可组合项] --> B[内置可组合项]  
A --> C[内置修饰符]  
B --> D[AnimatedVisibility]  
B --> E[AnimatedContent]  
B --> F[Crossfade]  
C --> G[animateContentSize]  
D --> H[显隐动画]  
D --> I[子项动画(animateEnterExit)]  
E --> J[状态切换动画]  
E --> K[尺寸变换(SizeTransform)]  
F --> L[简单淡入淡出]  
G --> M[尺寸变化动画]  
G --> N[修饰符顺序要求]  
```  

## 五、核心对比  

| **组件/修饰符**      | **适用场景**                          | **核心特性**                              |  
|----------------------|---------------------------------------|------------------------------------------|  
| `AnimatedVisibility` | 元素显隐动画                          | 支持复杂进入/退出过渡组合，管理组件生命周期 |  
| `AnimatedContent`    | 多状态内容切换动画                    | 自定义过渡规格，支持尺寸变换              |  
| `Crossfade`          | 两状态简单切换动画                    | 仅淡入淡出，轻量级                        |  
| `animateContentSize` | 布局尺寸变化动画（如展开/收缩）        | 自动处理布局过渡，需注意修饰符顺序        |  

通过合理组合这些工具，可高效实现 Compose 中各种动画效果，兼顾性能与开发效率。
