# 选择动画 API  

原地址：<https://developer.android.google.cn/develop/ui/compose/animation/choose-api?hl=zh-cn>  

![图片](https://developer.android.google.cn/static/develop/ui/compose/images/animations/compose_animation_decision_tree_v2.jpg?hl=zh-cn)

## 一、决策树核心逻辑  

通过回答一系列问题，逐步筛选出适合具体场景的 Compose 动画 API。以下是关键判断节点及对应解决方案：

## 二、详细决策流程  

### 1. **是否为包含复杂视觉元素的动画（如 SVG/图片）？**  

#### **是**  

- **子问题**：是否为简单 SVG（如带微动画的图标）？  
  - **是**：使用 `AnimatedVectorDrawable`（矢量图动画框架）。  
  - **否**：使用第三方动画框架（如 **Lottie**），适用于复杂插画/视频级动画。  

#### **否**  

- **子问题**：是否需要永久循环播放？  
  - **是**：使用 `rememberInfiniteTransition`（无限循环动画过渡）。  
  - **否**：进入布局动画判断。  

### 2. **是否为布局动画（涉及可组合项布局变化）？**  

#### **是**  

- **子问题**：是否在多个不同内容的可组合项间切换？  
  - **是**：  
    - 若使用 `navigation-compose`：在 `composable` 中设置 `enterTransition` 和 `exitTransition`。  
    - 否则：使用 `AnimatedContent`、`CrossFade` 或 `Pager`（内容切换动画）。  
  - **否**：进入「出现/消失动画」判断。  

#### **否**  

- **子问题**：是否为元素出现/消失动画？  
  - **是**：使用 `AnimatedVisibility` 或结合 `animateFloatAsState` + `Modifier.alpha()` 控制透明度。  
  - **否**：进入「尺寸/布局属性动画」判断。  

### 3. **是否为尺寸变化动画？**  

#### **是**  

- 使用 `Modifier.animateContentSize()`（自动处理布局尺寸变化的动画）。  

#### **否**  

- **子问题**：是否为其他布局属性（如偏移、内边距、间距等）？  
  - **是**：  
    - **子问题**：多个属性是否完全独立？  
      - **是**：使用 `animate*AsState`（如 `animateFloatAsState`）；若为文本动画，使用 `TextMotion.Animated`。  
      - **否**：  
        - **子问题**：动画是否同时开始？  
          - **是**：使用 `updateTransition` 搭配 `AnimatedVisibility`、`animateFloat` 等。  
          - **否**：使用 `Animatable` + `animateTo()` 挂起函数（支持不同 timing 调用）。  

### 4. **其他特殊场景**  

- **列表项动画（如排序/删除）**：使用 `animateItemPlacement()`（重新排序和删除功能待更新）。  
- **手势驱动动画（如拖拽/缩放）**：使用 `Animatable` + `animateTo()` 或 `snapTo()`（动画状态由手势驱动）。  
- **一次性动画（无状态管理）**：使用 `AnimationState` 或直接调用 `animate()` 函数。  
- **未涵盖的场景**：提交功能请求（`goo.gle/compose-feedback`）。  

## 三、流程图（mermaid决策树）  

```mermaid  
graph LR  
A[选择动画API] --> B{是否为复杂视觉元素动画？<br>（如SVG/图片）}  
B -->|是| C{是否为简单SVG图标动画？}  
C -->|是| D[AnimatedVectorDrawable]  
C -->|否| E[Lottie框架]  
B -->|否| F{是否需要永久重复？}  
F -->|是| G[rememberInfiniteTransition]  
F -->|否| H{是否为布局动画？}  
H -->|是| I{是否切换多内容可组合项？}  
I -->|是| J{使用navigation-compose?}  
J -->|是| K[设置enter/exitTransition]  
J -->|否| L[AnimatedContent/CrossFade/Pager]  
I -->|否| M[AnimatedVisibility / animateFloatAsState + alpha]  
H -->|否| N{是否为尺寸动画？}  
N -->|是| O[animateContentSize()]  
N -->|否| P{是否为其他布局属性？<br>（偏移/内边距等）}  
P -->|是| Q{属性是否完全独立？}  
Q -->|是| R[animate*AsState / TextMotion.Animated]  
Q -->|否| S{是否同时开始？}  
S -->|是| T[updateTransition + animate*]  
S -->|否| U[Animatable + animateTo() 挂起函数]  
P -->|否| V{是否为列表项动画？}  
V -->|是| W[animateItemPlacement()]  
V -->|否| X{是否为手势驱动？}  
X -->|是| Y[Animatable + animateTo/snapTo]  
X -->|否| Z[AnimationState / animate()]  
```

## 四、核心API总结  

| **场景**                     | **推荐API**                          | **说明**                                                                 |  
|------------------------------|--------------------------------------|--------------------------------------------------------------------------|  
| 简单 SVG 图标动画            | `AnimatedVectorDrawable`             | 矢量图微动画，轻量级，集成于 Compose                                   |  
| 复杂插画/视频级动画          | Lottie                               | 支持 JSON 动画，适合艺术级视觉效果                                       |  
| 无限循环动画                 | `rememberInfiniteTransition`         | 配合 `animateFloat` 等实现循环动画                                       |  
| 页面切换/内容过渡            | `enterTransition`/`exitTransition`   | 与 `navigation-compose` 结合，定义页面进出动画                           |  
| 内容切换（非导航场景）       | `AnimatedContent`/`CrossFade`        | 平滑切换不同内容组件                                                     |  
| 元素显隐动画                 | `AnimatedVisibility`                 | 自动处理显示/隐藏时的动画逻辑                                           |  
| 布局尺寸变化                 | `animateContentSize()`               | 自动计算并动画化布局尺寸变化                                             |  
| 多属性独立动画               | `animate*AsState`                    | 每个属性单独驱动动画（如透明度、偏移）                                   |  
| 协同属性动画（同时开始）     | `updateTransition`                   | 统一管理多个相关属性的动画 timing                                        |  
| 手势驱动动画                 | `Animatable` + `animateTo()`         | 响应手势操作（如拖拽位置、缩放比例）                                     |  
| 列表项增删/排序动画          | `animateItemPlacement()`             | 自动处理列表项布局变化的动画（待完善删除/重新排序功能）                   |  

通过以上决策树和 API 映射，可快速定位适合具体需求的 Compose 动画解决方案，平衡开发效率与动画性能。
