# 核心注解

以下是 Jetpack Compose 中核心注解及其作用的总结，涵盖 UI 构建、状态管理、性能优化等场景：

---

## **1. `@Composable`**

- **作用**：标记一个函数为**可组合函数**，用于声明 UI 组件。  
- **特性**：  
  - 函数通过调用其他 `@Composable` 函数生成 UI。  
  - 支持响应式状态管理（自动触发重组）。  
- **示例**：  

  ```kotlin
  @Composable
  fun Greeting(text: String) {
      Text(text)
  }
  ```

---

## **2. `@Preview`**

- **作用**：在 Android Studio 中实时预览 UI 组件，无需运行应用。  
- **关键参数**：  
  - `name`：预览名称。  
  - `showBackground`：显示背景。  
  - `device`：指定设备型号（如 `"id:pixel_6"`）。  
  - `backgroundColor`：背景色（ARGB 格式）。  
- **示例**：  

  ```kotlin
  @Preview(showBackground = true, name = "默认预览")
  @Composable
  fun PreviewGreeting() {
      Greeting("Hello Android!")
  }
  ```

---

## **3. `@Stable`**

- **作用**：标记一个类或接口为**稳定类型**，告知编译器其属性变化可预测，优化重组性能。  
- **使用场景**：  
  - 自定义数据类或接口，用于 Composable 函数的参数。  
  - 类的所有公共属性均为不可变（`val`），或变化时会通知 Compose。  
- **示例**：  

  ```kotlin
  @Stable
  data class User(val name: String, val age: Int)
  ```

---

## **4. `@Immutable`**

- **作用**：标记一个类为**完全不可变类型**，所有属性在创建后不可修改（比 `@Stable` 更严格）。  
- **与 `@Stable` 的区别**：  
  - `@Immutable` 要求所有属性为 `val`，且嵌套类型也需不可变。  
  - `@Stable` 允许属性可变，但需在变化时手动通知 Compose。  
- **示例**：  

  ```kotlin
  @Immutable
  data class Config(val theme: String, val fontSize: Int)
  ```

---

## **5. `@OptIn`**

- **作用**：显式启用 Compose 的**实验性 API**（标记为 `@ExperimentalXXX` 的接口或函数）。  
- **使用场景**：访问尚未稳定的 API（如某些动画或布局功能）。  
- **示例**：  

  ```kotlin
  @OptIn(ExperimentalAnimationApi::class)
  @Composable
  fun AnimatedBox() {
      AnimatedVisibility(visible = true) { /*...*/ }
  }
  ```

---

## **6. `@Model`（已废弃，由 `@Stable` 替代）**

- **历史作用**：在早期 Compose 版本中标记可观察状态容器，现已被 `mutableStateOf` + `@Stable` 替代。

---

## **7. `@ComposableOpen`**

- **作用**：允许非 `@Composable` 函数调用 Composable 函数（主要用于底层库开发，普通开发者极少使用）。

---

## **8. `@ComposableTarget`**

- **作用**：指定 Composable 函数的目标（如 `"app"` 或 `"material"`），用于模块化构建（高级场景）。

---

## **9. `@CheckResult`**

- **作用**：提示开发者检查函数返回值（非 Compose 特有，但常用于状态管理函数）。  
- **示例**：  

  ```kotlin
  @CheckResult
  fun rememberUpdatedState(newValue: T): State<T> = /*...*/
  ```

---

## **10. `@RequiresOptIn`**

- **作用**：标记自定义的实验性 API，要求调用方显式使用 `@OptIn` 启用。  
- **示例**：  

  ```kotlin
  @RequiresOptIn(message = "此 API 正在实验中，谨慎使用！")
  annotation class ExperimentalCustomApi

  @ExperimentalCustomApi
  fun riskyFunction() { /*...*/ }
  ```

---

## **总结表格**

| 注解              | 核心作用                                                                 |
|-------------------|------------------------------------------------------------------------|
| `@Composable`     | 声明函数为 UI 组件，支持响应式更新。                                       |
| `@Preview`        | 在 IDE 中实时预览组件。                                                   |
| `@Stable`         | 标记稳定类型，优化重组逻辑。                                               |
| `@Immutable`      | 标记完全不可变类型，避免无效重组。                                         |
| `@OptIn`          | 启用实验性 API。                                                          |
| `@RequiresOptIn`  | 自定义实验性 API 的标记。                                                  |

---

## **使用注意事项**

1. **避免滥用 `@Stable`**：仅在明确类型稳定性时使用，错误标记可能导致 UI 更新异常。  
2. **实验性 API**：使用 `@OptIn` 时需评估兼容性风险。  
3. **性能优化**：通过 `@Stable` 和 `@Immutable` 减少不必要的重组。  

掌握这些注解后，可以更高效地构建高性能 Compose 应用，同时充分利用 IDE 工具链的支持。
