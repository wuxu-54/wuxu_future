# 尺寸适配

在 Android Compose 中进行尺寸适配时，需要考虑不同设备的屏幕尺寸、分辨率和像素密度。以下是几种常用的尺寸适配方法：

1. Denisty适配
2. 代码动态计算（不推荐）
3. 最小宽度限定符

## 注意

永远不要覆盖 fontScale 值，确保无障碍支持

## 1. 使用 dp (密度无关像素)

Compose 默认使用 dp 作为尺寸单位，系统会自动根据设备的像素密度进行转换：

```kotlin
Box(
    modifier = Modifier
        .width(100.dp)
        .height(50.dp)
        .background(Color.Blue)
)
```

## 2. 百分比布局

通过 `WindowInsets` 获取屏幕尺寸，然后按比例计算组件大小：

```kotlin
@Composable
fun PercentageLayoutExample() {
    val density = LocalDensity.current
    val windowInsets = WindowInsets.systemBars
    val screenWidth = with(density) { windowInsets.getInsets(WindowInsetsSides.Horizontal).left + windowInsets.getInsets(WindowInsetsSides.Horizontal).right.toDp() }
    val screenHeight = with(density) { windowInsets.getInsets(WindowInsetsSides.Vertical).top + windowInsets.getInsets(WindowInsetsSides.Vertical).bottom.toDp() }

    Box(
        modifier = Modifier
            .width(screenWidth * 0.5f) // 屏幕宽度的50%
            .height(screenHeight * 0.3f) // 屏幕高度的30%
            .background(Color.Red)
    )
}
```

## 3. 响应式布局

根据屏幕尺寸选择不同的布局策略：

```kotlin
@Composable
fun ResponsiveLayout() {
    val configuration = LocalConfiguration.current
    val screenWidthDp = configuration.screenWidthDp.dp

    when {
        screenWidthDp < 600.dp -> {
            // 手机布局
            MobileLayout()
        }
        screenWidthDp < 840.dp -> {
            // 平板布局
            TabletLayout()
        }
        else -> {
            // 大屏设备布局
            LargeScreenLayout()
        }
    }
}
```

## 4. 尺寸系统抽象

创建自定义尺寸系统，根据设计稿进行映射：

```kotlin
// 尺寸系统
object Dimens {
    val spacingSmall = 8.dp
    val spacingMedium = 16.dp
    val spacingLarge = 24.dp
    
    val textSizeSmall = 14.sp
    val textSizeMedium = 16.sp
    val textSizeLarge = 20.sp
}

// 使用自定义尺寸
Text(
    text = "Hello World",
    fontSize = Dimens.textSizeMedium,
    modifier = Modifier.padding(Dimens.spacingMedium)
)
```

## 5. 缩放尺寸

根据设备屏幕密度或字体偏好动态调整尺寸：

```kotlin
@Composable
fun ScaledDimensExample() {
    val scaleFactor = 1.2f // 根据需要调整缩放因子
    
    Box(
        modifier = Modifier
            .width(100.dp * scaleFactor)
            .height(50.dp * scaleFactor)
            .background(Color.Green)
    )
}
```

## 6. 使用 ConstraintLayout

使用约束布局可以更灵活地控制组件尺寸和位置：

```kotlin
@Composable
fun ConstraintLayoutExample() {
    ConstraintLayout {
        val (box1, box2) = createRefs()
        
        Box(
            modifier = Modifier
                .constrainAs(box1) {
                    start.linkTo(parent.start, margin = 16.dp)
                    top.linkTo(parent.top, margin = 16.dp)
                    width = Dimension.percent(0.4f) // 父容器宽度的40%
                    height = Dimension.value(100.dp)
                }
                .background(Color.Yellow)
        )
        
        Box(
            modifier = Modifier
                .constrainAs(box2) {
                    start.linkTo(box1.end, margin = 16.dp)
                    top.linkTo(parent.top, margin = 16.dp)
                    end.linkTo(parent.end, margin = 16.dp)
                    width = Dimension.fillToConstraints
                    height = Dimension.value(100.dp)
                }
                .background(Color.Magenta)
        )
    }
}
```

## 7. 字体适配

使用 `sp` (缩放独立像素) 单位确保字体大小随用户偏好缩放：

```kotlin
Text(
    text = "Hello Compose",
    fontSize = 18.sp, // 会根据用户字体大小偏好自动缩放
    fontWeight = FontWeight.Bold
)
```

## 8. 处理不同屏幕方向

使用 `rememberOrientationState` 或监听配置变化：

```kotlin
@Composable
fun OrientationExample() {
    val orientation = LocalConfiguration.current.orientation
    
    if (orientation == Configuration.ORIENTATION_LANDSCAPE) {
        LandscapeLayout()
    } else {
        PortraitLayout()
    }
}
```

## 9. 使用 WindowInsets 处理系统窗口

避免内容被状态栏、导航栏等遮挡：

```kotlin
@Composable
fun WindowInsetsExample() {
    val insets = WindowInsets.systemBars.asPaddingValues()
    
    Box(
        modifier = Modifier
            .fillMaxSize()
            .padding(insets)
            .background(Color.Cyan)
    ) {
        // 内容不会被系统窗口遮挡
    }
}
```

## 10. 预览不同屏幕尺寸

使用 `@Preview` 注解预览不同设备的布局效果：

```kotlin
@Preview(name = "Phone", widthDp = 360, heightDp = 640)
@Preview(name = "Tablet", widthDp = 600, heightDp = 1024)
@Composable
fun PreviewExample() {
    MyAppTheme {
        MyScreenContent()
    }
}
```

## 总结

Android Compose 提供了多种尺寸适配方式，推荐的最佳实践包括：

1. 使用 dp 和 sp 作为基本单位
2. 通过百分比或约束布局实现响应式设计
3. 为不同屏幕尺寸提供不同的布局方案
4. 处理系统窗口插入以避免内容被遮挡
5. 利用预览功能测试不同设备的显示效果

这些方法结合使用可以确保应用在各种 Android 设备上都能提供良好的用户体验。
