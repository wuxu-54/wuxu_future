# å¼€å‘ Android TV åº”ç”¨

ä»¥ä¸‹æ˜¯ä½¿ç”¨ Jetpack Compose å¼€å‘ Android TV åº”ç”¨çš„å…¨é¢æŒ‡å—ï¼Œç»“åˆæ ¸å¿ƒçŸ¥è¯†ç‚¹ã€æœ€ä½³å®è·µåŠå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆæ•´ç†è€Œæˆï¼š

---

## âš™ï¸ **ä¸€ã€å¼€å‘ç¯å¢ƒé…ç½®**

1. **ä¾èµ–åº“é…ç½®**  
   åœ¨ `build.gradle` ä¸­æ·»åŠ  TV ä¸“ç”¨ Compose ä¾èµ–ï¼š

   ```kotlin
   dependencies {
       implementation("androidx.tv:tv-foundation:1.0.0") // TV ä¸“ç”¨ç»„ä»¶åº“
       implementation("androidx.tv:tv-material:1.0.0")   // TV ç‰ˆ Material è®¾è®¡
   }
   ```

2. **AndroidManifest å…³é”®é…ç½®**  
   åœ¨ `AndroidManifest.xml` ä¸­å£°æ˜ TV ç‰¹æ€§ï¼š

   ```xml
   <activity
       android:name=".MainActivity"
       android:screenOrientation="landscape" <!-- TV å›ºå®šæ¨ªå± -->
       android:isGame="false" <!-- éæ¸¸æˆåº”ç”¨ -->
       android:enableOnBackInvokedCallback="true"> <!-- Android 13+ è¿”å›é”®æ”¯æŒ -->
       <intent-filter>
           <action android:name="android.intent.action.MAIN" />
           <category android:name="android.intent.category.LEANBACK_LAUNCHER" /> <!-- TV ä¸»å±å…¥å£ -->
       </intent-filter>
   </activity>
   ```

---

## ğŸ¯ **äºŒã€ç„¦ç‚¹ç®¡ç†ï¼ˆTV åº”ç”¨æ ¸å¿ƒï¼‰**

1. **åŸºç¡€ç„¦ç‚¹æ§åˆ¶**  
   - ä½¿ç”¨ `Modifier.focusable()` ä½¿ç»„ä»¶å¯èšç„¦ã€‚
   - ç›‘å¬ç„¦ç‚¹å˜åŒ–ï¼š`Modifier.onFocusChanged { state -> ... }`ã€‚

   ```kotlin
   Button(
       onClick = {},
       modifier = Modifier
           .focusable()
           .onFocusChanged { state -> 
               isFocused = state.isFocused 
           }
   ) { ... }
   ```

2. **è‡ªå®šä¹‰ç„¦ç‚¹é¡ºåº**  
   é€šè¿‡ `FocusRequester` å’Œ `focusOrder` å®šä¹‰å¯¼èˆªé“¾ï¼š

   ```kotlin
   val (item1, item2) = FocusRequester.createRefs()
   Row {
       Button(
           modifier = Modifier.focusOrder(item1) { next = item2 },
           onClick = {}
       )
       Button(
           modifier = Modifier.focusOrder(item2) { previous = item1 },
           onClick = {}
       )
   }
   ```

3. **æ–¹å‘é”®å¯¼èˆª**  
   æŒ‡å®šæ–¹å‘é”®çš„ç„¦ç‚¹è·³è½¬ç›®æ ‡ï¼š

   ```kotlin
   Modifier.focusProperties {
       down = nextItemFocusRequester // æŒ‰ä¸‹â†“é”®è·³è½¬è‡³ nextItem
       right = rightItemFocusRequester
   }
   ```

---

## ğŸ“º **ä¸‰ã€TV ä¸“ç”¨ç»„ä»¶**

1. **æ¨ªå‘åˆ—è¡¨ (`LazyRow`)**  
   TV åº”ç”¨ä¸»è¦ä½¿ç”¨æ¨ªå‘å¸ƒå±€ï¼Œéœ€é…åˆç„¦ç‚¹ä¼˜åŒ–ï¼š

   ```kotlin
   LazyRow {
       items(items) { item ->
           Card(
               modifier = Modifier
                   .onFocusChanged { /* å¤„ç†ç„¦ç‚¹è§†è§‰åé¦ˆ */ }
                   .focusable()
           ) { ... }
       }
   }
   ```

2. **ç„¦ç‚¹è§†è§‰å¢å¼º**  
   ä½¿ç”¨ `tv-material` ä¸­çš„ `Card` æˆ– `Button`ï¼Œé»˜è®¤æä¾›æ”¾â¼¤æ•ˆæœå’Œè¾¹æ¡†é«˜äº®ï¼š

   ```kotlin
   androidx.tv.material3.Card(
       onClick = {},
       modifier = Modifier.focusable()
   ) { ... }
   ```

---

## ğŸ•¹ï¸ **å››ã€å¯¼èˆªä¸æŒ‰é”®å¤„ç†**

1. **ç‰©ç†æŒ‰é”®ç›‘å¬**  
   ä½¿ç”¨ `Modifier.onKeyEvent` å¤„ç†é¥æ§å™¨æŒ‰é”®ï¼š

   ```kotlin
   Modifier
       .focusable()
       .onKeyEvent { event ->
           if (event.key == Key.DirectionRight) {
               // å¤„ç†å³é”®é€»è¾‘
               true // äº‹ä»¶å·²æ¶ˆè´¹
           } else false
       }
   ```

2. **å…¨å±€ç„¦ç‚¹ç®¡ç†**  
   é€šè¿‡ `FocusManager` è·¨ç»„ä»¶ç§»åŠ¨ç„¦ç‚¹ï¼š

   ```kotlin
   val focusManager = LocalFocusManager.current
   Button(onClick = { focusManager.moveFocus(FocusDirection.Next) }) {
       Text("è·³è‡³ä¸‹ä¸€ä¸ªç„¦ç‚¹é¡¹")
   }
   ```

---

## âš¡ **äº”ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§**

1. **é¿å…ç„¦ç‚¹è·³è·ƒé—®é¢˜**  
   - ä½¿ç”¨æœ€æ–° Compose TV ç‰ˆæœ¬ï¼ˆâ‰¥1.3.0ï¼‰ï¼Œä¿®å¤äº†æ—©æœŸç‰ˆæœ¬çš„ç„¦ç‚¹è·³è·ƒ Bugã€‚
   - é¿å…åœ¨ `LazyColumn/LazyRow` çš„ `onFocusChanged` ä¸­è§¦å‘æ»šåŠ¨é€»è¾‘ã€‚

2. **å¼‚æ­¥åŠ è½½ä¼˜åŒ–**  
   ä½¿ç”¨ `LaunchedEffect` åŠ è½½æ•°æ®ï¼Œé¿å…é˜»å¡ UI çº¿ç¨‹ï¼š

   ```kotlin
   LaunchedEffect(Unit) {
       data = fetchData() // åå°æ•°æ®åŠ è½½
   }
   ```

---

## âš ï¸ **å…­ã€å¸¸è§é—®é¢˜è§£å†³**

1. **ç„¦ç‚¹ä¸¢å¤±**  
   - ä½¿ç”¨ `rememberSaveable` ä¿å­˜ç„¦ç‚¹çŠ¶æ€ã€‚
   - é‡ç»„åé€šè¿‡ `FocusRequester` é‡æ–°è¯·æ±‚ç„¦ç‚¹ï¼š

     ```kotlin
     LaunchedEffect(key) {
         focusRequester.requestFocus()
     }
     ```

2. **TV æ¨¡æ‹Ÿå™¨è°ƒè¯•**  
   - åœ¨ Android Studio ä¸­åˆ›å»º TV æ¨¡æ‹Ÿå™¨ï¼ˆé€‰æ‹© Android TV ç³»ç»Ÿé•œåƒï¼‰ã€‚
   - çœŸæœºè°ƒè¯•éœ€å¼€å¯å¼€å‘è€…æ¨¡å¼å¹¶å…è®¸ ADB è¿æ¥ã€‚

3. **é¥æ§å™¨æŒ‰é”®æ— å“åº”**  
   æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ·»åŠ  `focusable()` å¹¶ç¡®ä¿ç„¦ç‚¹é“¾æœªä¸­æ–­ã€‚

---

## ğŸ“ **ä¸ƒã€å®Œæ•´ç¤ºä¾‹ï¼šTV é¦–é¡µå¸ƒå±€**

```kotlin
@Composable
fun TvHomeScreen() {
    val focusManager = LocalFocusManager.current
    val movieList = remember { generateMovies() }
    val (featuredFocus, listFocus) = FocusRequester.createRefs()

    Column {
        // é¡¶éƒ¨æ¨ªå¹…
        BannerItem(
            modifier = Modifier.focusRequester(featuredFocus),
            onFocus = { /* é«˜äº®å¤„ç† */ }
        )

        // æ¨ªå‘ç”µå½±åˆ—è¡¨
        LazyRow(
            modifier = Modifier.focusRequester(listFocus),
            state = rememberLazyListState()
        ) {
            items(movieList) { movie ->
                MovieCard(
                    movie,
                    Modifier
                        .onFocusChanged { /* ç¼©æ”¾åŠ¨ç”» */ }
                        .focusable()
                )
            }
        }
    }

    // è®¾ç½®åˆå§‹ç„¦ç‚¹é¡ºåº
    LaunchedEffect(Unit) {
        featuredFocus.requestFocus()
        focusManager.setFocusProperties {
            down = listFocus // æŒ‰â†“é”®ä»æ¨ªå¹…è·³è½¬åˆ°åˆ—è¡¨
        }
    }
}
```

---

## âœ… **æœ€ä½³å®è·µæ€»ç»“**

1. **è®¾è®¡è§„èŒƒ**ï¼šéµå¾ª [TV Design Guidelines](https://developer.android.com/design/tv)ï¼Œç¡®ä¿å­—ä½“/é—´è·é€‚é…å¤§å±ã€‚
2. **ç„¦ç‚¹åé¦ˆ**ï¼šå§‹ç»ˆä¸ºç„¦ç‚¹é¡¹æä¾›è§†è§‰å˜åŒ–ï¼ˆç¼©æ”¾/è¾¹æ¡†ï¼‰ã€‚
3. **æµ‹è¯•è¦†ç›–**ï¼šä½¿ç”¨ D-Pad é¥æ§å™¨æ¨¡æ‹Ÿæ‰€æœ‰å¯¼èˆªè·¯å¾„ã€‚
4. **æ€§èƒ½ç›‘æ§**ï¼šé€šè¿‡ Android Studio Profiler æ£€æŸ¥é‡ç»„æ¬¡æ•°å’Œå¸§ç‡ã€‚

> æ›´å¤šå®è·µæ¡ˆä¾‹å¯å‚è€ƒå¼€æºé¡¹ç›® [ComposeTv](https://github.com/UmairKhalid786/ComposeTv) ã€‚é‡åˆ°å¤æ‚ç„¦ç‚¹é—®é¢˜å»ºè®®æŸ¥çœ‹å®˜æ–¹ [Compose TV Samples](https://github.com/android/tv-samples)ã€‚
