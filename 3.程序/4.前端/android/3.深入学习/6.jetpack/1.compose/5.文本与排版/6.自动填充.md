
# Compose 中的自动填充  

原地址：<https://developer.android.google.cn/develop/ui/compose/text/autofill?hl=zh-cn>  

## 一、自动填充功能概述  

### 1.1 核心作用  

- **填写凭据**：用户点击字段时，系统显示自动填充建议（如已保存的用户名/密码），支持输入内容过滤。  
- **保存凭据**：用户输入新信息或离开页面时，系统提示保存数据，支持显式提交（按钮）或隐式保存（导航离开）。  
- **适用组件**：基于 `BasicTextField` 的所有 Compose 文本组件（如 `TextField`、`Material Design` 文本字段）。  

### 1.2 优势  

- 减少用户输入耗时与错误。  
- 支持密码管理器等自动填充服务交互。  

## 二、启用自动填充的前提条件  

### 2.1 系统设置配置  

- **操作路径**：设备「设置」→「自动填充和辅助功能」→「自动填充服务」，选择凭据提供程序（如 Google Password Manager）。  
- **作用**：确保系统能存储和检索用户凭据。  

## 三、在文本字段中添加自动填充功能  

### 3.1 使用 `ContentType` 声明字段类型  

- **单一类型**：通过 `Modifier.semantics` 设置字段接受的数据类型，示例：  

  ```kotlin  
  TextField(  
      value = username,  
      onValueChange = { username = it },  
      modifier = Modifier.semantics { contentType = ContentType.Username }  
  )  
  ```  

  - 常见类型：`Username`、`EmailAddress`、`Password`、`NewPassword` 等。  

- **多种类型**：使用 `+` 运算符组合类型（如字段可接受用户名或邮箱）：  

  ```kotlin  
  TextField(  
      modifier = Modifier.semantics { contentType = ContentType.Username + ContentType.EmailAddress }  
  )  
  ```  

### 3.2 自动填充交互效果  

- **填写阶段**：点击字段时，键盘上方显示自动填充建议条（如已保存的凭据），用户可直接选择填充。  
- **保存阶段**：  
  - **隐式保存**：用户导航离开页面时，系统自动触发保存提示。  
  - **显式保存**：通过 `LocalAutofillManager` 手动提交上下文，示例：  

    ```kotlin  
    val autofillManager = LocalAutofillManager.current  
    Button(onClick = { autofillManager.commit() }) {  
        Text("保存凭据")  
    }  
    ```  

## 四、高级功能：安全密码建议  

### 4.1 触发条件  

- 当字段 `ContentType` 设置为 `NewPassword` 或 `NewUsername+NewPassword` 组合时，系统可能显示「建议安全密码」按钮（取决于凭据提供程序）。  

### 4.2 用户体验流程  

1. 用户点击密码字段的建议按钮，系统生成强密码。  
2. 底部弹出提示条，用户可选择「使用密码」或取消，密码自动保存至凭据提供程序。  

## 五、自定义与调试  

### 5.1 自定义自动填充高亮颜色  

- **默认颜色**：`Color(0x4dffeb3b)`（半透明黄色）。  
- **自定义方法**：通过 `CompositionLocalProvider` 提供新颜色：  

  ```kotlin  
  CompositionLocalProvider(LocalAutofillHighlightColor provides Color.Red) {  
      TextField(/* 组件 */)  
  }  
  ```  

### 5.2 问题排查  

- **保存提示消失**：若多次点击「以后再说」，凭据提供程序可能屏蔽提示。  
  - **解决方案**：进入设备「设置」→「应用管理」→ 找到目标应用 → 清除「自动填充」相关数据或缓存。  

## 六、流程图  

```mermaid  
flowchart TD  
    A[启用自动填充流程] --> B[系统设置：选择凭据提供程序]  
    A --> C[文本字段设置 ContentType]  
    C --> D[单一类型或组合类型（如 Username + EmailAddress）]  
    D --> E{用户操作}  
    E -->|点击字段| F[显示自动填充建议条，选择填充]  
    E -->|输入完成| G{保存方式}  
    G -->|隐式（导航离开）| H[系统自动触发保存提示]  
    G -->|显式（点击按钮）| I[调用 autofillManager.commit() 触发保存]  
    A --> J[密码字段场景]  
    J --> K[触发安全密码建议按钮]  
    J --> L[用户选择建议密码，自动保存]  
    A --> M[可选：自定义高亮颜色]  
    M --> N[通过 LocalAutofillHighlightColor 提供新颜色]  
    A --> O[问题排查]  
    O --> P[清除应用自动填充数据，重新启用提示]  
```  

## 七、关键代码示例汇总  

| 场景                | 代码示例                                                                 |  
|---------------------|--------------------------------------------------------------------------|  
| 单一类型自动填充    | `Modifier.semantics { contentType = ContentType.Username }`              |  
| 多种类型组合        | `Modifier.semantics { contentType = ContentType.Username + ContentType.EmailAddress }` |  
| 显式保存凭据        | `autofillManager.commit()`                                               |  
| 自定义高亮颜色      | `CompositionLocalProvider(LocalAutofillHighlightColor provides Color.Blue) { ... }` |
