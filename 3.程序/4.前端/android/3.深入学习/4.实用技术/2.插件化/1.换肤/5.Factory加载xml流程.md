# Factory接口

android 中LayoutInflater加载流程会在源码分析目录中详细描述，这里简单描述下流程，换肤时可以通过实现Factory接口在对View的创建时做些处理达到快速换肤的效果。（简单来说，在这个实现类中，记录每一个view，换肤时直接获取view的对象进行皮肤更换）

## 简介

`Factory2` 是 Android 中 `LayoutInflater` 的一个工厂接口，用于自定义视图的创建过程。当 `LayoutInflater` 需要根据 XML 布局文件创建视图时，它会使用 `Factory2` 接口。`Factory2` 接口继承自 `Factory` 接口，并添加了一些新的方法，使其功能更加强大。

以下是 `Factory2` 加载流程的概述：

1. **XML布局文件解析**：当 Activity 或 Fragment 需要加载一个布局时，它会请求 `LayoutInflater` 来解析 XML 文件并创建相应的视图结构。

2. **Factory2的设置**：开发者可以通过 `LayoutInflater` 的 `setFactory2()` 方法来设置一个 `Factory2` 实例。这个实例将在解析 XML 布局文件时被用来创建视图。

3. **视图创建**：`LayoutInflater` 会遍历 XML 文件中的标签，并根据标签名创建视图。对于每个标签，`LayoutInflater` 会调用 `Factory2` 的 `onCreateView()` 方法。

4. **自定义视图返回**：在 `Factory2` 的实现中，开发者可以自定义视图的创建过程。如果 `onCreateView()` 方法返回一个视图对象，那么这个视图就会被添加到视图树中。

5. **默认视图创建**：如果 `Factory2` 的 `onCreateView()` 方法返回 `null`，`LayoutInflater` 将使用其默认的视图创建逻辑来创建视图。

6. **AppCompatActivity与Factory2**：当使用 `AppCompatActivity` 作为基类时，`AppCompatActivity` 会设置自己的 `Factory2` 来确保向后兼容性，并自动将旧版本的视图替换为 `AppCompat` 版本的视图（例如，将 `TextView` 替换为 `AppCompatTextView`）。

7. **兼容AppCompatActivity**：如果开发者希望在使用 `AppCompatActivity` 的同时使用自定义的 `Factory2`，可以通过代理给 `AppCompatDelegate` 的 `createView()` 方法，或者通过重写 `viewInflaterClass` 属性来实现。

8. **完成视图加载**：一旦所有的视图都被创建并添加到视图树中，`LayoutInflater` 将完成视图的加载过程，并将最终的视图返回给请求者。

通过 `Factory2`，开发者可以深入自定义视图的创建过程，这在实现自定义组件或主题时非常有用。
