# 简介

AspectJ 是一个面向切面编程（AOP）的框架，它允许开发者将横切关注点（如日志记录、安全性、事务管理等）与业务逻辑分离，从而提高代码的模块化和可维护性。AspectJ 的核心概念包括：

1. **切面（Aspect）**：
   - 切面是封装横切关注点的类。它包含通知（Advice）和切点（Pointcut）。

2. **连接点（Join Point）**：
   - 连接点是程序执行过程中的一个点，如方法调用或字段访问。

3. **切点（Pointcut）**：
   - 切点是一组匹配连接点的规则，用于定义切面应该应用到哪些连接点上。

4. **通知（Advice）**：
   - 通知是切面的一部分，它定义了在切点匹配的连接点上应该执行的动作。通知有多种类型，包括：
     - `@Before`：在连接点之前执行。
     - `@After`：在连接点之后执行。
     - `@Around`：包围连接点，可以在连接点前后执行代码。
     - `@AfterReturning`：在连接点成功执行后执行。
     - `@AfterThrowing`：在连接点抛出异常后执行。

5. **织入（Weaving）**：
   - 织入是将切面应用到目标对象的过程。AspectJ 支持编译时织入、编译后织入和加载时织入。

6. **引入（Introduction）**：
   - 引入允许为现有的类动态地添加新的字段或方法。

7. **类型模式（Type Pattern）**：
   - 类型模式用于匹配特定的类或接口。

8. **异常处理（Exception Handling）**：
   - AspectJ 允许开发者定义异常处理逻辑，以便在抛出特定异常时执行。

## 注意

1. Join Point 用于表示程序中可以被 AOP 框架拦截的点。Pointcut 用于定义切面逻辑应该应用到哪些 Join Point 上。（说白了，Join Point是载有目标信息的所有切入点，Pointcut负责筛选出JoinPoint中需要的切入点）

## 示例

AspectJ 的使用示例可能包括：

```java
@Aspect
@Component
public class LoggingAspect { // 这个类是切面，表示要做切入操作

    @Before("execution(* com.example.service.*.*(..))")//execution(* com.example.service.*.*(..)) 目标切点，通过方法签名匹配到具体的切入点（pointcut），可以是函数、类、变量等等
    public void logBefore() {
        // 记录方法执行前的日志
    }

    @AfterReturning(pointcut = "execution(* com.example.service.*.*(..))", returning = "result")
    public void logAfterReturning(Object result) { // 此函数就是通知，收到切入点触发的通知并进行逻辑操作
        // 记录方法成功执行后的日志
    }

    @Around("execution(* com.example.service.*.*(..))")
    public Object logAround(ProceedingJoinPoint joinPoint) throws Throwable {
        // 记录方法执行前后的日志
        try {
            return joinPoint.proceed();
        } finally {
            // 记录方法执行后的日志
        }
    }
}
```

在这个示例中，`LoggingAspect` 定义了三种通知，分别在方法执行前、执行后和执行前后记录日志。

要在项目中使用 AspectJ，你需要添加 AspectJ 的依赖项，并配置 AspectJ 的编译器和织入。在 Maven 项目中，你可以添加以下依赖：

```xml
<dependency>
    <groupId>org.aspectj</groupId>
    <artifactId>aspectjrt</artifactId>
    <version>1.9.5</version>
</dependency>
<dependency>
    <groupId>org.aspectj</groupId>
    <artifactId>aspectjweaver</artifactId>
    <version>1.9.5</version>
</dependency>
```

然后，你可以使用 AspectJ 的编译器（ajc）来编译你的项目，确保切面被正确织入。在 Spring 项目中，你还需要配置 `@EnableAspectJAutoProxy` 来启用 AspectJ 的自动代理功能。

AspectJ 是一个强大的 AOP 框架，可以帮助你编写更干净、更模块化的代码。通过使用 AspectJ，你可以将横切关注点从业务逻辑中分离出来，提高代码的可读性和可维护性。

---

## 通知类型

AspectJ 支持多种类型的通知（Advice），这些通知可以在程序执行的不同点插入额外的行为。以下是 AspectJ 支持的通知类型：

1. **前置通知（Before）**：
   在目标方法执行之前执行的通知。它可以在方法调用之前运行，用于执行权限检查、日志记录等。

   ```java
   @Before("execution(* com.example..*(..))")
   public void beforeAdvice(JoinPoint joinPoint) {
       // ...
   }
   ```

2. **后置通知（After）**：
   在目标方法成功执行后执行的通知。它总是在方法返回后执行，无论方法是否抛出异常。

   ```java
   @After("execution(* com.example..*(..))")
   public void afterAdvice() {
       // ...
   }
   ```

3. **返回通知（AfterReturning）**：
   在目标方法成功返回后执行的通知。它允许访问方法的返回值。

   ```java
   @AfterReturning(pointcut = "execution(* com.example..*(..))", returning = "result")
   public void afterReturningAdvice(Object result) {
       // ...
   }
   ```

4. **异常通知（AfterThrowing）**：
   在目标方法抛出异常后执行的通知。它允许访问抛出的异常对象。

   ```java
   @AfterThrowing(pointcut = "execution(* com.example..*(..))", throwing = "error")
   public void afterThrowingAdvice(Throwable error) {
       // ...
   }
   ```

5. **环绕通知（Around）**：
   包围目标方法执行的通知。它允许在方法调用前后执行代码，并且可以决定是否继续执行原方法或替换其返回值。

   ```java
   @Around("execution(* com.example..*(..))")
   public Object aroundAdvice(ProceedingJoinPoint joinPoint) throws Throwable {
       Object result = null;
       try {
           result = joinPoint.proceed(); // 执行原方法
       } catch (Throwable throwable) {
           // 处理异常
       }
       return result;
   }
   ```

6. **引入通知（Declare Parents）**：
   用于在已有的类中引入新的接口或类。这不是直接应用于方法执行的通知，而是用于修改类的结构。

   ```java
   @DeclareParents(typesMatching = "com.example..*", defaultImpl = MyInterfaceImpl.class)
   public MyInterface myInterface;
   ```

7. **引入字段通知（DeclareMixin）**：
   类似于 `Declare Parents`，但它用于引入新的字段（Mixin）。

   ```java
   @DeclareMixin("com.example..*")
   public MixinModule mixinModule;
   ```

8. **预处理通知（BeforePreprocess）**：
   在前置通知执行之前执行的通知，主要用于 Java 5 之前的版本。

9. **后处理通知（AfterPreprocess）**：
   在后置通知执行之前执行的通知，主要用于 Java 5 之前的版本。

这些通知类型为 AspectJ 提供了强大的灵活性，允许开发者在不修改原有代码的情况下，为程序添加各种横切关注点。
