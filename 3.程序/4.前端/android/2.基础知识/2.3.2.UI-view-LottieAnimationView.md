# LottieAnimationView

`LottieAnimationView` 是一个用于在 Android 和 iOS 应用中展示高质量动画的开源库，它由 Airbnb 开发。Lottie 可以将 Adobe After Effects 动画导出为 JSON 文件，然后在应用中播放这些动画，极大地提高了动画的开发效率和灵活性。

[在线效果展示网站](https://www.bejson.com/ui/lottie/)

以下是 `LottieAnimationView` 在 Android 中的详细用法：

## 1. 添加依赖

在项目的 `build.gradle` 文件中添加 Lottie 库的依赖：

```groovy
implementation 'com.airbnb.android:lottie:6.1.0' // 请根据最新版本更新
```

## 2. 在布局文件中添加 `LottieAnimationView`

在你的 XML 布局文件中添加 `LottieAnimationView` 控件，示例如下：

```xml
<com.airbnb.lottie.LottieAnimationView
    android:id="@+id/lottieAnimationView"
    android:layout_width="200dp"
    android:layout_height="200dp"
    android:layout_gravity="center"
    app:lottie_autoPlay="true"
    app:lottie_loop="true"
    app:lottie_rawRes="@raw/your_animation" />
```

上述代码中各属性的含义如下：

- `app:lottie_autoPlay`：是否自动播放动画，值为 `true` 或 `false`。
- `app:lottie_loop`：是否循环播放动画，值为 `true` 或 `false`。
- `app:lottie_rawRes`：指定动画的 JSON 文件资源，需将 JSON 文件放在 `res/raw` 目录下。

## 3. 在 Java 或 Kotlin 代码中控制动画

### Java 示例

```java
import android.os.Bundle;
import androidx.appcompat.app.AppCompatActivity;
import com.airbnb.lottie.LottieAnimationView;

public class MainActivity extends AppCompatActivity {

    private LottieAnimationView lottieAnimationView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        lottieAnimationView = findViewById(R.id.lottieAnimationView);

        // 手动播放动画
        lottieAnimationView.playAnimation();

        // 暂停动画
        lottieAnimationView.pauseAnimation();

        // 停止动画
        lottieAnimationView.cancelAnimation();

        // 设置动画进度
        lottieAnimationView.setProgress(0.5f);

        // 设置动画重复次数
        lottieAnimationView.setRepeatCount(2);

        // 监听动画播放完成事件
        lottieAnimationView.addAnimatorListener(new android.animation.Animator.AnimatorListener() {
            @Override
            public void onAnimationStart(android.animation.Animator animation) {
                // 动画开始时的操作
            }

            @Override
            public void onAnimationEnd(android.animation.Animator animation) {
                // 动画结束时的操作
            }

            @Override
            public void onAnimationCancel(android.animation.Animator animation) {
                // 动画取消时的操作
            }

            @Override
            public void onAnimationRepeat(android.animation.Animator animation) {
                // 动画重复时的操作
            }
        });
    }
}
```

### Kotlin 示例

```kotlin
import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity
import com.airbnb.lottie.LottieAnimationView

class MainActivity : AppCompatActivity() {

    private lateinit var lottieAnimationView: LottieAnimationView

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        lottieAnimationView = findViewById(R.id.lottieAnimationView)

        // 手动播放动画
        lottieAnimationView.playAnimation()

        // 暂停动画
        lottieAnimationView.pauseAnimation()

        // 停止动画
        lottieAnimationView.cancelAnimation()

        // 设置动画进度
        lottieAnimationView.progress = 0.5f

        // 设置动画重复次数
        lottieAnimationView.repeatCount = 2

        // 监听动画播放完成事件
        lottieAnimationView.addAnimatorListener(object : android.animation.Animator.AnimatorListener {
            override fun onAnimationStart(animation: android.animation.Animator) {
                // 动画开始时的操作
            }

            override fun onAnimationEnd(animation: android.animation.Animator) {
                // 动画结束时的操作
            }

            override fun onAnimationCancel(animation: android.animation.Animator) {
                // 动画取消时的操作
            }

            override fun onAnimationRepeat(animation: android.animation.Animator) {
                // 动画重复时的操作
            }
        })
    }
}
```

## 4. 从其他来源加载动画

除了从 `raw` 资源加载动画，还可以从网络、文件或 `Assets` 目录加载动画：

```java
// 从网络加载动画
lottieAnimationView.setAnimationFromUrl("https://example.com/your_animation.json");

// 从 Assets 目录加载动画
pBinding.viewQrCodeScan.setAnimation("security_qr_scan_anim.json")//这是个重载方法，具体请看源码
```

## 5. 性能优化

为了提高性能，可以使用 `LottieCompositionFactory` 预加载动画：

```java
import com.airbnb.lottie.LottieCompositionFactory;
import com.airbnb.lottie.LottieComposition;
import com.airbnb.lottie.LottieDrawable;

LottieCompositionFactory.fromRawRes(this, R.raw.your_animation)
    .addListener(new LottieListener<LottieComposition>() {
        @Override
        public void onResult(LottieComposition composition) {
            lottieAnimationView.setComposition(composition);
            lottieAnimationView.playAnimation();
        }
    })
    .addFailureListener(new LottieListener<Throwable>() {
        @Override
        public void onResult(Throwable throwable) {
            // 处理加载失败的情况
        }
    });
```

通过以上步骤，你可以在 Android 应用中使用 `LottieAnimationView` 展示各种复杂的动画。
