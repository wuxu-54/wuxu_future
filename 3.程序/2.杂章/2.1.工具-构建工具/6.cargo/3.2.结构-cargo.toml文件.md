# cargo.toml 文件

以下是 Rust 项目配置文件 `Cargo.toml` 的核心结构和字段详解，按功能分类整理：

---

## **1. `[package]` 区块：包元数据**

定义包的元信息，是 `Cargo.toml` 的核心部分。

```toml
[package]
name = "my_project"         # 包名（必须，仅允许字母、数字、下划线和短横线）
version = "0.1.0"           # 版本号（必须，遵循语义化版本规范）
edition = "2021"            # Rust 版本（可选，默认2015，常用2021）
authors = ["Alice <alice@example.com>"]
description = "A short description"  # 包简介（发布到 crates.io 时必需）
license = "MIT OR Apache-2.0"        # 许可证（发布时必需）
repository = "https://github.com/username/repo"  # 代码仓库地址
keywords = ["cli", "tools"]         # 关键词（用于 crates.io 搜索）
categories = ["command-line-utilities"]  # 分类（crates.io 的官方分类列表）
readme = "README.md"                # 项目 README 文件路径
```

---

## **2. `[dependencies]` 区块：依赖管理**

声明项目依赖的第三方库。

```toml
[dependencies]
serde = "1.0"               # 从 crates.io 获取最新 1.x 版本
rand = { version = "0.8", features = ["small_rng"] }  # 指定版本和启用特性
reqwest = { version = "0.11", default-features = false }  # 禁用默认特性
my_local_crate = { path = "../path/to/crate" }  # 本地路径依赖
tokio = { git = "https://github.com/tokio-rs/tokio", branch = "master" }  # Git 依赖
```

### **依赖版本语法**

- `^1.2.3`：允许 1.x.x（x ≥ 2.且不破坏语义化版本）
- `~1.2.3`：允许 1.2.x（x ≥ 3）
- `1.2.*`：允许 1.2.x
- `=1.2.3`：严格等于 1.2.3

---

## **3. `[dev-dependencies]` 与 `[build-dependencies]`**

- **`[dev-dependencies]`**：仅用于测试和示例的依赖。
- **`[build-dependencies]`**：构建脚本（`build.rs`）的依赖。

```toml
[dev-dependencies]
tempfile = "3.3"  # 仅在运行测试时使用

[build-dependencies]
cc = "1.0"       # 构建时需要的依赖
```

---

## **4. `[features]` 区块：条件编译特性**

定义可选特性，用于启用/禁用代码或依赖。

```toml
[features]
default = ["web"]          # 默认启用的特性
web = ["dep1", "dep2/web"] # 定义一个名为 "web" 的特性，并关联依赖
advanced = []              # 无依赖的特性（用于代码中的 `#[cfg(feature = "advanced")]`）

# 依赖的特定特性
[dependencies]
dep1 = { version = "1.0", optional = true }  # 可选依赖
dep2 = { version = "2.0", features = [] }    # 默认不启用任何特性
```

---

## **5. `[workspace]` 区块：多包工作区**

管理包含多个子包的项目。

```toml
[workspace]
members = ["crates/*", "tools"]  # 子包路径
exclude = ["crates/experimental"] # 排除目录
resolver = "2"                   # 依赖解析器版本（解决不同包的依赖冲突）
```

---

## **6. `[lib]` 与 `[[bin]]` 区块：自定义构建目标**

指定库或二进制文件的特殊配置。

```toml
[lib]
name = "mylib"    # 库的名称（默认与包名相同）
path = "src/lib.rs"
crate-type = ["cdylib"]  # 编译类型（如动态库、静态库等）

[[bin]]           # 声明二进制目标
name = "mycli"
path = "src/main.rs"
test = true       # 是否默认参与测试
```

---

## **7. `[profile]` 区块：优化配置**

调整编译器的优化级别和调试信息。

```toml
[profile.dev]
opt-level = 0     # 调试模式（不优化）
debug = true      # 包含调试信息

[profile.release]
opt-level = 3     # 最大优化
lto = true        # 链接时优化
panic = "abort"   # 发生 panic 时直接终止进程
```

---

## **8. `[patch]` 与 `[replace]` 区块：依赖覆盖**

临时覆盖依赖版本（用于本地调试或解决版本冲突）。

```toml
[patch.crates-io]
serde = { git = "https://github.com/serde-rs/serde", branch = "fix-bug" }

[replace]
"rand:0.8.5" = { git = "https://github.com/rust-random/rand" }
```

---

## **9. 构建脚本 `build.rs` 配置**

```toml
[package]
build = "build.rs"  # 指定构建脚本路径（默认为项目根目录下的 build.rs）
```

---

## **10. 发布配置 `[package.metadata]`**

自定义发布到 [crates.io](https://crates.io/) 的元数据。

```toml
[package.metadata.docs.rs]
all-features = true  # 在 docs.rs 上生成文档时启用所有特性
```

---

## **典型 `Cargo.toml` 完整示例**

```toml
[package]
name = "my_project"
version = "0.1.0"
edition = "2021"
authors = ["Alice <alice@example.com>"]
description = "A fantastic Rust project"
license = "MIT"
repository = "https://github.com/username/my_project"

[dependencies]
serde = { version = "1.0", features = ["derive"] }
tokio = { version = "1.0", features = ["full"] }

[dev-dependencies]
tempfile = "3.3"

[features]
default = ["web"]
web = ["tokio/http"]

[build-dependencies]
cc = "1.0"

[workspace]
members = ["subcrate"]
```

---

## **注意事项**

1. **版本号管理**：使用语义化版本控制（SemVer），避免手动指定过于宽泛的版本范围。
2. **路径依赖**：本地开发时优先使用路径依赖，发布前需替换为 crates.io 或 Git 依赖。
3. **特性开关**：避免定义过多特性，防止用户配置复杂度爆炸。
4. **文档生成**：运行 `cargo doc --open` 可验证文档注释（`///`）的渲染效果。

建议结合 `cargo` 命令（如 `cargo add`、`cargo rm`）管理依赖，减少手动编辑错误。完整规范可参考 [Cargo 官方文档](https://doc.rust-lang.org/cargo/reference/manifest.html)。
