# 打印日志

在 CMakeLists.txt 中打印日志（调试信息）可以帮助追踪变量值、构建过程或条件判断结果，常用的方法有以下几种：

## 1. `message()` 命令（最常用）

`message()` 是 CMake 中打印日志的核心命令，语法：  

```cmake
message([<mode>] "消息内容")
```

### 常用 `<mode>` 类型（控制日志级别）：

- **无模式**：默认日志，正常输出到控制台。  
- `STATUS`：用于输出构建过程中的状态信息（推荐用于一般调试），前缀会带 `--`。  
- `WARNING`：警告信息（黄色显示，不中断构建）。  
- `AUTHOR_WARNING`：开发者警告（仅在 `CMAKE_ERROR_DEPRECATED` 开启时显示）。  
- `SEND_ERROR`：错误信息（红色显示，继续执行但终止构建）。  
- `FATAL_ERROR`：致命错误（红色显示，立即终止构建）。  

### 示例：

```cmake
# 打印普通消息
message("当前源目录: ${CMAKE_CURRENT_SOURCE_DIR}")

# 打印状态信息（推荐用于调试变量）
message(STATUS "编译类型: ${CMAKE_BUILD_TYPE}")
message(STATUS "是否开启测试: ${BUILD_TESTING}")

# 打印警告
message(WARNING "此功能已过时，请更新代码")

# 打印错误（终止构建）
if(NOT CMAKE_CXX_COMPILER)
  message(FATAL_ERROR "未找到 C++ 编译器！")
endif()
```

## 2. 打印变量值（调试常用）

结合 `message(STATUS)` 和变量引用（`${变量名}`），可以快速查看变量值：  

```cmake
# 打印系统信息变量
message(STATUS "操作系统: ${CMAKE_SYSTEM_NAME}")
message(STATUS "CPU 架构: ${CMAKE_SYSTEM_PROCESSOR}")

# 打印自定义变量
set(MY_VAR "hello cmake")
message(STATUS "自定义变量 MY_VAR = ${MY_VAR}")

# 打印列表变量（CMake 列表用分号分隔）
set(MY_LIST a b c)
message(STATUS "列表变量 MY_LIST = ${MY_LIST}")  # 输出: a;b;c
```

## 3. 条件打印（结合 `if` 判断）

在条件分支中打印日志，确认逻辑是否正确执行：  

```cmake
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
  message(STATUS "Debug 模式：开启调试符号")
  add_definitions(-DDEBUG)
elseif(CMAKE_BUILD_TYPE STREQUAL "Release")
  message(STATUS "Release 模式：开启优化")
else()
  message(WARNING "未知构建类型：${CMAKE_BUILD_TYPE}")
endif()
```

## 4. 打印目标信息（针对 `target`）

如果需要调试目标（如可执行文件、库）的属性，可结合 `get_target_property`：  

```cmake
add_executable(myapp main.cpp)

# 打印目标的输出路径
get_target_property(OUTPUT_PATH myapp RUNTIME_OUTPUT_DIRECTORY)
message(STATUS "myapp 输出路径: ${OUTPUT_PATH}")

# 打印目标链接的库
get_target_property(LINK_LIBS myapp LINK_LIBRARIES)
message(STATUS "myapp 链接的库: ${LINK_LIBS}")
```

## 5. 打印文件列表

查看 `file(GLOB)` 或 `aux_source_directory` 获取的文件列表：  

```cmake
aux_source_directory(src SRC_FILES)
message(STATUS "src 目录下的源文件: ${SRC_FILES}")

file(GLOB HEADERS include/*.h)
message(STATUS "include 目录下的头文件: ${HEADERS}")
```

## 6. 高级：打印所有缓存变量（调试全局配置）

如果需要查看 CMake 缓存中的所有变量（如通过 `-D` 传递的参数），可使用 `get_cmake_property` 遍历：  

```cmake
# 打印所有缓存变量
get_cmake_property(CACHE_VARS CACHE_VARIABLES)
foreach(VAR ${CACHE_VARS})
  get_property(VAR_TYPE CACHE ${VAR} PROPERTY TYPE)
  message(STATUS "缓存变量: ${VAR} = ${${VAR}} (类型: ${VAR_TYPE})")
endforeach()
```

## 注意事项

1. **变量引用格式**：CMake 中变量必须用 `${变量名}` 引用，否则会被当作字符串处理。  
2. **列表打印**：CMake 列表本质是分号分隔的字符串，打印时会显示为 `a;b;c`。  
3. **日志级别选择**：  
   - 普通调试用 `STATUS`（不干扰正常输出）；  
   - 潜在问题用 `WARNING`；  
   - 必须修复的问题用 `SEND_ERROR` 或 `FATAL_ERROR`。  
4. **构建过程中的打印时机**：`message()` 在 CMake 配置阶段（`cmake ..` 时）执行，而非编译阶段（`make` 时）。

通过以上方法，可以清晰地追踪 CMake 脚本的执行逻辑、变量值和配置状态，大幅提高调试效率。
