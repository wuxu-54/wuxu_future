# sourceSets

在 Android Gradle 构建中，`sourceSets` 用于定义项目源代码和资源的位置。以下从概念、Groovy 和 Kotlin DSL（.kts）三种方式详细介绍其使用方法：

## 一、基本概念

`sourceSets` 允许你：

- 指定源代码（Java/Kotlin）、资源文件、Manifest 文件的位置
- 为不同构建变体（如 debug/release）配置不同的源代码目录
- 自定义测试代码的位置

## 二、Groovy 语法配置（build.gradle）

在 Groovy 语法中，`sourceSets` 是 `android` 闭包下的一个配置项：

```groovy
android {
    // 其他配置...
    
    sourceSets {
        // 主源代码集（默认配置）
        main {
            // 设置 Java/Kotlin 源代码目录
            java.srcDirs = ['src/main/java', 'src/main/kotlin']
            
            // 设置资源文件目录
            res.srcDirs = ['src/main/res']
            
            // 设置 AndroidManifest 文件位置
            manifest.srcFile 'src/main/AndroidManifest.xml'
            
            // 设置 assets 文件目录
            assets.srcDirs = ['src/main/assets']
            
            // 设置 AIDL 文件目录
            aidl.srcDirs = ['src/main/aidl']
            
            // 设置 RenderScript 文件目录
            renderscript.srcDirs = ['src/main/rs']
        }
        
        // 测试源代码集
        test {
            java.srcDirs = ['src/test/java']
        }
        
        // Android 单元测试源代码集
        androidTest {
            java.srcDirs = ['src/androidTest/java']
        }
        
        // 自定义源代码集示例（如用于调试）
        debug {
            java.srcDirs = ['src/debug/java']
            res.srcDirs = ['src/debug/res']
        }
    }
}
```

## 三、Kotlin DSL 语法配置（build.gradle.kts）

在 Kotlin DSL 中，`sourceSets` 的配置方式略有不同：

```kotlin
android {
    // 其他配置...
    
    sourceSets {
        // 主源代码集
        getByName("main") {
            java.srcDirs("src/main/java", "src/main/kotlin")
            res.srcDirs("src/main/res")
            manifest.srcFile("src/main/AndroidManifest.xml")
            assets.srcDirs("src/main/assets")
            aidl.srcDirs("src/main/aidl")
            renderscript.srcDirs("src/main/rs")
        }
        
        // 测试源代码集
        getByName("test") {
            java.srcDirs("src/test/java")
        }
        
        // Android 单元测试源代码集
        getByName("androidTest") {
            java.srcDirs("src/androidTest/java")
        }
        
        // 自定义源代码集
        getByName("debug") {
            java.srcDirs("src/debug/java")
            res.srcDirs("src/debug/res")
        }
    }
}
```

## 四、常用配置示例

### 1. 添加额外的源代码目录

```groovy
// Groovy
android {
    sourceSets {
        main {
            java.srcDirs += 'src/custom'
        }
    }
}

// Kotlin DSL
android {
    sourceSets {
        getByName("main") {
            java.srcDirs("src/main/java", "src/custom")
        }
    }
}
```

### 2. 为构建变体配置单独的资源

```groovy
// Groovy
android {
    sourceSets {
        debug {
            res.srcDirs += 'src/debug/res'
        }
        release {
            res.srcDirs += 'src/release/res'
        }
    }
}

// Kotlin DSL
android {
    sourceSets {
        getByName("debug") {
            res.srcDirs("src/main/res", "src/debug/res")
        }
        getByName("release") {
            res.srcDirs("src/main/res", "src/release/res")
        }
    }
}
```

### 3. 禁用特定源代码集

```groovy
// Groovy
android {
    sourceSets {
        test {
            java.srcDirs = [] // 禁用单元测试
        }
    }
}

// Kotlin DSL
android {
    sourceSets {
        getByName("test") {
            java.setSrcDirs(emptyList())
        }
    }
}
```

## 五、注意事项

1. **路径优先级**：先指定的目录优先级更高（如资源冲突时）
2. **默认目录**：如果不配置，Gradle 会使用标准目录结构
3. **避免重复配置**：确保不同 sourceSet 之间没有路径冲突
4. **同步项目**：修改 sourceSets 后需要重新 sync Gradle

通过合理使用 `sourceSets`，你可以灵活组织项目结构，满足不同构建变体的需求。
