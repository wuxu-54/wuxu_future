# 常见命令

Gradle的命令非常丰富，涵盖了项目构建、任务执行、依赖管理、性能优化等多个方面。以下是对Gradle命令目录的归纳：

## 一、基本构建命令

1. **gradle build**：构建项目，包括编译、测试、打包等操作。
2. **gradle clean**：清除编译生成的build文件。

## 二、项目初始化与管理

1. **gradle init**：初始化一个Gradle项目。
2. **gradle wrapper**：生成Gradle Wrapper文件夹及相关文件，用于确保项目在不同环境中使用相同版本的Gradle。
3. **gradle wrapper --gradle-version=x.y.z**：升级或指定Gradle Wrapper的版本。
4. **gradle projects**：列出项目列表，按照层次结构展示。
5. **gradle init --type pom**：将maven项目转换成gradle项目（在根目录执行）

## 三、任务管理

1. **gradle tasks**：列出当前项目的所有已分配给任务组的任务。
2. **gradle tasks --all**：列出当前项目的所有任务，包括未分配给任务组的任务。
3. **gradle tasks --group="xxx"**：列出指定分组中的任务。
4. **gradle help --task someTask**：显示某个任务的详细信息。
5. **gradle ["taskName"]** 或 **gradle taskName**：执行自定义任务或内置任务。
6. **-x taskName** 或 **--exclude-task taskName**：在执行构建时排除指定的任务。
7. **--return-tasks**：强制执行任务，忽略up-to-date状态，常用`gradle build --return-tasks`。
8. **--continue**：忽略前面失败的任务继续执行，每个遇到的故障都将在构建结束时报告。

## 四、依赖管理

1. **gradle dependencies**：查看整个项目的依赖信息，以依赖树的方式显示。

    ```sh
    > gradle -q dependencies api:dependencies webapp:dependencies
    ------------------------------------------------------------
    Root project
    ------------------------------------------------------------
    No configurations
    ------------------------------------------------------------
    Project :api - The shared API for the application
    ------------------------------------------------------------
    compile
    \--- org.codehaus.groovy:groovy-all:2.3.3
    testCompile
    \--- junit:junit:4.11
        \--- org.hamcrest:hamcrest-core:1.3
    ------------------------------------------------------------
    Project :webapp - The Web application implementation
    ------------------------------------------------------------
    compile
    +--- project :api
    |    \--- org.codehaus.groovy:groovy-all:2.3.3
    \--- commons-io:commons-io:1.2
    testCompile
    No dependencies
    ```

2. **gradle -q api:dependencies --configuration testCompile**：上面示例输出比较多，可以通过 `--configuration` 参数来查看 指定构建任务的依赖情况

    ```sh
    > gradle -q api:dependencies --configuration testCompile
    ------------------------------------------------------------
    Project :api - The shared API for the application
    ------------------------------------------------------------
    testCompile
    \--- junit:junit:4.11
     \--- org.hamcrest:hamcrest-core:1.3
    ```

3. **gradle dependencyInsight**：命令可以查看指定的依赖。示例：

    ```sh
    > gradle -q webapp:dependencyInsight --dependency groovy --configuration compile
    org.codehaus.groovy:groovy-all:2.3.3
    \--- project :api
        \--- compile
    ```

    >这个 task 对于了解依赖关系、了解为何选择此版本作为依赖十分有用.了解更多请参阅 [DependencyInsightReportTask](https://docs.gradle.org/current/dsl/org.gradle.api.tasks.diagnostics.DependencyInsightReportTask.html).
    >dependencyInsight 任务是’Help’任务组中的一个. 这项任务需要进行配置才可以使用. Report 查找那些在指定的配置里特定的依赖.
    >如果用了Java相关的插件, 那么 dependencyInsight 任务已经预先被配置到’compile’下了. 你只需要通过 '--dependency' 参数来制定所需查看的依赖即可. 如果你不想用默认配置的参数项你可以通过'--configuration'参数来进行指定.了解更多请参阅 [DependencyInsightReportTask](https://docs.gradle.org/current/dsl/org.gradle.api.tasks.diagnostics.DependencyInsightReportTask.html).

## 五、性能优化

1. **--build-cache** / **--no-build-cache**：尝试重用先前版本的输出，以加快构建速度。
2. **--max-workers=x**：设置Gradle可以使用的worker数，x为指定的数字，默认值是处理器数。
3. **-parallel** / **--no-parallel**：并行执行项目任务，以加快构建速度。默认是关闭状态。

## 六、守护进程与日志

1. **--daemon** / **--no-daemon**：使用Gradle守护进程构建，默认是打开状态。
2. **--foreground**：在前台进程中启动Gradle守护进程。
3. **-Dorg.gradle.daemon.idletimeout=xxx**：设置Gradle守护进程的空闲超时时间，xxx为指定的毫秒数。
4. **日志选项**：`-Dorg.gradle.logging.level=(quiet,warn,lifecycle,info,debug)`
    * **-q, --quiet**：只记录错误信息。
    * **-w, --warn**：设置日志级别为warn。
    * **-i, --info**：设置日志级别为info。
    * **-d, --debug**：进入调试模式，记录详细日志信息。
5. **—profile**：参数可以收集一些构建期间的信息并保存到 build/reports/profile 目录下，并且会以构建时间命名这些文件.

## 七、其他命令

1. **-h, --help**：查看帮助信息。
2. **-v, --version**：显示Gradle的版本信息。
3. **-S, --full-stacktrace**：打印出所有异常的完整堆栈跟踪信息。
4. **-s, --stacktrace**：打印出用户异常的堆栈跟踪信息。
5. **-Dorg.gradle.daemon.debug=true**：调试Gradle守护进程。
6. **-Dorg.gradle.debug=true**：调试Gradle客户端（非daemon）进程。
7. **-Dorg.gradle.debug.port=xxx**：指定启用调试时要侦听的端口号，xxx为指定的端口号，默认值为5005。
8. **gradle properties**：列出所选项目的属性列表

    ```sh
    > gradle -q api:properties
    ------------------------------------------------------------
    Project :api - The shared API for the application
    ------------------------------------------------------------
    allprojects: [project ':api']
    ant: org.gradle.api.internal.project.DefaultAntBuilder@12345
    antBuilderFactory: org.gradle.api.internal.project.DefaultAntBuilderFactory@12345
    artifacts: org.gradle.api.internal.artifacts.dsl.DefaultArtifactHandler@12345
    asDynamicObject: org.gradle.api.internal.ExtensibleDynamicObject@12345
    baseClassLoaderScope: org.gradle.api.internal.initialization.DefaultClassLoaderScope@12345
    buildDir: /home/user/gradle/samples/userguide/tutorial/projectReports/api/build
    buildFile: /home/user/gradle/samples/userguide/tutorial/projectReports/api/build.gradle
    ```

## 八、Gradle Wrapper命令

在实际使用中，为了确保项目在不同环境中使用相同版本的Gradle，通常会使用Gradle Wrapper。Gradle Wrapper的命令通常以`./gradlew`（在Unix/Linux/macOS系统上）或`gradlew`（在Windows系统上）开头，后跟具体的Gradle命令。例如：

* **./gradlew build**：使用Gradle Wrapper构建项目。
* **./gradlew clean**：使用Gradle Wrapper清除编译生成的build文件。

以上是对Gradle命令目录的归纳和解释。Gradle的命令非常丰富且功能强大，熟练掌握这些命令可以大大提高项目构建和管理的效率。

---

## 选择执行构建

调用 gradle 命令时,默认情况下总是会构建当前目录下的文件, 可以使用 `-b` 参数选择其他目录的构建文件,并且当你使用此参数时 `settings.gradle` 将不会生效。

看下面的例子:

1. 选择文件构建

    subdir/myproject.gradle

    ```groovy
    task hello << {
        println "using build file '$buildFile.name' in '$buildFile.parentFile.name'."
    }
    ```

    gradle -q -b subdir/myproject.gradle hello 的输出

    ```sh
    gradle -q -b subdir/myproject.gradle hello
    using build file 'myproject.gradle' in 'subdir'.
    ```

2. 选择构建目录

    另外,你可以使用 `-p` 参数来指定构建的目录,例如在多项目构建中你可以用 -p 来替代 -b 参数

    gradle -q -p subdir hello 命令的输出

    ```sh
    gradle -q -p subdir hello
    using build file 'build.gradle' in 'subdir'.
    ```

### 说明

* `-b` 参数用以指定脚本具体所在位置,格式为 `dirpwd/build.gradle`.
* `-p` 参数用以指定脚本目录即可.
