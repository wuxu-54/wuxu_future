# java-gradle-plugin

Gradle的`java-gradle-plugin`是一个用于帮助开发Gradle插件的插件。
>这是开发Gradle插件时常用的三方插件，简化了开发流程。不必再手动配置properties文件信息。配合`maven-pubilish`插件一起使用，可以打打简化从开发到发布的操作流程。

以下是对其的详细解析：

## 一、作用与功能

* `java-gradle-plugin`插件会自动应用Java Library插件，并在项目的dependencies中添加对`gradleApi()`的依赖。
* 它会在jar任务执行期间验证插件元数据，确保插件的正确性。
* 该插件还与Gradle TestKit集成，便于编写和执行针对插件代码的功能测试。

## 二、使用方法

要在Gradle项目中使用`java-gradle-plugin`插件，可以按照以下步骤进行配置：

1. **在`build.gradle`文件中添加插件依赖**：

    ```groovy
    plugins {
        id 'java-gradle-plugin'
    }
    ```

2. **配置插件的其他相关属性**：

    * 可以根据需要配置group、version和description等属性，以定义插件的基本信息。
    * 使用`gradlePlugin`块来定义插件的ID和实现类。

    例如：

    ```groovy
    gradlePlugin {
        plugins {
            myPlugin {
                id = 'com.example.myplugin'
                implementationClass = 'com.example.MyPlugin'
            }
        }
    }
    ```

3. **编写插件代码**：

    * 创建一个实现了`org.gradle.api.Plugin`接口的类。
    * 在该类中覆写`apply`方法，并在其中编写插件的逻辑。

    例如：

    ```java
    import org.gradle.api.Plugin;
    import org.gradle.api.Project;

    public class MyPlugin implements Plugin<Project> {
        @Override
        public void apply(Project project) {
            // 插件逻辑
            project.task("myTask") {
                doLast {
                    println "MyTask doLast invoke..."
                }
            }
        }
    }
    ```

4. **构建和发布插件**：

    * 使用Gradle的构建工具来构建插件，并生成jar包。
    * 可以使用`maven-publish`插件将插件发布到Maven仓库，包括本地仓库和远程仓库。

## 三、注意事项

* 在开发Gradle插件时，需要确保插件的元数据正确无误，以便Gradle能够正确识别和加载插件。
* 插件的逻辑应该尽量简单明了，避免引入不必要的复杂性。
* 在发布插件时，需要遵循相应的发布流程，包括配置仓库、添加认证信息等。

## 四、示例项目

以下是一个简单的Gradle插件示例项目的目录结构和关键文件内容：

* **目录结构**：

 ```txt
 gradle-plugin-example/
 ├── build.gradle
 ├── settings.gradle
 └── src/
     ├── main/
     │   ├── java/
     │   │   └── com/
     │   │       └── example/
     │   │           └── MyPlugin.java
     │   └── resources/
     └── test/
         └── java/
             └── com/
                 └── example/
                     └── MyPluginTest.java
 ```

* **`build.gradle`文件内容**：

 ```groovy
 plugins {
     id 'java-gradle-plugin'
     id 'maven-publish'
 }

 group 'com.example'
 version '1.0-SNAPSHOT'

 repositories {
     mavenLocal()
     mavenCentral()
 }

 dependencies {
     testImplementation 'junit:junit:4.13'
 }

 gradlePlugin {
     plugins {
         myPlugin {
             id = 'com.example.myplugin'
             implementationClass = 'com.example.MyPlugin'
         }
     }
 }

 publishing {
     publications {
         mavenJava(MavenPublication) {
             from components.java
         }
     }
     repositories {
         maven {
             name = "localMaven"
             url = uri("$buildDir/repos/maven2")
         }
     }
 }
 ```

* **`MyPlugin.java`文件内容**（插件实现类）：

 ```java
 package com.example;

 import org.gradle.api.Plugin;
 import org.gradle.api.Project;

 public class MyPlugin implements Plugin<Project> {
     @Override
     public void apply(Project project) {
         project.task("myTask") {
             doLast {
                 println "MyTask doLast invoke..."
             }
         }
     }
 }
 ```

通过以上步骤和示例项目，可以快速地创建和发布一个简单的Gradle插件。
