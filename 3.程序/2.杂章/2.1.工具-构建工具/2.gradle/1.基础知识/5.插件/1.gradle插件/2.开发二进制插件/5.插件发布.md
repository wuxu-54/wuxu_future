# 插件发布

- [maven发布插件](https://doc.qzxdp.cn/gradle/8.1.1/userguide/publishing_maven.html)
- [Ivy发布插件](https://doc.qzxdp.cn/gradle/8.1.1/userguide/publishing_ivy.html)

下面是使用`maven-publish`插件进行发布。建议看上面的文档，翻译的是gradle官方说明。很详细、且api使用方式比较新。

## 一、配置插件发布信息

1. **应用`maven-publish`插件**

   在你的插件项目的`build.gradle`文件中，应用`maven-publish`插件。这个插件提供了将构建产物发布到Maven仓库的功能。

   ```groovy
   plugins {
       id 'maven-publish'
   }
   ```

2. **配置发布信息**

   在`publishing`块中，配置发布的详细信息，包括分组（`groupId`）、标识符（`artifactId`）、版本（`version`）以及要发布的组件（如Java库）。

   ```groovy
   publishing {
       publications {
           mavenJava(MavenPublication) {
               from components.java
               groupId = 'com.yourcompany.plugins' // 替换为你的公司或组织的域名反转
               artifactId = 'your-plugin-id' // 替换为你的插件ID
               version = '1.0.0' // 替换为你的插件版本
           }
       }
       repositories {
           maven {
               // 配置仓库的URL，可以是本地文件系统或远程Maven仓库
               url = uri('https://your.repository.url/repo') // 替换为你的仓库URL

               // 如果你需要认证，可以添加以下配置
               // credentials {
               //     username = findProperty("repo.user") ?: "defaultUser"
               //     password = findProperty("repo.pass") ?: "defaultPassword"
               // }
           }
       }
   }
   ```

## 二、执行发布任务

1. **构建并发布插件**

   在命令行中，使用`gradle publish`命令来构建并发布你的插件。这个命令会根据你在`build.gradle`文件中配置的信息，将插件的JAR文件和相关元数据发布到指定的Maven仓库。

   ```bash
   ./gradlew publish
   ```

   如果你使用的是Windows系统，可能需要使用`gradlew.bat`命令。

2. **验证发布结果**

   发布完成后，你可以登录到配置的Maven仓库，检查你的插件是否已经成功上传。你应该能够在仓库中看到你的插件的JAR文件、POM文件以及可能的其他相关文件。

## 三、注意事项

1. **插件ID的唯一性**

   确保你的插件ID在Maven仓库中是唯一的，以避免与其他插件发生冲突。

2. **仓库的访问权限**

   如果你将插件发布到远程Maven仓库，确保你有足够的权限来访问和上传文件到该仓库。你可能需要配置用户名和密码等认证信息。

3. **插件的兼容性**

   在发布插件之前，确保你的插件与当前版本的Gradle兼容。你可以在你的插件项目中添加适当的测试来验证这一点。

4. **文档和示例**

   提供清晰的文档和示例代码，以帮助其他开发者了解如何使用你的插件。这可以包括插件的用途、配置选项、使用示例以及任何相关的注意事项。

5. **版本控制**

   使用版本控制系统（如Git）来管理你的插件代码和发布历史。这可以帮助你跟踪更改、管理版本以及与其他开发者协作。

通过遵循以上步骤和注意事项，你可以成功地将Gradle自定义插件发布到远程或本地Maven仓库中，供其他开发者使用。

---

## 坑

新版本android studio项目的build.gradle：

```groovy
plugins {
    id 'com.android.application' version '8.0.2' apply false
    id 'com.android.library' version '8.0.2' apply false
    id 'org.jetbrains.kotlin.android' version '1.7.20' apply false
    id 'com.wuxu.plugin' version '1.0.0'
}
```

坑点：通过maven打出的插件，引入报错！困扰我半天时间。

```txt
org.gradle.api.plugins.UnknownPluginException: Plugin [id: 'com.wuxu.plugin', version: '1.0.0'] was not found in any of the following sources:
- Gradle Core Plugins (plugin is not in 'org.gradle' namespace)
- Plugin Repositories (could not resolve plugin artifact 'com.wuxu.plugin:com.wuxu.plugin.gradle.plugin:1.0.0')
  ...
  ...
```

解决办法：改为旧版通过`buildScript`处理

```groovy
buildscript {
    repositories {
        maven{ url = uri('./wuxu_plugin/local/repo')}
        google()
        mavenCentral()
    }
    dependencies {
        classpath "com.android.tools.build:gradle:8.0.2"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.20"
        classpath "com.wuxu:plugin:1.0.0"
    }
}
```

问题原因是什么？

可以看下[plugins任务章节](../../../3.task%E5%92%8Cproject/2.task/3.%E5%B8%B8%E8%A7%81%E4%BB%BB%E5%8A%A1%E4%BB%8B%E7%BB%8D/1.plugins%E4%BB%BB%E5%8A%A1.md)
