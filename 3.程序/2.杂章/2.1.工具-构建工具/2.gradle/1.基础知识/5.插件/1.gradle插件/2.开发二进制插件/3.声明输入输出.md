# 声明输入输出

在 Gradle 插件中声明任务的输入和输出通常涉及创建一个自定义任务类，并在该类中使用 Gradle 提供的注解来标记输入和输出属性。这些注解帮助 Gradle 识别任务的依赖性和增量构建行为。

以下是一个简单的示例，展示了如何在 Gradle 插件中声明自定义任务的输入和输出：

1. **创建自定义任务类**：

   首先，你需要创建一个继承自 `DefaultTask` 的自定义任务类。在这个类中，你可以使用如 `@Input`, `@InputFile`, `@InputFiles`, `@OutputFile`, `@OutputFiles`, 和 `@OutputDirectory` 等注解来标记输入和输出。

   ```java
   import org.gradle.api.DefaultTask;
   import org.gradle.api.file.FileCollection;
   import org.gradle.api.tasks.Input;
   import org.gradle.api.tasks.InputFile;
   import org.gradle.api.tasks.InputFiles;
   import org.gradle.api.tasks.OutputFile;
   import org.gradle.api.tasks.TaskAction;

   import java.io.File;
   import java.util.Set;

   public class MyCustomTask extends DefaultTask {

       // 声明单个输入文件
       @InputFile
       private File inputFile;

       public void setInputFile(File inputFile) {
           this.inputFile = inputFile;
       }

       // 声明多个输入文件
       @InputFiles
       private FileCollection inputFiles;

       public void setInputFiles(FileCollection inputFiles) {
           this.inputFiles = inputFiles;
       }

       // 声明一个输入属性
       @Input
       private String someInputProperty;

       public void setSomeInputProperty(String someInputProperty) {
           this.someInputProperty = someInputProperty;
       }

       // 声明单个输出文件
       @OutputFile
       private File outputFile;

       public void setOutputFile(File outputFile) {
           this.outputFile = outputFile;
       }

       // 任务执行逻辑
       @TaskAction
       public void execute() {
           // 在这里编写你的任务逻辑，使用 inputFile, inputFiles, someInputProperty, 和 outputFile
           // 例如，读取 inputFile 的内容，处理它，并将结果写入 outputFile
       }
   }
   ```

2. **在插件中应用任务**：

   接下来，在你的 Gradle 插件类中，你需要注册这个自定义任务，并配置它的输入和输出。这通常是在插件的 `apply` 方法中完成的。

   ```java
   import org.gradle.api.Plugin;
   import org.gradle.api.Project;
   import org.gradle.api.tasks.TaskContainer;

   public class MyCustomPlugin implements Plugin<Project> {
       @Override
       public void apply(Project project) {
           TaskContainer tasks = project.getTasks();
           tasks.register("myCustomTask", MyCustomTask.class, task -> {
               // 配置输入和输出
               task.setInputFile(project.file("path/to/input/file.txt"));
               // 或者使用项目属性或配置来设置输入
               // task.setSomeInputProperty(project.hasProperty("someProperty") ? project.property("someProperty").toString() : "default");

               // 配置输出
               task.setOutputFile(project.getBuildDir().file("path/to/output/file.txt"));

               // 如果需要配置多个输入文件，可以这样做：
               // task.setInputFiles(project.files("path/to/input/file1.txt", "path/to/input/file2.txt"));
           });
       }
   }
   ```

3. **在构建脚本中应用插件**：

   最后，你需要在你的 Gradle 构建脚本（如 `build.gradle` 或 `build.gradle.kts`）中应用这个插件。

   ```groovy
   // build.gradle
   apply plugin: MyCustomPlugin
   ```

   或者，如果你使用的是 Kotlin DSL：

   ```kotlin
   // build.gradle.kts
   apply(plugin = "com.example.mycustomplugin") // 假设插件的 ID 是 "com.example.mycustomplugin"
   ```

   注意：在实际应用中，你通常会将插件打包为一个 JAR 文件，并通过 Gradle 的插件机制来应用它，而不是直接在构建脚本中使用 `apply plugin:` 语句。这通常涉及在 `buildSrc` 目录中编写插件代码，或者将插件发布到一个 Maven 或 Ivy 仓库中。

确保你的插件和任务类正确配置，并且输入和输出声明与你的任务逻辑相匹配。这样，Gradle 就能根据这些声明来优化构建过程，例如通过避免不必要的任务执行和缓存任务输出来提高构建效率。
