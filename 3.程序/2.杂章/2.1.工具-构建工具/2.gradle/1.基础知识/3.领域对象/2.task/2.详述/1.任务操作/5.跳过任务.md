# 跳过任务

在 Gradle 中，跳过任务（Skipping Tasks）通常涉及到条件判断，使得在特定条件下任务不会被执行。以下是几种跳过任务的方法：

## 1. 使用 `onlyIf` 条件

你可以使用 `onlyIf` 方法为任务添加一个条件，只有当条件为真时任务才会执行。如果条件为假，任务将被跳过。

```groovy
task myTask {
    doLast {
        println 'Executing my task'
    }
    onlyIf { false } // 这个任务将总是被跳过
}
```

## 2. 使用 `enabled` 属性

通过设置任务的 `enabled` 属性为 `false`，可以直接禁用任务，使其在构建中不被执行。

```groovy
task myTask {
    doLast {
        println 'Executing my task'
    }
}
myTask.enabled = false // 禁用任务
```

## 3. 使用 `skip` 方法

Gradle 提供了 `skip` 方法，允许你在运行时跳过任务。

```groovy
gradle.taskGraph.whenReady { graph ->
    if (someCondition) {
        graph.getAllTasks().forEach { task ->
            task.skip = true
        }
    }
}
```

## 4. 使用 `upToDateWhen` 条件

对于某些类型的任务，如 `Copy` 或 `Sync`，你可以使用 `upToDateWhen` 条件来指定何时任务被认为是最新的，从而跳过执行。

```groovy
task copyTask(type: Copy) {
    from 'sourceDir'
    into 'targetDir'
    upToDateWhen { false } // 这个任务将总是执行
}
```

## 5. 使用 `Gradle Build Cache`

Gradle 构建缓存（Build Cache）可以自动跳过那些没有变化的任务，从而提高构建速度。

```groovy
// 在 build.gradle 文件中启用构建缓存
buildCache {
    isEnabled = true
}
```

## 6. 使用 `--skip` 命令行选项

在命令行中，你可以使用 `--skip` 选项来跳过任务。

```sh
gradle build --skip myTask
```

## 7. 使用 `noOperation` 方法

如果你需要创建一个不执行任何操作的任务，可以使用 `noOperation` 方法。

```groovy
task myTask {
    doLast {
        noOperation 'This task does nothing'
    }
}
```

## 8. 使用 `ignoreEmptySource` 属性

对于 `Copy` 类型的任务，你可以设置 `ignoreEmptySource` 属性为 `true`，这样如果源目录为空，任务将被跳过。

```groovy
task copyTask(type: Copy) {
    from 'sourceDir'
    into 'targetDir'
    ignoreEmptySource = true
}
```

通过这些方法，你可以根据需要在不同的场景下跳过 Gradle 任务，优化构建过程并提高效率。更多详细信息和高级用法可以参考 Gradle 官方文档 [Skipping tasks](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks)。

---

## 补充跳过姿势

### 1. StopExecutionException

通过此异常，可以跳过当前task的操作。

```groovy
task compile << {
    println "Compiling"
}
compile.doFirst{
    if(true){throw new StopExecutionException()}
}

task myTask(dependsOn:'compile') << {
    println "myTask"
}
```

执行：

```sh
> gradle -q myTask #-q 是指仅输出异常日志
my Task
```

从执行结果可以看出，最后的doLast没有执行，说明中断生效了
