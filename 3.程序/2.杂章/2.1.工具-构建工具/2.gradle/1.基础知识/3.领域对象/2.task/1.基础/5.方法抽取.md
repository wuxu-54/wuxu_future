# 方法抽取

在 Gradle 构建脚本（通常是 `build.gradle` 文件）中，将任务（task）方法抽取出来可以使脚本更加模块化和易于维护。你可以通过创建自定义方法或函数，然后在任务中调用这些方法来达到这个目的。

## 示例：抽取任务方法

假设你有一个简单的 Gradle 构建脚本，其中包含几个任务，每个任务都执行一些文件操作。

### 原始构建脚本

```groovy
task copyFiles {
    doLast {
        def sourceDir = file('src/main/resources')
        def destDir = file("$buildDir/resources/main")
        copy {
            from sourceDir
            into destDir
        }
    }
}

task cleanResources {
    doLast {
        def destDir = file("$buildDir/resources/main")
        delete destDir
    }
}
```

### 抽取方法后的构建脚本

你可以将任务中的逻辑抽取到方法中，然后在任务中调用这些方法。

```groovy
// 定义方法
def copyResources(sourceDir, destDir) {
    copy {
        from sourceDir
        into destDir
    }
}

def cleanDirectory(dir) {
    delete dir
}

// 定义任务并调用方法
task copyFiles {
    doLast {
        def sourceDir = file('src/main/resources')
        def destDir = file("$buildDir/resources/main")
        copyResources(sourceDir, destDir)
    }
}

task cleanResources {
    doLast {
        def destDir = file("$buildDir/resources/main")
        cleanDirectory(destDir)
    }
}
```

## 进一步抽象

如果你有更多的任务需要执行类似的操作，你可以进一步抽象这些逻辑，甚至创建自定义任务类型。

### 自定义任务类型示例

```groovy
// 定义自定义任务类型
class CopyTask extends DefaultTask {
    @InputDirectory File sourceDir
    @OutputDirectory File destDir

    @TaskAction
    def copyAction() {
        copy {
            from sourceDir
            into destDir
        }
    }
}

class CleanTask extends DefaultTask {
    @OutputDirectory File dir

    @TaskAction
    def cleanAction() {
        delete dir
    }
}

// 在构建脚本中使用自定义任务类型
task copyFiles(type: CopyTask) {
    sourceDir = file('src/main/resources')
    destDir = file("$buildDir/resources/main")
}

task cleanResources(type: CleanTask) {
    dir = file("$buildDir/resources/main")
}
```

## 总结

通过将任务方法抽取出来，你可以使 Gradle 构建脚本更加清晰和模块化。这不仅提高了代码的可读性，还使得维护和扩展变得更加容易。你可以根据项目的需要，选择适合的方法抽取方式，无论是简单的函数定义还是自定义任务类型。
