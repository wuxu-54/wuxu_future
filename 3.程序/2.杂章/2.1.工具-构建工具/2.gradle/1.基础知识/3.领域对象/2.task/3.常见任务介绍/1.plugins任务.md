# plugins任务

在 Gradle 中，`plugins {}` 块用于以声明式的方式添加插件，这里的 `id` 对应于插件的唯一标识符，它通常是由插件的 group（groupId）和 name（artifactId）组合而成的。这个 `id` 是 Gradle 用来从插件仓库中查找和解析插件的关键。

## 插件 ID 的组成

插件的 `id` 通常具有以下格式：

```groovy
<groupId>.<artifactId>
```

- **groupId**：插件的组织或组的唯一标识符，通常是一个反向域名。
- **artifactId**：插件的名称，它是在给定的 groupId 范围内唯一的。

## apply

apply 关键字用于指定是否应用该插件。如果 apply 被设置为 false，这意味着插件被声明了，但不会被自动应用。

### 为什么可能需要这样做？

- 条件应用插件：你可能想根据某些条件来决定是否应用插件。例如，你可以根据构建类型或项目阶段来决定是否应用特定的插件。
- 避免自动应用：有时候，你可能只是想声明插件，以便在构建脚本的其他部分手动应用它，而不是在 plugins {} 块中自动应用。

### 手动应用插件

如果你在 plugins {} 块中将 apply 设置为 false，你仍然可以在构建脚本的其他部分手动应用该插件，如下所示：

```groovy
plugins {
    id 'com.example.my-plugin' version '1.0.0' apply false
}

// 在构建脚本的其他部分手动应用插件
apply plugin: 'com.example.my-plugin'
```

这样，你就可以在需要的时候控制插件的应用时机，而不是在声明时立即应用。

## 示例

假设你想要使用一个名为 `my-plugin` 的插件，其 groupId 为 `com.example`，artifactId 为 `my-plugin`，则在 `plugins {}` 块中的声明如下：

```groovy
plugins {
    id 'com.example.my-plugin' // 注意这里的点号用于连接 groupId 和 artifactId
}
```

## 版本指定

如果你需要指定插件的版本，可以在插件 ID 后面添加版本号：

```groovy
plugins {
    id 'com.example.my-plugin' version '1.0.0'
}
```

## 自动版本解析

在某些情况下，如果你没有指定插件的版本，Gradle 会尝试根据插件的元数据来解析版本，或者使用插件仓库中的最新版本。

## 注意事项

- 确保插件的 groupId 和 artifactId 是正确的，否则 Gradle 将无法找到并应用插件。
- 插件 ID 在 `plugins {}` 块中是大小写敏感的，确保正确输入。
- 如果插件托管在 Gradle 插件门户上，Gradle 可以直接通过插件 ID 解析和应用插件，无需额外的仓库配置。

通过这种方式，`plugins {}` 块提供了一种简洁和高效的方式来管理和应用 Gradle 插件。

---

## 坑

引入插件库，plugins{}引入失败，但buildscript{}可以。他俩区别：

`plugins {}` 和 `buildscript {}` 在 Gradle 中有不同的用途和行为，这就是为什么在某些情况下 `buildscript {}` 可以成功加载插件，而 `plugins {}` 会报错的原因。

1. **`plugins {}` 的限制**：
   - `plugins {}` 块是 Gradle 4.9 版本引入的新特性，它允许以更简洁的方式应用插件，特别是当插件托管在 Gradle 插件仓库时。使用 `plugins {}` 时，Gradle 会自动从 Gradle 插件仓库中解析插件的坐标，因此不需要显式指定类路径和仓库。
   - 但是，`plugins {}` 只能用于应用那些在 Gradle 插件仓库中可用的插件。如果插件没有发布到 Gradle 插件仓库(这个是个特殊仓库)，或者需要从特定的 Maven 仓库中获取，`plugins {}` 就无法解析这些插件，从而导致错误。（我已经配置maven地址，仍然报错，所以原因跟这个没关系。同时报错信息打印出的插件id根本不是我配置的，原`com.wuxu:plugin:1.0.0`，错误日志输出的是`com.wuxu.plugin:com.wuxu.plugin.gradle.plugin:1.0.0`）

2. **`buildscript {}` 的灵活性**：
   - `buildscript {}` 块用于显式地添加构建脚本的类路径依赖，包括插件和其他库。这种方式不依赖于 Gradle 插件仓库，可以指定任意的 Maven 仓库来解析插件。
   - 当插件不是托管在 Gradle 插件仓库中，或者你需要自定义插件的类路径和仓库时，使用 `buildscript {}` 是必要的。这种方式提供了更多的控制和灵活性，允许你指定插件的具体版本和来源。

3. **为什么 `buildscript {}` 可以解决问题**：
   - 如果插件没有发布到 Gradle 插件仓库，或者你需要从特定的 Maven 仓库中获取插件，使用 `buildscript {}` 可以手动指定插件的 Maven 坐标和仓库，从而成功加载插件。
   - `buildscript {}` 允许你添加自定义仓库和依赖，这在 `plugins {}` 中是做不到的。因此，当遇到 `plugins {}` 无法解析插件的问题时，切换到 `buildscript {}` 并指定正确的仓库和依赖通常可以解决问题。

总结来说，`buildscript {}` 提供了更多的灵活性和控制，允许你指定插件的具体版本和来源，这在 `plugins {}` 中是做不到的。这就是为什么在某些情况下 `buildscript {}` 可以成功加载插件，而 `plugins {}` 会报错的原因。

>以上是搜到的说法，我没找到具体的根因。我认为问题点在于为什么plugins引入时修改了插件id。
