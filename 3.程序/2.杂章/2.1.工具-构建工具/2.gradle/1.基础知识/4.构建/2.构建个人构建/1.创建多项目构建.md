# 使用 Gradle 构建软件组件

>[传送门](https://doc.qzxdp.cn/gradle/8.1.1/userguide/multi_project_builds.html)

如果您正在使用 Gradle 构建一定规模的软件，您有两种基本的结构化机制。首先，本章介绍了如何使用 Gradle 多项目构建软件项目。在本文档中，我们将其视为内部结构化的单个 software component。其次，您可以将您的软件视为由多个 software components 组成的 software product，其中每个组件都由一个单独的 Gradle 构建表示。这在 使用 Gradle 构建软件产品 章节中有详细描述

创建多项目构建
Gradle 中的多项目构建由一个根项目和一个或多个子项目组成。

基本的多项目构建包含一个根项目和一个子项目。这是一个多项目构建的结构，其中包含一个名为 app 的子项目：

示例 1.基本的多项目构建

```kotlin
Project layout
.
├── app
│   ...
│   └── build.gradle.kts
└── settings.gradle.kts
```

这是启动任何 Gradle 项目的推荐项目结构。 构建初始化插件 还生成遵循此结构的骨架项目 - 具有单个子项目的根项目。

请注意，根项目没有 Gradle 构建文件，只有一个定义要包含的子项目的设置文件。

```kotlin
settings.gradle.kts
rootProject.name = "basic-multiproject"
include("app")
```

在这种情况下，Gradle 将在 app 目录中查找构建文件。

我们可以通过运行 gradle projects 命令来查看多项目构建的结构。

```sh
> gradle -q projects

------------------------------------------------------------
Root project 'basic-multiproject'
------------------------------------------------------------

Root project 'basic-multiproject'
\--- Project ':app'

To see a list of the tasks of a project, run gradle <project-path>:tasks
For example, try running gradle :app:tasks
```

假设 app 子项目是一个 Java 应用程序，通过应用 应用插件 并配置主类：

```kotlin
app/build.gradle.kts
plugins {
    id("application")
}

application {
    mainClass.set("com.example.Hello")
}
app/src/main/java/com/example/Hello.java
package com.example;

public class Hello {
    public static void main(String[] args) {
        System.out.println("Hello, world!");
    }
}
```

然后我们可以通过从 应用插件 执行 run 任务来运行应用程序。

```sh
> gradle -q run
Hello, world!
```

这就是创建基本的多项目构建的简单之处。

## 添加子项目

假设我们要将另一个名为 lib 的子项目添加到先前创建的项目中。我们需要做的就是在根设置文件中添加另一个 include 语句：

```kotlin
settings.gradle.kts
rootProject.name = "basic-multiproject"
include("app")
include("lib")
```

Gradle 然后会在项目的 lib/ 子目录中寻找新子项目的构建文件：

示例 2.包含两个子项目的多项目构建

```kotlin
Project layout
.
├── app
│   ...
│   └── build.gradle.kts
├── lib
│   ...
│   └── build.gradle.kts
└── settings.gradle.kts
```

接下来，将探索构建逻辑如何子项目之间共享 以及子项目如何相依为命。

## 命名建议

随着项目的增长，命名和一致性变得越来越重要。为了保持构建的可维护性，我们建议如下：

Keep default project names for subprojects：可以在设置文件中配置自定义项目名称。但是，对于开发人员来说，跟踪哪个项目属于哪个文件夹是一项不必要的额外工作。

Use kebab case formatting for all project names : kebab 大小写格式是所有字母小写，单词用破折号 ('-') 字符分隔 (egkebab-case-formatting)。这已经是许多大型项目的实际模式。此外，Gradle 支持 烤肉串案例名称的缩写 。

Define the root project name in the settings file：“rootProject.name”有效地为整个构建分配了一个名称，用于构建扫描等报告中。如果未设置根项目名称，该名称将是容器目录名称，这可能是不稳定的（即您可以将您的项目检出到任何目录）。如果未设置根项目名称并将其检出到文件系统的根目录（例如 / 或 C:\ ），则名称将随机生成。
