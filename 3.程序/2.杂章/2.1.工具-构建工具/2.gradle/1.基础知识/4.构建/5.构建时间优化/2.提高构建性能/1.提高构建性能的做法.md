# 提高 Gradle 构建的性能

[传送门](https://doc.qzxdp.cn/gradle/8.1.1/userguide/performance.html)

---

## 提高Gradle构建性能

### 1. 启用并行构建

Gradle提供了构建并行化的功能，允许多个任务同时执行，从而显著减少构建时间。你可以通过在`gradle.properties`文件中添加以下配置来启用并行构建：

```properties
org.gradle.parallel=true
```

这将启用Gradle的并行化模式，允许多个任务同时执行。

### 2. 配置最大工作线程数

你还可以配置Gradle使用所有可用的核心来执行任务：

```properties
org.gradle.workers.max=4 # 根据你的机器配置调整核心数
```

这可以根据你的机器配置来调整，以最大化并行构建的效果。

### 3. 使用Gradle特性

Gradle 4.0及以上版本引入了自动项目配置（Auto Project Configuration）和配置缓存（Configuration Cache）等特性，这些特性可以进一步提高并行构建的性能：

```properties
# 启用自动项目配置
org.gradle.configureondemand=true

# 启用配置缓存
org.gradle.configurationcache=true
```

这些特性可以提高构建速度，尤其是在大型项目中。

### 4. 优化JVM参数

增加JVM内存分配可以提高构建速度，适当增加JVM内存分配可以提高构建速度：

```properties
org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
```

这有助于避免内存不足导致的性能问题。

### 5. 启用守护进程

Gradle守护进程可以显著提升构建速度，因为它避免了每次构建时都需要重新启动Gradle：

```properties
org.gradle.daemon=true
```

守护进程通过跨构建缓存项目信息、在后台运行等方式减少构建时间。

### 6. 使用国内镜像加速依赖下载

由于网络原因，依赖下载往往是构建过程中的瓶颈之一。使用国内镜像可以有效解决这一问题：

```properties
distributionUrl=https\://maven.aliyun.com/repository/gradle-plugin/gradle-7.0.2-bin.zip
```

这可以加速依赖的下载，尤其是在网络环境较差的情况下。

### 7. 优化构建脚本

复杂的构建脚本会增加构建时间，因此需要尽量简化构建脚本，避免不必要的构建任务：

```groovy
tasks.withType(JavaCompile) {
    options.incremental = true
}
```

这有助于减少不必要的任务执行，提高构建效率。

通过上述方法，你可以显著提高Gradle项目的构建性能。每个项目的具体情况不同，可能需要根据实际情况进行适当调整。希望这些优化策略能帮助你在实际开发中提高开发效率。
