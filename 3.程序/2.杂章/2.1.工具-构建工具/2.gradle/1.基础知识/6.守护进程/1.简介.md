# 守护进程

Gradle守护进程（Gradle Daemon）是Gradle的一个核心特性，旨在提高构建性能。
>[gradle 守护进程描述](https://www.bookstack.cn/read/gradle-user-guide/the_gradle_daemon-README.md)

## 一、定义与功能

1. **定义**：Gradle守护进程（Gradle Daemon）是一个长期运行的后台进程，它避免了每次执行Gradle构建时都需要启动新的Java虚拟机（JVM）及其相关初始化的开销。
2. **功能**：

* **加速构建**：通过保持JVM及其加载的类和资源在内存中，大大减少了构建的启动时间。对于频繁执行的构建任务尤其有效。
* **持续优化**：JVM的即时编译器（JIT）可以在守护进程中不断优化代码路径，进一步提升执行效率。
* **资源缓存**：守护进程可以缓存项目配置和依赖信息，减少磁盘I/O操作。

## 二、启用与配置

1. **启用**：

    * Gradle 3.0及以后的版本，默认启用了守护进程。
    * 对于较早版本，可能需要手动通过`--daemon`选项启用。

2. **配置**：

    * 可以通过命令行参数`--no-daemon`临时禁用守护进程。
    * 在项目的`gradle.properties`文件中设置`org.gradle.daemon=false`来永久禁用守护进程。
    * 在`gradle.properties`文件中，可以对守护进程进行更多配置，比如调整其空闲超时时间（`org.gradle.daemon.idletimeout`）。

## 三、工作原理与通信

1. **工作原理**：

    * Gradle守护进程在后台运行时缓存项目信息，这样每个Gradle构建就不必等待JVM启动。
    * 守护进程通过运行时优化JVM，使JVM连续受益于其运行时优化。
    * 守护进程还通过监视文件系统来精确计算在运行构建之前需要重新构建的内容。

2. **通信**：

    * Gradle JVM客户端向守护进程发送构建信息，如命令行参数、项目目录和环境变量，以便守护进程可以运行构建。
    * 守护进程使用包装器负责解决依赖关系、执行构建脚本、创建和运行任务，并将输出发送给客户端。
    * 客户端和守护进程之间的通信通过本地套接字连接进行。

## 四、管理与停止

1. **管理**：

    * Gradle自动管理守护进程。如果构建环境配置为利用守护进程，且没有可用守护进程，Gradle就会自动启动一个守护进程，或者使用现有的空闲的兼容守护进程。
    * 守护进程在无操作大约3小时后会自动终止，以避免长时间占用系统资源。

2. **停止**：

    * 使用命令`gradle --stop`可以请求所有与当前Gradle版本匹配的守护进程终止。
    * 也可以通过操作系统手动关闭守护进程。

## 五、注意事项与兼容性

1. **注意事项**：

    * 守护进程可能消耗一定量的内存，对于资源有限的环境，需要权衡其带来的好处与资源占用。
    * 在持续集成和构建服务器环境下，通常不推荐启用守护进程，因为这类环境往往是瞬时的，守护进程可能无法有效发挥作用。

2. **兼容性**：

    * 守护进程与Gradle版本紧密相关，不同版本的守护进程不能混用。
    * 守护进程的兼容性基于请求的构建环境（包括Java版本、JVM属性、Gradle版本等）的精确匹配。

综上所述，Gradle守护进程是一个强大的工具，可以显著提高Gradle构建的效率和性能。通过合理管理和配置Gradle守护进程，开发者可以更加高效地进行项目构建和开发工作。
