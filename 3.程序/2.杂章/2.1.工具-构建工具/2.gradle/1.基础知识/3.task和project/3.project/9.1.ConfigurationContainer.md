# ConfigurationContainer

`ConfigurationContainer` 是 Gradle 中用于管理 `Configuration` 对象的容器。在构建过程里，它对依赖项进行分组和管理，从而使项目的依赖管理更加灵活和高效。以下将从其概述、常用操作、应用场景和注意事项几个方面详细介绍 `ConfigurationContainer`。

## 概述

在 Gradle 里，`Configuration` 代表一组依赖项的集合，而 `ConfigurationContainer` 就是存储和管理这些 `Configuration` 对象的容器。它是一个可迭代的集合，提供了一系列方法来创建、访问、修改和删除 `Configuration` 对象。通过 `project.configurations` 可以获取当前项目的 `ConfigurationContainer` 实例。

## 常用操作

### 1. 创建配置

可以使用 `create` 方法来创建新的 `Configuration` 对象。

- **Groovy DSL**

```groovy
// 创建一个名为 customConfig 的配置
def customConfig = project.configurations.create('customConfig')
```

- **Kotlin DSL**

```kotlin
// 创建一个名为 customConfig 的配置
val customConfig by configurations.creating
```

### 2. 访问配置

可以通过配置的名称来访问 `Configuration` 对象。

- **Groovy DSL**

```groovy
// 获取名为 implementation 的配置
def implementationConfig = project.configurations.getByName('implementation')
```

- **Kotlin DSL**

```kotlin
// 获取名为 implementation 的配置
val implementationConfig = configurations.getByName("implementation")
```

### 3. 检查配置是否存在

可以使用 `hasProperty` 或 `findByName` 方法来检查某个配置是否存在。

- **Groovy DSL**

```groovy
if (project.configurations.hasProperty('customConfig')) {
    println 'customConfig exists'
}

def config = project.configurations.findByName('customConfig')
if (config != null) {
    println 'customConfig found'
}
```

- **Kotlin DSL**

```kotlin
if ("customConfig" in configurations) {
    println("customConfig exists")
}

val config = configurations.findByName("customConfig")
if (config != null) {
    println("customConfig found")
}
```

### 4. 删除配置

使用 `remove` 方法可以删除指定的配置。

- **Groovy DSL**

```groovy
if (project.configurations.hasProperty('customConfig')) {
    project.configurations.remove(project.configurations.getByName('customConfig'))
}
```

- **Kotlin DSL**

```kotlin
configurations.findByName("customConfig")?.let {
    configurations.remove(it)
}
```

### 5. 配置继承

可以通过 `extendsFrom` 方法让一个配置继承另一个配置的依赖。

- **Groovy DSL**

```groovy
def baseConfig = project.configurations.create('baseConfig')
def childConfig = project.configurations.create('childConfig')
childConfig.extendsFrom(baseConfig)
```

- **Kotlin DSL**

```kotlin
val baseConfig by configurations.creating
val childConfig by configurations.creating {
    extendsFrom(baseConfig)
}
```

## 应用场景

### 1. 分离不同环境的依赖

可以为开发、测试、生产等不同环境创建不同的配置，分别管理它们的依赖。

```groovy
configurations {
    devDependencies
    testDependencies
    prodDependencies
}

dependencies {
    devDependencies 'com.example:dev-library:1.0.0'
    testDependencies 'com.example:test-library:1.0.0'
    prodDependencies 'com.example:prod-library:1.0.0'
}
```

### 2. 自定义构建流程

在自定义任务中，可以使用特定的配置来获取所需的依赖。

```groovy
task myTask {
    doLast {
        project.configurations.customConfig.files.each { file ->
            println "Processing file: ${file.name}"
        }
    }
}
```

## 注意事项

- **命名冲突**：配置的名称必须唯一，避免出现命名冲突，否则会导致 Gradle 构建出错。
- **依赖传递**：当一个配置继承另一个配置时，要注意依赖的传递性，避免引入不必要的依赖。
- **性能影响**：过多的配置和复杂的依赖关系可能会影响 Gradle 的构建性能，因此要合理使用配置。

通过 `ConfigurationContainer`，可以灵活地管理项目的依赖配置，满足不同项目的构建需求。
