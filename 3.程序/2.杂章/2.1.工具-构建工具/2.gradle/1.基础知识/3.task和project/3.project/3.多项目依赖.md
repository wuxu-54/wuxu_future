# 多项目依赖

在 Gradle 中，管理多项目依赖（multi-project dependencies）是一种常见的做法，特别是当你有一个大型项目需要拆分成多个子项目时。这种方式有助于代码复用、模块化和独立构建。
>Android 项目中有一个父级项目，会引入其他子项目。可以通过命令查看依赖树进行管理

以下是如何在 Gradle 中配置多项目依赖的步骤：

## 1. 项目结构

首先，你需要有一个合适的项目结构。例如，一个根项目包含多个子项目：

```sh
rootProject/
├── build.gradle
├── settings.gradle
├── subProjectA/
│   ├── build.gradle
│   └── src/
│       └── main/
│           └── java/
│               └── ...
└── subProjectB/
    ├── build.gradle
    └── src/
        └── main/
            └── java/
                └── ...
```

## 2. 配置 `settings.gradle`

在 `settings.gradle` 文件中，你需要包含所有子项目：

```groovy
rootProject.name = 'rootProject'
include 'subProjectA', 'subProjectB'
```

## 3. 配置根项目的 `build.gradle`

通常，根项目的 `build.gradle` 文件是空的或仅包含一些全局配置。如果你需要全局插件或依赖，可以在这里添加：

```groovy
// rootProject/build.gradle
subprojects {//这就是向所有子project进行配置
    apply plugin: 'java'

    repositories {
        mavenCentral()
    }

    dependencies {
        testImplementation 'junit:junit:4.13.2'
    }
}
```

## 4. 配置子项目的 `build.gradle`

每个子项目可以有自己的 `build.gradle` 文件，定义该项目的特定依赖和配置。例如：

### `subProjectA/build.gradle`

```groovy
dependencies {
    // 可以在这里添加 subProjectA 的特定依赖
    //这其实引入的也是Maven依赖。Maven 项目的坐标（Group ID、Artifact ID 和 Version）
    implementation 'org.apache.commons:commons-lang3:3.12.0'
}
```

### `subProjectB/build.gradle`

```groovy
dependencies {
    // 添加对 subProjectA 的依赖
    implementation project(':subProjectA')

    // 可以在这里添加 subProjectB 的特定依赖
    implementation 'com.google.guava:guava:31.0.1-jre'
}
```

在 `subProjectB` 的 `build.gradle` 文件中，`implementation project(':subProjectA')` 表示 `subProjectB` 依赖于 `subProjectA`。

## 5. 构建和运行

现在，你可以使用 Gradle 命令来构建和运行你的多项目构建。例如：

```sh
# 构建所有项目
./gradlew build

# 仅构建 subProjectB
./gradlew :subProjectB:build

# 运行所有测试
./gradlew test
```

## 6. 注意事项

- **依赖解析**：Gradle 会自动处理项目间的依赖关系，并正确地编译和打包。
- **版本管理**：确保所有子项目使用的插件和库版本一致，以避免版本冲突。
- **性能优化**：对于大型项目，可以考虑使用 Gradle 的增量构建和缓存功能来提高构建速度。

通过以上步骤，你可以在 Gradle 中有效地管理多项目依赖，使你的项目结构更加清晰和模块化。

---

## 共享依赖

在Gradle中实现多项目共享依赖，可以通过以下几种方式来实现：

### 一、利用根项目的`build.gradle`文件

1. **在根项目的`build.gradle`中配置共同依赖**：

   - 可以在根项目的`build.gradle`文件中，使用`allprojects`或`subprojects`闭包为所有子项目或特定子项目配置共同的依赖。
   - `allprojects`闭包会应用于所有项目（包括根项目），而`subprojects`闭包则仅应用于子项目。

2. **使用`ext`块定义版本号**：

   - 在根项目的`build.gradle`文件中，使用`ext`块定义依赖项的版本号，然后在子项目的`build.gradle`文件中引用这些版本号。
   - 这样做可以避免在每个子项目中重复定义版本号，同时也方便统一管理和更新依赖项的版本。

### 二、使用`settings.gradle`和`buildSrc`

1. **在`settings.gradle`中定义项目结构**：

   - 使用`include`语句在`settings.gradle`文件中定义要包含的子项目。

2. **利用`buildSrc`共享依赖管理**：

   - `buildSrc`是一个特殊的项目，Gradle会自动将其编译并添加到所有其他项目的类路径中。
   - 可以在`buildSrc`项目中定义依赖项的版本号或创建自定义的Gradle插件，然后在其他子项目中引用这些依赖项或插件。

### 三、使用Gradle的Version Catalog特性（Gradle 7.0+）

1. **启用Version Catalog特性**：

   - 在`settings.gradle`文件中，通过`enableFeaturePreview('VERSION_CATALOGS')`语句启用Version Catalog特性。

2. **配置`libs.versions.toml`文件**：

   - 在项目的根目录下创建`libs.versions.toml`文件，并在其中定义依赖项和版本号。
   - Gradle会读取这个文件，并生成一个`libs`目录，用于在子项目的`build.gradle`文件中引用依赖项。

3. **在子项目中引用依赖项**：

   - 在子项目的`build.gradle`文件中，使用`libs`目录来引用依赖项。例如，`implementation(libs.someDependency)`。

### 四、项目间的直接依赖

1. **在子项目中声明对其他子项目的依赖**：

   - 如果一个子项目需要依赖于另一个子项目的输出（如库或模块），可以在该子项目的`build.gradle`文件中使用`implementation project(':projectName')`语句来声明依赖关系。

2. **确保项目间的依赖关系正确配置**：

   - 在`settings.gradle`文件中，确保所有相关的子项目都已被包含。
   - 在子项目的`build.gradle`文件中，正确配置依赖项的版本和依赖关系。

通过以上方式，可以在Gradle中实现多项目共享依赖，提高构建效率和代码复用性。同时，也需要注意依赖冲突、缓存问题和性能问题等方面的处理。
