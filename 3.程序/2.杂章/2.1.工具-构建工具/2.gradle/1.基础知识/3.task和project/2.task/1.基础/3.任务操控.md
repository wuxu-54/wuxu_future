# 任务操控

通过API可以对已建任务进行控制，以下是对Gradle任务操控和API目录的详细解释：

## 一、Gradle任务操控

1. **任务定义**：
   - 使用`task`关键字定义任务。
   - 可以为任务指定名称、分组、描述等属性。
   - 在任务体内，可以使用`doFirst`和`doLast`方法来指定任务执行的先后顺序。

2. **任务依赖**：
   - 使用`dependsOn`属性来设置任务之间的依赖关系。
   - 当一个任务依赖于另一个任务时，Gradle会确保先执行被依赖的任务。

3. **任务执行**：
   - 在命令行中使用`gradle [taskName...]`命令来执行任务。
   - 可以同时执行多个任务，Gradle会按照任务之间的依赖关系来确定执行顺序。

4. **任务操控方法**：
   - `enabled`：控制任务是否可以被执行。
   - `onlyIf`：指定一个条件，只有当条件为真时，任务才会被执行。
   - `doFirst`和`doLast`：分别用于在任务执行前和执行后添加额外的操作。

## 二、示例代码

### 简单示例

1. 增加依赖

    ```groovy
    4.times{counter->
        task "task$counter" <<{
            println("task number: $counter");
        }
    }

    task0.dependsOn task2,task3
    ```

    此示例，展示的是通过api进行依赖设置

2. 增加任务行为

    ```groovy
    task hello << {
        println "hello Earth"
    }
    hello.doFirst{//这就是api中的doFirst
        println "hello 1"
    }
    hello.doLast{//这就是api中的doLast
        println "hello 2"
    }
    hello << {//等同于api中的doLast
        println "hello 3"
    }
    ```

    此示例，展示的是使用api `doFirst`、`doLast`、`<<` 增加任务行为。

### Gradle构建脚本示例

以下是一个简单的Gradle构建脚本示例，展示了如何定义任务、设置依赖关系以及使用API来操控项目：

```groovy
// 定义项目属性
ext {
    version = '1.0.0'
}

// 定义任务taskA
task taskA {
    group = 'Example'
    description = 'This is task A'
    doLast {
        println 'Executing task A'
    }
}

// 定义任务taskB，依赖于taskA
task taskB {
    dependsOn taskA
    doLast {
        println 'Executing task B (depends on task A)'
    }
}

// 使用Project API获取所有子项目并配置仓库地址
allprojects {
    repositories {
        mavenCentral()
    }
}

// 使用File API复制文件
task copyFiles(type: Copy) {
    from 'src/main/resources'
    into 'build/resources/main'
}

// 使用Property API设置项目版本
version = '2.0.0'
println "Project version: ${version}"
```

在这个示例中，我们定义了两个任务`taskA`和`taskB`，其中`taskB`依赖于`taskA`。我们还使用了Project API来获取所有子项目并配置仓库地址，使用了File API来复制文件，以及使用了Property API来设置和读取项目版本。

综上所述，Gradle提供了丰富的任务操控和API接口来支持项目的构建和管理。通过理解和使用这些API，开发者可以更加灵活和高效地构建和管理Gradle项目。
