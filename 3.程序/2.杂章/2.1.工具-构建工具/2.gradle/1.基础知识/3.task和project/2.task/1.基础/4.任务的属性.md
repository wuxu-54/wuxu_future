# 属性

task任务有很多属性，我们可以通过属性对任务进行行为变更或延展。

## 1. 短标记法

在Gradle中，短标记法（Shorthand Notation）是一种简洁的任务定义方式，它允许开发者使用`<<`操作符来快速添加任务的动作（Action）。这种写法利用了Groovy的操作符重载特性，将左位移操作符`<<`实现为将动作添加到任务的最后，相当于调用`doLast`方法。然而，需要注意的是，这种语法已经不被推荐使用，并且在较新版本的 Gradle 中可能会被废弃或移除（5.0被移除）。

例如，假设你有一个名为 `hello` 的任务，并且你想在该任务执行完毕后打印一条消息，你可以这样写：

```groovy
task hello {
    doLast {
        println 'Hello, Gradle!'
    }
}
```

使用 `<<` 操作符的等价写法（不推荐）是：

```groovy
task hello {
    << {
        println 'Hello, Gradle!'
    }
}
```

然而，更现代和推荐的方式是使用 `doLast` 块，因为它更加清晰和易于理解。

总结来说，`<<` 在 Gradle 中用于表示任务的“doLast”动作，但这是一个过时的语法，建议使用 `doLast` 块来替代。

## 2. 常见任务属性

在 Gradle 中，任务（Task）具有多种属性，这些属性可以用来配置任务的行为和获取任务的信息。以下是一些常用的任务属性和它们的使用示例：

### 1. 名称（Name）

每个任务都有一个名称，它是任务的唯一标识符。

```groovy
task myTask {
    println "Task name is ${name}"
}
```

### 2. 描述（Description）

任务的描述提供了任务的简短描述，这可以在列出所有任务时显示。

```groovy
task myTask {
    description = 'This task does something important'
    doLast {
        println 'Executing my task'
    }
}
```

### 3. 组（Group）

任务可以被分配到一个组，这有助于在列出所有任务时对任务进行分类。

```groovy
task myTask {
    group = 'verification'
    description = 'Runs tests'
    doLast {
        println 'Running tests'
    }
}
```

### 4. 依赖（Depends On）

任务可以声明它们依赖于哪些其他任务。这意味着在执行当前任务之前，必须先执行所依赖的任务。

```groovy
task myTask {
    dependsOn 'clean', 'compile'
    doLast {
        println 'Doing something after clean and compile'
    }
}
```

### 5. 必须运行条件（Must Run After）

任务可以声明它们必须在哪些其他任务之后执行。

```groovy
task myTask {
    mustRunAfter 'clean'
    doLast {
        println 'Doing something after clean'
    }
}
```

### 6. 输入和输出属性（Inputs and Outputs）

任务可以使用 `@Input` 和 `@Output` 注解来标记它们的输入和输出属性，这有助于 Gradle 判断任务是否需要重新执行。

```groovy
task copyFile {
    @Input
    String source

    @Output
    File destination

    doLast {
        destination.text = new File(source).text
    }
}
```

### 7. 只做一次（Do Once）

`doFirst` 和 `doLast` 方法允许你在任务执行前后添加操作，而 `onlyIf` 可以指定一个条件，只有当条件为真时，任务才会执行。

```groovy
task myTask {
    doFirst {
        println 'Starting my task'
    }
    doLast {
        println 'Finishing my task'
    }
    onlyIf { true } // 只有当条件为真时才执行任务
    doLast {
        println 'Executing my task'
    }
}
```

### 8. 禁用任务（Disabled）

你可以使用 `enabled` 属性来启用或禁用一个任务。

```groovy
task myTask {
    enabled = false
    doLast {
        println 'This task is disabled and will not run'
    }
}
```

### 9. 任务类型（Type）

每个任务都有一个类型，你可以通过 `getClass()` 方法来获取任务的类型。

```groovy
task myTask {
    doLast {
        println "Task type is ${getClass()}"
    }
}
```

### 10. 任务动作（Actions）

任务的动作可以通过 `getActions()` 方法来获取，这允许你检查或修改任务的动作列表。

```groovy
task myTask {
    doLast {
        println 'Executing my task'
    }
}

myTask.getActions().each {
    println "Action: $it"
}
```

## 3. 自定义属性

Gradle自定义属性是Gradle构建脚本中一个重要的功能，它允许用户为Project和Task等对象添加额外的属性，以便在构建过程中使用。以下是对Gradle自定义属性的详细解释：

### 一、自定义属性的添加

1. **通过ext关键字添加**：ext对象其实是DefaultExtraPropertiesExtension对象的一个实例，为领域对象设定属性。

    - Gradle允许通过ext关键字为Project和Task等对象添加额外的属性。
    - 对于Project对象，可以直接在build.gradle文件中使用`ext.propertyName = value`的形式添加属性。
    - 对于Task对象，同样可以使用ext关键字在任务定义内部添加属性。

2. **通过ext代码块添加**

    - 如果需要同时添加多个属性，可以使用ext代码块，这样代码更加整洁。
    - 示例：`ext { property1 = value1; property2 = value2 }`

### 二、自定义属性的访问

1. **直接访问**

    - 在添加了自定义属性后，可以直接通过属性名访问这些属性，无需使用ext前缀。
    - 示例：`println property1`

2. **通过对象访问**

    - 在某些情况下，为了明确属性所属的对象，可以通过对象名访问属性。
    - 示例：`println project.property1` 或 `println task.property2`

### 三、自定义属性的作用域

1. **Project级别的属性**

    - 通过ext关键字在Project对象上添加的属性，可以在整个Project范围内访问。
    - 这些属性对于所有的Task和子Project都是可见的。

2. **Task级别的属性**

    - 通过ext关键字在Task对象上添加的属性，只能在该Task内部访问。
    - 这些属性对于其他Task和Project是不可见的。

### 四、自定义属性的应用场景

1. **配置Plugin**

    - 很多Plugin都会向Project中加入额外的Property，在使用这些Plugin时，用户需要对这些Property进行赋值。
    - 通过自定义属性，可以方便地配置这些Plugin。

2. **跨Project和Task共享数据**

    - 自定义属性可以跨Project和Task访问，因此可以用于在不同Project和Task之间共享数据。

3. **管理版本信息**

    - 在项目中，版本号和版本名称等信息经常变动。
    - 通过将这些信息放在单独的Gradle文件中，并使用自定义属性来引用它们，可以更方便地管理这些信息。

### 五、自定义属性的命名约定

1. **驼峰式命名**

    - 属性名称应该使用驼峰式的命名规则。

2. **双引号括起来**

    - 属性值应该尽量使用双引号括起来。

### 六、自定义属性的其他设置方式

1. **通过gradle.properties文件设置**

    - 可以在gradle.properties文件中声明属性，这些属性可以通过项目实例访问。
    - gradle.properties文件通常位于USER\_HOME/.gradle目录或项目的根目录下。

2. **通过命令行参数设置**

    - Gradle提供了-P命令行参数来设置属性。
    - 示例：`gradle -PpropertyName=value taskName`

3. **通过系统属性设置**

    - 在Gradle中，也可以通过-D的方式来设置JVM的系统参数，但需要遵循一些约定。
    - 每个通过-D方式声明的属性都需要以“org.gradle.project”为前缀。

4. **通过设置环境变量设置**

    - 还可以通过设置环境变量的方式来设置Project的属性。
    - 每个属性都需要以“ORG\_GRADLE\_PROJECT\_”为前缀。

### 七、示例：在Gradle中定义和使用自定义属性

以下是一个Gradle自定义属性的示例，展示了如何在Gradle构建脚本中定义、访问和使用自定义属性。

#### 1. 定义自定义属性

在`build.gradle`文件中，你可以通过`ext`关键字为Project对象添加自定义属性。例如：

```groovy
// 定义Project级别的自定义属性
ext {
    myCustomProperty = 'This is a custom property'
    myVersion = '1.0.0'
    myBooleanFlag = true
}

// 也可以在Task定义内部为Task添加自定义属性
task myTask {
    ext.taskSpecificProperty = 'This is a task-specific property'//自定义task内的属性，ext可以省略不写

    doLast {
        println "Task-specific property: ${taskSpecificProperty}"
    }
}
```

#### 2. 访问自定义属性

在定义了自定义属性后，你可以在整个Project范围内或Task内部访问这些属性。例如：

```groovy
// 在Project范围内访问自定义属性
task printProperties {
    doLast {
        println "Custom property: ${myCustomProperty}"
        println "Version: ${myVersion}"
        println "Boolean flag: ${myBooleanFlag}"
    }
}

// 在Task内部访问Task特定的自定义属性（已在myTask中定义）
// 注意：这里不需要再次定义，只需在myTask任务中访问即可
```

#### 3. 使用自定义属性

自定义属性可以在Gradle构建脚本的任何地方使用，包括在任务（Task）中、依赖配置中、插件配置中等。例如：

```groovy
// 使用自定义属性设置依赖版本
dependencies {
    implementation "com.example:my-library:${myVersion}"
}

// 使用自定义属性控制任务执行
task conditionalTask {
    onlyIf { myBooleanFlag }
    doLast {
        println 'This task will only execute if myBooleanFlag is true'
    }
}
```

#### 4. 命令行参数和环境变量设置自定义属性

除了直接在`build.gradle`文件中定义自定义属性外，你还可以通过命令行参数或环境变量来设置这些属性。例如：

- 通过命令行参数设置：

  ```bash
  gradle -PmyCustomProperty='New value from command line' printProperties
  ```

- 通过环境变量设置（需要遵循`ORG_GRADLE_PROJECT_`前缀的约定）：

  ```bash
  export ORG_GRADLE_PROJECT_myCustomProperty='New value from environment variable'
  gradle printProperties
  ```

#### 注意事项

- 自定义属性的命名应避免与Gradle内置属性冲突。
- 在多项目构建中，自定义属性可以在根项目的`build.gradle`文件中定义，并被子项目继承和使用。
- 使用自定义属性可以提高构建脚本的灵活性和可维护性，但过度使用也可能导致脚本变得复杂和难以管理。因此，建议合理使用自定义属性，并根据项目的实际需求进行配置。

通过以上示例和注意事项，你可以更好地理解和使用Gradle自定义属性来优化你的构建脚本。
