# 任务排序

在 Gradle 中，任务（Task）的排序和依赖管理是构建过程中的重要部分。以下是关于 Gradle 任务排序的详细说明和示例：

## 1. 任务依赖关系

使用 `dependsOn` 方法可以指定一个任务依赖于其他任务，这样在执行当前任务之前，Gradle 会确保所有依赖的任务都已完成。

```groovy
task taskA {
    doLast {
        println 'Task A executed'
    }
}

task taskB {
    dependsOn taskA // Task B 依赖于 Task A
    doLast {
        println 'Task B executed'
    }
}
```

在这个例子中，执行 `taskB` 时，Gradle 会首先执行 `taskA`。

## 2. 任务执行顺序

使用 `mustRunAfter` 和 `shouldRunAfter` 方法可以控制任务的执行顺序。

- **mustRunAfter**：表示当前任务必须在指定的任务之后执行。
  
```groovy
task taskC {
    doLast {
        println 'Task C executed'
    }
}

task taskD {
    mustRunAfter taskC // Task D 必须在 Task C 之后执行
    doLast {
        println 'Task D executed'
    }
}
```

- **shouldRunAfter**：表示当前任务应该在指定的任务之后执行，但不是强制的。

```groovy
task taskE {
    doLast {
        println 'Task E executed'
    }
}

task taskF {
    shouldRunAfter taskE // Task F 应该在 Task E 之后执行
    doLast {
        println 'Task F executed'
    }
}
```

## 3. 任务的条件执行

使用 `onlyIf` 方法可以为任务添加条件，只有在条件为真时任务才会执行。

```groovy
task conditionalTask {
    onlyIf { project.hasProperty('runTask') } // 只有在指定属性存在时才执行
    doLast {
        println 'Conditional Task executed'
    }
}
```

## 4. 并行执行

Gradle 允许并行执行任务，这可能会影响任务的执行顺序。使用 --parallel 命令行选项可以启用并行执行。

```sh
gradle build --parallel
```

并行执行时，任务的执行顺序可能不再严格按照依赖关系来确定，因为多个任务可以同时运行。

## 5. 调度优先级

Gradle 守护进程的调度优先级可以通过命令行选项 --priority 设置。这个选项影响 Gradle 守护进程及其启动的所有进程的调度优先级，但不影响任务在构建脚本中设置的依赖关系。

```sh
gradle build --priority low
```

这个选项可以设置为 normal 或 low，影响守护进程的调度优先级，而不是任务的执行顺序。

## 6. 任务的执行顺序

在 Gradle 中，任务的执行顺序可以通过 `dependsOn`、`mustRunAfter` 和 `shouldRunAfter` 方法来控制。合理使用这些方法可以确保任务按预期顺序执行，避免潜在的错误。

## 7. 任务的动态创建

你可以在构建脚本中动态创建任务，并为它们设置依赖关系和执行顺序。

```groovy
(1..3).forEach { i ->
    tasks.register("task$i") {
        doLast {
            println "Executing task $i"
        }
    }
}

tasks.named("task1") {
    dependsOn("task2") // 设置依赖关系
}
```

## 8. 任务的属性

每个任务都有一些属性，如 `name`、`description`、`group` 等，可以在创建任务时进行配置。

```groovy
task myTask {
    description = 'This is my custom task'
    group = 'Custom Tasks'
}
```

## 9. 任务的执行状态

你可以使用 `didWork` 属性来检查任务是否实际执行了工作。

```groovy
task myTask {
    doLast {
        println 'Doing some work'
    }
}

println("Did myTask do work? ${myTask.didWork}")
```

通过这些方法和示例，你可以有效地管理和控制 Gradle 中的任务执行顺序和依赖关系，从而实现复杂的构建逻辑和流程管理。更多详细信息可以参考 Gradle 官方文档 [Task - Gradle DSL Version](https://docs.gradle.org/current/dsl/org.gradle.api.Task.html) 。
