# 简介

Gradle中的文件操作是一个强大的功能，它允许开发者在构建脚本中直接对文件系统进行操作。以下是对Gradle文件操作的解析及示例：

## 一、本地文件操作

Gradle使用`Project.file(java.lang.Object)`方法来操作本地文件。这个方法接受一个文件的相对路径或绝对路径，并返回一个`File`对象。相对路径是相对于当前项目的根目录，而不是当前工作空间的目录。

### 本地文件操作示例代码

```groovy
// 使用相对路径
File configFile = file('src/test.xml')
configFile.createNewFile() // 创建文件

// 使用绝对路径
configFile = file('/Users/dds/HelloWorld/src/test.xml')
println(configFile.absolutePath) // 打印文件的绝对路径

// 使用一个文件对象
configFile = file(new File('src/test.xml'))
println(configFile.exists()) // 打印文件是否存在
```

## 二、文件集合

文件集合是一组文件的列表，在Gradle中用`FileCollection`接口表示。可以使用`Project.files(java.lang.Object[])`方法来获得一个文件集合对象。文件集合是延迟操作的，即文件集合中的文件对象在需要时才会被真正创建。

### 文件集合示例代码

```groovy
FileCollection collection = files('src/test1.txt', new File('src/test2.txt'), ['src/test3.txt', 'src/test4.txt'])

// 遍历文件集合
collection.each { File file ->
    println file.name
}

// 转换文件集合
Set set1 = collection.files
Set set2 = collection as Set
List list = collection as List
String path = collection.asPath
File file1 = collection.singleFile
File file2 = collection as File

// 添加或删除文件
def union = collection + files('src/test5.txt')
def different = collection - files('src/test3.txt')
```

## 三、文件树

文件树是有层级结构的文件集合，可以代表一个目录结构或ZIP压缩包中的内容结构。文件树是从文件集合继承过来的，因此具有文件集合的所有功能。可以使用`Project.fileTree(java.util.Map)`方法来创建**文件树对象**，并可以使用过滤条件来包含或排除相关文件。`FileTree` 继承自 `FileCollection`

### 文件树示例代码

创建：

```groovy
// 指定目录创建文件树对象
FileTree tree = fileTree(dir: 'src/main')

// 添加包含指定文件
tree.include '**/*.java'

// 添加排除指定文件
tree.exclude '**/Abstract*'

// 使用路径创建文件树对象，同时指定包含的文件
tree = fileTree('src').include('**/*.java')

// 通过闭包创建文件树
tree = fileTree('src') {
    include '**/*.java'
}

// 通过map创建文件树
tree = fileTree(dir: 'src', include: '**/*.java')
tree = fileTree(dir: 'src', includes: ['**/*.java', '**/*.xml'])
tree = fileTree(dir: 'src', include: '**/*.java', exclude: '**/*test*/**')
```

使用文件树：

```groovy
// 遍历文件树的所有文件
tree.each { File file ->
    println file
}

// 过滤生成新的文件树对象
FileTree filtered = tree.matching {
    include 'org/gradle/api/**'
}

// 合并两个文件树
FileTree sum = tree + fileTree(dir: 'src/test')

// 访问文件树的元素
tree.visit {element ->
    println "$element.relativePath => $element.file"
}
```

### 使用一个归档文件的内容作为文件树

你可以使用 ZIP 或者 TAR 等压缩文件的内容作为文件树, `Project.zipTree()` 和 `Project.tarTree()` 方法返回一个 `FileTree` 实例, 你可以像使用其他文件树或者文件集合一样使用它.例如,你可以使用它去扩展一个压缩文档或者合并一些压缩文档.

```groovy
// 使用路径创建一个 ZIP 文件
FileTree zip = zipTree('someFile.zip')
// 使用路径创建一个 TAR 文件
FileTree tar = tarTree('someFile.tar')
//tar tree 能够根据文件扩展名得到压缩方式,如果你想明确的指定压缩方式,你可以使用下面方法
FileTree someTar = tarTree(resources.gzip('someTar.ext'))
```

## 四、文件拷贝

Gradle提供了`Copy`任务来拷贝文件。`Copy`任务必须指定一组需要拷贝的文件和拷贝到的目录。可以使用`CopySpec.from(java.lang.Object[])`方法指定原文件，使用`CopySpec.into(java.lang.Object)`方法指定目标目录。

### 文件拷贝示例代码

```groovy
task copyTask(type: Copy) {
    from 'src/main/resources'
    into 'build/config'
}

task copyTaskWithPatterns(type: Copy) {
    from 'src/main/webapp'
    into 'build/explodedWar'
    include '**/*.html'
    include '**/*.jsp'
    exclude { details ->
        details.file.name.endsWith('.html') && details.file.text.contains('staging')
    }
}
```

在上面的示例中，`copyTask`任务将`src/main/resources`目录下的所有文件拷贝到`build/config`目录。而`copyTaskWithPatterns`任务则更加复杂，它拷贝`src/main/webapp`目录下的所有`.html`和`.jsp`文件到`build/explodedWar`目录，但排除了文件名以`.html`结尾且内容包含`staging`的文件。

综上所述，Gradle提供了丰富的文件操作方法，包括本地文件操作、文件集合、文件树和文件拷贝等。这些功能使得Gradle在构建自动化和项目管理方面更加灵活和强大。
