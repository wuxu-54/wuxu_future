# idea插件旧版开发流程

本文转载自：[学习原文](https://blog.csdn.net/yyh352091626/article/details/100008609)
>注意，本网页的内容是19年的，虽然已经过时了，但仍可以快速了解插件开发知识外。

---

## 1. 一段话总结原文内容  

**IDEA插件开发**需通过**Plugin Devkit**创建工程，核心组件包括**Action**（实现用户交互）、**Component**（生命周期管理）和**持久化存储**（PropertiesComponent/PersistentStateComponent）。通过**plugin.xml**配置插件信息、注册Action和组件，使用GUI Designer设计界面，最终打包为.jar或.zip文件安装发布。关键步骤包括**创建工程→编写逻辑→配置→调试→打包→上传**。

## 2. 思维导图  

```txt
IDEA插件开发  
├─ 工程创建  
│  ├─ 启用Plugin Devkit  
│  ├─ 工程结构（src/resources/META-INF/plugin.xml）  
│  └─ plugin.xml配置（id/name/version/depends/action/extension）  
├─ 核心组件  
│  ├─ Action  
│  │  ├─ 创建（继承AnAction）  
│  │  ├─ 注册（xml中配置菜单/快捷键）  
│  │  └─ 事件处理（actionPerformed/update）  
│  ├─ Component  
│  │  ├─ 类型（Application/Project/Module）  
│  │  ├─ 创建与注册（xml声明）  
│  │  └─ 获取实例（ApplicationManager/Project/Module）  
│  └─ 持久化  
│     ├─ PropertiesComponent（简单键值对）  
│     └─ PersistentStateComponent（复杂对象，@State注解）  
├─ GUI设计  
│  ├─ 使用GUI Designer拖拽布局  
│  ├─ 生成Java代码（绑定控件）  
│  └─ 预览与测试  
├─ 打包与发布  
│  ├─ 生成.jar/.zip文件  
│  ├─ 本地安装（Preferences→Plugins→From Disk）  
│  └─ 上传至官方仓库  
└─ 调试与日志  
   ├─ 配置运行参数（VM Options）  
   └─ 控制台日志输出  
```

## 3. 详细总结  

### **1. 插件工程基础**  

- **创建步骤**：启用Plugin Devkit → 新建IntelliJ Platform Plugin工程 → 配置工程信息（名称/路径）。  
- **工程结构**：  

  ```txt
  BundleFileFinder/  
    src/               # 代码逻辑  
    resources/         # 资源文件（如插件图标）  
      META-INF/  
        plugin.xml     # 核心配置文件  
  ```  

- **plugin.xml核心配置**：  

  | 标签名          | 作用                     | 示例值                  |  
  |-----------------|--------------------------|-------------------------|  
  | `<id>`          | 插件唯一标识             | `com.yuyang.finder`     |  
  | `<depends>`     | 依赖插件                 | `com.intellij.modules.all` |  
  | `<actions>`     | 注册Action               | `FinderAction`          |  
  | `<application-components>` | 注册全局组件 | `FinderApplication`     |  

### **2. 核心组件**  

- **Action**：  
  - **功能**：定义用户交互行为（如菜单点击、快捷键触发）。  
  - **关键方法**：`actionPerformed()`（执行逻辑）、`update()`（状态更新）。  
  - **注册方式**：在`plugin.xml`中配置菜单位置（如`ProjectViewPopupMenu`）和快捷键。  

- **Component**：  

  | 类型              | 作用范围               | 初始化时机               |  
  |-------------------|------------------------|--------------------------|  
  | Application       | 全局（IDEA启动时）     | `ApplicationManager.getApplication()` |  
  | Project           | 当前项目               | `event.getData(PlatformDataKeys.PROJECT)` |  
  | Module            | 当前模块               | `project.getComponent(FinderModule.class)` |  

### **3. 持久化存储**  

- **简单配置**：`PropertiesComponent`（键值对存储，支持全局/项目级）。  

  ```java  
  PropertiesComponent.getInstance().setValue("key", "value");  
  ```  

- **复杂对象**：`PersistentStateComponent`（需实现`getState()`和`loadState()`，支持自定义存储路径）。  

  ```java  
  @State(storages = @Storage("config.xml"))  
  class MyState implements PersistentStateComponent<MyState> {  
      public String value;  
  }  
  ```  

### **4. GUI设计**  

- **工具**：通过IDEA内置的GUI Designer拖拽控件生成布局代码。  
- **步骤**：  
  1. 新建GUI Form（如`Demo.form`）。  
  2. 拖拽控件并配置属性（如`field name`绑定Java变量）。  
  3. 生成Java代码（自动创建`Demo.java`并绑定控件）。  
  4. 运行`main()`方法预览界面。  

### **5. 打包与安装**  

- **打包**：`Build → Prepare All Plugin Modules For Deployment`，生成`.jar`（无依赖）或`.zip`（含依赖）。  
- **安装**：`Preferences → Plugins → Install Plugin From Disk`，选择打包文件。  

## 4. 关键问题  

**Q1：如何区分Application Component、Project Component和Module Component？**  
**A1**：  

- **Application Component**：全局唯一，IDEA启动时初始化（如日志管理器）。  
- **Project Component**：每个项目独立实例，项目打开时创建（如项目配置管理器）。  
- **Module Component**：每个模块独立实例，模块加载时创建（如模块构建工具）。  

**Q2：如何实现插件的配置持久化？**  
**A2**：  

- **简单配置**：使用`PropertiesComponent`存储键值对（如用户设置）。  
- **复杂对象**：实现`PersistentStateComponent`接口，通过`@State`注解指定存储路径（如XML文件）。  

**Q3：如何在插件中添加自定义菜单和快捷键？**  
**A3**：  

1. 创建`AnAction`子类，实现`actionPerformed()`逻辑。  
2. 在`plugin.xml`中注册Action：  

   ```xml  
   <action id="FinderAction" class="com.yuyang.finder.FinderAction" text="FileFinder">  
     <add-to-group group-id="ProjectViewPopupMenu" anchor="first"/>  
     <keyboard-shortcut first-keystroke="control alt G"/>  
   </action>  
   ```  

3. 运行插件后，右键菜单或快捷键触发Action。
