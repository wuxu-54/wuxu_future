# 组合模式（又称：部分整体模式）

把一组相似的对象当作一个单一的对象，使得用户可以一致地对待单个对象和对象组合。它允许将对象组合成树状结构，以表示“部分-整体”的层次结构。
>通俗来讲：将相似的对象采用树状结构组合起来，每次调用“树杈”，再由树杈调用叶子或“子树杈”，通过这种方式可以方便的管理这些对象。

类型：结构型

目的：

- 简化树形结构中对象的处理，无论它们是单个对象还是组合对象。
- 解耦客户端代码与复杂元素的内部结构，使得客户端可以统一处理所有类型的节点。

## 结构

组合模式通常包含以下角色：

- **组件接口（Component）**:定义了组合中所有对象的通用接口，可以是抽象类或接口。它声明了用于访问和管理子组件的方法，包括添加、删除、获取子组件等。
- **叶子节点（Leaf）**:表示组合中的叶子节点对象，叶子节点没有子节点。它实现了组件接口的方法，但通常不包含子组件。
- **复合节点（Composite）**:表示组合中的复合对象，复合节点可以包含子节点，可以是叶子节点，也可以是其他复合节点。它实现了组件接口的方法，包括管理子组件的方法。
- **客户端（Client）**:通过组件接口与组合结构进行交互，客户端不需要区分叶子节点和复合节点，可以一致地对待整体和部分。

## 优缺点

- 优点：
  - **透明性**：客户端对单个对象和组合对象的使用没有差别，可以统一处理。
  - **灵活性**：可以很容易地增加新的叶节点和组合节点，符合开闭原则。
  - **层次性**：提供了一种树状结构的组织方式，可以清晰地表示层次关系。

- 缺点：

  - **复杂性**：对于某些简单情况，使用组合模式可能会让问题变得复杂。
  - **性能问题**：如果树状结构很深，对树的遍历操作可能会比较耗时。
  - **违反依赖倒置原则**：组件的声明是基于具体类而不是接口，这可能导致代码的灵活性降低。

## 适用场景

- 当需要表示对象的部分-整体层次结构时。
- 当希望客户端忽略组合对象与单个对象的不同，统一对待它们时。
- 当需要递归地操作树状结构中的所有对象时。

## 注意事项

- 在实现时，确保所有组件都遵循统一的接口，以保持一致性。
- 考虑使用工厂模式来创建不同类型的组件，以进一步解耦组件的创建逻辑。

## 示例

```java
// 组件接口
interface Component {
    void operation();
}

// 叶节点
class Leaf implements Component {
    @Override
    public void operation() {
        System.out.println("Leaf operation");
    }
}

// 组合节点
class Composite implements Component {
    private List<Component> children = new ArrayList<>();

    @Override
    public void operation() {
        for (Component child : children) {
            child.operation();
        }
    }

    public void add(Component component) {
        children.add(component);
    }

    public void remove(Component component) {
        children.remove(component);
    }
}

// 客户端代码
public class CompositePatternDemo {
    public static void main(String[] args) {
        Composite root = new Composite();
        root.add(new Leaf());
        root.add(new Leaf());
        root.add(new Composite());
        ((Composite) root.get(2)).add(new Leaf());

        root.operation(); // 将依次调用所有添加到树中的叶节点和组合节点的operation方法
    }
}
```
