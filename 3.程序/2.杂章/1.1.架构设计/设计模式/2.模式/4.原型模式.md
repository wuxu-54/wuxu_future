# 原型模式

类型：创建型

目的：创建重复对象，同时减小性能开销。其核心是通过克隆（分为深克隆、浅克隆。看自己的需要），实现对象的创建。
>**new** 是先确定数据类型然后根据数据类型分配内存空间，分配完内存后，再去调用构造函数，填充对象的各个域，这一步叫做对象的初始化，构造函数返回后，一个对象构造完成，可以将它的地址发送到外部，在外部就可以使用这个地址操作这个对象。
**clone** 相比new无需确定数据类型可直接开辟原对象相同大小的内存空间，将原对象的内容填充给新对象，相对来说少了很多处理，所以性能更好。

## 结构

原型模式包含以下几个主要角色：

- **原型接口（Prototype Interface）**：定义一个用于克隆自身的接口，通常包括一个 clone() 方法。
- **具体原型类（Concrete Prototype）**：实现原型接口的具体类，负责实际的克隆操作。这个类需要实现 clone() 方法，通常使用浅拷贝或深拷贝来复制自身。
- **客户端（Client）**：使用原型实例来创建新的对象。客户端调用原型对象的 clone() 方法来创建新的对象，而不是直接使用构造函数。

## 优缺点

- 优点
  - 简化对象创建：避免了复杂的构造过程，特别是当对象创建涉及大量步骤或多个依赖时。
  - 性能优势：对于创建成本高的对象，通过克隆可以节省资源。
  - 动态性：可以在运行时动态地创建特定类型的对象。
- 缺点
  - 配备克隆方法需要全面考虑类的功能，对已有类可能较难实现，特别是处理不支持串行化的间接对象或含有循环结构的引用时。
  - 必须实现 Cloneable 接口。
  - 克隆复杂对象：如果对象包含不可克隆的资源（如线程、文件句柄等），则需要特殊处理。
  - 深拷贝和浅拷贝：需要考虑对象克隆时的深拷贝和浅拷贝问题，以确保克隆的对象是独立的。
  - 违反封装原则：实现克隆操作可能需要公开其内部结构，这可能违反对象的封装原则。

## 使用场景

- 资源优化
- 性能和安全要求高的场景
- 一个对象需要多个修改者
- 对象需提供给其他对象访问并可能被各个调用者修改时
- 通常与工厂方法模式一起使用，通过 clone 创建对象，然后由工厂方法提供给调用者
- 当创建新对象的成本较高时，如类初始化需要消耗大量资源（如数据、硬件资源）
- 当系统需要动态增加新对象时。
- 通过 new 创建对象需要复杂的数据准备或访问权限时，或者对象的创建涉及多个步骤或多个依赖对象时。

## 注意事项

与直接实例化类创建新对象不同，原型模式通过拷贝现有对象生成新对象。浅拷贝通过实现 Cloneable 实现，深拷贝通过实现 Serializable 读取二进制流实现。
>**浅拷贝**：对基本数据类型进行值传递，对引用数据类型进行引用传递般的拷贝，此为浅拷贝。
**深拷贝**：对基本数据类型进行值传递，对引用数据类型，创建一个新的对象，并复制其内容，此为深拷贝。

## 简单示例

```java
// 抽象原型类
public interface Prototype extends Cloneable {
    Prototype clone();
}

// 具体原型类
public class ConcretePrototype implements Prototype {
    private String property;

    public ConcretePrototype(String property) {
        this.property = property;
    }

    @Override
    public Prototype clone() {
        try {
            return (ConcretePrototype) super.clone();
        } catch (CloneNotSupportedException e) {
            e.printStackTrace();
            return null;
        }
    }

    // Getter and Setter
    public String getProperty() {
        return property;
    }

    public void setProperty(String property) {
        this.property = property;
    }

    @Override
    public String toString() {
        return "ConcretePrototype{" +
                "property='" + property + '\'' +
                '}';
    }
}

// 客户端代码
public class PrototypePatternDemo {
    public static void main(String[] args) {
        ConcretePrototype prototype = new ConcretePrototype("Original");
        ConcretePrototype clone = (ConcretePrototype) prototype.clone();
        clone.setProperty("Cloned");

        System.out.println(prototype);  // 输出: ConcretePrototype{property='Original'}
        System.out.println(clone);      // 输出: ConcretePrototype{property='Cloned'}
    }
}
```
