# 组合实体模式

用在 EJB 持久化机制中。一个组合实体是一个 EJB 实体 bean，代表了对象的图解。当更新一个组合实体时，内部依赖对象 beans 会自动更新，因为它们是由 EJB 实体 bean 管理的。
>我认为：此模式是从J2EE系统层面将**数据的实体**以设计模式中**组合模式**的设计思想来设计。

类型：J2EE设计模式

目的：将数据库中的表转换为应用程序中的组合对象，这些对象可以表示表中的单个记录或一组记录。

解决问题：解决在对象关系映射中，如何高效地表示和管理数据库中的复杂数据结构，特别是当存在一对多或多对多关系时。

>EJB(Enterprise JavaBeans):是一个行业标准的服务器端组件架构，用于开发和部署多层的、分布式的、面向对象的Java应用程序。EJB定义了一组规范，允许开发者创建可重用的组件，这些组件可以轻松地集成到企业信息系统中。

## 实现方式

- **组合实体类**：代表数据库中的表，可以包含单个记录或一组记录。
- **叶子实体类**：代表表中的单个记录。
- **容器实体类**：代表表中的一组记录，可以包含其他叶子或容器实体。

## 结构

包含的几个主要角色：

- **组合实体（Composite Entity）**：代表数据库中的表，可以包含单个或多个记录。
- **叶子实体（Leaf Entity）**：代表表中的单个记录，不包含子实体。
- **容器实体（Container Entity）**：代表表中的一组记录，可以包含其他叶子或容器实体。
- **数据访问对象（Data Access Object）（可选）**：用于访问和操作数据库，封装了数据访问逻辑。
- **客户端（Client）（可选）**：使用组合实体模式来访问和操作数据库记录

>【客户端】---*访问*--->【组合实体【容器实体【叶子实体】】】

## 适用场景

- 当数据库表具有复杂的关系，或者需要将数据库表映射为应用程序中的复合对象时。

## 优缺点

- 优点
  - **简化数据访问**：通过对象的方式来简化数据库记录的访问和管理。
  - **提高代码可读性**：使代码更贴近自然语言，易于理解和维护。
  - **易于扩展**：可以方便地添加新的实体类型或修改现有实体。
- 缺点
  - **性能问题**：在处理大量数据时，可能会遇到性能瓶颈。
  - **复杂性**：对于简单的数据模型，可能会增加不必要的复杂性。

## 注意事项

- 确保组合实体模式的使用不会引入性能问题，特别是在处理大量数据时。

## 示例

```java
//叶子实体
public class DependentObject1 {
   
   private String data;
 
   public void setData(String data){
      this.data = data; 
   } 
 
   public String getData(){
      return data;
   }
}

public class DependentObject2 {
   
   private String data;
 
   public void setData(String data){
      this.data = data; 
   } 
 
   public String getData(){
      return data;
   }
}

//容器实体
public class CoarseGrainedObject {
   DependentObject1 do1 = new DependentObject1();
   DependentObject2 do2 = new DependentObject2();
 
   public void setData(String data1, String data2){
      do1.setData(data1);
      do2.setData(data2);
   }
 
   public String[] getData(){
      return new String[] {do1.getData(),do2.getData()};
   }
}

//组合实体
public class CompositeEntity {
   private CoarseGrainedObject cgo = new CoarseGrainedObject();
 
   public void setData(String data1, String data2){
      cgo.setData(data1, data2);
   }
 
   public String[] getData(){
      return cgo.getData();
   }
}

//客户端
public class Client {
   private CompositeEntity compositeEntity = new CompositeEntity();
 
   public void printData(){
      for (int i = 0; i < compositeEntity.getData().length; i++) {
         System.out.println("Data: " + compositeEntity.getData()[i]);
      }
   }
 
   public void setData(String data1, String data2){
      compositeEntity.setData(data1, data2);
   }
}

//演示入口
public class CompositeEntityPatternDemo {
   public static void main(String[] args) {
       Client client = new Client();
       client.setData("Test", "Data");
       client.printData();
       client.setData("Second Test", "Data1");
       client.printData();
   }
}
```
