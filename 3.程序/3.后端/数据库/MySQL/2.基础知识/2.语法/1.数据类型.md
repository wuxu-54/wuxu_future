# 数据类型

MySQL 支持多种数据类型，这些数据类型可以分为几个主要类别：

- [数值型](#数值类型)
- [日期和时间型](#日期和时间类型)
- [字符串型](#字符串类型)
- [二进制型](#二进制类型)
- [空间数据类型](#空间数据类型)
- [枚举和集合类型](#枚举和集合类型)
- [JSON数据类型](#json数据类型)

以下是一些常用的 MySQL 数据类型：

## 数值类型

MySQL 提供了多种数值类型，用于存储整数、小数和精确数值。以下是 MySQL 中常用的数值类型：

### 整数类型

1. **TINYINT**: 非常小的整数值。占用1字节。有符号范围是 -128 到 127，无符号范围是 0 到 255。
2. **SMALLINT**: 较小的整数值。占用2字节。有符号范围是 -32,768 到 32,767，无符号范围是 0 到 65,535。
3. **MEDIUMINT**: 中等大小的整数值。占用3字节。有符号范围是 -8,388,608 到 8,388,607，无符号范围是 0 到 16,777,215。
4. **INT** 或 **INTEGER**: 常用的整数值。占用4字节。有符号范围是 -2,147,483,648 到 2,147,483,647，无符号范围是 0 到 4,294,967,295。
5. **BIGINT**: 大整数值。占用8字节。有符号范围是 -9,223,372,036,854,775,808 到 9,223,372,036,854,775,807，无符号范围是 0 到 18,446,744,073,709,551,615。
6. **SERIAL**: 与 `BIGINT` 相同，是一个自动递增的数字，通常用作主键。仅在 MySQL 5.7.6 及更高版本中可用。

### 定点数和小数类型

1. **DECIMAL** 和 **NUMERIC**: 用于存储固定小数点或浮动小数点的精确数值。格式为 `DECIMAL(M,D)` 或 `NUMERIC(M,D)`，其中 `M` 是数字的总位数，`D` 是小数点后的位数。例如，`DECIMAL(5,2)` 可以存储的最大数是 999.99。

### 浮点数类型

1. **FLOAT**: 单精度浮点数。占用4字节。用于存储近似的小数值。
2. **DOUBLE**: 双精度浮点数。占用8字节。比 `FLOAT` 有更高的精度。

### 精确数值类型

1. **BIT**: 用于存储二进制数，可以指定为1位或多位。

### 特殊数值类型

1. **BOOLEAN**: 布尔值，实际上是 `TINYINT(1)` 的同义词。

在选择数值类型时，应考虑以下因素：

- 数据的范围和精度要求。
- 存储空间的需求。
- 性能考虑，尤其是在索引和计算时。

例如，如果你需要存储一个用户ID，通常 `INT` 类型就足够了。但如果你需要存储一个非常大的计数器或者预计未来数字会增长到非常大的范围，那么 `BIGINT` 可能是更好的选择。对于需要非常精确的小数值，如金融数据，`DECIMAL` 类型是一个好的选择。

---

## 日期和时间类型

MySQL 提供了多种日期和时间数据类型，用于存储和操作日期和时间信息。以下是 MySQL 中常用的日期和时间类型：

1. **DATE**:
   - 格式为 'YYYY-MM-DD'。
   - 用于存储日期，不包含时间。范围从 '1000-01-01' 到 '9999-12-31'。

   ```sql
   CREATE TABLE example (
       date_column DATE
   );
   INSERT INTO example (date_column) VALUES ('2024-05-29');
   ```

2. **TIME**:
   - 格式为 'HH:MM:SS'。
   - 用于存储时间，不包含日期。范围从 '-838:59:59' 到 '838:59:59'。
   - 可以包含分数秒，如 'HH:MM:SS.ffffff'。

   ```sql
   CREATE TABLE example (
      time_column TIME
   );
   INSERT INTO example (time_column) VALUES ('14:23:01');
   ```

3. **DATETIME**:
   - 格式为 'YYYY-MM-DD HH:MM:SS'。
   - 用于存储日期和时间，范围从 '1000-01-01 00:00:00' 到 '9999-12-31 23:59:59'。
   - 可以包含分数秒。

   ```sql
   CREATE TABLE example (
       datetime_column DATETIME
   );
   INSERT INTO example (datetime_column) VALUES ('2024-05-29 14:23:01');
   ```

4. **TIMESTAMP**:
   - 格式为 'YYYY-MM-DD HH:MM:SS'。
   - 类似于 `DATETIME`，但 `TIMESTAMP` 值的范围较小，通常用于记录时间戳。从 '1970-01-01 00:00:01' UTC 到 '2038-01-19 03:14:07' UTC。
   - TIMESTAMP 通常用于记录时间戳，因为它会自动转换为 UTC 时间。

   ```sql
   CREATE TABLE example (
       timestamp_column TIMESTAMP
   );
   INSERT INTO example (timestamp_column) VALUES (CURRENT_TIMESTAMP);
   ```

5. **YEAR**:
   - 格式为 'YYYY' 或 'YY'。
   - 用于存储年份，范围从 '1901' 到 '2155'。

   ```sql
   CREATE TABLE example (
       year_column YEAR
   );
   INSERT INTO example (year_column) VALUES ('2024');
   ```

6. **DATETIME WITH LOCAL TIME ZONE** 和 **TIMESTAMP WITH LOCAL TIME ZONE**:
   - 这些类型在 MySQL 5.7.6 及更高版本中引入。
   - 它们存储的值包含时区信息，可以用于处理时区转换。

   ```sql
   SET time_zone = '+00:00';
   INSERT INTO example (datetime_column) VALUES (NOW());
   ```

7. **TIME WITH LOCAL TIME ZONE**:
   - 用于存储带时区的时间。当创建表或定义字段时，可以指定这些日期和时间类型之一。例如：

   ```sql
   CREATE TABLE events (
      event_date DATE,
      event_time TIME,
      event_datetime DATETIME,
      event_timestamp TIMESTAMP,
      event_year YEAR
   );
   ```

8. **日期和时间的函数**：
   MySQL 提供了许多处理日期和时间的函数，如 `CURDATE()`、`CURTIME()`、`NOW()`、`DATE_ADD()`、`DATE_SUB()` 等。这些函数可以用于获取当前日期和时间、计算日期和时间的差值、格式化日期和时间等。

   ```sql
   SELECT CURDATE(); -- 当前日期
   SELECT CURTIME(); -- 当前时间
   SELECT NOW(); -- 当前日期和时间
   ```

9. **格式化日期和时间**：
   使用 `DATE_FORMAT()` 函数可以格式化日期和时间的输出。

   ```sql
   SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') AS formatted_datetime;

在设计数据库时，选择正确的日期类型对于确保数据的准确性和查询性能至关重要。例如，如果你只需要存储日期而不关心时间，那么使用 `DATE` 类型比使用 `DATETIME` 类型更高效。同样，如果你需要记录时间戳，`TIMESTAMP` 可能是更好的选择。

---

## 字符串类型

MySQL 提供了多种字符串数据类型，用于存储字符数据。这些类型可以进一步分为三类：非二进制字符串类型、二进制字符串类型和枚举类型。以下是 MySQL 中常用的字符串类型：
>注意字符串类型值使用**单引号`'`**

### 非二进制字符串类型

1. **CHAR**:
   - 固定长度的字符串。
   - 存储长度固定的数据，如果存储的字符串短于指定的长度，MySQL 会用空格填充剩余的空间。
   - 例如，`CHAR(5)` 会存储最多5个字符的字符串。

2. **VARCHAR**:
   - 可变长度的字符串。
   - 存储长度可变的字符串，只占用必要的空间加上一个额外字节来存储长度信息（对于长度小于或等于255的字符串）。
   - 例如，`VARCHAR(255)` 可以存储最多255个字符的字符串。

3. **TEXT**:
   - 用于存储大量文本，如文章或评论。
   - 有四种类型：`TINYTEXT`、`TEXT`、`MEDIUMTEXT` 和 `LONGTEXT`。
   - 例如，`TEXT` 可以存储的最大长度为 65,535 字符。

4. **BLOB**:
   - 二进制大对象，用于存储二进制数据，如图片或文件。
   - 也有四种类型：`TINYBLOB`、`BLOB`、`MEDIUMBLOB` 和 `LONGBLOB`。

### 二进制字符串类型

1. **BINARY**:
   - 固定长度的二进制字符串。
   - 与 `CHAR` 类似，但用于存储二进制数据。

2. **VARBINARY**:
   - 可变长度的二进制字符串。
   - 与 `VARCHAR` 类似，但用于存储二进制数据。

### 枚举类型

1. **ENUM**:
   - 枚举类型，用于存储一组预定义的字符串值中的一个。
   - 例如，`ENUM('value1', 'value2', 'value3')`。

### 集合类型

1. **SET**:
   - 用于存储多个枚举值的集合。
   - 例如，`SET('value1', 'value2', 'value3')`。

### JSON 数据类型

1. **JSON**:
   - 用于存储有效的 JSON 文档。
   - MySQL 5.7 及更高版本支持。

### 其他注意事项

- 字符串类型在定义时可以指定字符集，例如 `VARCHAR(255) CHARACTER SET utf8mb4`。
- 字符串类型的比较是基于字符集的校对规则进行的，因此选择合适的字符集和校对规则对于数据的准确性和性能都很重要。
- 在创建表或定义字段时，可以根据数据的特性和需求选择合适的字符串类型。例如：

   ```sql
   CREATE TABLE users (
      username VARCHAR(50) NOT NULL,
      password CHAR(60) NOT NULL, -- 通常用于存储经过散列的密码
      email VARCHAR(100),
      biography TEXT,
      profile_picture BLOB,
      preferences JSON
   );
   ```

   在这个例子中，`username` 和 `email` 使用 `VARCHAR` 类型，`password` 使用 `CHAR` 类型（因为散列后的密码长度通常是固定的），`biography` 使用 `TEXT` 类型，`profile_picture` 使用 `BLOB` 类型，而 `preferences` 使用 `JSON` 类型来存储用户偏好设置。

## 二进制类型

MySQL 中的二进制字符串类型用于存储二进制数据，如图像、文件等。这些类型与非二进制字符串类型类似，但它们存储的是二进制数据，而不是普通文本。以下是 MySQL 中的二进制字符串类型：

1. **BINARY(n)**:
   - 固定长度的二进制字符串，`n` 表示字节长度。
   - 存储长度固定的二进制数据，如果存储的数据短于指定的长度，MySQL 会用零字节填充剩余的空间。

2. **VARBINARY(n)**:
   - 可变长度的二进制字符串，`n` 表示最大字节长度。
   - 存储长度可变的二进制数据，只占用必要的空间加上一个额外字节来存储长度信息（对于长度小于或等于255的二进制字符串）。

3. **BLOB**:
   - 二进制大对象，用于存储大量的二进制数据。
   - 有四种类型：`TINYBLOB`、`BLOB`、`MEDIUMBLOB` 和 `LONGBLOB`。
   - `TINYBLOB`：最大长度 255 字节。
   - `BLOB`：最大长度 65,535 字节。
   - `MEDIUMBLOB`：最大长度 16,777,215 字节。
   - `LONGBLOB`：最大长度 4,294,967,295 字节。

### 创建表时使用二进制类型的例子

```sql
CREATE TABLE binary_data (
    id INT PRIMARY KEY,
    image VARBINARY(1000),
    document BLOB
);
```

在这个例子中，`image` 字段被定义为 `VARBINARY(1000)`，可以存储最多1000字节的二进制数据，例如小图像或文件。`document` 字段被定义为 `BLOB`，可以存储更大的二进制数据，例如文档。

### 注意事项

- 当存储二进制数据时，不应该使用非二进制字符串类型，因为它们可能会在存储和检索过程中引入不必要的字符集转换，导致数据损坏。
- 二进制类型字段在进行比较时是按字节值进行的，而不是按字符集的校对规则。
- 在处理二进制数据时，通常使用 MySQL 提供的二进制函数，如 `BIN()`、`UNHEX()` 等。
- 在某些情况下，如果二进制数据实际上是文本数据的编码（如十六进制编码），可以考虑使用 `HEX()` 函数将其转换为十六进制字符串进行存储和检索。

使用二进制类型时，应该根据数据的大小和使用场景选择合适的类型，以确保数据的完整性和查询性能。

## 空间数据类型

MySQL的空间数据类型是用于存储地理信息系统（GIS）数据的一组数据类型。这些数据类型允许你存储地理特征，如点、线和多边形，并执行空间查询和操作。以下是MySQL中一些主要的空间数据类型及其描述：

1. **GEOMETRY**: 这是一个通用的空间数据类型，可以存储所有其他空间数据类型。

2. **POINT**: 用于存储单个点的坐标。例如，一个点可以表示一个地理位置，如经纬度。

3. **LINESTRING**: 用于存储由两个或多个点组成的线。这可以表示道路或河流等线性特征。

4. **POLYGON**: 用于存储多边形，可以表示土地区域或其他封闭区域。

5. **MULTIPOINT**: 用于存储多个点的集合。

6. **MULTILINESTRING**: 用于存储多条线的集合。

7. **MULTIPOLYGON**: 用于存储多个多边形的集合。

8. **GEOMETRYCOLLECTION**: 用于存储上述任何类型的几何对象集合。

空间数据类型可以具有空间参考系统标识符（SRID），这允许你在查询中使用空间索引，并确保几何数据与特定的空间参考系统相关联。例如，你可以创建一个具有特定SRID的GEOMETRY列，这通常对应于一个特定的坐标系统，如WGS 84（SRID 4326）。

要创建空间数据类型的列，你可以使用如下SQL语句：

```sql
CREATE TABLE example (
    id INT PRIMARY KEY,
    location GEOMETRY NOT NULL SRID 4326
);
```

插入空间数据时，你可以使用`ST_GeomFromText`函数，例如：

```sql
INSERT INTO example (location) VALUES (ST_GeomFromText('POINT(115.0 39.0)', 4326));
```

MySQL还提供了许多空间函数来进行空间数据的查询和分析，例如`ST_Distance`用于计算两点之间的距离，`ST_Contains`用于判断一个几何体是否包含另一个几何体等。

空间索引（如SPATIAL索引）可以用于优化空间查询的性能，使得空间数据类型的列可以更快地被搜索和访问。

这些空间数据类型和函数为处理地理空间数据提供了强大的支持，适用于需要地理信息系统（GIS）功能的应用程序。

## 枚举和集合类型

在 MySQL 中，枚举（ENUM）和集合（SET）类型是两种特殊类型的字符串对象，它们用于存储一组预定义的值。

### ENUM 类型

在 MySQL 中，`ENUM` 是一种特殊的数据类型，用于定义列只能有预定义的一系列值之一。这些预定义的值被称为枚举值，它们在创建表时定义，并在列定义中指定。

#### 如何查询 MySQL 枚举类型的可能值

要获取 MySQL 表中某个列的枚举类型可能的值，可以使用 `SHOW COLUMNS` 语句。例如，如果你有一个表 `my_table` 并且其中一个列 `status` 是枚举类型，你可以使用以下命令：

```sql
SHOW COLUMNS FROM my_table WHERE Field = 'status';
```

这将返回 `status` 列的类型和可能的值。

#### 如何使用 MySQL 枚举类型

1. **创建表时定义枚举类型**：
   在创建表时，可以为某个列指定 `ENUM` 类型，并列出所有可能的值。例如：

   ```sql
   CREATE TABLE my_table (
       id INT,
       status ENUM('active', 'inactive', 'pending') NOT NULL
   );
   ```

2. **插入数据**：
   插入数据时，必须使用预定义的枚举值之一。例如：

   ```sql
   INSERT INTO my_table (id, status) VALUES (1, 'active');
   ```

3. **查询数据**：
   使用普通的 `SELECT` 语句查询数据。例如：

   ```sql
   SELECT * FROM my_table WHERE status = 'active';
   ```

4. **更新数据**：
   更新数据时，同样需要使用预定义的枚举值。例如：

   ```sql
   UPDATE my_table SET status = 'inactive' WHERE id = 1;
   ```

5. **删除数据**：
   删除数据时，可以使用枚举值作为条件。例如：

   ```sql
   DELETE FROM my_table WHERE status = 'pending';
   ```

#### 枚举注意事项

- **枚举值的排序**：枚举值在 MySQL 中是有顺序的，排序是按照枚举值定义的顺序来的。
- **修改枚举类型**：如果要修改枚举类型，可能需要使用 `ALTER TABLE` 语句重建整个列，这可能会很耗时。
- **空值和 NULL**：枚举类型可以包含空字符串作为值，但不推荐使用数字作为枚举值，因为这容易引起混淆。
- **性能考虑**：枚举类型在存储上比文本类型更高效，因为它们在内部使用数字来表示字符串值。

### SET 类型

SET 类型是一个字符串对象，可以有多个 ENUM 值，列值是值列表中值的组合，用逗号分隔。SET 类型的语法如下：

```sql
SET('value1', 'value2', 'value3', ...)
```

例如：

```sql
CREATE TABLE hobbies (
    interests SET('reading', 'sports', 'music', 'travel')
);
```

在这个例子中，`interests` 列可以包含 'reading'、'sports'、'music'、'travel' 中的任意一个或多个值的组合，如 'reading,sports' 或 'music,travel,reading'。

### 枚举和集合注意事项

- ENUM 和 SET 类型的值列表必须在创建表时定义，并且不能更改（除非使用 `ALTER TABLE` 语句重新定义整个列）。
- ENUM 和 SET 类型的值列表中不能有重复的值。
- ENUM 类型的列在存储时会为列表中的每个值分配一个整数，通常按照它们在列表中出现的顺序，从 1 开始。
- SET 类型的列在存储时会为每个可能的值组合创建一个唯一的整数，这使得 SET 类型在处理多值时非常高效。

### 使用场景

- ENUM 类型适用于只有固定几个值的场景，如性别（男、女）、状态（启用、禁用）等。
- SET 类型适用于需要在一个字段中存储多个值的场景，如用户的兴趣爱好、权限设置等。

### 插入和查询数据

插入数据时，可以直接使用枚举或集合的值，例如：

```sql
INSERT INTO colors (name) VALUES ('red');
INSERT INTO hobbies (interests) VALUES ('reading,sports');
```

查询数据时，可以使用 `IN` 操作符来检查 ENUM 列中的特定值，或者使用 `IN` 或者 `FIND_IN_SET()` 函数来检查 SET 列中的值，例如：

```sql
SELECT * FROM colors WHERE name IN ('red', 'blue');
SELECT * FROM hobbies WHERE FIND_IN_SET('music', interests);
```

枚举和集合类型在需要限制列值在预定义列表中时非常有用，但它们也有一些限制，比如不支持索引和直接的算术运算。在设计数据库时，应根据实际需求和这些类型的优缺点来选择是否使用。

## JSON数据类型

MySQL 从 5.7 版本开始支持 JSON 数据类型，这使得可以直接在数据库中存储和操作 JSON 文档。JSON（JavaScript Object Notation）是一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。

### JSON 数据类型的特点

- **存储 JSON 文档**：可以直接将 JSON 文档存储在 JSON 类型的列中。
- **内置 JSON 函数**：MySQL 提供了一系列内置函数来处理 JSON 数据，如 `JSON_EXTRACT`、`JSON_REPLACE`、`JSON_SET` 等。
- **索引 JSON 列**：可以对 JSON 类型的列创建索引，提高查询性能。
- **灵活的查询和更新**：可以查询和更新 JSON 文档中的特定元素，而不需要解析整个文档。

### JSON 数据类型的操作

1. **创建 JSON 列**：

   ```sql
   CREATE TABLE users (
       id INT AUTO_INCREMENT PRIMARY KEY,
       name VARCHAR(100),
       preferences JSON
   );
   ```

2. **插入 JSON 数据**：

   ```sql
   INSERT INTO users (name, preferences) VALUES ('John Doe', '{"theme": "dark", "notifications": {"email": true, "sms": false}}');
   ```

3. **查询 JSON 数据**：

   ```sql
   SELECT JSON_EXTRACT.preferences->'$.theme' AS theme FROM users;
   ```

4. **更新 JSON 数据**：

   ```sql
   UPDATE users SET preferences->'$.theme' = 'light' WHERE id = 1;
   ```

5. **查询 JSON 列中的特定路径**：

   ```sql
   SELECT name, preferences FROM users WHERE JSON_EXTRACT.preferences->'$.notifications.email' = 'true';
   ```

6. **添加新的 JSON 属性**：

   ```sql
   UPDATE users SET preferences = JSON_SET/preferences, '$.newKey', 'newValue' WHERE id = 1;
   ```

7. **删除 JSON 属性**：

   ```sql
   UPDATE users SET preferences = JSON_REMOVE/preferences, '$.newKey' WHERE id = 1;
   ```

8. **使用 JSON 函数**：
   MySQL 提供了许多 JSON 函数，如 `JSON_OBJECT`、`JSON_ARRAY`、`JSON_INSERT` 等，可以构造和操作 JSON 数据。

### JSON 索引

- 可以对 JSON 列创建索引，但需要注意的是，只有对 JSON 文档中的标量值（非嵌套对象或数组）的索引才能被有效使用。
- 可以使用 `CREATE INDEX` 语句创建索引，例如：

  ```sql
  CREATE INDEX idx_preferences_email ON users(preferences->'$.notifications.email');
  ```

### JSON类型注意事项

- JSON 数据类型提供了一种灵活的方式来存储结构化数据，但它们在存储大量复杂 JSON 数据时可能会比传统数据类型占用更多的空间。
- 在使用 JSON 索引时，需要确保查询条件与索引的路径匹配，否则索引可能不会被使用。

JSON 数据类型为处理现代 Web 应用中的灵活数据结构提供了强大的支持，使得数据库能够更好地适应快速变化的数据需求。
