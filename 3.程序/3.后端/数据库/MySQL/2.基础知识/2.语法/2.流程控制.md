# 流程控制

在MySQL中，流程控制语句允许您在存储过程、函数和触发器中控制程序的执行流程。这些语句包括条件判断语句（如IF和CASE）、循环语句（如LOOP、WHILE和REPEAT）以及跳转语句（如LEAVE和ITERATE）。

## 条件判断

### IF语句

IF语句用于基于特定条件执行不同的代码块。其基本语法如下：

```sql
IF condition THEN
    -- 当条件为真时执行的语句
ELSEIF condition THEN
    -- 当第一个条件为假且第二个条件为真时执行的语句
ELSE
    -- 当所有条件为假时执行的语句
END IF;
```

例如，您可以使用IF语句来检查一个值并根据该值执行不同的操作。

### CASE语句

CASE语句在SQL查询中用于执行条件逻辑。它有两种形式：简单CASE和搜索CASE。简单CASE类似于switch语句，而搜索CASE类似于if-else if-else结构。

```sql
CASE expression
    WHEN value THEN result
    WHEN value THEN result
    ...
    ELSE default_result
END;
```

或者

```sql
CASE
    WHEN condition THEN result
    WHEN condition THEN result
    ...
    ELSE default_result
END;
```

## 循环控制

### WHILE循环

WHILE循环在满足条件时重复执行一个代码块。

```sql
WHILE condition DO
    -- 循环体中的语句
END WHILE;
```

### REPEAT循环

REPEAT循环至少执行一次代码块，然后在每次迭代后检查条件。

```sql
REPEAT
    -- 循环体中的语句
UNTIL condition
END REPEAT;
```

### LOOP循环

LOOP循环是一个无条件循环，需要使用LEAVE语句来退出循环。

```sql
LOOP
    -- 循环体中的语句
    -- 可以使用 LEAVE 语句退出循环
END LOOP;
```

## 跳转语句

### LEAVE语句

LEAVE语句用于立即退出循环。

```sql
LEAVE loop_label;
```

### ITERATE语句

ITERATE语句用于跳过当前迭代中剩余的部分，并开始下一次迭代。

```sql
ITERATE loop_label;
```

## 示例

假设您有一个名为`employees`的表，您想为每个部门的员工数量计算平均薪资：

```sql
SELECT department_id, AVG(salary) AS average_salary
FROM employees
GROUP BY department_id;
```

如果您想使用存储过程来实现更复杂的逻辑，例如根据不同的部门ID执行不同的操作，您可以使用IF语句：

```sql
DELIMITER //

CREATE PROCEDURE CheckDepartment(dept_id INT)
BEGIN
    IF dept_id = 1 THEN
        -- 执行部门1的特定逻辑
    ELSEIF dept_id = 2 THEN
        -- 执行部门2的特定逻辑
    ELSE
        -- 执行其他部门的通用逻辑
    END IF;
END //

DELIMITER ;
```

在上述存储过程中，您可以通过传递不同的部门ID作为参数来执行不同的逻辑。

流程控制语句是编写复杂存储程序和函数的关键，它们提供了强大的工具来控制程序的执行路径。
