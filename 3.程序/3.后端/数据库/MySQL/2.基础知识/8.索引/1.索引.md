# 索引

在MySQL中，索引是一种特殊的数据库对象，它可以加快数据检索速度，减少数据查找时间。索引类似于书籍的目录，可以帮助数据库快速定位到数据所在的物理位置，而不需要扫描整个表。

- 创建索引：`create [unique] index 索引名 on 表名(字段名,...)`
- 查看索引：`show index from 表名`
- 删除索引：`drop index 索引名 on 表名`

## 索引的类型

1. **主键索引（PRIMARY KEY）**：
   - 每个表只能有一个主键索引。
   - 主键值必须唯一，不能为空（NOT NULL）。

2. **唯一索引（UNIQUE INDEX）**：
   - 唯一索引要求索引列的值必须唯一，但可以有空值。

3. **普通索引（INDEX）**：
   - 最基本的索引类型，没有唯一性的要求。

4. **全文索引（FULLTEXT INDEX）**：
   - 用于搜索文本中的关键字，适用于大型文本字段。

5. **组合索引（COMPOSITE INDEX）**：
   - 在多个列上创建的索引，可以提高查询多个列值的速度。

6. **外键索引（FOREIGN KEY INDEX）**：
   - 用于引用另一个表中的唯一值，保证数据的参照完整性。

## 索引的创建

### 创建主键索引

```sql
ALTER TABLE table_name
ADD PRIMARY KEY (column_name);
```

### 创建唯一索引

```sql
ALTER TABLE table_name
ADD UNIQUE (column_name);
```

### 创建普通索引

```sql
CREATE INDEX index_name
ON table_name (column_name);
```

### 创建全文索引

```sql
ALTER TABLE table_name
ADD FULLTEXT (column_name);
```

### 创建组合索引

```sql
CREATE INDEX index_name
ON table_name (column1, column2);
```

## 索引的使用

1. **提高查询速度**：
   - 通过索引，数据库可以快速定位到数据，而不需要扫描整个表。

2. **加速排序**：
   - 索引可以加快ORDER BY操作，尤其是当索引列用于排序时。

3. **优化分组查询**：
   - 索引可以提高GROUP BY操作的性能。

## 索引的维护

1. **索引的更新**：
   - 当表中的数据发生变化时（如INSERT、UPDATE、DELETE），索引也需要更新，这会增加额外的开销。

2. **索引的删除**：
   - 如果索引不再需要，应该及时删除，以减少维护成本。
   - 删除索引的语句：

     ```sql
     DROP INDEX index_name ON table_name;
     ```

3. **索引的分析**：
   - 使用`EXPLAIN`关键字可以分析查询语句的执行计划，查看是否使用了索引。

## 示例

示例：使用索引优化查询
假设有一个employees表，其中包含employee_id、department_id、salary和hire_date等列。

```sql
-- 创建索引
CREATE INDEX idx_department ON employees (department_id);
CREATE INDEX idx_salary ON employees (salary);

-- 使用索引进行查询
SELECT * FROM employees WHERE department_id = 10;

-- 使用索引进行范围查询
SELECT * FROM employees WHERE salary BETWEEN 50000 AND 100000;

-- 使用索引进行排序
SELECT * FROM employees ORDER BY salary;

-- 使用复合索引
CREATE INDEX idx_department_salary ON employees (department_id, salary);

-- 使用复合索引进行查询
SELECT * FROM employees WHERE department_id = 10 AND salary > 50000;
```

## 注意事项

- 索引虽然可以提高查询速度，但过多的索引会增加写操作的负担，因为每次数据更新（INSERT、UPDATE、DELETE）时，索引也需要更新。
- 选择合适的列创建索引很重要，通常对于经常作为查询条件的列、参与JOIN操作的列、用作排序的列创建索引。
- 索引并不是越多越好，需要根据实际的查询需求和数据更新频率来平衡索引的创建。
- 主键字段，在建表时，会自动创建主键索引。
- 添加唯一约束时，数据库实际上会添加唯一索引（unique index）。

索引是数据库性能优化的重要手段，合理使用索引可以显著提高数据库的操作效率。

---

## 补充

1. 没有索引，会进行全表扫描，即从头到尾遍历查找
2. 索引会维护一个数据结构（如二叉树，有很多结构，默认是`B+Tree`结构），提高查询效率。
3. 在磁盘的MySQL文件目录会维护索引的数据结构文件，占用内存空间（磁盘占用无需多虑，服务器管够）。
4. 索引会导致增删改的效率（因为数据结构要变动，导致增删改降低，不过实际业务一般不会修改表结构）。
