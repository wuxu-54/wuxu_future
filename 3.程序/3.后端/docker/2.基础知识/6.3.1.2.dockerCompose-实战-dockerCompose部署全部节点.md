# 实战`dockerCompose.yml`

记住几个核心知识点：

1. 镜像是类，容器是镜像运行后才出现的，等同于类的实例
2. `dockerCompose.yml` ，`docker-compose`命令会根据这个文件的配置，进行多镜像运行。
3. 如果有`client`、`server`两个镜像，且client需要通过Nginx反向代理，那么必须要通过`docker-Compose`运行,通过docker分别运行client和server那二者的关联配置是不生效的，也就是运行会出现问题。
4. .Dockerfile文件为了避免打出的包太大，可以采用轻量的仓库镜像
5. 官方镜像网站必须翻墙，如果不翻墙可以使用加速器，但我试过了国内的加速器都不好使，那采用步骤6吧
6. 通过[镜像网站章节](../2.基础知识/5.2.镜像-镜像网站.md)，在网站找你需要的镜像，`FROM`直接依赖镜像名称。
7. 部署成功后，外网访问不了，在代码及配置没问题的情况下，检查端口是否正常：1.服务器防火墙是否拦截你使用的端口。 2.网关将端口放开

## 命令

本地端执行下面命令：

```sh
docker image prune #移除全部无用镜像
docker rmi wuxu54/app:v0.1.0  #移除镜像
docker-compose build --no-cache #打单独的镜像
docker save -o app.tar myapp_web:latest mysql:8.0  #将多个镜像打入到一个tar中。一般是compose联合部署时使用
```

将`app.tar`文件上传服务器，执行下面命令：

```sh
docker-compose stop 文件中设定的容器名字 # 停止容器
docker-compose rm 文件中设定的容器名字 #移除容器
docker rmi wuxu54/app:v0.1.0 #移除原有镜像
docker load -i  app.tar  #在服务器中，解压
docker-compose up -d #部署运行 -d 是指后台运行
```
