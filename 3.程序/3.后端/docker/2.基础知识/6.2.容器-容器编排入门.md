# Docker 容器编排入门指南

以下是 **Docker 容器编排入门指南**，涵盖核心概念、常用工具和基础操作，帮助您快速掌握多容器应用的自动化部署与管理：

---

## **一、容器编排的必要性**

当应用从**单容器**发展为**多容器微服务架构**时，手动管理容器将变得复杂。编排工具可解决以下问题：

- **服务依赖**：确保服务按顺序启动（如数据库先于应用）。
- **动态扩缩容**：根据负载自动增减容器副本。
- **网络互联**：跨主机容器通信与服务发现。
- **故障恢复**：自动重启崩溃的容器。
- **统一配置**：集中管理环境变量、密钥等。

---

## **二、常用编排工具对比**

| 工具               | 适用场景                 | 特点                                                                 |
|--------------------|--------------------------|----------------------------------------------------------------------|
| **Docker Compose** | 单机开发/测试环境        | 基于 YAML 文件定义多容器应用，简单易用，适合本地调试。               |
| **Docker Swarm**   | 中小规模生产环境         | Docker 原生集群管理，轻量级，与 Docker CLI 无缝集成。                |
| **Kubernetes**     | 大规模生产环境           | 功能强大，生态丰富，学习曲线陡峭，适合复杂场景（如自动扩缩、滚动更新）。 |

---

## **三、Docker Compose 入门**

### **1. 核心概念**

- **服务 (Service)**：一个容器实例的抽象（可包含多个副本）。
- **项目 (Project)**：一组关联服务的集合（默认以目录名命名）。
- **YAML 文件**：`docker-compose.yml` 定义服务、网络、卷等。

### **2. 快速示例**

```yaml
version: '3.8'

services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    depends_on:
      - db
    networks:
      - my-net

  db:
    image: postgres:14
    environment:
      POSTGRES_PASSWORD: 123456
    volumes:
      - pgdata:/var/lib/postgresql/data
    networks:
      - my-net

volumes:
  pgdata:

networks:
  my-net:
```

### **3. 常用命令**

```bash
docker-compose up -d        # 启动所有服务（后台运行）
docker-compose down         # 停止并删除容器、网络
docker-compose ps           # 查看运行状态
docker-compose logs -f web  # 查看指定服务日志
docker-compose scale web=3  # 扩展 web 服务为 3 个副本
```

---

## **四、Docker Swarm 入门**

### **1.Docker Swarm 核心概念**

- **节点 (Node)**：分为 Manager（管理集群）和 Worker（运行容器）。
- **服务 (Service)**：定义容器副本数、镜像、端口等。
- **栈 (Stack)**：通过 `docker-compose.yml` 部署一组服务（类似 Compose 项目）。

### **2. 快速部署集群**

```bash
# 初始化 Swarm 集群（在 Manager 节点执行）
docker swarm init --advertise-addr <MANAGER-IP>

# 加入 Worker 节点（在 Worker 节点执行）
docker swarm join --token <TOKEN> <MANAGER-IP>:2377

# 部署服务
docker service create --name web -p 80:80 --replicas 3 nginx:alpine

# 查看服务状态
docker service ls
docker service ps web

# 扩展副本数
docker service scale web=5
```

### **3. 使用 Stack 部署**

```bash
# 创建 docker-compose.yml（格式与 Compose 兼容）
docker stack deploy -c docker-compose.yml myapp
docker stack ls
docker stack services myapp
```

---

## **五、Kubernetes 极简入门**

### **1. Kubernetes核心概念**

- **Pod**：最小部署单元，包含一个或多个容器。
- **Deployment**：定义 Pod 副本数和更新策略。
- **Service**：暴露 Pod 的访问入口（如负载均衡）。
- **Namespace**：资源隔离（如开发、测试、生产环境）。

### **2. Kubernetes快速示例**

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80

# service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: LoadBalancer
```

### **3. Kubernetes常用命令**

```bash
kubectl apply -f deployment.yaml  # 部署应用
kubectl get pods                  # 查看 Pod 状态
kubectl get services              # 查看服务暴露的 IP 和端口
kubectl scale deployment/nginx-deployment --replicas=5  # 扩展副本
```

---

## **六、编排工具选择建议**

| **场景**               | **推荐工具**       |
|------------------------|--------------------|
| 本地开发与测试         | Docker Compose     |
| 中小规模生产集群       | Docker Swarm       |
| 大规模企业级部署       | Kubernetes         |
| 云原生应用（如 AWS ECS） | 云厂商托管 Kubernetes |

---

## **七、学习路径**

1. **入门**：从 Docker Compose 开始，熟悉多服务定义和依赖管理。  
2. **进阶**：掌握 Docker Swarm，理解集群管理和服务扩缩。  
3. **深入**：学习 Kubernetes，掌握 Pod、Deployment、Service 等核心概念。  
4. **扩展**：探索 Helm（Kubernetes 包管理）、Istio（服务网格）等生态工具。

---

## **八、调试技巧**

- **查看编排服务日志**：

  ```bash
  docker-compose logs     # Compose
  docker service logs web # Swarm
  kubectl logs <pod-name> # Kubernetes
  ```

- **可视化监控工具**：
  - **Portainer**：管理 Docker 和 Swarm。
  - **Lens**：Kubernetes IDE。
  - **Grafana + Prometheus**：监控容器资源。

---

通过掌握容器编排技术，您可以轻松管理复杂的多容器应用，提升开发效率和系统可靠性。
