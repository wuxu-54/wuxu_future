# **一、为什么用 Docker 部署 Nginx？**

1. **环境一致性**  
   - 避免“本地能跑，服务器报错”的问题，确保开发、测试、生产环境一致。
2. **快速部署与扩展**  
   - 通过镜像秒级启动 Nginx，配合 Kubernetes 可实现自动扩缩容。
3. **隔离性**  
   - Nginx 与其他服务（如后端应用、数据库）运行在独立容器中，互不干扰。
4. **配置管理**  
   - 通过挂载配置文件（`nginx.conf`）和数据目录（如静态资源），实现配置与镜像解耦。

---

## **二、Docker 部署 Nginx 的步骤**

### **1. 拉取官方镜像**

```bash
docker pull nginx:latest
```

### **2. 运行基础容器**

```bash
# 简单启动（仅用于测试）
docker run -d --name my-nginx -p 80:80 nginx
```

- 访问 `http://localhost:80` 可看到默认欢迎页。

### **3. 实际生产配置（挂载配置和静态资源）**

```bash
docker run -d \
  --name my-nginx \
  -p 80:80 \
  -v /path/on/host/nginx.conf:/etc/nginx/nginx.conf \  # 挂载配置文件
  -v /path/on/host/html:/usr/share/nginx/html \        # 挂载静态资源
  -v /path/on/host/logs:/var/log/nginx \               # 挂载日志
  nginx
```

### **4. 自定义 `nginx.conf` 示例**

```nginx
user  nginx;
worker_processes  auto;

events {
  worker_connections  1024;
}

http {
  server {
    listen 80;
    server_name localhost;

    location / {
      root   /usr/share/nginx/html;
      index  index.html;
    }

    # 反向代理到后端服务
    location /api {
      proxy_pass http://backend-service:8080;
      proxy_set_header Host $host;
    }
  }
}
```

---

## **三、实际应用场景**

### **1. 反向代理 + 负载均衡**

```nginx
http {
  upstream backend {
    server backend1:8080;
    server backend2:8080;
    server backend3:8080;
  }

  server {
    location / {
      proxy_pass http://backend;
    }
  }
}
```

- 配合 `docker-compose` 定义多容器协作。

### **2. 静态资源托管**

```bash
# 挂载静态文件目录
docker run -d \
  -v /data/static:/usr/share/nginx/html \
  nginx
```

### **3. HTTPS 配置**

```bash
# 挂载 SSL 证书
docker run -d \
  -v /path/to/certs:/etc/nginx/certs \
  -p 443:443 \
  nginx
```

- `nginx.conf` 中配置 SSL 监听和证书路径。

---

## **四、注意事项**

1. **性能优化**  
   - 调整 `worker_processes` 和 `worker_connections` 以匹配宿主机 CPU 核心数。
2. **配置文件管理**  
   - 使用版本控制（如 Git）管理 `nginx.conf`，避免容器内直接修改。
3. **日志持久化**  
   - 挂载日志目录到宿主机，便于长期存储和分析。
4. **网络配置**  
   - 若容器间通信（如 Nginx → 后端服务），需使用 Docker 自定义网络。
5. **安全性**  
   - 避免以 `root` 用户运行容器：添加 `user nginx;` 配置。

---

## **五、完整 `docker-compose.yml` 示例**

```yaml
version: '3'
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./static:/usr/share/nginx/html
      - ./logs:/var/log/nginx
      - ./certs:/etc/nginx/certs
    networks:
      - my-network

  backend:
    image: my-backend-app:latest
    networks:
      - my-network

networks:
  my-network:
    driver: bridge
```

---

## **总结**

- **推荐场景**：微服务架构、多环境部署、快速迭代。
- **不推荐场景**：对极致性能有严苛要求的单机部署（直接宿主机安装更高效）。

通过 Docker 部署 Nginx，可以显著简化运维复杂度，是现代化 Web 服务的标准实践。
