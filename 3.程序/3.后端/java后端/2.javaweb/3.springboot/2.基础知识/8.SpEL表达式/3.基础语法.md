# 基础语法

SpEL（Spring Expression Language）是Spring框架提供的一种强大的表达式语言，用于在运行时查询和操作对象图。以下是对SpEL语法的详细解析：

## 一、字面量表达式

SpEL支持多种字面量，包括：

* **字符串**：使用单引号或双引号括起来，如`'Hello'`或`"World"`。
* **数字**：支持整数（如`123`）、长整数（如`123L`）、浮点数（如`123.45`）和双精度浮点数（如`123.45d`）。
* **布尔值**：使用`true`或`false`表示。
* **null值**：直接使用`null`关键字。

## 二、算术运算表达式

SpEL支持基本的算术运算，包括：

* **加法**：使用`+`运算符，如`1 + 1`。
* **减法**：使用`-`运算符，如`2 - 1`。
* **乘法**：使用`*`运算符，如`2 * 3`。
* **除法**：使用`/`运算符，如`6 / 2`。
* **求余**：使用`%`运算符，如`5 % 2`。另外，SpEL还提供`MOD`运算符，与`%`等价。
* **幂运算**：使用`^`运算符，如`2 ^ 3`表示2的3次方。

## 三、关系表达式

SpEL支持关系运算，包括：

* **等于**：使用`==`或`EQ`运算符，如`1 == 1`或`1 EQ 1`。
* **不等于**：使用`!=`或`NE`运算符，如`1 != 2`或`1 NE 2`。
* **大于**：使用`>`或`GT`运算符，如`2 > 1`或`2 GT 1`。
* **大于等于**：使用`>=`或`GE`运算符，如`2 >= 1`或`2 GE 1`。
* **小于**：使用`<`或`LT`运算符，如`1 < 2`或`1 LT 2`。
* **小于等于**：使用`<=`或`LE`运算符，如`1 <= 1`或`1 LE 1`。

此外，SpEL还支持`between`运算符，用于判断一个值是否在某个区间内。例如，`1 between {1, 2}`将返回`true`。

## 四、逻辑表达式

SpEL支持逻辑运算，包括：

* **逻辑与**：使用`and`运算符，如`true and false`将返回`false`。
* **逻辑或**：使用`or`运算符，如`true or false`将返回`true`。
* **逻辑非**：使用`!`或`NOT`运算符，如`!true`或`NOT true`将返回`false`。

## 五、字符串操作表达式

SpEL支持字符串操作，包括：

* **字符串连接**：使用`+`运算符连接字符串，如`'Hello ' + 'World!'`将返回`'Hello World!'`。
* **字符串截取**：使用索引截取字符串的一个字符，如`'Hello World!'[0]`将返回`'H'`。注意，目前只支持截取一个字符。

## 六、三目运算及Elvis运算表达式

* **三目运算**：使用`表达式1 ? 表达式2 : 表达式3`的语法。例如，`2 > 1 ? true : false`将返回`true`。
* **Elvis运算**：从Groovy语言引入，用于简化三目运算符。使用`表达式1 ?: 表达式2`的语法。当表达式1为非null时返回表达式1，当表达式1为null时返回表达式2。例如，`null ?: false`将返回`false`，而`true ?: false`将返回`true`。

## 七、正则表达式

SpEL支持正则表达式匹配，使用`str matches regex`的语法。例如，`'123' matches '\\d{3}'`将返回`true`。

## 八、括号优先级表达式

使用`(表达式)`来构造括号表达式，括号内的表达式具有更高的优先级。

## 九、类类型表达式

使用`T(Type)`来表示`java.lang.Class`实例。`Type`必须是类全限定名，但`java.lang`包下的类可以不指定包名。例如，`T(String)`表示`String.class`。使用类类型表达式还可以访问类静态方法及类静态字段。

## 十、类实例化

使用`new`关键字进行类实例化。类名必须是全限定名，但`java.lang`包内的类型除外。例如，`new String('haha')`将创建一个新的`String`对象，内容为`'haha'`。

## 十一、instanceof表达式

SpEL支持`instanceof`运算符，用于判断一个对象是否是某个类的实例。例如，`'haha' instanceof T(String)`将返回`true`。

## 十二、变量定义及引用

* **变量定义**：通过`EvaluationContext`接口的`setVariable(variableName, value)`方法定义变量。
* **变量引用**：在表达式中使用`#variableName`来引用定义的变量。

此外，SpEL还支持引用根对象（使用`#root`）和当前上下文对象（使用`#this`）。

总之，SpEL语法简洁且功能强大，几乎可以表达任何Java代码能够做的事情。通过熟练掌握SpEL语法，开发者可以更加高效地编写和维护Spring应用程序。

---

## SpEL语法关键要素和示例

以下是一些SpEL语法的关键要素和示例：

1. **字面量**：
   * 字符串：`'Hello World'`
   * 数字：`123`、`3.14`
   * 布尔值：`true`、`false`
   * null值：`null`

2. **属性访问和调用方法**：
   * 访问bean的属性：`#{myBean.myProperty}`
   * 调用bean的方法：`#{myBean.myMethod()}`

3. **算术运算**：
   * 加法：`1 + 1`
   * 减法：`2 - 1`
   * 乘法：`2 * 3`
   * 除法：`6 / 2`
   * 取模：`5 % 2`

4. **关系运算**：
   * 等于：`1 == 1`
   * 不等于：`1 != 2`
   * 大于：`2 > 1`
   * 小于：`1 < 2`

5. **逻辑运算**：
   * 逻辑与：`true and false`
   * 逻辑或：`true or false`
   * 逻辑非：`!true`

6. **条件运算（三目运算）**：
   * `condition ? trueExpression : falseExpression`

7. **正则表达式匹配**：
   * `'myString' matches 'regex'`

8. **类类型表达式**：
   * 使用`T()`来获取类的`Class`对象，如`T(java.lang.String)`

9. **类实例化**：
   * 使用`new`关键字来创建对象实例，如`new java.util.HashMap<>()`

10. **instanceof运算**：
    * 检查对象是否为特定类的实例，如`'myString' instanceof T(String)`

11. **变量引用**：
    * 在表达式中引用变量，使用`#variableName`

12. **选择表达式（Elvis运算符）**：
    * `expression ?: defaultValue`，如果`expression`不为`null`，则返回`expression`的值；否则返回`defaultValue`

13. **安全导航运算符（?.）**：
    * 用于在访问可能为`null`的对象属性时避免`NullPointerException`，如`myBean?.myProperty`

SpEL语法非常灵活且强大，几乎可以表达任何Java代码能够做的事情。通过熟练掌握SpEL语法，开发者可以更加高效地编写和维护Spring应用程序，特别是在需要动态配置和操作对象时。

---

## 表达式示例

以下是一些使用SpEL（Spring Expression Language）语法的具体例子，这些例子展示了SpEL在不同场景下的应用：

### 1. 字面量表达式

* **字符串**：`#{'Hello World'}` 或 `#{"Hello World"}`
* **数字**：`#{5}`、`#{89.7}`、`#{1e4}`（表示10000）
* **布尔值**：`#{true}`、`#{false}`

### 2. 引用Bean和属性

* **引用Bean**：`#{myBean}`（假设`myBean`是Spring容器中的一个bean）
* **引用Bean的属性**：`#{myBean.myProperty}`（假设`myBean`有一个名为`myProperty`的属性）

### 3. 调用方法

* **调用Bean的方法**：`#{myBean.myMethod()}`
* **链式调用**：`#{myBean.getFirstName().toUpperCase()}`（假设`getFirstName()`返回一个字符串）

### 4. 算术运算和比较运算

* **算术运算**：`#{3 + 4 * 2}`（结果为11）
* **比较运算**：`#{2 > 1}`（结果为`true`）

### 5. 逻辑运算

* **逻辑与**：`#{true and false}`（结果为`false`）
* **逻辑或**：`#{true or false}`（结果为`true`）

### 6. 三目运算

* **条件表达式**：`#{myBean.myProperty > 100 ? 'High' : 'Low'}`（根据`myProperty`的值返回'High'或'Low'）

### 7. 引用静态方法和属性

* **引用静态方法**：`#{T(java.lang.Math).PI}`（返回Math类的PI常量）
* **引用静态属性**：`#{T(System).currentTimeMillis()}`（返回当前时间的毫秒数）

### 8. 集合和数组操作

* **访问List元素**：`#{myList[0]}`（假设`myList`是一个List，返回第一个元素）
* **访问Map元素**：`#{myMap['key']}`（假设`myMap`是一个Map，返回键为'key'的值）
* **创建数组**：`#{new int[]{1,2,3}}`（创建一个包含1, 2, 3的整数数组）

### 9. 变量引用

* **定义变量**：在`EvaluationContext`中设置变量，例如`context.setVariable("myVar", 100)`
* **引用变量**：`#{myVar}`（在表达式中引用之前定义的变量）

### 10. 安全导航和Elvis运算符

* **安全导航**：`#{myBean?.myProperty}`（如果`myBean`为`null`，则不会抛出异常，而是返回`null`）
* **Elvis运算符**：`#{myBean.myProperty ?: 'default'}`（如果`myBean.myProperty`为`null`，则返回'default'）

### 实际应用例子

假设我们有一个Spring配置文件（XML格式），其中定义了几个bean，我们可以使用SpEL来配置它们的属性：

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="person" class="com.example.Person">
        <property name="name" value="#{'John Doe'}"/>
        <property name="age" value="#{25 + 5}"/>
        <property name="isAdult" value="#{25 > 18}"/>
        <property name="salary" value="#{T(java.lang.Math).round(12345.678 * 1.1)}"/>
    </bean>

    <bean id="car" class="com.example.Car">
        <property name="brand" value="Toyota"/>
        <property name="price" value="#{T(java.lang.Double).valueOf('20000.00')}"/>
        <property name="isExpensive" value="#{car.price > 15000 ? 'Yes' : 'No'}"/>
    </bean>

</beans>
```

在这个例子中，我们使用了SpEL来配置`person`和`car` bean的属性。这些表达式在Spring容器启动时会被解析和计算，并将结果注入到相应的bean属性中。

请注意，这些例子是基于Spring框架的，因此你需要有一个Spring环境来运行它们。此外，SpEL表达式的语法和功能可能会随着Spring版本的更新而发生变化，因此建议查阅最新的Spring官方文档以获取最准确的信息。
