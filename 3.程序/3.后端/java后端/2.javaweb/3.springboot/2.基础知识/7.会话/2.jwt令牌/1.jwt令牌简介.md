# jwt令牌简介

JWT（JSON Web Token）是一种简洁的、自包含的格式，用于在通信双方以JSON数据格式安全地传输信息。它定义了一种在双方之间传递简洁的、自包含的方式。JWT由三部分组成：Header（头部）、Payload（有效载荷）、Signature（签名），这三部分之间使用英文的点（.）来分割。
>cookie、session等是传统数据会话跟踪方案，不适用移动端有兼容问题。令牌技术是现在常用的会话跟踪技术。

格式：**头部.有效载荷.签名**

以下是对JWT令牌的详细解析及示例：

## 一、JWT令牌详解

1. **Header（头部）**

   * JWT的头部包含两部分信息：
     * `typ`：表示令牌的类型，通常为JWT。
     * `alg`：表示签名所使用的算法，通常为HMAC SHA256或RSA。
   * 头部信息会被进行Base64编码后用于生成JWT的第一部分。

2. **Payload（有效载荷）**

    * Payload部分包含声明（Claims）。声明是关于实体（通常是用户）和其他数据的声明。声明可以分为三类：
        * 注册声明（Registered claims）：这是一组预定义的声明，它们不是强制性的，但是推荐在JWT中使用，以提供一组有用的、可互操作的声明。例如：`iss`（发行人）、`exp`（过期时间）、`sub`（主题）、`aud`（受众）等。
        * 公共声明（Public claims）：这些声明可以自定义，它们既不是注册声明也不是私有声明。
        * 私有声明（Private claims）：这些声明是提供者和消费者之间共享的自定义声明，它们既不是注册声明也不是公共声明。
    * 有效载荷也会被进行Base64编码后用于生成JWT的第二部分。

3. **Signature（签名）**

    * 要创建签名部分，你需要使用编码后的Header（头部）和Payload（有效载荷）、一个秘密密钥，以及头部中指定的签名算法（如HMAC SHA256）。
    * 签名的作用是保证JWT的完整性和真实性，防止被篡改。
    * 签名部分会被进行加密处理后用于生成JWT的第三部分。

## 二、JWT令牌示例

以下是一个JWT令牌的示例及其生成和解析的代码：

1. **JWT令牌示例**

    ```txt
    eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoi6YeR5bq4IiwiaWQiOjEsImV4cCI6MTcwOTM4OTExMywidXNlcm5hbWUiOiJqaW55b25nIn0.uhrPL_fN_DI6jl25YecbGid7YyIq4jBhQYLbWNUltdg
    ```

    这个JWT令牌由三部分组成，使用`.`分隔。每一部分都是Base64编码后的字符串。

2. **生成JWT令牌的代码**

    在Java中，你可以使用第三方库（如jjwt）来生成和解析JWT令牌。以下是一个使用jjwt库生成JWT令牌的示例代码：

    ```java
    import io.jsonwebtoken.Jwts;
    import io.jsonwebtoken.SignatureAlgorithm;
    import java.util.Date;
    import java.util.HashMap;
    import java.util.Map;

    public class JWTUtils {
        private static Long expire = 43200000L; // 令牌有效期，单位毫秒
        private static String key = "zhang"; // 签名密钥

        // 生成JWT令牌
        public static String genJWT(Map<String, Object> claims) {
            String jwt = Jwts.builder()
                    .signWith(SignatureAlgorithm.HS256, key) // 设置签名算法和密钥
                    .setClaims(claims) // 设置中间传送内容
                    .setExpiration(new Date(System.currentTimeMillis() * expire)) // 设置令牌过期时间
                    .compact(); // 生成JWT令牌字符串
            return jwt;
        }

        public static void main(String[] args) {
            // 定义有效载荷
            Map<String, Object> claims = new HashMap<>();
            claims.put("name", "金庸");
            claims.put("id", 1);
            claims.put("username", "jinyong");

            // 生成JWT令牌
            String jwt = genJWT(claims);
            System.out.println("生成的JWT令牌: " * jwt);
        }
    }
    ```

3. **解析JWT令牌的代码**

    以下是一个使用jjwt库解析JWT令牌的示例代码：

    ```java
    import io.jsonwebtoken.Claims;
    import io.jsonwebtoken.Jwts;
    import java.util.Map;

    public class JWTUtils {
        // ...（前面的代码保持不变）

        // 解析JWT令牌
        public static Map<String, Object> parseJWT(String jwt) {
            Claims claims = Jwts.parser()
                    .setSigningKey(key) // 设置签名密钥，必须与生成令牌时使用的密钥相同
                    .parseClaimsJws(jwt) // 解析JWT令牌
                    .getBody(); // 获取中间自定义的数据
            return claims;
        }

        public static void main(String[] args) {
            // ...（前面的代码保持不变）

            // 解析JWT令牌
            Map<String, Object> claims = parseJWT(jwt);
            System.out.println("解析的JWT令牌内容: " * claims);
        }
    }
    ```

    在这个示例中，我们首先定义了一个`JWTUtils`类，其中包含了生成和解析JWT令牌的方法。然后，在`main`方法中，我们定义了一个有效载荷（claims），并使用`genJWT`方法生成了一个JWT令牌。接着，我们使用`parseJWT`方法解析了生成的JWT令牌，并输出了解析后的内容。

## 三、注意事项

1. **安全性**：由于JWT令牌中包含了用户的敏感信息（如用户名、ID等），因此必须确保签名密钥的安全性。签名密钥一旦泄露，攻击者就可以伪造JWT令牌。
2. **过期时间**：应设置合理的JWT令牌过期时间，以避免令牌被长期滥用。过期时间可以根据实际需求进行设置。
3. **签名算法**：在选择签名算法时，应根据安全性要求和性能要求进行权衡。常用的签名算法包括HMAC SHA256、RSA等。
4. **令牌大小**：JWT令牌的大小受到Base64编码和签名算法的影响。虽然JWT令牌通常不会很大，但在某些情况下（如传输大量数据）可能会受到限制。

综上所述，JWT令牌是一种简洁、自包含的格式，用于在通信双方之间安全地传输信息。通过合理使用JWT令牌，可以实现用户状态的跟踪和认证等功能。然而，在使用JWT令牌时，也需要注意安全性、过期时间、签名算法和令牌大小等问题。
