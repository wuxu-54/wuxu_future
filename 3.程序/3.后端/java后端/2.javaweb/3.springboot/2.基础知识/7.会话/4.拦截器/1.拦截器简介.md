# Java Web拦截器详解及示例

## 一、拦截器概述

Java Web拦截器（Interceptor）是Java Web开发中一个重要的概念，它允许开发者在处理HTTP请求和响应之前或之后执行特定的代码，从而实现如权限检查、日志记录、事务管理等功能。拦截器可以作用于Java EE的Servlet、Spring框架、Struts2框架等，但通常提到拦截器都是基于Spring框架下的讨论。

## 二、拦截器的作用

在Spring框架中，拦截器主要有以下作用：

1. **预处理**：在控制器（Controller）方法执行之前进行预处理，可以进行权限校验、日志记录等。
2. **后处理**：在控制器方法执行之后、视图（View）返回之前进行处理，可以添加模型数据、处理异常等。
3. **完成处理**：在整个请求处理完成后执行，即视图渲染结束后，可以用于资源清理等操作。

## 三、拦截器的实现

在Spring MVC中，要定义一个拦截器，需要实现`HandlerInterceptor`接口或继承`HandlerInterceptorAdapter`类（注意：`HandlerInterceptorAdapter`在Spring 5.3版本被标记为废弃，推荐使用实现接口的方式）。`HandlerInterceptor`接口包含三个方法：

1. `preHandle()`：预处理回调方法，返回值为true时，请求继续传递；返回false时，请求处理流程中断。
2. `postHandle()`：后处理回调方法，可以进行异常检查并处理。
3. `afterCompletion()`：请求处理完成后回调方法，可以做资源清理工作。

## 四、示例代码

以下是一个简单的拦截器示例：

```java
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class MyInterceptor implements HandlerInterceptor {
    // 在Controller方法前进行预处理
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("Pre Handle method is Calling");
        // 返回true继续流程,返回false中断流程
        return true;
    }

    // 在Controller方法后,视图渲染前进行后处理
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println("Post Handle method is Calling");
    }

    // 请求完成后的回调方法,可用于资源清理
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println("Request and Response is completed");
    }
}
```

## 五、拦截器的注册

在Spring MVC配置中，需要将自定义的拦截器注册到拦截器链中。这可以通过实现`WebMvcConfigurer`接口并重写`addInterceptors`方法来完成：

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    @Autowired
    private MyInterceptor myInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(myInterceptor);
    }
}
```

## 六、拦截器与过滤器的区别

1. **运行位置**：过滤器是运行在Web服务器和Servlet容器之间的组件，可以拦截所有进出该容器的请求和响应；而拦截器则是针对具体的控制器方法进行拦截处理的，只在控制器内部执行。
2. **执行顺序**：过滤器的执行顺序是由其在`web.xml`文件中声明的顺序决定的；而拦截器的执行顺序是根据其在配置文件中的声明顺序决定的。
3. **功能**：过滤器主要用于对请求进行预处理和过滤，例如设置字符集、登录验证、日志记录等操作；而拦截器则主要用于对请求进行流程控制，例如权限验证、参数注入、异常处理等操作。
4. **依赖框架**：过滤器是基于Servlet规范实现的，不依赖任何特定的框架；而拦截器则通常是针对特定的框架或库实现的，例如Spring MVC框架中的拦截器。
