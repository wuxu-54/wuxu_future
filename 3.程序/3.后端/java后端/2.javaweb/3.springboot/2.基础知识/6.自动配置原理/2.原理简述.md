# 原理简述

Spring Boot的自动配置是其核心特性之一，它大大简化了Spring应用的配置过程。以下是Spring Boot自动配置原理的详细解释：

## 一、自动配置的核心注解

1. **@SpringBootApplication**

    * 这是Spring Boot项目的主注解，它包含了@SpringBootConfiguration、@EnableAutoConfiguration、@ComponentScan三个核心注解。
    * @SpringBootConfiguration：标注当前类为配置类，是`@Configuration`注解的封装。
    * @EnableAutoConfiguration：开启自动配置功能，是自动配置的核心注解。
    * @ComponentScan：配置组件扫描指令，用于扫描并注册Bean。

2. **@EnableAutoConfiguration**

    * 这个注解告诉Spring Boot开始查找添加了@Configuration注解的类，并自动配置它们。
    * 它通过@Import注解导入了AutoConfigurationImportSelector类，该类负责扫描并加载符合条件的自动配置类。

## 二、自动配置的实现原理

1. **扫描项目依赖**

    * 当应用启动时，Spring Boot会扫描项目依赖中的jar包，寻找包含spring.factories文件的项目。这些文件通常位于jar包的META-INF目录下。

2. **加载自动配置类**

    * 在spring.factories文件中，会列出一系列自动配置的类名。Spring Boot会读取这些类名，并通过反射机制将它们实例化并注册到Spring容器中。
    * 这些自动配置类通常使用@Configuration注解标注，并通过@Bean注解定义需要注册的Bean。

3. **条件化配置**

    * Spring Boot使用条件注解（如@ConditionalOnClass、@ConditionalOnBean等）来实现条件化配置。这些注解允许自动配置类在特定条件满足时才注册Bean。
    * 例如，@ConditionalOnClass注解会在指定的类存在于classpath时才注册Bean。

4. **外部配置**

    * Spring Boot允许使用properties或yaml文件来外部配置应用。这些配置可以与自动配置紧密结合，允许开发者覆盖自动配置的默认属性值。

## 三、自动配置的流程

1. **@SpringBootApplication注解**：标注在Spring Boot应用的启动类上，包含了自动配置所需的核心注解。
2. **@EnableAutoConfiguration注解**：通过@Import注解导入AutoConfigurationImportSelector类。
3. **AutoConfigurationImportSelector类**：扫描并加载符合条件的自动配置类。
4. **条件化配置**：使用条件注解根据特定条件注册Bean。
5. **外部配置**：读取并应用外部配置文件中的属性值。

## 四、总结

Spring Boot的自动配置原理主要依赖于注解、反射和条件化配置等机制。通过扫描项目依赖、加载自动配置类、条件化配置和外部配置等步骤，Spring Boot能够自动配置应用所需的Bean和属性，从而大大简化了Spring应用的配置过程。这使得开发者可以更快速地搭建和运行Spring应用，提高了开发效率。

---

## 装配注解

在 Spring Boot 中，自动配置是通过 `@EnableAutoConfiguration` 注解实现的，它会根据类路径下的 jar 包依赖自动配置 Spring Boot 的默认配置。`@Conditional` 注解族用于控制配置类是否应该被注册到 Spring 容器中，这些条件注解包括 `@ConditionalOnClass`、`@ConditionalOnBean`、`@ConditionalOnMissingBean`、`@ConditionalOnProperty` 等 。

1. 当你使用 `@ConditionalOnProperty` 注解时，你可以指定一个或多个属性名和期望的值（即配置文件中是否有某个属性或值）。如果属性存在并且匹配指定的值，则自动配置类会被注册到 Spring 容器中。例如，你可以这样使用它：

    ```java
    @Configuration
    @ConditionalOnProperty(prefix = "spring", name = "example.values", havingValue = "true")
    public class ExampleAutoConfiguration {
        // ...
    }
    ```

    如果 `spring.example.values` 属性设置为 "true"，则 `ExampleAutoConfiguration` 会被注册 。

2. `@ConditionalOnMissingBean` 注解确保当没有相应的 Bean 定义时，才会创建一个 Bean。例如：

    ```java
    @Configuration
    public class MyConfig {
        @Bean
        @ConditionalOnMissingBean(BClass.class)
        public AClass aClass() {
            // ...
        }
    }
    ```

    如果容器中没有 `BClass` 类型的 Bean，那么 `AClass` 就会被创建 。

3. `@ConditionalOnClass` 和 `@ConditionalOnMissingClass` 注解用于根据类路径上是否存在某个类来决定是否注册配置。例如：

    ```java
    @Configuration
    @ConditionalOnClass(DataSource.class)
    public class DataSourceConfig {
        // ...
    }
    ```

    如果 `DataSource.class` 存在于类路径上，那么 `DataSourceConfig` 就会被注册 。

这些条件注解可以组合使用，以实现复杂的自动配置逻辑。例如，你可以同时使用 `@ConditionalOnClass` 和 `@ConditionalOnMissingBean` 来确保只有在指定的类存在，并且没有相应的 Bean 定义时，才注册配置。
