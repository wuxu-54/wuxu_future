# 事务管理器

在 Spring 中，事务管理器（`PlatformTransactionManager`）是一个核心接口，它定义了事务管理的基本操作。事务管理器负责获取事务资源、提交事务和回滚事务。Spring 事务管理器的主要目的是提供一种一致的方式来管理不同的事务资源，如 JDBC、JTA、Hibernate、JPA 等。
>简单来说，可以将一组合并成为一个事务操作。比如 需要有多个数据库操作时，可以用事务，并且支持回滚，可以避免异常导致的数据问题。

## 事务管理器的职责

1. **开始事务**：通过调用 `getTransaction` 方法获取当前事务状态，如果当前没有事务，就创建一个新的事务。
2. **提交事务**：在事务成功完成时，通过调用 `commit` 方法提交事务。
3. **回滚事务**：在事务失败时，通过调用 `rollback` 方法回滚事务。

## 事务定义（`TransactionDefinition`）

事务定义包含了事务的属性，如传播行为、隔离级别、超时设置和回滚规则。这些属性可以通过 `@Transactional` 注解来配置。

## 事务状态（`TransactionStatus`）

事务状态用于跟踪当前事务的执行状态，包括事务资源（如数据库连接）和回滚标志。

## 事务传播行为

事务传播行为定义了当事务方法被另一个事务方法调用时，事务应该如何处理。Spring 支持多种传播行为，如 `REQUIRED`、`REQUIRES_NEW`、`NESTED` 等。

## 示例

以下是使用 `@Transactional` 注解的一个简单示例，它定义了一个事务管理器的 Bean，并在服务方法上应用了事务注解。

```java
@Configuration
@EnableTransactionManagement
public class TransactionConfig {
    @Bean
    public PlatformTransactionManager txManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}

@Service
public class MyService {
    @Transactional
    public void myTransactionalMethod() {
        // 业务逻辑代码
    }
}
```

在这个示例中，`myTransactionalMethod` 方法被 `@Transactional` 注解标记，这意味着该方法将在事务环境中执行。如果方法执行过程中抛出异常，默认情况下事务将被回滚。

## 事务管理器的实现

Spring 提供了多种 `PlatformTransactionManager` 的实现，例如 `DataSourceTransactionManager` 用于 JDBC 数据源，`JtaTransactionManager` 用于 JTA 数据源。开发者可以根据实际需求选择合适的事务管理器。

## 总结

Spring 的事务管理器提供了一种灵活、一致的方式来处理事务，无论是本地事务还是全局事务。通过 `@Transactional` 注解，开发者可以轻松地在代码中声明事务边界，而无需编写复杂的事务管理代码。
