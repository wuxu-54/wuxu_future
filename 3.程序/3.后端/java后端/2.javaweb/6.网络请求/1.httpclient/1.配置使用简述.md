# http client

在Java Web开发中，HttpClient框架是一个非常重要的工具，它用于发送HTTP请求并接收HTTP响应。以下是关于HttpClient框架的配置与使用的详细解释：
>后台服务也需要请求其他服务接口，这里使用http client 框架做请求。

## 一、HttpClient框架的配置

1. **引入依赖**：

   - 对于Java 11及以上的版本，HttpClient是Java标准库的一部分，因此无需额外引入依赖。
   - 对于Java 11之前的版本，需要使用第三方库，如Apache HttpClient。此时，需要在项目的构建文件中添加相应的依赖项。例如，在Maven项目中，可以在`pom.xml`文件中添加Apache HttpClient的依赖：

     ```xml
     <dependency>
       <groupId>org.apache.httpcomponents</groupId>
       <artifactId>httpclient</artifactId>
       <version>4.5.13</version> <!-- 请根据实际需要选择合适的版本 -->
     </dependency>
     ```

2. **创建HttpClient实例**：

   - 对于Java 11及以上的版本，可以使用`HttpClient.newBuilder()`方法来创建HttpClient实例，并配置相关的参数，如HTTP版本、代理、超时等。
   - 对于Apache HttpClient，可以使用`HttpClients.createDefault()`或`HttpClients.custom()`方法来创建HttpClient实例，并配置连接池、请求重试策略等。

3. **配置请求参数**：

   - 在创建HttpRequest对象时，需要设置请求的URI、方法（GET、POST等）、请求头、请求体等参数。
   - 对于Apache HttpClient，还可以使用`RequestConfig`类来配置请求的超时时间、连接请求时间等参数。

## 二、HttpClient框架的使用

1. **发送HTTP请求**：

   - 使用HttpClient实例的`send()`方法或`execute()`方法来发送HTTP请求。
   - 对于Java 11及以上的版本，`send()`方法返回一个`HttpResponse<T>`对象，其中T表示响应体的类型（如String、byte[]等）。
   - 对于Apache HttpClient，`execute()`方法返回一个`CloseableHttpResponse`对象。

2. **处理HTTP响应**：

   - 通过HttpResponse对象可以获取响应状态码、响应头和响应体等信息。
   - 对于Java 11及以上的版本，可以使用`HttpResponse.statusCode()`、`HttpResponse.headers()`、`HttpResponse.body()`等方法来获取这些信息。
   - 对于Apache HttpClient，可以使用`CloseableHttpResponse.getStatusLine().getStatusCode()`、`CloseableHttpResponse.getAllHeaders()`、`CloseableHttpResponse.getEntity()`等方法来获取这些信息。

3. **释放资源**：

   - 在处理完HTTP响应后，需要释放HttpClient和HttpResponse所占用的资源。这通常通过调用`close()`方法来实现。
   - 对于Java 11及以上的版本，HttpClient实例通常是可重用的，因此不需要在每次请求后都关闭它。但是，如果不再需要HttpClient实例，可以调用其`close()`方法来释放资源。
   - 对于Apache HttpClient，无论是HttpClient实例还是CloseableHttpResponse对象，都需要在使用完毕后调用其`close()`方法来释放资源。

## 三、示例代码

以下是一个使用Java 11的HttpClient发送GET请求的示例代码：

```java
import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;

public class HttpClientExample {
    public static void main(String[] args) throws Exception {
        // 创建HttpClient实例
        HttpClient httpClient = HttpClient.newBuilder().build();
        
        // 创建HttpRequest对象
        HttpRequest request = HttpRequest.newBuilder()
                .uri(URI.create("http://www.example.com"))
                .GET()
                .build();
        
        // 发送HTTP请求并获取响应
        HttpResponse<String> response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());
        
        // 处理HTTP响应
        if (response.statusCode() == 200) {
            System.out.println("Response Body: " + response.body());
        } else {
            System.out.println("Response Error: " + response.statusCode());
        }
        
        // 注意：在这个示例中，HttpClient实例是可重用的，因此不需要关闭它。
        // 但是，如果在实际应用中不再需要HttpClient实例，应该调用其close()方法来释放资源。
    }
}
```

对于Apache HttpClient的示例代码，可以参考以下代码段：

```java
import org.apache.http.HttpResponse;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;

public class ApacheHttpClientExample {
    public static void main(String[] args) throws Exception {
        // 创建CloseableHttpClient实例
        try (CloseableHttpClient httpClient = HttpClients.createDefault()) {
            
            // 创建HttpGet对象
            HttpGet httpGet = new HttpGet("http://www.example.com");
            
            // 发送HTTP请求并获取响应
            try (CloseableHttpResponse response = httpClient.execute(httpGet)) {
                
                // 处理HTTP响应
                if (response.getStatusLine().getStatusCode() == 200) {
                    String responseBody = EntityUtils.toString(response.getEntity(), "UTF-8");
                    System.out.println("Response Body: " + responseBody);
                } else {
                    System.out.println("Response Error: " + response.getStatusLine().getStatusCode());
                }
            }
        }
    }
}
```
