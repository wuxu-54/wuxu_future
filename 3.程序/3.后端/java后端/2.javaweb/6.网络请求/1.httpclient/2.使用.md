# HttpClient使用步骤

1. **创建HttpClient对象**：

    * 使用`HttpClients.createDefault()`方法创建一个默认的`CloseableHttpClient`对象。

2. **创建请求方法的实例，并指定请求URL**：

    * 如果需要发送GET请求，创建`HttpGet`对象。
    * 如果需要发送POST请求，创建`HttpPost`对象。

3. **设置请求参数**：

    * 对于GET请求，可以使用`URIBuilder`来构建URI，并通过`addParameter`方法添加查询参数。
    * 对于POST请求，可以使用`UrlEncodedFormEntity`来设置表单参数，或者通过`setEntity`方法设置其他类型的请求体。

4. **调用HttpClient对象的execute方法发送请求**：

    * `execute`方法返回一个`CloseableHttpResponse`对象，该对象包含了服务器的响应信息。

5. **处理响应**：

    * 调用`HttpResponse`的`getStatusLine()`方法获取响应状态码。
    * 调用`HttpResponse`的`getEntity()`方法获取`HttpEntity`对象，该对象包装了服务器的响应内容。
    * 使用`EntityUtils.toString()`方法将`HttpEntity`对象转换为字符串，以便进一步处理。

6. **释放连接**：

    * 无论请求是否成功，都需要调用`CloseableHttpResponse`和`CloseableHttpClient`的`close()`方法来释放资源。

## 示例代码

### 示例1：发送GET请求

```java
package com.example.httpclient;

import org.apache.http.client.config.RequestConfig;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;

import java.io.IOException;

public class HttpClientGetExample {
    public static void main(String[] args) {
        // 创建HttpClient对象
        CloseableHttpClient httpClient = HttpClients.createDefault();

        // 设置请求传输超时时间
        RequestConfig requestConfig = RequestConfig.custom()
                .setConnectTimeout(5000)
                .setConnectionRequestTimeout(5000)
                .setSocketTimeout(5000)
                .setRedirectsEnabled(true)
                .build();

        // 创建GET请求
        String url = "https://api.example.com/data";
        HttpGet httpGet = new HttpGet(url);
        httpGet.setConfig(requestConfig);

        // 执行请求
        try (CloseableHttpResponse httpResponse = httpClient.execute(httpGet)) {
            // 判断响应信息是否正确
            if (httpResponse.getStatusLine().getStatusCode() == 200) {
                String jsonResult = EntityUtils.toString(httpResponse.getEntity());
                // 处理响应内容
                System.out.println(jsonResult);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                httpClient.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```

### 示例2：发送POST请求

```java
package com.example.httpclient;

import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;

import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.HashMap;
import java.util.Map;

public class HttpClientPostExample {
    public static void main(String[] args) {
        // 创建HttpClient对象
        CloseableHttpClient httpClient = HttpClients.createDefault();

        // 创建POST请求
        String url = "https://api.example.com/submit";
        HttpPost httpPost = new HttpPost(url);

        // 设置请求参数（JSON格式）
        Map<String, String> paramMap = new HashMap<>();
        paramMap.put("key1", "value1");
        paramMap.put("key2", "value2");
        String jsonParam = "{\"key1\":\"value1\",\"key2\":\"value2\"}";
        httpPost.setEntity(new StringEntity(jsonParam, StandardCharsets.UTF_8));
        httpPost.setHeader("Content-type", "application/json");

        // 执行请求
        try (CloseableHttpResponse httpResponse = httpClient.execute(httpPost)) {
            // 判断响应信息是否正确
            if (httpResponse.getStatusLine().getStatusCode() == 200) {
                String jsonResult = EntityUtils.toString(httpResponse.getEntity());
                // 处理响应内容
                System.out.println(jsonResult);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                httpClient.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```

## 注意事项

1. **异常处理**：在实际开发中，需要妥善处理可能出现的异常，如IO异常、连接异常等。
2. **资源管理**：在使用完HttpClient和HttpResponse后，务必调用它们的`close()`方法来释放资源，避免内存泄漏。
3. **请求参数**：对于GET请求，参数通常放在URL的查询字符串中；对于POST请求，参数可以放在请求体中（如JSON、表单数据等）。
4. **安全性**：在发送敏感信息（如密码、密钥等）时，务必使用HTTPS协议来保障数据传输的安全性。
