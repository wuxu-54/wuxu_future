# 技术实现

通过NAS搭建个人网站是一个高效且经济的选择，以下是基于Java后台+Web网页的完整技术方案及实现步骤：

---

## 一、技术选型

| 模块        | 技术栈                                                                 |
|-------------|----------------------------------------------------------------------|
| 后端        | Spring Boot 3.x + Java 17（部署在Docker容器）                          |
| 前端        | React 18 + TypeScript + TailwindCSS（或Vue3）                         |
| 数据库      | MySQL 8.x / PostgreSQL 15（可选，若需数据持久化）                       |
| 容器化      | Docker + Docker Compose（NAS推荐使用Container Station/Portainer管理） |
| 网络        | Nginx反向代理 + Let's Encrypt SSL证书                                 |
| 存储        | NAS本地存储（通过Docker Volume映射）                                  |

---

## 二、详细步骤

### 1. NAS基础准备

```bash
# 在NAS中启用SSH访问（以群晖为例）
控制面板 -> 终端机和SNMP -> 启用SSH
# 创建网站专用目录
mkdir /volume1/webapps/my_website
```

![NAS目录结构示例](https://example.com/nas-dir-structure.png)

### 2. 后端服务搭建（Spring Boot）

```java
// 示例Controller（src/main/java/com/example/MyController.java）
@RestController
public class MyController {
    @GetMapping("/api/hello")
    public String hello() {
        return "Hello from NAS!";
    }
}
```

```dockerfile
# Dockerfile
FROM eclipse-temurin:17-jdk-jammy
WORKDIR /app
COPY target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","app.jar"]
```

### 3. 前端开发（React示例）

```typescript
// src/components/Home.tsx
export default function Home() {
  const [message, setMessage] = useState('');

  useEffect(() => {
    fetch('/api/hello')
      .then(res => res.text())
      .then(data => setMessage(data));
  }, []);

  return (
    <div className="p-4">
      <h1>{message}</h1>
    </div>
  );
}
```

### 4. Docker Compose编排

```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend

  reverse-proxy:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./certs:/etc/ssl/certs
```

### 5. Nginx配置（反向代理+HTTPS）

```nginx
# nginx.conf
server {
    listen 443 ssl;
    server_name yourdomain.com;

    ssl_certificate /etc/ssl/certs/fullchain.pem;
    ssl_certificate_key /etc/ssl/certs/privkey.pem;

    location /api {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
    }

    location / {
        proxy_pass http://frontend:3000;
        proxy_set_header Host $host;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

### 6. 部署与验证

```bash
# 构建并启动服务
docker-compose up -d --build

# 查看日志
docker-compose logs -f

# 验证服务（应返回200）
curl -I http://localhost:8080/api/health
```

---

## 三、关键注意事项

1. **网络配置**：
   - 在NAS路由器配置端口转发（80/443端口）
   - 建议使用DDNS服务（如群晖QuickConnect、No-IP）
   - 使用Certbot自动续签SSL证书

2. **性能优化**：

   ```dockerfile
   # 生产环境Dockerfile优化
   FROM eclipse-temurin:17-jre-jammy
   RUN jlink --add-modules java.base,java.logging \
            --strip-debug \
            --no-man-pages \
            --no-header-files \
            --compress=2 \
            --output /opt/java
   ```

3. **安全防护**：
   - 使用Spring Security配置JWT认证
   - 定期备份Docker Volume数据
   - 设置NAS防火墙规则

---

## 四、常见问题排查

1. **服务无法访问**：
   - 检查NAS防火墙设置
   - 验证Docker容器状态：`docker ps -a`
   - 查看容器日志：`docker logs <container_id>`

2. **数据库连接问题**：

   ```properties
   # application.properties配置示例
   spring.datasource.url=jdbc:mysql://mysql-container:3306/mydb
   spring.datasource.username=root
   spring.datasource.password=${DB_PASSWORD}
   ```

3. **前端资源加载失败**：
   - 检查Nginx代理配置
   - 确保构建时设置正确的`PUBLIC_URL`
   - 使用浏览器开发者工具查看Network请求

---

## 五、扩展方案

1. 集成GitLab CI/CD实现自动化部署
2. 添加监控系统（Prometheus + Grafana）
3. 实现文件存储对接NAS SMB/NFS服务
4. 配置Let's Encrypt自动续期证书

建议使用Portainer进行可视化容器管理，可大幅提升NAS Docker管理效率。
